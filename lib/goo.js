// Version 0.4
// Goo Engine. Copyright 2013 Goo Technologies AB
(function(window,undefined){ var f=function(){'use strict';define("goo/entities/components/Component",[],function(){return function(){this.enabled=!0}});
define("goo/addons/box2d/components/Box2DComponent",["goo/entities/components/Component"],function(g){function c(b){this.type="Box2DComponent";this.world=this.body=null;this.mass=1;this.settings=b||{};this.shape=b.shape?b.shape:"box";this.width=b.width?b.width:1;this.height=b.height?b.height:1;this.radius=b.radius?b.radius:1;this.vertices=b.vertices?b.vertices:[0,1,2,2,0,2];this.movable=b.movable===!0?!0:!1;this.friction=b.friction?b.friction:1;this.offsetX=b.offsetX?b.offsetX:0;this.offsetY=b.offsetY?
b.offsetY:0}c.prototype=Object.create(g.prototype);return c});
define("goo/entities/systems/System",[],function(){function g(c,b){this.type=c;this.interests=b;this._activeEntities=[];this.passive=!1}g.prototype.added=function(c){this._check(c)};g.prototype.changed=function(c){this._check(c)};g.prototype.removed=function(c){var b=this._activeEntities.indexOf(c);b!==-1&&(this._activeEntities.splice(b,1),this.deleted&&this.deleted(c))};g.prototype._check=function(c){var b=this.interests===null;if(!b&&this.interests.length<=c._components.length)for(var b=!0,a=0;a<
this.interests.length;a++){var d=this.interests[a].charAt(0).toLowerCase()+this.interests[a].substr(1);if(!c[d]){b=!1;break}}a=this._activeEntities.indexOf(c);b&&a===-1?(this._activeEntities.push(c),this.inserted&&this.inserted(c)):!b&&a!==-1&&(this._activeEntities.splice(a,1),this.deleted&&this.deleted(c))};g.prototype._process=function(c){this.process&&this.process(this._activeEntities,c)};return g});
define("goo/addons/box2d/systems/Box2DSystem",["goo/entities/systems/System"],function(g){function c(){g.call(this,"Box2DSystem",["Box2DComponent","MeshDataComponent"]);this.SCALE=0.5;this.world=new Box2D.b2World(new Box2D.b2Vec2(0,-9));this.sortVertexesClockWise=function(b,a){var d=Math.atan2(b.get_y(),b.get_x()),e=Math.atan2(a.get_y(),a.get_x());return d>e?1:-1};this.createPolygonShape=function(b){for(var a=new Box2D.b2PolygonShape,d=Box2D.allocate(b.length*8,"float",Box2D.ALLOC_STACK),e=0,f=0;f<
b.length;f++)Box2D.setValue(d+e,b[f].get_x(),"float"),Box2D.setValue(d+(e+4),b[f].get_y(),"float"),e+=8;d=Box2D.wrapPointer(d,Box2D.b2Vec2);a.Set(d,b.length);return a}}c.prototype=Object.create(g.prototype);c.prototype.inserted=function(b){var a=b.physics2DComponent,d=0,e=0,f=new Box2D.b2PolygonShape;if(a.shape==="box")f.SetAsBox(a.width*this.SCALE,a.height*this.SCALE);else if(a.shape==="circle")f=new Box2D.b2CircleShape,f.set_m_radius(a.radius);else if(a.shape==="mesh"){for(var j=b.meshDataComponent.meshData.getAttributeBuffer("POSITION"),
f=0,c=[],d=1E4,k=-1E4,e=1E4,i=-1E4;f<=j.length-3;){var g=j[f],m=j[++f];m<d&&(d=m);m>k&&(k=m);g<e&&(e=g);g>i&&(i=g);++f;b.transformComponent.updateWorldTransform();g=new Box2D.b2Vec2(g,m);c.push(g)}f=this.createPolygonShape(c);d=Math.abs(k-d);e=Math.abs(i-e)}else if(a.shape==="polygon"){c=[];for(f=0;f<=a.vertices.length-2;)g=new Box2D.b2Vec2(a.vertices[f],a.vertices[++f]),c.push(g),++f;f=this.createPolygonShape(c);console.log(c)}c=new Box2D.b2FixtureDef;c.set_shape(f);c.set_density(1);c.set_friction(a.friction);
f=new Box2D.b2BodyDef;a.movable===!0&&f.set_type(Box2D.b2_dynamicBody);f.set_position(new Box2D.b2Vec2(b.transformComponent.transform.translation.x+a.offsetX,b.transformComponent.transform.translation.y+a.offsetY));f=this.world.CreateBody(f);f.CreateFixture(c);f.SetLinearDamping(0.95);f.SetAngularDamping(0.6);a.body=f;a.world=this.world;b.body=f;b.body.h=d;b.body.w=e};c.prototype.deleted=function(){};c.prototype.process=function(b,a){this.world.Step(a,2,2);for(var d=0;d<b.length;d++){var e=b[d].body.GetPosition();
b[d].transformComponent.transform.translation.y=e.get_y()-b[d].physics2DComponent.offsetY;b[d].transformComponent.transform.translation.x=e.get_x()-b[d].physics2DComponent.offsetX;b[d].transformComponent.setUpdated();b[d].transformComponent.transform.rotation.z=b[d].body.GetAngle();e.get_y()>100&&b[d].body.ApplyForce(new Box2D.b2Vec2(0,-100),b[d].body.GetPosition())}};return c});
define("goo/addons/cannon/components/CannonjsComponent",["goo/entities/components/Component"],function(g){function c(b){this.type="CannonjsComponent";this.settings=b||{};this.mass=b.mass!==void 0?b.mass:0;this.useBounds=b.useBounds!==void 0?b.useBounds:!1;this.linearDamping=b.linearDamping!==void 0?b.linearDamping:0;this.angularDamping=b.angularDamping!==void 0?b.angularDamping:0}c.prototype=Object.create(g.prototype);return c});
define("goo/math/MathUtils",[],function(){function g(){}g.DEG_TO_RAD=Math.PI/180;g.RAD_TO_DEG=180/Math.PI;g.HALF_PI=0.5*Math.PI;g.TWO_PI=2*Math.PI;g.EPSILON=1.0E-7;g.radFromDeg=function(c){return c*g.DEG_TO_RAD};g.degFromRad=function(c){return c*g.RAD_TO_DEG};g.lerp=function(c,b,a){return b===a?b:b+(a-b)*c};g.clamp=function(c,b,a){return b<a?c<b?b:c>a?a:c:c<a?a:c>b?b:c};g.moduloPositive=function(c,b){var a=c%b;a+=a<0?b:0;return a};g.scurve3=function(c){return(-2*c+3)*c*c};g.scurve5=function(c){return((6*
c-15)*c+10)*c*c*c};g.sphericalToCartesian=function(c,b,a,d){var e=c*Math.cos(a);d.x=e*Math.cos(b);d.y=c*Math.sin(a);d.z=e*Math.sin(b)};g.cartesianToSpherical=function(c,b,a,d){var e=Math.sqrt(c*c+a*a);d.x=Math.sqrt(c*c+b*b+a*a);d.y=Math.atan2(a,c);d.z=Math.atan2(b,e)};g.getTriangleNormal=function(c,b,a,d,e,f,j,h,k){d-=c;e-=b;f-=a;c=j-c;b=h-b;a=k-a;return[e*a-f*b,f*c-d*a,d*b-e*c]};return g});
define("goo/math/Vector",["goo/math/MathUtils"],function(g){function c(b){this.data=new Float32Array(b||0)}c.prototype.setupAliases=function(b){for(var a=this,d=0;d<b.length;d++)(function(e){for(var f=0;f<b[e].length;f++)Object.defineProperty(a,b[e][f],{get:function(){return this.data[e]},set:function(a){this.data[e]=a}});Object.defineProperty(a,d,{get:function(){return this.data[e]},set:function(a){this.data[e]=a}})})(d)};c.add=function(b,a,d){var b=b.data||b,a=a.data||a,e=b.length;d||(d=new c(e));
if(a.length!==e||d.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var f=0;f<e;f++)d.data[f]=b[f]+a[f];return d};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,d){var b=b.data||b,a=a.data||a,e=b.length;d||(d=new c(e));if(a.length!==e||d.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var f=0;f<e;f++)d.data[f]=b[f]-a[f];return d};c.prototype.sub=function(b){return c.sub(this,
b,this)};c.mul=function(b,a,d){var b=b.data||b,a=a.data||a,e=b.length;d||(d=new c(e));if(a.length!==e||d.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var f=0;f<e;f++)d.data[f]=b[f]*a[f];return d};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,d){var b=b.data||b,a=a.data||a,e=b.length;d||(d=new c(e));if(a.length!==e||d.data.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var f=0;f<e;f++)d.data[f]=b[f]/a[f];return d};c.prototype.div=function(b){return c.div(this,b,this)};c.copy=function(b,a){var d=b.data.length;a||(a=new c(d));if(a.data.length!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};c.prototype.copy=function(b){return c.copy(b,this)};c.dot=function(b,a){var d=b.data||b,e=a.data||a,f=d.length;if(e.length!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var j=0,c=0;c<f;c++)j+=d[c]*e[c];return j};c.prototype.dot=function(b){return c.dot(this,b)};c.apply=function(b,a,d){var e=b.rows,f=b.cols,j=a.data.length;d||(d=new c(e));if(d.data.length!==e||f!==j)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(d===a)return c.copy(c.apply(b,a),d);for(var h=0;h<f;h++)for(var k=h*e,i=0;i<e;i++){for(var g=0,m=0;m<j;m++)g+=b.data[m*b.rows+i]*a.data[m];d.data[k+i]=g}return d};c.prototype.apply=function(b){return c.apply(b,this,
this)};c.equals=function(b,a){var d=b.data.length;if(d!==a.data.length)return!1;for(var e=0;e<d;e++)if(Math.abs(b.data[e]-a.data[e])>g.EPSILON)return!1;return!0};c.prototype.equals=function(b){return c.equals(this,b)};c.distanceSquared=function(b,a){return c.sub(b,a).lengthSquared()};c.prototype.distanceSquared=function(b){return c.sub(this,b).lengthSquared()};c.distance=function(b,a){return c.sub(b,a).length()};c.prototype.distance=function(b){return c.sub(this,b).length()};c.prototype.lengthSquared=
function(){return c.dot(this,this)};c.prototype.length=function(){return Math.sqrt(c.dot(this,this))};c.prototype.scale=function(b){for(var a=this.data.length-1;a>=0;a--)this.data[a]*=b;return this};c.prototype.invert=function(){for(var b=0;b<this.data.length;b++)this.data[b]=0-this.data[b];return this};c.prototype.normalize=function(){var b=this.length(),a=this.data.length;if(b<g.EPSILON)for(var d=0;d<a;d++)this.data[d]=0;else{b=1/b;for(d=0;d<a;d++)this.data[d]*=b}return this};c.prototype.clone=
function(){return c.copy(this)};c.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof c)this.copy(arguments[0]);else if(arguments[0].length>1)for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];else this.set(arguments[0][0]);else for(b=0;b<arguments.length;b++)this.data[b]=arguments[b];return this};c.prototype.toString=function(){var b="";b+="[";for(var a=0;a<this.data.length;a++)b+=this.data[a],b+=a!==this.data.length-1?", ":"";
b+="]";return b};return c});
define("goo/math/Vector3",["goo/math/Vector"],function(g){function c(){g.call(this,3);arguments.length!==0?this.set(arguments):this.setd(0,0,0)}c.prototype=Object.create(g.prototype);c.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]);c.ZERO=new c(0,0,0);c.ONE=new c(1,1,1);c.UNIT_X=new c(1,0,0);c.UNIT_Y=new c(0,1,0);c.UNIT_Z=new c(0,0,1);c.add=function(b,a,d){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==
3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};d.data[0]=b[0]+a[0];d.data[1]=b[1]+a[1];d.data[2]=b[2]+a[2];return d};c.addv=function(b,a,d){d||(d=new c);d.data[0]=b.data[0]+a.data[0];d.data[1]=b.data[1]+a.data[1];d.data[2]=b.data[2]+a.data[2];return d};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,d){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",
message:"The arguments are of incompatible sizes."};d.data[0]=b[0]-a[0];d.data[1]=b[1]-a[1];d.data[2]=b[2]-a[2];return d};c.subv=function(b,a,d){d||(d=new c);d.data[0]=b.data[0]-a.data[0];d.data[1]=b.data[1]-a.data[1];d.data[2]=b.data[2]-a.data[2];return d};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,d){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
d.data[0]=b[0]*a[0];d.data[1]=b[1]*a[1];d.data[2]=b[2]*a[2];return d};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,d){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};d.data[0]=b[0]/a[0];d.data[1]=b[1]/a[1];d.data[2]=b[2]/a[2];return d};c.prototype.div=function(b){return c.div(this,b,this)};c.dot=function(b,
a){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);var d=b.data||b,e=a.data||a;if(d.length!==3||e.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var f=0;f+=d[0]*e[0];f+=d[1]*e[1];f+=d[2]*e[2];return f};c.prototype.dot=function(b){return c.dot(this,b)};c.cross=function(b,a,d){d||(d=new c);var e=a.data||a;if((b.data||b).length!==3||e.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var e=a.data[0]*
b.data[2]-a.data[2]*b.data[0],f=a.data[1]*b.data[0]-a.data[0]*b.data[1];d.data[0]=a.data[2]*b.data[1]-a.data[1]*b.data[2];d.data[1]=e;d.data[2]=f;return d};c.prototype.cross=function(b){return c.cross(this,b,this)};c.prototype.lerp=function(b,a){this.data[0]=(1-a)*this.data[0]+a*b.data[0];this.data[1]=(1-a)*this.data[1]+a*b.data[1];this.data[2]=(1-a)*this.data[2]+a*b.data[2];return this};c.prototype.setd=function(b,a,d){this.data[0]=b;this.data[1]=a;this.data[2]=d;return this};c.prototype.seta=function(b){this.data[0]=
b[0];this.data[1]=b[1];this.data[2]=b[2];return this};c.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];this.data[2]=b.data[2];return this};c.prototype.add_d=function(b,a,d){this.data[0]+=b;this.data[1]+=a;this.data[2]+=d;return this};c.prototype.addv=function(b){this.data[0]+=b.data[0];this.data[1]+=b.data[1];this.data[2]+=b.data[2];return this};c.prototype.mulv=function(b){this.data[0]*=b.data[0];this.data[1]*=b.data[1];this.data[2]*=b.data[2];return this};c.prototype.muld=
function(b,a,d){this.data[0]*=b;this.data[1]*=a;this.data[2]*=d;return this};c.prototype.subv=function(b){this.data[0]-=b.data[0];this.data[1]-=b.data[1];this.data[2]-=b.data[2];return this};c.prototype.sub_d=function(b,a,d){this.data[0]-=b;this.data[1]-=a;this.data[2]-=d;return this};c.prototype.lengthSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]};return c});
define("goo/renderer/bounds/BoundingVolume",["goo/math/Vector3"],function(g){function c(b){this.center=new g;b!==void 0&&this.center.setv(b);this.min=new g(Infinity,Infinity,Infinity);this.max=new g(-Infinity,-Infinity,-Infinity)}c.Outside=0;c.Inside=1;c.Intersects=2;return c});
define("goo/renderer/bounds/BoundingBox",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/math/MathUtils"],function(g,c,b){function a(a,e,f,b){c.call(this,a);this.xExtent=e!==void 0?e:1;this.yExtent=f!==void 0?f:1;this.zExtent=b!==void 0?b:1;this._compVect1=new g;this._compVect2=new g;this.vec=new g;this.corners=[];for(a=0;a<8;a++)this.corners.push(new g)}a.prototype=Object.create(c.prototype);a.prototype.computeFromPoints=function(a){var e=this.min,f=this.max,b=this.vec;e.setd(Infinity,
Infinity,Infinity);f.setd(-Infinity,-Infinity,-Infinity);for(var c,k,i,g=0;g<a.length;g+=3)c=a[g+0],k=a[g+1],i=a[g+2],e.x=c<e.x?c:e.x,e.y=k<e.y?k:e.y,e.z=i<e.z?i:e.z,f.x=c>f.x?c:f.x,f.y=k>f.y?k:f.y,f.z=i>f.z?i:f.z;b.setv(f).subv(e).div(2);this.xExtent=b.x;this.yExtent=b.y;this.zExtent=b.z;this.center.setv(f).addv(e).div(2)};a.prototype.computeFromPrimitives=function(d,e,f,b,c){if(!(c-b<=0)){for(var g=this._compVect1.set(Infinity,Infinity,Infinity),i=this._compVect2.set(-Infinity,-Infinity,-Infinity),
l=[];b<c;b++)for(var l=d.getPrimitiveVertices(f[b],e,l),m=0;m<l.length;m++)a.checkMinMax(g,i,l[m]);this.center.copy(g.add(i));this.center.mul(0.5);this.xExtent=i.x-this.center.x;this.yExtent=i.y-this.center.y;this.zExtent=i.z-this.center.z}};a.checkMinMax=function(a,e,f){if(f.x<a.x)a.x=f.x;if(f.x>e.x)e.x=f.x;if(f.y<a.y)a.y=f.y;if(f.y>e.y)e.y=f.y;if(f.z<a.z)a.z=f.z;if(f.z>e.z)e.z=f.z};a.prototype.transform=function(d,e){e===null&&(e=new a);var f=this.corners;this.getCorners(f);for(var b=0;b<f.length;b++)d.matrix.applyPostPoint(f[b]);
for(var c=f[0].data[0],g=f[0].data[1],i=f[0].data[2],l=c,m=g,o=i,b=1;b<f.length;b++)var p=f[b].data[0],n=f[b].data[1],r=f[b].data[2],c=Math.min(c,p),g=Math.min(g,n),i=Math.min(i,r),l=Math.max(l,p),m=Math.max(m,n),o=Math.max(o,r);f=(l+c)*0.5;g=(m+g)*0.5;i=(o+i)*0.5;e.center.setd(f,g,i);e.xExtent=l-f;e.yExtent=m-g;e.zExtent=o-i;return e};a.prototype.getCorners=function(a){if(!a||a.length!==8)for(var a=[],e=0;e<a.length;e++)a.push(new g);a[0].setd(this.center.data[0]+this.xExtent,this.center.data[1]+
this.yExtent,this.center.data[2]+this.zExtent);a[1].setd(this.center.data[0]+this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent);a[2].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent);a[3].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent);a[4].setd(this.center.data[0]-this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]+this.zExtent);a[5].setd(this.center.data[0]-
this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent);a[6].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent);a[7].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent);return a};a.prototype.whichSide=function(a){var e=a.normal.data,f=this.center.data,b=Math.abs(this.xExtent*e[0])+Math.abs(this.yExtent*e[1])+Math.abs(this.zExtent*e[2]),a=e[0]*f[0]+e[1]*f[1]+e[2]*f[2]-
a.constant;return a<-b?c.Inside:a>b?c.Outside:c.Intersects};a.prototype._pseudoDistance=function(a,e){var f=a.normal.data,b=e.data;return f[0]*b[0]+f[1]*b[1]+f[2]*b[2]-a.constant};a.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))};a.prototype.toString=function(){var a=Math.round(this.center.x*10)/10,e=Math.round(this.center.y*10)/10,f=Math.round(this.center.z*10)/10;return"["+a+","+e+","+f+"] - ["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"};
a.prototype.intersects=function(a){return a.intersectsBoundingBox(this)};a.prototype.intersectsBoundingBox=function(a){return this.center.x+this.xExtent<a.center.x-a.xExtent||this.center.x-this.xExtent>a.center.x+a.xExtent?!1:this.center.y+this.yExtent<a.center.y-a.yExtent||this.center.y-this.yExtent>a.center.y+a.yExtent?!1:this.center.z+this.zExtent<a.center.z-a.zExtent||this.center.z-this.zExtent>a.center.z+a.zExtent?!1:!0};a.prototype.intersectsSphere=function(a){return Math.abs(this.center.x-
a.center.x)<a.radius+this.xExtent&&Math.abs(this.center.y-a.center.y)<a.radius+this.yExtent&&Math.abs(this.center.z-a.center.z)<a.radius+this.zExtent?!0:!1};a.prototype.testStaticAABBAABB=function(a,e){var f={mtvDistance:1E10,mtvAxis:new g};if(!this.testAxisStatic(g.UNIT_X,this.center.x-this.xExtent,this.center.x+this.xExtent,a.center.x-a.xExtent,a.center.x+a.xExtent,f))return!1;if(!this.testAxisStatic(g.UNIT_Y,this.center.y-this.yExtent,this.center.y+this.yExtent,a.center.y-a.yExtent,a.center.y+
a.yExtent,f))return!1;if(!this.testAxisStatic(g.UNIT_Z,this.center.z-this.zExtent,this.center.z+this.zExtent,a.center.z-a.zExtent,a.center.z+a.zExtent,f))return!1;if(e)e.isIntersecting=!0,e.normal=f.mtvAxis,e.penetration=Math.sqrt(f.mtvDistance)*1.001;return!0};a.prototype.testAxisStatic=function(a,e,f,b,c,k){var i=g.dot(a,a);if(i<1.0E-6)return!0;e=c-e;f-=b;if(e<=0||f<=0)return!1;f=e<f?e:-f;i=(new g).copy(a).mul(f/i);i=g.dot(i,i);if(i<k.mtvDistance)k.mtvDistance=i,k.mtvAxis=a;return!0};a.prototype.intersectsRay=
function(d){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return!1;var e=this._compVect1.setv(d.origin).subv(this.center),d=d.direction,f=[0,Infinity],j=this.xExtent;if(j<b.ZERO_TOLERANCE&&j>=0)j=b.ZERO_TOLERANCE;var c=this.yExtent;if(c<b.ZERO_TOLERANCE&&c>=0)c=b.ZERO_TOLERANCE;var g=this.zExtent;if(g<b.ZERO_TOLERANCE&&g>=0)g=b.ZERO_TOLERANCE;return a.clip(d.data[0],-e.data[0]-j,f)&&a.clip(-d.data[0],e.data[0]-j,f)&&a.clip(d.data[1],-e.data[1]-c,f)&&a.clip(-d.data[1],e.data[1]-
c,f)&&a.clip(d.data[2],-e.data[2]-g,f)&&a.clip(-d.data[2],e.data[2]-g,f)&&(f[0]!==0||f[1]!==Infinity)?!0:!1};a.prototype.intersectsRayWhere=function(d){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var e=g.sub(d.origin,this.center,this._compVect1),f=d.direction,j=[0,Infinity],c=this.xExtent;if(c<b.ZERO_TOLERANCE&&c>=0)c=b.ZERO_TOLERANCE;var k=this.yExtent;if(k<b.ZERO_TOLERANCE&&k>=0)k=b.ZERO_TOLERANCE;var i=this.zExtent;if(i<b.ZERO_TOLERANCE&&i>=0)i=b.ZERO_TOLERANCE;
if(a.clip(f.x,-e.x-c,j)&&a.clip(-f.x,e.x-c,j)&&a.clip(f.y,-e.y-k,j)&&a.clip(-f.y,e.y-k,j)&&a.clip(f.z,-e.z-i,j)&&a.clip(-f.z,e.z-i,j)&&(j[0]!==0||j[1]!==Infinity)){if(j[1]>j[0])return e=j,d=[(new g(d.direction)).mul(e[0]).add(d.origin),(new g(d.direction)).mul(e[1]).add(d.origin)],{distances:e,points:d};e=[j[0]];d=[(new g(d.direction)).mul(e[0]).add(d.origin)];return{distances:e,points:d}}return null};a.clip=function(a,e,f){if(a>0){if(e>a*f[1])return!1;e>a*f[0]&&(f[0]=e/a);return!0}else if(a<0){if(e>
a*f[0])return!1;e>a*f[1]&&(f[1]=e/a);return!0}else return e<=0};a.prototype.merge=function(d){return d instanceof a?this.mergeBox(d.center,d.xExtent,d.yExtent,d.zExtent,this):this.mergeBox(d.center,d.radius,d.radius,d.radius,this)};a.prototype.mergeBox=function(d,e,f,b,c){c||(c=new a);var g=this._compVect1,i=this._compVect2;g.x=this.center.x-this.xExtent;if(g.x>d.x-e)g.x=d.x-e;g.y=this.center.y-this.yExtent;if(g.y>d.y-f)g.y=d.y-f;g.z=this.center.z-this.zExtent;if(g.z>d.z-b)g.z=d.z-b;i.x=this.center.x+
this.xExtent;if(i.x<d.x+e)i.x=d.x+e;i.y=this.center.y+this.yExtent;if(i.y<d.y+f)i.y=d.y+f;i.z=this.center.z+this.zExtent;if(i.z<d.z+b)i.z=d.z+b;c.center.set(i).addv(g).muld(0.5,0.5,0.5);c.xExtent=i.x-c.center.x;c.yExtent=i.y-c.center.y;c.zExtent=i.z-c.center.z;return c};a.prototype.clone=function(d){return d&&d instanceof a?(d.center.setv(this.center),d.xExtent=this.xExtent,d.yExtent=this.yExtent,d.zExtent=this.zExtent,d):new a(this.center,this.xExtent,this.yExtent,this.zExtent)};return a});
define("goo/renderer/BufferData",[],function(){function g(c,b){this.data=c;this.target=b;this.glBuffer=null;this._dataUsage="StaticDraw";this._dataNeedsRefresh=!1}g.prototype.setDataUsage=function(c){this._dataUsage=c};g.prototype.setDataNeedsRefresh=function(){this._dataNeedsRefresh=!0};return g});
define("goo/renderer/Util",[],function(){function g(){}g.getByteSize=function(c){switch(c){case "Byte":return 1;case "UnsignedByte":return 1;case "Short":return 2;case "UnsignedShort":return 2;case "Int":return 4;case "HalfFloat":return 2;case "Float":return 4;case "Double":return 8;default:throw"Unknown type: "+c;}};g.checkGLError=function(c){for(var b=c.getError(),a=!1;b!==c.NO_ERROR;){a=!0;if(b===c.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===c.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===c.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===c.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===c.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";b=c.getError()}if(a)throw"Stopping due to error";};g.isPowerOfTwo=function(c){return(c&c-1)===0};g.nearestPowerOfTwo=function(c){return Math.pow(2,Math.ceil(Math.log(c)/Math.log(2)))};g.clone=function(c){if(c===null||typeof c!=="object")return c;if(c instanceof Uint8Array)return c;if(c instanceof Date){var b=
new Date;b.setTime(c.getTime());return b}if(c instanceof Array){for(var b=[],a=0,d=c.length;a<d;++a)b[a]=g.clone(c[a]);return b}if(c instanceof Object){b={};for(a in c)c.hasOwnProperty(a)&&(b[a]=g.clone(c[a]));return b}throw Error("Unable to copy obj! Its type isn't supported.");};return g});
define("goo/renderer/BufferUtils",[],function(){function g(){}g.createIndexBuffer=function(c,b){var a;if(b<256)a=new Uint8Array(c);else if(b<65536)a=new Uint16Array(c);else throw Error("Maximum number of vertices is 65535. Got: "+b);return a};return g});
define("goo/math/Vector2",["goo/math/Vector"],function(g){function c(){g.call(this,2);arguments.length!==0?this.set(arguments):this.setd(0,0)}c.prototype=Object.create(g.prototype);c.prototype.setupAliases([["x","u","s"],["y","v","t"]]);c.ZERO=new c(0,0);c.ONE=new c(1,1);c.UNIT_X=new c(1,0);c.UNIT_Y=new c(0,1);c.add=function(b,a,d){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
d.data[0]=b[0]+a[0];d.data[1]=b[1]+a[1];return d};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,d){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};d.data[0]=b[0]-a[0];d.data[1]=b[1]-a[1];return d};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,d){typeof b==="number"&&(b=[b,b]);typeof a===
"number"&&(a=[a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};d.data[0]=b[0]*a[0];d.data[1]=b[1]*a[1];return d};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,d){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
d.data[0]=b[0]/a[0];d.data[1]=b[1]/a[1];return d};c.prototype.div=function(b){return c.div(this,b,this)};c.dot=function(b,a){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);var d=b.data||b,e=a.data||a;if(d.length!==2||e.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var f=0;f+=d[0]*e[0];f+=d[1]*e[1];return f};c.prototype.dot=function(b){return c.dot(this,b)};c.prototype.setd=function(b,a){this.data[0]=b;this.data[1]=a;return this};c.prototype.seta=
function(b){this.data[0]=b[0];this.data[1]=b[1];return this};c.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];return this};return c});
define("goo/math/Vector4",["goo/math/Vector"],function(g){function c(){g.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,0)}c.prototype=Object.create(g.prototype);c.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]);c.ZERO=new c(0,0,0,0);c.ONE=new c(1,1,1,1);c.UNIT_X=new c(1,0,0,0);c.UNIT_Y=new c(0,1,0,0);c.UNIT_Z=new c(0,0,1,0);c.UNIT_W=new c(0,0,0,1);c.add=function(b,a,d){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);d||(d=new c);b=b.data||
b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};d.data[0]=b[0]+a[0];d.data[1]=b[1]+a[1];d.data[2]=b[2]+a[2];d.data[3]=b[3]+a[3];return d};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,d){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
d.data[0]=b[0]-a[0];d.data[1]=b[1]-a[1];d.data[2]=b[2]-a[2];d.data[3]=b[3]-a[3];return d};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,d){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};d.data[0]=b[0]*a[0];d.data[1]=b[1]*a[1];d.data[2]=b[2]*a[2];d.data[3]=b[3]*a[3];return d};c.prototype.mul=function(b){return c.mul(this,
b,this)};c.div=function(b,a,d){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);d||(d=new c);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};d.data[0]=b[0]/a[0];d.data[1]=b[1]/a[1];d.data[2]=b[2]/a[2];d.data[3]=b[3]/a[3];return d};c.prototype.div=function(b){return c.div(this,b,this)};c.dot=function(b,a){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);var d=b.data||b,
e=a.data||a;if(d.length!==4||e.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var f=0;f+=d[0]*e[0];f+=d[1]*e[1];f+=d[2]*e[2];f+=d[3]*e[3];return f};c.prototype.dot=function(b){return c.dot(this,b)};c.prototype.lerp=function(b,a){this.x=(1-a)*this.x+a*b.x;this.y=(1-a)*this.y+a*b.y;this.z=(1-a)*this.z+a*b.z;this.w=(1-a)*this.w+a*b.w;return this};c.prototype.setd=function(b,a,d,e){this.data[0]=b;this.data[1]=a;this.data[2]=d;this.data[3]=e;return this};
c.prototype.seta=function(b){this.data[0]=b[0];this.data[1]=b[1];this.data[2]=b[2];this.data[3]=b[3];return this};c.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];this.data[2]=b.data[2];this.data[3]=b.data[3];return this};return c});
define("goo/renderer/MeshData","goo/renderer/BufferData,goo/renderer/Util,goo/renderer/BufferUtils,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4".split(","),function(g,c,b,a,d,e){function f(a,e,d){this.attributeMap=a;this.vertexCount=e!==void 0?e:0;this.indexCount=d!==void 0?d:0;this.primitiveCounts=[0];this.indexData=this.vertexData=null;this.dataViews={};this.indexLengths=null;this.indexModes=["Triangles"];this.type=f.MESH;this.rebuildData(this.vertexCount,this.indexCount)}function j(a){for(var e=
{},f=0;f<a.length;f++){var d=a[f];if(o[d]!==void 0)e[d]=c.clone(o[d]);else throw"No default attribute named: "+d;}return e}var h=window.Uint8ClampedArray;f.MESH=0;f.SKINMESH=1;f.prototype.rebuildData=function(a,e,f){var d={},b=null;if(f){for(var j in this.attributeMap){var c=this.dataViews[j];c&&(d[j]=c)}if(this.indexData)b=this.indexData.data}this.rebuildVertexData(a);this.rebuildIndexData(e);if(f){for(j in this.attributeMap)if(a=d[j])c=this.dataViews[j],c.set(a);b&&this.indexData.data.set(b)}};
f.prototype.rebuildVertexData=function(a){if(!isNaN(a))this._vertexCountStore=this.vertexCount=a;if(this.vertexCount>0){var a=0,e;for(e in this.attributeMap){var f=this.attributeMap[e];a+=c.getByteSize(f.type)*f.count}this.vertexData=new g(new ArrayBuffer(a*this.vertexCount),"ArrayBuffer");this.generateAttributeData()}};f.prototype.rebuildIndexData=function(a){if(a!==void 0)this.indexCount=a;if(this.indexCount>0)a=b.createIndexBuffer(this.indexCount,this.vertexCount),this.indexData=new g(a,"ElementArrayBuffer")};
f.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=!0};f.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1};f.prototype.getPrimitiveCount=function(a){return a>=0&&a<this.primitiveCounts.length?this.primitiveCounts[a]:0};f.prototype.getPrimitiveVertices=function(a,e,b){var j=this.getPrimitiveCount(e);if(a>=j||a<0)throw Error("Invalid primitiveIndex '"+a+"'.  Count is "+j);j=f.getVertexCount(this.indexModes[e]);if(!b||b.length<j)b=[];
for(var c=this.getAttributeBuffer(f.POSITION),h=0;h<j;h++){b[h]||(b[h]=new d);var g=this.getIndexBuffer()?this.getIndexBuffer()[this.getVertexIndex(a,h,e)]:this.getVertexIndex(a,h,e);b[h].x=c[g*3+0];b[h].y=c[g*3+1];b[h].z=c[g*3+2]}return b};f.prototype.getVertexIndex=function(a,e,d){for(var b=0,j=0;j<d;j++)b+=this.indexLengths[j];switch(this.indexModes[d]){case "Triangles":b+=a*3+e;break;case "TriangleStrip":b+=a+e;break;case "TriangleFan":b+=e===0?0:a+e;break;case "Points":b+=a;break;case "Lines":b+=
a*2+e;break;case "LineStrip":case "LineLoop":b+=a+e;break;default:return f.logger.warning("unimplemented index mode: "+this.indexModes[d]),-1}return b};f.prototype.getTotalPrimitiveCount=function(){for(var a=0,e=0,f=this.primitiveCounts.length;e<f;e++)a+=this.primitiveCounts[e];return a};f.prototype.updatePrimitiveCounts=function(){var a=this.indexData?this.indexData.data.length:this.vertexCount,e=this.getSectionCount();if(this.primitiveCounts.length!==e)this.primitiveCounts=[];for(var d=0;d<e;d++){var b=
f.getPrimitiveCount(this.indexModes[d],this.indexLengths?this.indexLengths[d]:a);this.primitiveCounts[d]=b}};f.getPrimitiveCount=function(a,e){switch(a){case "Triangles":return e/3;case "TriangleFan":case "TriangleStrip":return e-2;case "Lines":return e/2;case "LineStrip":return e-1;case "LineLoop":return e;case "Points":return e}throw Error("unimplemented index mode: "+a);};f.getVertexCount=function(a){switch(a){case "Triangles":case "TriangleFan":case "TriangleStrip":return 3;case "Lines":case "LineStrip":case "LineLoop":return 2;
case "Points":return 1}throw Error("unimplemented index mode: "+a);};var k={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:h,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array,Double:Float64Array};f.prototype.generateAttributeData=function(){var a=this.vertexData.data,e,f=0,d;for(d in this.attributeMap){e=this.attributeMap[d];e.offset=f;var b=this.vertexCount*e.count;f+=b*c.getByteSize(e.type);var j=k[e.type];if(j)e=new j(a,e.offset,b);
else throw"Unsupported DataType: "+e.type;this.dataViews[d]=e}};f.prototype.makeInterleavedData=function(){var a=0,e=0,f;for(f in this.attributeMap){var d=this.attributeMap[f];d.offset=a;a+=d.count*c.getByteSize(d.type)}var b=new g(new ArrayBuffer(a*this.vertexCount),this.vertexData.target);b._dataUsage=this.vertexData._dataUsage;b._dataNeedsRefresh=!0;var j=new DataView(b.data);for(f in this.attributeMap){var h=this.dataViews[f],d=this.attributeMap[f];d.stride=a;for(var e=d.offset,i=d.count,k=c.getByteSize(d.type),
d=this.getDataMethod(d.type),d=j[d],l=0;l<this.vertexCount;l++)for(var m=0;m<i;m++)d.apply(j,[e+a*l+m*k,h[l*i+m],!0])}this.vertexData=b};f.prototype.getDataMethod=function(a){switch(a){case "Byte":return"setInt8";case "UnsignedByte":return"setUInt8";case "Short":return"setInt16";case "UnsignedShort":return"setUInt16";case "Int":return"setInt32";case "HalfFloat":return"setInt16";case "Float":return"setFloat32";case "Double":return"setFloat64"}};f.prototype.getAttributeBuffer=function(a){return this.dataViews[a]};
f.prototype.getIndexData=function(){return this.indexData};f.prototype.getIndexBuffer=function(){return this.indexData!==null?this.indexData.data:null};f.prototype.getIndexLengths=function(){return this.indexLengths};f.prototype.getIndexModes=function(){return this.indexModes};f.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore};f.prototype.applyTransform=function(a,e){var b=new d,j=this.getAttributeBuffer(a),c=j.length;if(a===f.POSITION)for(var h=0;h<c;h+=3)b.setd(j[h+
0],j[h+1],j[h+2]),e.matrix.applyPostPoint(b),j[h+0]=b[0],j[h+1]=b[1],j[h+2]=b[2];else if(a===f.NORMAL)for(h=0;h<c;h+=3)b.setd(j[h+0],j[h+1],j[h+2]),e.rotation.applyPost(b),j[h+0]=b[0],j[h+1]=b[1],j[h+2]=b[2];else if(a===f.TANGENT)for(h=0;h<c;h+=3)b.setd(j[h+0],j[h+1],j[h+2]),e.rotation.applyPost(b),j[h+0]=b[0],j[h+1]=b[1],j[h+2]=b[2];return this};f.prototype.applyFunction=function(f,b){var j,c,h=this.getAttributeBuffer(f),g=h.length;switch(this.attributeMap[f].count){case 1:for(var i=0;i<g;i++)h[i]=
b(h[i]);break;case 2:j=new a;for(i=0;i<g;i+=2)j.setd(h[i+0],h[i+1]),c=b(j),h[i+0]=c[0],h[i+1]=c[1];break;case 3:j=new d;for(i=0;i<g;i+=3)j.setd(h[i+0],h[i+1],h[i+2]),c=b(j),h[i+0]=c[0],h[i+1]=c[1],h[i+2]=c[2];break;case 4:j=new e;for(i=0;i<g;i+=4)j.setd(h[i+0],h[i+1],h[i+2],h[i+3]),c=b(j),h[i+0]=c[0],h[i+1]=c[1],h[i+2]=c[2],h[i+3]=c[3]}return this};f.prototype.getNormalsMeshData=function(a){if(this.getAttributeBuffer("POSITION")!==void 0&&this.getAttributeBuffer("NORMAL")!==void 0){for(var a=a!==
void 0?a:1,e=[],d=[],b=this.dataViews.POSITION.length/3,j=0;j<b;j++)e.push(this.dataViews.POSITION[j*3+0],this.dataViews.POSITION[j*3+1],this.dataViews.POSITION[j*3+2],this.dataViews.POSITION[j*3+0]+this.dataViews.NORMAL[j*3+0]*a,this.dataViews.POSITION[j*3+1]+this.dataViews.NORMAL[j*3+1]*a,this.dataViews.POSITION[j*3+2]+this.dataViews.NORMAL[j*3+2]*a);for(j=0;j<b*2;j+=2)d.push(j,j+1);a=new f(f.defaultMap([f.POSITION]),e.length,d.length);a.getAttributeBuffer(f.POSITION).set(e);a.getIndexBuffer().set(d);
a.indexModes[0]="Lines";return a}};f.prototype.buildWireframeData=function(){var a=c.clone(this.attributeMap),e=new f(a,this.vertexCount,0);e.indexModes[0]="Lines";var d=this.getIndexBuffer(),b=[],j=0;this.updatePrimitiveCounts();for(var h=0;h<this.getSectionCount();h++)for(var i=this.indexModes[h],g=this.getPrimitiveCount(h),k=0;k<g;k++)switch(i){case "Triangles":case "TriangleFan":case "TriangleStrip":var l=d[this.getVertexIndex(k,0,h)],m=d[this.getVertexIndex(k,1,h)],o=d[this.getVertexIndex(k,
2,h)];b[j+0]=l;b[j+1]=m;b[j+2]=m;b[j+3]=o;b[j+4]=o;b[j+5]=l;j+=6;break;case "Lines":case "LineStrip":l=d[this.getVertexIndex(k,0,h)];m=d[this.getVertexIndex(k,1,h)];b[j+0]=l;b[j+1]=m;j+=2;break;case "LineLoop":l=d[this.getVertexIndex(k,0,h)],m=d[this.getVertexIndex(k,1,h)],k===g-1&&(m=d[this.getVertexIndex(0,0,h)]),b[j+0]=l,b[j+1]=m,j+=2}if(j>0){e.rebuildIndexData(j);for(var x in a)e.getAttributeBuffer(x).set(this.getAttributeBuffer(x));e.getIndexBuffer().set(b)}e.paletteMap=this.paletteMap;e.weightsPerVertex=
this.weightsPerVertex;return e};var i=new d,l=new d,m=new d;f.prototype.buildFlatMeshData=function(){var a=[],e=this.getIndexBuffer();if(e===null)return console.debug("No indices, probably a point mesh"),this;if(e.length>65535)return console.warn("Mesh too big, cannot build flat mesh data"),this;var d=c.clone(this.attributeMap),b={},j;for(j in d)b[j]={oldBuffer:this.getAttributeBuffer(j),values:[]};var h=0;this.updatePrimitiveCounts();for(var g=0;g<this.getSectionCount();g++)for(var k=this.indexModes[g],
o=this.getPrimitiveCount(g),z=!1,w=0;w<o;w++)switch(k){case "TriangleStrip":z=w%2===1?!0:!1;case "Triangles":case "TriangleFan":var A=e[this.getVertexIndex(w,0,g)],x=e[this.getVertexIndex(w,1,g)],B=e[this.getVertexIndex(w,2,g)];if(z)var D=B,B=x,x=D;for(j in b)if(j!==f.NORMAL){for(var D=d[j].count,C=0;C<D;C++)b[j].values[h*D+C]=b[j].oldBuffer[A*D+C],b[j].values[(h+1)*D+C]=b[j].oldBuffer[x*D+C],b[j].values[(h+2)*D+C]=b[j].oldBuffer[B*D+C];j===f.POSITION&&(i.setd(b[j].values[h*3],b[j].values[h*3+1],
b[j].values[h*3+2]),l.setd(b[j].values[(h+1)*3],b[j].values[(h+1)*3+1],b[j].values[(h+1)*3+2]),m.setd(b[j].values[(h+2)*3],b[j].values[(h+2)*3+1],b[j].values[(h+2)*3+2]),l.subv(i),m.subv(i),l.cross(m).normalize(),b[f.NORMAL]&&(b[f.NORMAL].values[h*3]=l.data[0],b[f.NORMAL].values[h*3+1]=l.data[1],b[f.NORMAL].values[h*3+2]=l.data[2],b[f.NORMAL].values[(h+1)*3]=l.data[0],b[f.NORMAL].values[(h+1)*3+1]=l.data[1],b[f.NORMAL].values[(h+1)*3+2]=l.data[2],b[f.NORMAL].values[(h+2)*3]=l.data[0],b[f.NORMAL].values[(h+
2)*3+1]=l.data[1],b[f.NORMAL].values[(h+2)*3+2]=l.data[2]))}a.push(a.length);a.push(a.length);a.push(a.length);h+=3}if(a.length===0)return console.warn("Could not build flat data"),this;e=new f(d,a.length,a.length);for(j in b)e.getAttributeBuffer(j).set(b[j].values);e.getIndexBuffer().set(a);e.paletteMap=this.paletteMap;e.weightPerVertex=this.weightsPerVertex;return e};f.POSITION="POSITION";f.NORMAL="NORMAL";f.COLOR="COLOR";f.TANGENT="TANGENT";f.TEXCOORD0="TEXCOORD0";f.TEXCOORD1="TEXCOORD1";f.TEXCOORD2=
"TEXCOORD2";f.TEXCOORD3="TEXCOORD3";f.WEIGHTS="WEIGHTS";f.JOINTIDS="JOINTIDS";f.createAttribute=function(a,e,d){return{count:a,type:e,stride:0,offset:0,normalized:d!==void 0?d:!1}};var o={POSITION:f.createAttribute(3,"Float"),NORMAL:f.createAttribute(3,"Float"),COLOR:f.createAttribute(4,"Float"),TANGENT:f.createAttribute(4,"Float"),TEXCOORD0:f.createAttribute(2,"Float"),TEXCOORD1:f.createAttribute(2,"Float"),TEXCOORD2:f.createAttribute(2,"Float"),TEXCOORD3:f.createAttribute(2,"Float"),WEIGHTS:f.createAttribute(4,
"Float"),JOINTIDS:f.createAttribute(4,"Short")};f.defaultMap=function(a){return a===void 0?j(Object.keys(o)):j(a)};return f});
define("goo/renderer/bounds/BoundingSphere",["goo/math/Vector3","goo/math/MathUtils","goo/renderer/bounds/BoundingVolume","goo/renderer/MeshData"],function(g,c,b,a){function d(a,d){b.call(this,a);this.radius=d!==void 0?d:1;this.vec=new g}d.prototype=Object.create(b.prototype);d.prototype.constructor=d;d.prototype.computeFromPoints=function(a){var d=this.min,b=this.max,c=this.vec;d.setd(Infinity,Infinity,Infinity);b.setd(-Infinity,-Infinity,-Infinity);for(var g,i,l,m=0;m<a.length;m+=3)g=a[m+0],i=a[m+
1],l=a[m+2],d.x=g<d.x?g:d.x,d.y=i<d.y?i:d.y,d.z=l<d.z?l:d.z,b.x=g>b.x?g:b.x,b.y=i>b.y?i:b.y,b.z=l>b.z?l:b.z;d=b.addv(d).div(2);for(m=b=0;m<a.length;m+=3)c.setd(a[m],a[m+1],a[m+2]),g=c.subv(d).lengthSquared(),g>b&&(b=g);this.radius=Math.sqrt(b);this.center.setv(d)};d.prototype.computeFromPrimitives=function(e,d,b,c,k){if(!(k-c<=0)){for(var i=[],l=[],m=a.getVertexCount(e.indexModes[d]),o=0;c<k;c++)for(var l=e.getPrimitiveVertices(b[c],d,l),p=0;p<m;p++)i[o++]=(new g).set(l[p]);this.averagePoints(i)}};
d.prototype.averagePoints=function(a){this.center.set(a[0]);for(var d=1;d<a.length;d++)this.center.add(a[d]);this.center.mul(1/a.length);for(var b=0,d=0;d<a.length;d++){var c=g.sub(a[d],this.center,this.vec).lengthSquared();c>b&&(b=c)}this.radius=Math.sqrt(b)+1.0E-5};d.prototype.transform=function(a,f){f===null&&(f=new d);a.applyForward(this.center,f.center);f.radius=Math.abs(this._maxAxis(a.scale)*this.radius);return f};d.prototype.whichSide=function(a){var d=a.normal.data,j=this.center.data,a=d[0]*
j[0]+d[1]*j[1]+d[2]*j[2]-a.constant;return a<-this.radius?b.Inside:a>this.radius?b.Outside:b.Intersects};d.prototype._pseudoDistance=function(a,d){return a.normal.x*d.x+a.normal.y*d.y+a.normal.z*d.z-a.constant};d.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))};d.prototype.toString=function(){var a=Math.round(this.center.x*10)/10,d=Math.round(this.center.y*10)/10,b=Math.round(this.center.z*10)/10,c=Math.round(this.radius*10)/10;return"["+a+","+d+
","+b+"] - "+c};d.prototype.intersects=function(a){return a.intersectsSphere(this)};d.prototype.intersectsBoundingBox=function(a){return Math.abs(a.center.x-this.center.x)<this.radius+a.xExtent&&Math.abs(a.center.y-this.center.y)<this.radius+a.yExtent&&Math.abs(a.center.z-this.center.z)<this.radius+a.zExtent?!0:!1};d.prototype.intersectsSphere=function(a){var d=this.vec.setv(this.center).subv(a.center),a=this.radius+a.radius;return d.dot(d)<=a*a};d.prototype.intersectsRay=function(a){if(!this.center)return!1;
var d=(new g).copy(a.origin).sub(this.center),b=d.dot(d)-this.radius*this.radius;if(b<=0)return!0;a=a.direction.dot(d);return a>=0?!1:a*a>=b};d.prototype.intersectsRayWhere=function(a){var d=(new g).copy(a.origin).sub(this.center),b=d.dot(d)-this.radius*this.radius;if(b<=0)return d=a.direction.dot(d),b=Math.sqrt(d*d-b),d=[b-d],a=[(new g).copy(a.direction).mul(d[0]).add(a.origin)],{distances:d,points:a};d=a.direction.dot(d);if(d>=0)return null;b=d*d-b;if(b<0)return null;else if(b>=1.0E-5)return b=
Math.sqrt(b),d=[-d-b,-d+b],a=[(new g).copy(a.direction).mul(d[0]).add(a.origin),(new g).copy(a.direction).mul(d[1]).add(a.origin)],{distances:d,points:a};d=[-d];a=[(new g).copy(a.direction).mul(d[0]).add(a.origin)];return{distances:d,points:a}};d.prototype.merge=function(a){if(a instanceof d)return this.mergeSphere(a.center,a.radius,this);else{var f=this.vec.setd(a.xExtent,a.yExtent,a.zExtent).length();return this.mergeSphere(a.center,f,this)}};d.prototype.mergeSphere=function(a,f,b){b||(b=new d);
var h=this.vec.setv(a).subv(this.center),g=h.lengthSquared(),i=f-this.radius;if(i*i>=g)return i<=0?(b.center.setv(this.center),b.radius=this.radius):(b.center.setv(a),b.radius=f),b;a=Math.sqrt(g);g=b.center;a>c.EPSILON&&g.addv(h.mul((a+i)/(2*a)));b.radius=0.5*(a+this.radius+f);return b};d.prototype.clone=function(a){return a&&a instanceof d?(a.center.setv(this.center),a.radius=this.radius,a):new d(this.center,this.radius)};return d});
define("goo/math/Matrix",["goo/math/MathUtils"],function(g){function c(b,a){this.rows=b||0;this.cols=a||0;this.data=new Float32Array(this.rows*this.cols)}c.prototype.setupAliases=function(b){for(var a=this,d=0;d<b.length;d++)(function(e){for(var f=0;f<b[e].length;f++)Object.defineProperty(a,b[e][f],{get:function(){return this.data[e]},set:function(a){this.data[e]=a}});Object.defineProperty(a,d,{get:function(){return this.data[e]},set:function(a){this.data[e]=a}})})(d)};c.add=function(b,a,d){var e=
b.rows,f=b.cols;d||(d=new c(e,f));if(a instanceof c){if(a.rows!==e||a.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]+a.data[e]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]+a}return d};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,d){var e=
b.rows,f=b.cols;d||(d=new c(e,f));if(a instanceof c){if(a.rows!==e||a.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]-a.data[e]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]-a}return d};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,d){var e=
b.rows,f=b.cols;d||(d=new c(e,f));if(a instanceof c){if(a.rows!==e||a.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]*a.data[e]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]*a}return d};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,d){var e=
b.rows,f=b.cols;d||(d=new c(e,f));if(a instanceof c){if(a.rows!==e||a.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]/a.data[e]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a=1/a;for(e=0;e<b.data.length;e++)d.data[e]=b.data[e]*a}return d};c.prototype.div=function(b){return c.div(this,b,this)};c.combine=function(b,a,
d){var e=b.rows,f=a.cols,j=b.cols=a.rows;d||(d=new c(e,f));if(b.cols!==j||a.rows!==j||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(d===b||d===a)return c.copy(c.combine(b,a),d);for(var h=0;h<f;h++)for(var g=h*e,i=0;i<e;i++){for(var l=0,m=0;m<j;m++)l+=b.data[m*b.rows+i]*a.data[h*a.rows+m];d.data[g+i]=l}return d};c.prototype.combine=function(b){return c.combine(this,b,this)};c.transpose=function(b,a){var d=b.cols,e=b.rows;a||(a=new c(d,
e));if(a.rows!==d||a.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(a===b)return c.copy(c.transpose(b),a);for(var f=0;f<e;f++)for(var j=f*d,h=0;h<d;h++)a.data[j+h]=b.data[h*e+f];return a};c.prototype.transpose=function(){return c.transpose(this,this)};c.copy=function(b,a){var d=b.rows,e=b.cols;a||(a=new c(d,e));if(a.rows!==d||a.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};c.prototype.copy=
function(b){return c.copy(b,this)};c.equals=function(b,a){if(b.rows!==a.rows||b.cols!==a.cols)return!1;for(var d=0;d<b.data.length;d++)if(Math.abs(b.data[d]-a.data[d])>g.EPSILON)return!1;return!0};c.prototype.equals=function(b){return c.equals(this,b)};c.prototype.isOrthogonal=function(){for(var b=0;b<this.cols;b++)for(var a=b+1;a<this.cols;a++){for(var d=b*this.rows,e=a*this.rows,f=0,j=0;j<this.rows;j++)f+=this.data[d+j]*this.data[e+j];if(Math.abs(f)>g.EPSILON)return!1}return!0};c.prototype.isNormal=
function(){for(var b=0;b<this.cols;b++){for(var a=b*this.rows,d=0,e=0;e<this.rows;e++)d+=this.data[a+e]*this.data[a+e];if(Math.abs(d-1)>g.EPSILON)return!1}return!0};c.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};c.prototype.clone=function(){return c.copy(this)};c.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof c)this.copy(arguments[0]);else for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];
else for(b=0;b<arguments.length;b++)this.data[b]=arguments[b];return this};c.prototype.toString=function(){for(var b="",a=0;a<this.cols;a++){var d=a*this.rows;b+="[";for(var e=0;e<this.rows;e++)b+=this.data[d+e],b+=e!==this.rows-1?", ":"";b+=a!==this.cols-1?"], ":"]"}return b};return c});
define("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(g,c,b){function a(){c.call(this,3,3);arguments.length===0?this.setIdentity():this.set(arguments);this._tempX=new b;this._tempY=new b;this._tempZ=new b}a.prototype=Object.create(c.prototype);a.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]);a.IDENTITY=new a(1,0,0,0,1,0,0,0,1);a.add=function(d,e,f){f||(f=new a);var b=f.data,d=d.data;e instanceof a?(e=e.data,
b[0]=d[0]+e[0],b[1]=d[1]+e[1],b[2]=d[2]+e[2],b[3]=d[3]+e[3],b[4]=d[4]+e[4],b[5]=d[5]+e[5],b[6]=d[6]+e[6],b[7]=d[7]+e[7],b[8]=d[8]+e[8]):(b[0]=d[0]+e,b[1]=d[1]+e,b[2]=d[2]+e,b[3]=d[3]+e,b[4]=d[4]+e,b[5]=d[5]+e,b[6]=d[6]+e,b[7]=d[7]+e,b[8]=d[8]+e);return f};a.prototype.add=function(d){return a.add(this,d,this)};a.sub=function(d,e,f){f||(f=new a);var b=f.data,d=d.data;e instanceof a?(e=e.data,b[0]=d[0]-e[0],b[1]=d[1]-e[1],b[2]=d[2]-e[2],b[3]=d[3]-e[3],b[4]=d[4]-e[4],b[5]=d[5]-e[5],b[6]=d[6]-e[6],b[7]=
d[7]-e[7],b[8]=d[8]-e[8]):(b[0]=d[0]-e,b[1]=d[1]-e,b[2]=d[2]-e,b[3]=d[3]-e,b[4]=d[4]-e,b[5]=d[5]-e,b[6]=d[6]-e,b[7]=d[7]-e,b[8]=d[8]-e);return f};a.prototype.sub=function(d){return a.sub(this,d,this)};a.mul=function(d,e,f){f||(f=new a);var b=f.data,d=d.data;e instanceof a?(e=e.data,b[0]=d[0]*e[0],b[1]=d[1]*e[1],b[2]=d[2]*e[2],b[3]=d[3]*e[3],b[4]=d[4]*e[4],b[5]=d[5]*e[5],b[6]=d[6]*e[6],b[7]=d[7]*e[7],b[8]=d[8]*e[8]):(b[0]=d[0]*e,b[1]=d[1]*e,b[2]=d[2]*e,b[3]=d[3]*e,b[4]=d[4]*e,b[5]=d[5]*e,b[6]=d[6]*
e,b[7]=d[7]*e,b[8]=d[8]*e);return f};a.prototype.mul=function(d){return a.mul(this,d,this)};a.div=function(d,e,f){f||(f=new a);var b=f.data,d=d.data;e instanceof a?(e=e.data,b[0]=d[0]/e[0],b[1]=d[1]/e[1],b[2]=d[2]/e[2],b[3]=d[3]/e[3],b[4]=d[4]/e[4],b[5]=d[5]/e[5],b[6]=d[6]/e[6],b[7]=d[7]/e[7],b[8]=d[8]/e[8]):(b[0]=d[0]/e,b[1]=d[1]/e,b[2]=d[2]/e,b[3]=d[3]/e,b[4]=d[4]/e,b[5]=d[5]/e,b[6]=d[6]/e,b[7]=d[7]/e,b[8]=d[8]/e);return f};a.prototype.div=function(d){return a.div(this,d,this)};a.combine=function(d,
e,f){f||(f=new a);var b=d.data,d=b[0],c=b[3],g=b[6],i=b[1],l=b[4],m=b[7],o=b[2],p=b[5],b=b[8],n=e.data,e=n[0],r=n[3],t=n[6],q=n[1],v=n[4],y=n[7],s=n[2],u=n[5],n=n[8],z=f.data;z[0]=d*e+c*q+g*s;z[3]=d*r+c*v+g*u;z[6]=d*t+c*y+g*n;z[1]=i*e+l*q+m*s;z[4]=i*r+l*v+m*u;z[7]=i*t+l*y+m*n;z[2]=o*e+p*q+b*s;z[5]=o*r+p*v+b*u;z[8]=o*t+p*y+b*n;return f};a.prototype.combine=function(d){return a.combine(this,d,this)};a.transpose=function(d,e){e||(e=new a);var f=d.data,b=e.data;if(e===d){var c=f[3],g=f[6],i=f[7];b[3]=
f[1];b[6]=f[2];b[7]=f[5];b[1]=c;b[2]=g;b[5]=i;return e}b[0]=f[0];b[1]=f[3];b[2]=f[6];b[3]=f[1];b[4]=f[4];b[5]=f[7];b[6]=f[2];b[7]=f[5];b[8]=f[8];return e};a.prototype.transpose=function(){return a.transpose(this,this)};a.invert=function(d,e){e||(e=new a);if(e===d)return c.copy(a.invert(d),e);var f=d.determinant();if(Math.abs(f)<g.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};var f=1/f,b=e.data,h=d.data;b[0]=(h[4]*h[8]-h[7]*h[5])*f;b[1]=(h[7]*h[2]-h[1]*
h[8])*f;b[2]=(h[1]*h[5]-h[4]*h[2])*f;b[3]=(h[6]*h[5]-h[3]*h[8])*f;b[4]=(h[0]*h[8]-h[6]*h[2])*f;b[5]=(h[3]*h[2]-h[0]*h[5])*f;b[6]=(h[3]*h[7]-h[6]*h[4])*f;b[7]=(h[6]*h[1]-h[0]*h[7])*f;b[8]=(h[0]*h[4]-h[3]*h[1])*f;return e};a.prototype.invert=function(){return a.invert(this,this)};a.prototype.isOrthogonal=function(){var a=this.data,e=a[0]*a[3]+a[1]*a[4]+a[2]*a[5];if(Math.abs(e)>g.EPSILON)return!1;e=a[0]*a[6]+a[1]*a[7]+a[2]*a[8];if(Math.abs(e)>g.EPSILON)return!1;e=a[3]*a[6]+a[4]*a[7]+a[5]*a[8];return Math.abs(e)>
g.EPSILON?!1:!0};a.prototype.isNormal=function(){var a=this.data,e=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];if(Math.abs(e-1)>g.EPSILON)return!1;e=a[3]*a[3]+a[4]*a[4]+a[5]*a[5];if(Math.abs(e-1)>g.EPSILON)return!1;e=a[6]*a[6]+a[7]*a[7]+a[8]*a[8];return Math.abs(e-1)>g.EPSILON?!1:!0};a.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};a.prototype.determinant=function(){var a=this.data;return a[0]*(a[4]*a[8]-a[7]*a[5])-a[3]*(a[1]*a[8]-a[7]*a[2])+a[6]*(a[1]*a[5]-a[4]*a[2])};a.prototype.setIdentity=
function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return this};a.prototype.applyPost=function(a){var e=a.data,f=this.data,b=e[0],c=e[1],g=e[2];e[0]=f[0]*b+f[3]*c+f[6]*g;e[1]=f[1]*b+f[4]*c+f[7]*g;e[2]=f[2]*b+f[5]*c+f[8]*g;return a};a.prototype.applyPre=function(a){var e=a.data,f=this.data,b=e[0],c=e[1],g=e[2];e[0]=f[0]*b+f[1]*c+f[2]*g;e[1]=f[3]*b+f[4]*c+f[5]*g;e[2]=f[6]*b+f[7]*c+f[8]*g;return a};a.prototype.multiplyDiagonalPost=function(a,e){var f=a.data[0],
b=a.data[1],c=a.data[2],g=this.data,i=e.data;i[0]=f*g[0];i[1]=f*g[1];i[2]=f*g[2];i[3]=b*g[3];i[4]=b*g[4];i[5]=b*g[5];i[6]=c*g[6];i[7]=c*g[7];i[8]=c*g[8];return e};a.prototype.fromAngles=function(a,e,f){var b=Math.cos(a),a=Math.sin(a),c=Math.cos(e),e=Math.sin(e),g=Math.cos(f),f=Math.sin(f),i=this.data;i[0]=c*g;i[3]=e*a-c*f*b;i[6]=c*f*a+e*b;i[1]=f;i[4]=g*b;i[7]=-g*a;i[2]=-e*g;i[5]=e*f*b+c*a;i[8]=-e*f*a+c*b;return this};a.prototype.rotateX=function(a,e){var f=this.data,b=(e||this).data,c=Math.sin(a),
g=Math.cos(a),i=f[3],l=f[4],m=f[5],o=f[6],p=f[7],n=f[8];f!==b&&(b[0]=f[0],b[1]=f[1],b[2]=f[2]);b[3]=i*g+o*c;b[4]=l*g+p*c;b[5]=m*g+n*c;b[6]=o*g-i*c;b[7]=p*g-l*c;b[8]=n*g-m*c;return b};a.prototype.rotateY=function(a,e){var b=this.data,c=(e||this).data,h=Math.sin(a),g=Math.cos(a),i=b[0],l=b[1],m=b[2],o=b[6],p=b[7],n=b[8];b!==c&&(c[3]=b[3],c[4]=b[4],c[5]=b[5]);c[0]=i*g-o*h;c[1]=l*g-p*h;c[2]=m*g-n*h;c[6]=i*h+o*g;c[7]=l*h+p*g;c[8]=m*h+n*g;return c};a.prototype.rotateZ=function(a,e){var b=this.data,c=(e||
this).data,h=Math.sin(a),g=Math.cos(a),i=b[0],l=b[1],m=b[2],o=b[3],p=b[4],n=b[5];b!==c&&(c[6]=b[6],c[7]=b[7],c[8]=b[8]);c[0]=i*g+o*h;c[1]=l*g+p*h;c[2]=m*g+n*h;c[3]=o*g-i*h;c[4]=p*g-l*h;c[5]=n*g-m*h;return c};a.prototype.toAngles=function(a){a||(a=new b);var e=this.data,f=a.data;e[3]>1-g.EPSILON?(f[1]=Math.atan2(e[2],e[8]),f[2]=Math.PI/2,f[0]=0):e[3]<-1+g.EPSILON?(f[1]=Math.atan2(e[2],e[8]),f[2]=-Math.PI/2,f[0]=0):(f[1]=Math.atan2(-e[2],e[0]),f[0]=Math.atan2(-e[7],e[4]),f[2]=Math.asin(e[1]));return a};
a.prototype.fromAngleNormalAxis=function(a,e,b,c){var h=Math.cos(a),g=Math.sin(a),a=1-h,i=e*b*a,l=e*c*a,m=b*c*a,o=e*g,p=b*g;g*=c;var n=this.data;n[0]=e*e*a+h;n[3]=i-g;n[6]=l+p;n[1]=i+g;n[4]=b*b*a+h;n[7]=m-o;n[2]=l-p;n[5]=m+o;n[8]=c*c*a+h;return this};a.prototype.lookAt=function(a,e){var f=this._tempX,c=this._tempY,h=this._tempZ;h.setv(a).normalize();f.setv(e).cross(h).normalize();f.equals(b.ZERO)&&(h.data[0]!==0?f.setd(h.data[1],-h.data[0],0):f.setd(0,h.data[2],-h.data[1]));c.setv(h).cross(f);var g=
this.data;g[0]=f.data[0];g[1]=f.data[1];g[2]=f.data[2];g[3]=c.data[0];g[4]=c.data[1];g[5]=c.data[2];g[6]=h.data[0];g[7]=h.data[1];g[8]=h.data[2];return this};a.prototype.copyQuaternion=function(a){return a.toRotationMatrix(this)};a.prototype.copy=function(a){var e=this.data,a=a.data;e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=a[3];e[4]=a[4];e[5]=a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];return this};a.prototype.clone=function(){var d=this.data;return new a(d[0],d[1],d[2],d[3],d[4],d[5],d[4],d[5],d[6])};return a});
define("goo/math/Quaternion",["goo/math/Vector","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(g,c,b,a){function d(){g.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,1)}d.prototype=Object.create(g.prototype);d.prototype.setupAliases([["x"],["y"],["z"],["w"]]);d.IDENTITY=new d(0,0,0,1);d.ALLOWED_DEVIANCE=1.0E-8;d.add=function(a,b,c){c||(c=new d);c.data[0]=a.data[0]+b.data[0];c.data[1]=a.data[1]+b.data[1];c.data[2]=a.data[2]+b.data[2];c.data[3]=a.data[3]+
b.data[3];return c};d.sub=function(a,b,c){c||(c=new d);c.data[0]=a.data[0]-b.data[0];c.data[1]=a.data[1]-b.data[1];c.data[2]=a.data[2]-b.data[2];c.data[3]=a.data[3]-b.data[3];return c};d.mul=function(a,b,c){c||(c=new d);c.data[0]=a.data[0]*b.data[0];c.data[1]=a.data[1]*b.data[1];c.data[2]=a.data[2]*b.data[2];c.data[3]=a.data[3]*b.data[3];return c};d.div=function(a,b,c){c||(c=new d);var h=!0;c.data[0]=(h&=b.data[0]<0||b.data[0]>0)?a.data[0]/b.data[0]:0;c.data[1]=(h&=b.data[1]<0||b.data[1]>0)?a.data[1]/
b.data[1]:0;c.data[2]=(h&=b.data[2]<0||b.data[2]>0)?a.data[2]/b.data[2]:0;c.data[3]=(h&=b.data[3]<0||b.data[3]>0)?a.data[3]/b.data[3]:0;h===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!");return c};d.scalarAdd=function(a,b,c){c||(c=new d);c.data[0]=a.data[0]+b;c.data[1]=a.data[1]+b;c.data[2]=a.data[2]+b;c.data[3]=a.data[3]+b;return c};d.scalarSub=function(a,b,c){c||(c=new d);c.data[0]=a.data[0]-b;c.data[1]=a.data[1]-b;c.data[2]=a.data[2]-b;c.data[3]=a.data[3]-b;return c};d.scalarMul=
function(a,b,c){c||(c=new d);c.data[0]=a.data[0]*b;c.data[1]=a.data[1]*b;c.data[2]=a.data[2]*b;c.data[3]=a.data[3]*b;return c};d.scalarDiv=function(a,b,c){c||(c=new d);var h=!0,b=(h&=b<0||b>0)?1/b:0;c.data[0]=a.data[0]*b;c.data[1]=a.data[1]*b;c.data[2]=a.data[2]*b;c.data[3]=a.data[3]*b;h===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!");return c};d.slerp=function(a,b,d,c){if(d===0)return c.setv(a);else if(d===1)return c.setv(b);if(a.equals(b))return c.setv(a);var g=a.dot(b);
c.setv(b);g<0&&(c.negate(),g=-g);var b=1-d,i=d;1-g>0.1&&(g=Math.acos(g),i=1/Math.sin(g),b=Math.sin((1-d)*g)*i,i*=Math.sin(d*g));c.setd(b*a.data[0]+i*c.data[0],b*a.data[1]+i*c.data[1],b*a.data[2]+i*c.data[2],b*a.data[3]+i*c.data[3]);return c};d.prototype.negate=function(){this.data[0]*=-1;this.data[1]*=-1;this.data[2]*=-1;this.data[3]*=-1;return this};d.prototype.dot=function(a){var b=this.data,a=a.data||a,d=0;d+=b[0]*a[0];d+=b[1]*a[1];d+=b[2]*a[2];d+=b[3]*a[3];return d};d.prototype.add=function(a){return d.add(this,
a,this)};d.prototype.sub=function(a){return d.sub(this,a,this)};d.prototype.mul=function(a){return d.mul(this,a,this)};d.prototype.div=function(a){return d.div(this,a,this)};d.prototype.scalarAdd=function(a){return d.scalarAdd(this,a,this)};d.prototype.scalarSub=function(a){return d.scalarSub(this,a,this)};d.prototype.scalarMul=function(a){return d.scalarMul(this,a,this)};d.prototype.scalarDiv=function(a){return d.scalarDiv(this,a,this)};d.prototype.slerp=function(a,b){var c=(new d).copy(a);d.slerp(this,
a,b,c);this.copy(c);return this};d.prototype.fromRotationMatrix=function(a){var b=a.e00+a.e11+a.e22,d,c,g;if(b>=0){var i=Math.sqrt(b+1);g=0.5*i;i=0.5/i;b=(a.e21-a.e12)*i;d=(a.e02-a.e20)*i;c=(a.e10-a.e01)*i}else a.e00>a.e11&&a.e00>a.e22?(i=Math.sqrt(1+a.e00-a.e11-a.e22),b=i*0.5,i=0.5/i,d=(a.e10+a.e01)*i,c=(a.e02+a.e20)*i,g=(a.e21-a.e12)*i):a.e11>a.e22?(i=Math.sqrt(1+a.e11-a.e00-a.e22),d=i*0.5,i=0.5/i,b=(a.e10+a.e01)*i,c=(a.e21+a.e12)*i,g=(a.e02-a.e20)*i):(i=Math.sqrt(1+a.e22-a.e00-a.e11),c=i*0.5,i=
0.5/i,b=(a.e02+a.e20)*i,d=(a.e21+a.e12)*i,g=(a.e10-a.e01)*i);return this.set(b,d,c,g)};d.prototype.toRotationMatrix=function(a){a||(a=new b);var d=this.magnitudeSquared(),d=d>0?2/d:0,c=this.data,h=c[0]*d,g=c[1]*d,i=c[2]*d,d=c[0]*h,l=c[0]*g,m=c[0]*i;h*=c[3];var o=c[1]*g,p=c[1]*i;g*=c[3];var n=c[2]*i,c=c[3]*i,i=a.data;i[0]=1-(o+n);i[1]=l+c;i[2]=m-g;i[3]=l-c;i[4]=1-(d+n);i[5]=p+h;i[6]=m+g;i[7]=p-h;i[8]=1-(d+o);return a};d.prototype.fromVectorToVector=function(b,f){var j=b.length()*f.length();if(Math.abs(j)>
a.EPSILON){var h=new c,g=b.dot(f)/j,j=Math.acos(Math.max(-1,Math.min(g,1)));b.cross(f,h);g<0&&h.length()<a.EPSILON&&(g=Math.abs(b.x)>Math.abs(b.y)?Math.abs(b.x)>Math.abs(b.z)?0:2:Math.abs(b.y)>Math.abs(b.z)?1:2,h.setValue(g,-b[(g+1)%3]),h.setValue((g+1)%3,b[g]),h.setValue((g+2)%3,0));return this.fromAngleAxis(j,h)}else return this.set(d.IDENTITY)};d.prototype.normalize=function(){var a=1/this.magnitude();return this.set(this.x*a,this.y*a,this.z*a,this.w*a)};d.prototype.magnitude=function(){var a=
this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3];return a===1?1:Math.sqrt(a)};d.prototype.magnitudeSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3]};d.prototype.fromAngleAxis=function(a,b){var d=(new c(b)).normalize();return this.fromAngleNormalAxis(a,d)};d.prototype.fromAngleNormalAxis=function(b,f){if(f.equals(c.ZERO))return this.set(d.IDENTITY);var j=0.5*b,h=a.sin(j),
j=a.cos(j),g=h*f.getX(),i=h*f.getY();h*=f.getZ();return this.set(g,i,h,j)};d.prototype.toAngleAxis=function(a){var b=this.x*this.x+this.y*this.y+this.z*this.z,c;if(Math.abs(b)<=d.ALLOWED_DEVIANCE){if(c=0,a!==null)a.x=1,a.y=0,a.z=0}else if(c=2*Math.acos(this.w),a!==null)b=1/Math.sqrt(b),a.x=this.x*b,a.y=this.y*b,a.z=this.z*b;return c};d.prototype.equals=function(a){return this===a?!0:!a instanceof d?!1:Math.abs(this.data[0]-a.data[0])<d.ALLOWED_DEVIANCE&&Math.abs(this.data[1]-a.data[1])<d.ALLOWED_DEVIANCE&&
Math.abs(this.data[2]-a.data[2])<d.ALLOWED_DEVIANCE&&Math.abs(this.data[3]-a.data[3])<d.ALLOWED_DEVIANCE};d.prototype.setd=function(a,b,d,c){this.data[0]=a;this.data[1]=b;this.data[2]=d;this.data[3]=c;return this};d.prototype.seta=function(a){this.data[0]=a[0];this.data[1]=a[1];this.data[2]=a[2];this.data[3]=a[3];return this};d.prototype.setv=function(a){this.data[0]=a.data[0];this.data[1]=a.data[1];this.data[2]=a.data[2];this.data[3]=a.data[3];return this};return d});
define("goo/shapes/Box",["goo/renderer/MeshData"],function(g){function c(b,a,d,e,f){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=d!==void 0?d*0.5:0.5;this.tileX=e||1;this.tileY=f||1;b=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);g.call(this,b,24,36);this.rebuild()}c.prototype=Object.create(g.prototype);c.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,d=this.zExtent,e=this.tileX,f=this.tileY,c=[-b,-a,-d,b,-a,-d,b,a,-d,-b,a,-d,b,-a,d,-b,-a,d,b,
a,d,-b,a,d],h=[];(function(a){for(var b=0;b<a.length;b++){var d=a[b]*3;h.push(c[d]);h.push(c[d+1]);h.push(c[d+2])}})([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]);this.getAttributeBuffer(g.POSITION).set(h);var k=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],i=[];(function(){for(var a=0;a<k.length/3;a++)for(var b=0;b<4;b++){var d=a*3;i.push(k[d]);i.push(k[d+1]);i.push(k[d+2])}})();this.getAttributeBuffer(g.NORMAL).set(i);b=[];for(a=0;a<6;a++)b.push(e),b.push(0),b.push(0),b.push(0),b.push(0),b.push(f),
b.push(e),b.push(f);this.getAttributeBuffer(g.TEXCOORD0).set(b);this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]);return this};return c});
define("goo/shapes/Quad",["goo/renderer/MeshData"],function(g){function c(b,a,d,e){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.tileX=d||1;this.tileY=e||1;b=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);g.call(this,b,4,6);this.rebuild()}c.prototype=Object.create(g.prototype);c.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,d=this.tileX,e=this.tileY;this.getAttributeBuffer(g.POSITION).set([-b,-a,0,-b,a,0,b,a,0,b,-a,0]);this.getAttributeBuffer(g.NORMAL).set([0,
0,1,0,0,1,0,0,1,0,0,1]);this.getAttributeBuffer(g.TEXCOORD0).set([0,0,0,e,d,e,d,0]);this.getIndexBuffer().set([0,3,1,1,3,2]);return this};return c});
define("goo/util/Enum",[],function(){function g(a,b){Object.getOwnPropertyNames(b).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(b,e))});return a}function c(a,b){this.name=a;b&&g(this,b);Object.freeze(this)}function b(a){arguments.length===1&&a!==null&&typeof a==="object"?Object.keys(a).forEach(function(b){this[b]=new c(b,a[b])},this):Array.prototype.forEach.call(arguments,function(a){this[a]=new c(a)},this);Object.freeze(this)}c.prototype=Object.create(null);c.prototype.constructor=
c;c.prototype.toString=function(){return"|"+this.name+"|"};Object.freeze(c.prototype);b.prototype.symbols=function(){return Object.keys(this).map(function(a){return this[a]},this)};b.prototype.contains=function(a){return!a instanceof c?!1:this[a.name]===a};return b});
define("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(g,c,b,a){function d(a,b,e,c){this.zSamples=(a!==void 0?a:8)+1;this.radialSamples=b!==void 0?b:8;this.radius=e!==void 0?e:0.5;this.textureMode=c!==void 0?c:d.TextureModes.Polar;this.viewInside=!1;a=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);b=this.textureMode===d.TextureModes.Chromeball?this.zSamples+1:this.zSamples;g.call(this,a,(b-2)*(this.radialSamples+1)+2,6*(b-2)*this.radialSamples);
this.rebuild()}function e(a,b,d){a[d*3+0]=a[b*3+0];a[d*3+1]=a[b*3+1];a[d*3+2]=a[b*3+2]}d.prototype=Object.create(g.prototype);d.prototype.rebuild=function(){for(var f=this.getAttributeBuffer(g.POSITION),c=this.getAttributeBuffer(g.NORMAL),h=this.getAttributeBuffer(g.TEXCOORD0),k=this.getIndexBuffer(),i=1/this.radialSamples,l=2/(this.zSamples-1),m=[],o=[],p=0;p<this.radialSamples;p++){var n=a.TWO_PI*i*p;o[p]=Math.cos(n);m[p]=Math.sin(n)}m[this.radialSamples]=m[0];o[this.radialSamples]=o[0];for(var n=
0,r=new b,t=new b,q=new b,v=1;v<this.zSamples-1;v++){var y=a.HALF_PI*(-1+l*v),s=Math.sin(y),p=this.radius*s,u=t.set(0,0,0);u.z+=p;for(var z=Math.sqrt(Math.abs(this.radius*this.radius-p*p)),w,A=n,p=0;p<this.radialSamples;p++){var x=p*i;w=q.set(o[p],m[p],0);b.mul(w,z,r);f[n*3+0]=u.x+r.x;f[n*3+1]=u.y+r.y;f[n*3+2]=u.z+r.z;w=r.set(f[n*3+0],f[n*3+1],f[n*3+2]);w.normalize();this.viewInside?(c[n*3+0]=-w.x,c[n*3+1]=-w.y,c[n*3+2]=-w.z):(c[n*3+0]=w.x,c[n*3+1]=w.y,c[n*3+2]=w.z);this.textureMode===d.TextureModes.Linear?
(h[n*2+0]=x,h[n*2+1]=0.5*(s+1)):this.textureMode===d.TextureModes.Projected?(h[n*2+0]=x,h[n*2+1]=(a.HALF_PI+Math.asin(s))/Math.PI):this.textureMode===d.TextureModes.Polar?(x=(a.HALF_PI-Math.abs(y))/Math.PI,w=x*o[p]+0.5,x=x*m[p]+0.5,h[n*2+0]=w,h[n*2+1]=x):this.textureMode===d.TextureModes.Chromeball&&(x=Math.sin((a.HALF_PI+y)/2),x/=2,w=x*o[p]+0.5,x=x*m[p]+0.5,h[n*2+0]=w,h[n*2+1]=x);n++}e(f,A,n);e(c,A,n);this.textureMode===d.TextureModes.Linear?(h[n*2+0]=1,h[n*2+1]=0.5*(s+1)):this.textureMode===d.TextureModes.Projected?
(h[n*2+0]=1,h[n*2+1]=(a.HALF_PI+Math.asin(s))/Math.PI):this.textureMode===d.TextureModes.Polar?(x=(a.HALF_PI-Math.abs(y))/Math.PI,h[n*2+0]=x+0.5,h[n*2+1]=0.5):this.textureMode===d.TextureModes.Chromeball&&(x=Math.sin((a.HALF_PI+y)/2),x/=2,h[n*2+0]=x+0.5,h[n*2+1]=0.5);n++}if(this.textureMode===d.TextureModes.Chromeball){v=a.HALF_PI-0.001;i=this.radius*Math.sin(v);l=Math.sqrt(Math.abs(this.radius*this.radius-i*i));A=n;for(p=0;p<this.radialSamples;p++)f[n*3+0]=l*o[p],f[n*3+1]=l*m[p],f[n*3+2]=i,w=r.set(f[n*
3+0],f[n*3+1],f[n*3+2]),w.normalize(),this.viewInside?(c[n*3+0]=-w.x,c[n*3+1]=-w.y,c[n*3+2]=-w.z):(c[n*3+0]=w.x,c[n*3+1]=w.y,c[n*3+2]=w.z),x=Math.sin((a.HALF_PI+v)/2),x/=2,w=x*o[p]+0.5,x=x*m[p]+0.5,h[n*2+0]=w,h[n*2+1]=x,n++;e(f,A,n);e(c,A,n);x=Math.sin((a.HALF_PI+v)/2);x/=2;h[n*2+0]=x+0.5;h[n*2+1]=0.5;n++}f[n*3+0]=0;f[n*3+1]=0;f[n*3+2]=-this.radius;this.viewInside?(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=1):(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=-1);this.textureMode===d.TextureModes.Polar||this.textureMode===d.TextureModes.Chromeball?
(h[n*2+0]=0.5,h[n*2+1]=0.5):(h[n*2+0]=0.5,h[n*2+1]=0);n++;f[n*3+0]=0;f[n*3+1]=0;f[n*3+2]=this.radius;this.viewInside?(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=-1):(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=1);this.textureMode===d.TextureModes.Polar?(h[n*2+0]=0.5,h[n*2+1]=0.5):this.textureMode===d.TextureModes.Chromeball?(h[n*2+0]=1,h[n*2+1]=-0.5):(h[n*2+0]=0.5,h[n*2+1]=1);f=0;c=this.textureMode===d.TextureModes.Chromeball?this.zSamples+1:this.zSamples;for(h=v=0;v<c-3;v++){m=h;o=m+1;h+=this.radialSamples+1;p=h;r=p+1;for(n=
0;n<this.radialSamples;n++)this.viewInside?(k[f++]=m++,k[f++]=p,k[f++]=o,k[f++]=o++,k[f++]=p++,k[f++]=r++):(k[f++]=m++,k[f++]=o,k[f++]=p,k[f++]=o++,k[f++]=r++,k[f++]=p++)}for(n=0;n<this.radialSamples;n++)this.viewInside?(k[f++]=n,k[f++]=n+1,k[f++]=this.vertexCount-2):(k[f++]=n,k[f++]=this.vertexCount-2,k[f++]=n+1);v=(c-3)*(this.radialSamples+1);for(n=0;n<this.radialSamples;n++)this.viewInside?(k[f++]=n+v,k[f++]=this.vertexCount-1,k[f++]=n+1+v):(k[f++]=n+v,k[f++]=n+1+v,k[f++]=this.vertexCount-1);return this};
d.TextureModes=new c("Linear","Projected","Polar","Chromeball");return d});
define("goo/addons/cannon/systems/CannonjsSystem","goo/entities/systems/System,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/math/Quaternion,goo/shapes/Box,goo/shapes/Quad,goo/shapes/Sphere,goo/renderer/MeshData".split(","),function(g,c,b,a,d,e,f,j){function h(b){g.call(this,"CannonjsSystem",["CannonjsComponent","TransformComponent"]);var b=b||{},d=this.world=new k.World;d.gravity.y=-9.82;d.broadphase=new k.NaiveBroadphase;this.stepFrequency=b.stepFrequency||60;this.quat=
new a}var k=window.CANNON;h.prototype=Object.create(g.prototype);h.prototype.createShape=function(a){var h=a.cannonjsComponent,g=a.transformComponent,o;if(a.meshDataComponent)if(a=a.meshDataComponent,h.useBounds)a.computeBoundFromPoints(),h=a.modelBound,h instanceof c?o=new k.Box(new k.Vec3(h.xExtent,h.yExtent,h.zExtent)):h instanceof b&&(o=new k.Sphere(h.radius));else if(o=a.meshData,o instanceof d)o=new k.Box(new k.Vec3(o.xExtent,o.yExtent,o.zExtent));else if(o instanceof f)o=new k.Sphere(o.radius);
else if(o instanceof e)o=new k.Plane;else{for(var a=[],g=[],p=o.getAttributeBuffer(j.POSITION),n=o.getIndexBuffer(),h=0;h<o.vertexCount*3;h+=3)a.push(new k.Vec3(p[h],p[h+1],p[h+2]));for(h=0;h<o.indexCount;h+=3)g.push([n[h],n[h+1],n[h+2]]);o=new k.ConvexPolyhedron(a,g)}else{a=g.children;for(h=0;h<a.length;h++)if(n=a[h].entity,g=this.createShape(n))o||(o=new k.Compound),p=n.transformComponent.transform.translation,n=n.transformComponent.transform.rotation,p=new k.Vec3(p.x,p.y,p.z),this.quat.fromRotationMatrix(n),
n=new k.Quaternion(this.quat.x,this.quat.y,this.quat.z,this.quat.w),o.addChild(g,p,n)}return o};h.prototype.inserted=function(a){var b=a.cannonjsComponent,d=a.transformComponent,e=this.createShape(a);e?(a=new k.RigidBody(b.mass,e),a.position.set(d.transform.translation.x,d.transform.translation.y,d.transform.translation.z),this.quat.fromRotationMatrix(d.transform.rotation),a.quaternion.set(this.quat.x,this.quat.y,this.quat.z,this.quat.w),b.body=a,this.world.add(a)):a.clearComponent("CannonjsComponent")};
h.prototype.deleted=function(a){(a=a.cannonjsComponent)&&this.world.remove(a.body)};h.prototype.process=function(a){this.world.step(1/this.stepFrequency);for(var b=0;b<a.length;b++){var d=a[b],e=d.cannonjsComponent,f=e.body.position;d.transformComponent.transform.translation.x=f.x;d.transformComponent.transform.translation.y=f.y;d.transformComponent.transform.translation.z=f.z;e=e.body.quaternion;this.quat.set(e.x,e.y,e.z,e.w);d.transformComponent.transform.rotation.copyQuaternion(this.quat);d.transformComponent.setUpdated()}};
return h});define("goo/addons/howler/components/HowlerComponent",["goo/entities/components/Component"],function(g){function c(){this.type="HowlerComponent";this.sounds={}}c.prototype=Object.create(g.prototype);c.prototype.addSound=function(b,a){this.sounds[b]=a};c.prototype.playSound=function(b,a,d){this.sounds[b].play(a,d)};c.prototype.getSound=function(b){return this.sounds[b]};return c});
define("goo/renderer/RendererRecord",[],function(){function g(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}};this.currentFrameBuffer=null;this.clippingTestEnabled=this.clippingTestValid=!1;this.clips=[];this.enabledTextures=0;this.texturesValid=!1;this.currentTextureArraysUnit=0;this.textureRecord=[];this.usedProgram=null;this.boundAttributes=[];this.depthRecord={};this.cullRecord={};this.blendRecord={};this.offsetRecord={};this.lineRecord={};this.pointRecord=
{}}g.prototype.invalidateBuffer=function(c){this.currentBuffer[c].buffer=null;this.currentBuffer[c].valid=!1};return g});
define("goo/util/rsvp",["exports"],function(g){function c(b,d){a.async(function(){b.trigger("promise:resolved",{detail:d});b.isResolved=!0;b.resolvedValue=d})}function b(b,d){a.async(function(){b.trigger("promise:failed",{detail:d});b.isRejected=!0;b.rejectedValue=d})}var a={},d=typeof window!=="undefined"?window:{},d=d.MutationObserver||d.WebKitMutationObserver,e=window.process;if(typeof e!=="undefined"&&{}.toString.call(e)==="[object process]")a.async=function(a,b){e.nextTick(function(){a.call(b)})};
else if(d){var f=[],j=new d(function(){var a=f.slice();f=[];a.forEach(function(a){a[0].call(a[1])})}),h=document.createElement("div");j.observe(h,{attributes:!0});window.addEventListener("unload",function(){j.disconnect();j=null});a.async=function(a,b){f.push([a,b]);h.setAttribute("drainQueue","drainQueue")}}else a.async=function(a,b){setTimeout(function(){a.call(b)},1)};var k=function(a,b){this.type=a;for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])},i=function(a,b){for(var d=0,e=a.length;d<e;d++)if(a[d][0]===
b)return d;return-1},l=function(a){var b=a._promiseCallbacks;if(!b)b=a._promiseCallbacks={};return b},d={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,d){for(var e=l(this),f,c,a=a.split(/\s+/),d=d||this;c=a.shift();)(f=e[c])||(f=e[c]=[]),i(f,b)===-1&&f.push([b,d])},off:function(a,b){for(var d=l(this),e,f,a=a.split(/\s+/);e=a.shift();)b?(e=d[e],f=i(e,b),f!==-1&&e.splice(f,1)):d[e]=[]},trigger:function(a,b){var d,e,f,c;if(d=l(this)[a])for(var h=0,j=d.length;h<
j;h++)e=d[h],f=e[0],e=e[1],typeof b!=="object"&&(b={detail:b}),c=new k(a,b),f.call(e,c)}},m=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},o=function(){},p=function(a,b,d,e){var f=typeof d==="function",c,h,j,g;if(f)try{c=d(e.detail),j=!0}catch(i){g=!0,h=i}else c=e.detail,j=!0;if(c&&typeof c.then==="function")c.then(function(a){b.resolve(a)},function(a){b.reject(a)});
else if(f&&j)b.resolve(c);else if(g)b.reject(h);else b[a](c)};m.prototype={then:function(b,d){var e=new m;this.isResolved&&a.async(function(){p("resolve",e,b,{detail:this.resolvedValue})},this);this.isRejected&&a.async(function(){p("reject",e,d,{detail:this.rejectedValue})},this);this.on("promise:resolved",function(a){p("resolve",e,b,a)});this.on("promise:failed",function(a){p("reject",e,d,a)});return e},resolve:function(a){c(this,a);this.reject=this.resolve=o},reject:function(a){b(this,a);this.reject=
this.resolve=o}};d.mixin(m.prototype);g.Promise=m;g.Event=k;g.EventTarget=d;g.all=function(a){var b,d=[],e=new m,f=a.length;f===0&&e.resolve([]);var c=function(a){return function(b){d[a]=b;--f===0&&e.resolve(d)}},h=function(a){e.reject(a)};for(b=0;b<f;b++)a[b].then(c(b),h);return e};g.configure=function(b,d){a[b]=d}});
define("goo/util/Ajax",["goo/util/rsvp"],function(g){function c(b){this._loadStack=[];this._callback=b}c.prototype.get=function(b){var a=new g.Promise,d=this._progress.bind(this),e={loaded:0,total:0,lengthComputable:!1};this._loadStack.push(e);var b=b||{},f=new XMLHttpRequest;f.open("GET",b.url||"",!0);if(b.responseType)f.responseType=b.responseType;f.onreadystatechange=function(){if(f.readyState===4)f.status>=200&&f.status<=299?(e.loaded=e.total,d(),a.resolve(f)):a.reject(f.statusText)};f.addEventListener("progress",
function(a){e.loaded=a.loaded||a.position;e.total=a.total||a.totalSize;e.lengthComputable=a.lengthComputable;d()},!1);f.send();return a};c.prototype._progress=function(){if(this._callback){for(var b={total:0,loaded:0,count:this._loadStack.length},a=0;a<this._loadStack.length;a++)b.total+=this._loadStack[a].total,b.loaded+=this._loadStack[a].loaded;this._callback(b)}};c.ARRAY_BUFFER="arraybuffer";c.prototype.load=function(b,a){if(typeof b==="undefined"||b===null)throw Error("Ajax(): `path` was undefined/null");
var d={url:b};if(a===c.ARRAY_BUFFER)d.responseType=c.ARRAY_BUFFER;var e=this.get(d).then(function(a){return a.response});e.then(null,function(a){console.error("Ajax.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a);throw Error("Ajax.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a);});return e};c.prototype.loadImage=function(b,a){window.URL=window.URL||window.webkitURL;var d=new g.Promise,e=new Image;e.addEventListener("load",function(){e.dataReady=!0;window.URL.revokeObjectURL(e.src);
d.resolve(e)},!1);e.addEventListener("error",function(a){console.log(a);d.reject("Ajax.loadImage(): Couldn't load from ["+b+"]")},!1);a?this.load(b,function(a){var a=new Uint8Array(a,0,a.byteLength),d="image/jpeg";/\.png$/.test(b)&&(d="image/png");a=new Blob([a],{type:d});e.src=window.URL.createObjectURL(a);return e},c.ARRAY_BUFFER):e.src=b;return d};return c});
define("goo/loaders/Loader",["goo/util/rsvp","goo/util/Ajax"],function(g,c){function b(a){if(typeof a!=="undefined"&&a!==null&&typeof a!=="object")throw Error("Loader(): Argument `parameters` must be of type `object`");else if(typeof a==="undefined"||a===null)a={};this.rootPath=a.rootPath||"";this.xhr=a.xhr||new c(this._progressCallback.bind(this));this._progressCallbacks=[];this.total=0}b.prototype.load=function(a,d,e){if(typeof a==="undefined"||a===null)throw Error("Loader(): `path` was undefined/null");
var f={url:this._buildURL(a)};if(e===b.ARRAY_BUFFER)f.responseType=b.ARRAY_BUFFER;a=this.xhr.get(f).then(function(a){return a.response});d&&(a=a.then(function(a){return typeof d==="function"?d(a):a}));a.then(function(){console.log("Loaded: "+f.url)});a.then(null,function(a){console.error("Loader.load(): Could not retrieve data from `"+f.url+"`.\n Reason: "+a);throw Error("Loader.load(): Could not retrieve data from `"+f.url+"`.\n Reason: "+a);});return a};b.prototype.addProgressCallback=function(a){this._progressCallbacks.push(a)};
b.prototype.removeProgressCallback=function(a){for(var b=0;b<this._progressCallbacks.length;b++)if(this._progressCallbacks[b]===a){this._progressCallbacks.splice(b,1);break}};b.prototype._progressCallback=function(a){if(this.total)a.total=this.total;for(var b=0;b<this._progressCallbacks.length;b++)this._progressCallbacks[b](a)};b.prototype.loadImage=function(a,d){window.URL=window.URL||window.webkitURL;var e=new g.Promise,f=new Image;f.addEventListener("load",function(){f.dataReady=!0;window.URL.revokeObjectURL(f.src);
e.resolve(f)},!1);f.addEventListener("error",function(){e.reject("Loader.loadImage(): Couldn't load from ["+a+"]")},!1);d?this.load(a,function(b){var b=new Uint8Array(b,0,b.byteLength),d="image/jpeg";/\.png$/.test(a)&&(d="image/png");b=new Blob([b],{type:d});f.src=window.URL.createObjectURL(b)},b.ARRAY_BUFFER):f.src=this._buildURL(a);return e};b.prototype._buildURL=function(a){return this.rootPath+window.escape(a)};b.ARRAY_BUFFER="arraybuffer";return b});
define("goo/renderer/Texture",["goo/math/Vector2"],function(g){function c(b,a,d,e){this.glTexture=null;a=a||{};this.wrapS=a.wrapS||"Repeat";this.wrapT=a.wrapT||"Repeat";this.magFilter=a.magFilter||"Bilinear";this.minFilter=a.minFilter||"Trilinear";this.anisotropy=a.anisotropy!==void 0?a.anisotropy:1;this.format=a.format||"RGBA";this.type=a.type||"UnsignedByte";this.variant="2D";this.offset=new g(a.offset||[0,0]);this.repeat=new g(a.repeat||[1,1]);this.generateMipmaps=a.generateMipmaps!==void 0?a.generateMipmaps:
!0;this.premultiplyAlpha=a.premultiplyAlpha!==void 0?a.premultiplyAlpha:!1;this.flipY=a.flipY!==void 0?a.flipY:!0;this.needsUpdate=this.hasBorder=!1;this.readyCallback=this.updateCallback=null;b&&this.setImage(b,a,d,e)}c.prototype.checkDataReady=function(){return this.image&&(this.image.dataReady||this.image instanceof HTMLImageElement)||this.readyCallback!==null&&this.readyCallback()};c.prototype.checkNeedsUpdate=function(){return this.needsUpdate||this.updateCallback!==null&&this.updateCallback()};
c.prototype.setNeedsUpdate=function(){this.needsUpdate=!0};c.prototype.setImage=function(b,a,d,e){this.image=b;var f=b instanceof Array?b[0]:b;if(f instanceof Uint8Array||f instanceof Uint8ClampedArray||f instanceof Uint16Array)if(d=d||b.width,e=e||b.height,d!==void 0&&e!==void 0)if(this.image={data:b},this.image.width=d,this.image.height=e,this.image.isData=!0,this.image.dataReady=!0,f instanceof Uint8Array||f instanceof Uint8ClampedArray)a.type="UnsignedByte";else{if(f instanceof Uint16Array)a.type=
"UnsignedShort4444"}else throw"Data textures need width and height";else if(b instanceof Array)this.image={data:b}};c.CUBE_FACES="PositiveX,NegativeX,PositiveY,NegativeY,PositiveZ,NegativeZ".split(",");return c});
define("goo/loaders/dds/DdsUtils",[],function(){function g(){}g.getDdsExtension=function(c){for(var b=["","WEBKIT_","MOZ_"],a=0;a<b.length;a++){var d=c.getExtension(b[a]+"WEBGL_compressed_texture_s3tc");if(typeof d!=="undefined"&&d!==null)return d}return null};g.isSupported=function(c){return g.getDdsExtension(c)!==null};g.shiftCount=function(c){if(c===0)return 0;for(var b=0;(c&1)===0;)if(c>>=1,b++,b>32)throw"invalid mask!";return b};g.isSet=function(c,b){return(c&b)===b};g.getIntFromString=function(c){for(var b=
[],a=0;a<c.length;a++)b[a]=c.charCodeAt(a);return g.getIntFromBytes(b)};g.getIntFromBytes=function(c){var b=0;b|=(c[0]&255)<<0;c.length>1&&(b|=(c[1]&255)<<8);c.length>2&&(b|=(c[2]&255)<<16);c.length>3&&(b|=(c[3]&255)<<24);return b};g.getComponents=function(c){switch(c){case "Alpha":return 1;case "RGB":return 3;case "RGBA":return 4;case "Luminance":return 1;case "LuminanceAlpha":return 2;case "PrecompressedDXT1":return 1;case "PrecompressedDXT1A":return 1;case "PrecompressedDXT3":return 2;case "PrecompressedDXT5":return 2}return 0};
g.flipDXT=function(c,b,a,d){for(var e=new Uint8Array(c.length),b=b+3>>2,a=a+3>>2,f=g.getComponents(d)*8,j=0;j<a;j++)for(var h=a-j-1,k=0;k<b;k++){var i=(h*b+k)*f,l=(j*b+k)*f;switch(d){case "PrecompressedDXT1":case "PrecompressedDXT1A":e[i+0]=c[l+0];e[i+1]=c[l+1];e[i+2]=c[l+2];e[i+3]=c[l+3];e[i+4]=c[l+7];e[i+5]=c[l+6];e[i+6]=c[l+5];e[i+7]=c[l+4];break;case "PrecompressedDXT3":e[i+0]=c[l+6];e[i+1]=c[l+7];e[i+2]=c[l+4];e[i+3]=c[l+5];e[i+4]=c[l+2];e[i+5]=c[l+3];e[i+6]=c[l+0];e[i+7]=c[l+1];e[i+8]=c[l+8];
e[i+9]=c[l+9];e[i+10]=c[l+10];e[i+11]=c[l+11];e[i+12]=c[l+15];e[i+13]=c[l+14];e[i+14]=c[l+13];e[i+15]=c[l+12];break;case "PrecompressedDXT5":e[i+0]=c[l+0],e[i+1]=c[l+1],g.getBytesFromUInt24(e,i+5,g.flipUInt24(g.getUInt24(c,l+2))),g.getBytesFromUInt24(e,i+2,g.flipUInt24(g.getUInt24(c,l+5))),e[i+8]=c[l+8],e[i+9]=c[l+9],e[i+10]=c[l+10],e[i+11]=c[l+11],e[i+12]=c[l+15],e[i+13]=c[l+14],e[i+14]=c[l+13],e[i+15]=c[l+12]}}return e};g.getUInt24=function(c,b){var a=0;a|=(c[b+0]&255)<<0;a|=(c[b+1]&255)<<8;a|=
(c[b+2]&255)<<16;return a};g.getBytesFromUInt24=function(c,b,a){c[b+0]=a&255;c[b+1]=(a&65280)>>8;c[b+2]=(a&16711680)>>16};g.ThreeBitMask=7;g.flipUInt24=function(c){for(var b=[],a=0;a<2;a++)b.push([0,0,0,0]);b[0][0]=c&g.ThreeBitMask;c>>=3;b[0][1]=c&g.ThreeBitMask;c>>=3;b[0][2]=c&g.ThreeBitMask;c>>=3;b[0][3]=c&g.ThreeBitMask;c>>=3;b[1][0]=c&g.ThreeBitMask;c>>=3;b[1][1]=c&g.ThreeBitMask;c>>=3;b[1][2]=c&g.ThreeBitMask;c>>=3;b[1][3]=c&g.ThreeBitMask;c=0;c|=b[1][0]<<0;c|=b[1][1]<<3;c|=b[1][2]<<6;c|=b[1][3]<<
9;c|=b[0][0]<<12;c|=b[0][1]<<15;c|=b[0][2]<<18;c|=b[0][3]<<21;return c};return g});
define("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(g){function c(){this.dwABitMask=this.dwBBitMask=this.dwGBitMask=this.dwRBitMask=this.dwRGBBitCount=this.dwFourCC=this.dwFlags=this.dwSize=0}function b(){this.dwAlphaBitDepth=this.dwMipMapCount=this.dwDepth=this.dwLinearSize=this.dwWidth=this.dwHeight=this.dwFlags=this.dwSize=0;this.dwReserved1=[];this.ddpf=null;this.dwTextureStage=this.dwCaps4=this.dwCaps3=this.dwCaps2=this.dwCaps=0}function a(){this.flipVertically=!1;this.bpp=
0;this.headerDX10=this.header=null;this.mipmapByteSizes=[]}function d(){}c.HEADER_OFFSET=19;c.DDPF_ALPHAPIXELS=1;c.DDPF_ALPHA=2;c.DDPF_FOURCC=4;c.DDPF_RGB=64;c.DDPF_YUV=512;c.DDPF_LUMINANCE=131072;c.read=function(a){var b=new c;b.dwSize=a[c.HEADER_OFFSET+0];if(b.dwSize!==32)throw"invalid pixel format size: "+b.dwSize;b.dwFlags=a[c.HEADER_OFFSET+1];b.dwFourCC=a[c.HEADER_OFFSET+2];b.dwRGBBitCount=a[c.HEADER_OFFSET+3];b.dwRBitMask=a[c.HEADER_OFFSET+4];b.dwGBitMask=a[c.HEADER_OFFSET+5];b.dwBBitMask=a[c.HEADER_OFFSET+
6];b.dwABitMask=a[c.HEADER_OFFSET+7];return b};b.DDSD_CAPS=1;b.DDSD_HEIGHT=2;b.DDSD_WIDTH=4;b.DDSD_PITCH=8;b.DDSD_PIXELFORMAT=4096;b.DDSD_MIPMAPCOUNT=131072;b.DDSD_LINEARSIZE=524288;b.DDSD_DEPTH=8388608;b.DDSCAPS_COMPLEX=8;b.DDSCAPS_MIPMAP=4194304;b.DDSCAPS_TEXTURE=4096;b.DDSCAPS2_CUBEMAP=512;b.DDSCAPS2_CUBEMAP_POSITIVEX=1024;b.DDSCAPS2_CUBEMAP_NEGATIVEX=2048;b.DDSCAPS2_CUBEMAP_POSITIVEY=4096;b.DDSCAPS2_CUBEMAP_NEGATIVEY=8192;b.DDSCAPS2_CUBEMAP_POSITIVEZ=16384;b.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768;b.DDSCAPS2_VOLUME=
2097152;b.read=function(a){var d=new b;d.dwSize=a[1];if(d.dwSize!==124)throw"invalid dds header size: "+d.dwSize;d.dwFlags=a[2];d.dwHeight=a[3];d.dwWidth=a[4];d.dwLinearSize=a[5];d.dwDepth=a[6];d.dwMipMapCount=a[7];d.dwAlphaBitDepth=a[8];for(var j=0;j<d.dwReserved1.length;j++)d.dwReserved1[j]=a[9+j];d.ddpf=c.read(a);d.dwCaps=a[27];d.dwCaps2=a[28];d.dwCaps3=a[29];d.dwCaps4=a[30];d.dwTextureStage=a[31];a=1+Math.ceil(Math.log(Math.max(d.dwHeight,d.dwWidth))/Math.log(2));g.isSet(d.dwCaps,b.DDSCAPS_MIPMAP)?
g.isSet(d.dwFlags,b.DDSD_MIPMAPCOUNT)?d.dwMipMapCount!==a&&console.warn("Got "+d.dwMipMapCount+" mipmaps, expected "+a):d.dwMipMapCount=a:d.dwMipMapCount=1;return d};a.prototype.calcMipmapSizes=function(a){for(var b=this.header.dwWidth,d=this.header.dwHeight,c=0,g=0;g<this.header.dwMipMapCount;g++)c=a?~~((b+3)/4)*~~((d+3)/4)*this.bpp*2:~~(b*d*this.bpp/8),this.mipmapByteSizes.push(~~((c+3)/4)*4),b=~~(b/2)>1?~~(b/2):1,d=~~(d/2)>1?~~(d/2):1};d.updateDepth=function(a,d){if(g.isSet(d.header.dwCaps2,b.DDSCAPS2_CUBEMAP)){var c=
0;g.isSet(d.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEX)&&c++;g.isSet(d.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEX)&&c++;g.isSet(d.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEY)&&c++;g.isSet(d.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEY)&&c++;g.isSet(d.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEZ)&&c++;g.isSet(d.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&c++;if(c!==6)throw Error("Cubemaps without all faces defined are not currently supported.");a.depth=c}else a.depth=d.header.dwDepth>0?d.header.dwDepth:
1};d.readDXT=function(a,b,d,c){c.image.isCompressed=!0;if(!d.flipVertically)return new Uint8Array(a.buffer,a.byteOffset+0,b);for(var k=d.header.dwWidth,i=d.header.dwHeight,b=new Uint8Array(b),l=0,m=0;m<d.header.dwMipMapCount;m++){var o=a.subarray(l,l+d.mipmapByteSizes[m]),o=g.flipDXT(o,k,i,c.format);b.set(o,l);l+=o.length;k=~~(k/2)>1?~~(k/2):1;i=~~(i/2)>1?~~(i/2):1}return b};d.readUncompressed=function(a,b,d,c,k,i,l,m){for(var o=g.shiftCount(l.header.ddpf.dwRBitMask),p=g.shiftCount(l.header.ddpf.dwGBitMask),
n=g.shiftCount(l.header.ddpf.dwBBitMask),r=g.shiftCount(l.header.ddpf.dwABitMask),t=~~(l.header.ddpf.dwRGBBitCount/8),m=g.getComponents(m.format)*1,b=new Uint8Array(b),q=l.header.dwWidth,v=l.header.dwHeight,y=0,s=0,u=0,z=[],u=0;u<t;u++)z.push(0);for(var w=0;w<l.header.dwMipMapCount;w++){for(var A=0;A<v;A++)for(var x=0;x<q;x++){for(u=0;u<t;u++)z[u]=a[s++];var u=g.getIntFromBytes(z),B=(u&l.header.ddpf.dwRBitMask)>>o,D=(u&l.header.ddpf.dwGBitMask)>>p,C=(u&l.header.ddpf.dwBBitMask)>>n,u=(u&l.header.ddpf.dwABitMask)>>
r;k?b[y++]=u:c?(b[y++]=B,i&&(b[y++]=u)):d&&(b[y++]=B,b[y++]=D,b[y++]=C,i&&(b[y++]=u))}y+=q*v*m;q=~~(q/2)>1?~~(q/2):1;v=~~(v/2)>1?~~(v/2):1}return b};d.populate=function(a,b,j){var h=b.header.ddpf.dwFlags,k=g.isSet(h,c.DDPF_FOURCC),i=g.isSet(h,c.DDPF_RGB),l=g.isSet(h,c.DDPF_ALPHAPIXELS),m=g.isSet(h,c.DDPF_LUMINANCE),h=g.isSet(h,c.DDPF_ALPHA);a.type="UnsignedByte";if(k){var o=b.header.ddpf.dwFourCC;if(o===g.getIntFromString("DXT1"))b.bpp=4,a.format="PrecompressedDXT1A";else if(o===g.getIntFromString("DXT3"))b.bpp=
8,a.format="PrecompressedDXT3";else if(o===g.getIntFromString("DXT5"))b.bpp=8,a.format="PrecompressedDXT5";else if(o===g.getIntFromString("DX10"))throw Error("dxt10 LATC formats not supported currently: "+b.headerDX10.dxgiFormat);else if(o===g.getIntFromString("DXT2"))throw"DXT2 is not supported.";else if(o===g.getIntFromString("DXT4"))throw"DXT4 is not supported.";else throw"unsupported compressed dds format found ("+o+")";}else if(b.bpp=b.header.ddpf.dwRGBBitCount,i)a.format=l?"RGBA":"RGB";else if(m||
l)if(m&&l)a.format="LuminanceAlpha";else if(m)a.format="Luminance";else{if(h)a.format="Alpha"}else throw Error("unsupported uncompressed dds format found.");b.calcMipmapSizes(k);a.image.mipmapSizes=b.mipmapByteSizes;for(var p=o=0;p<b.mipmapByteSizes.length;p++)o+=b.mipmapByteSizes[p];for(var n=[],p=0;p<a.image.depth;p++)k?n.push(d.readDXT(j,o,b,a)):(i||m||h)&&n.push(d.readUncompressed(j,o,i,m,h,l,b,a));a.image.data=a.image.depth===1?n[0]:n;a.image.useArrays=!0};d.prototype.load=function(e,f,c,h,k){var i=
new Int32Array(e,h+0,32);if(i[0]!==g.getIntFromString("DDS "))throw"Not a dds file.";var l=new a;l.flipVertically=c;l.header=b.read(i);l.headerDX10=l.header.ddpf.dwFourCC===g.getIntFromString("DX10")?b.read(Int32Array.create(e,h+128,5)):null;c=f.image;if(typeof c==="undefined"||c===null)c={},f.image=c;c.width=l.header.dwWidth;c.height=l.header.dwHeight;d.updateDepth(c,l);i=128+(l.headerDX10?20:0);d.populate(f,l,new Uint8Array(e,h+i,k-i));if(!l.mipmapByteSizes||l.mipmapByteSizes.length<2)f.minFilter=
"BilinearNoMipMaps";c.bpp=l.bpp;c.dataReady=!0;f.needsUpdate=!0};d.SUPPORTS_DDS=!1;d.prototype.isSupported=function(){return d.SUPPORTS_DDS};d.prototype.toString=function(){return"DdsLoader"};return d});
define("goo/loaders/tga/TgaLoader",[],function(){function g(){this.header=null;this.offset=0;this.use_grey=this.use_rgb=this.use_pal=this.use_rle=!1}g.TYPE_NO_DATA=0;g.TYPE_INDEXED=1;g.TYPE_RGB=2;g.TYPE_GREY=3;g.TYPE_RLE_INDEXED=9;g.TYPE_RLE_RGB=10;g.TYPE_RLE_GREY=11;g.ORIGIN_MASK=48;g.ORIGIN_SHIFT=4;g.ORIGIN_BL=0;g.ORIGIN_BR=1;g.ORIGIN_UL=2;g.ORIGIN_UR=3;g.prototype.load=function(c,b){this.loadData(new Uint8Array(c));var a=this.getImageData();b.setImage(a,null,a.width,a.height);a.dataReady=!0;b.needsUpdate=
!0};g.prototype.loadData=function(c){if(c.length<19)throw Error("Targa::load() - Not enough data to contain header.");this.offset=0;this.header={id_length:c[this.offset++],colormap_type:c[this.offset++],image_type:c[this.offset++],colormap_index:c[this.offset++]|c[this.offset++]<<8,colormap_length:c[this.offset++]|c[this.offset++]<<8,colormap_size:c[this.offset++],origin:[c[this.offset++]|c[this.offset++]<<8,c[this.offset++]|c[this.offset++]<<8],width:c[this.offset++]|c[this.offset++]<<8,height:c[this.offset++]|
c[this.offset++]<<8,pixel_size:c[this.offset++],flags:c[this.offset++]};this.checkHeader();if(this.header.id_length+this.offset>c.length)throw Error("Targa::load() - No data ?");this.offset+=this.header.id_length;switch(this.header.image_type){case g.TYPE_RLE_INDEXED:this.use_rle=!0;break;case g.TYPE_INDEXED:this.use_pal=!0;break;case g.TYPE_RLE_RGB:this.use_rle=!0;break;case g.TYPE_RGB:this.use_rgb=!0;break;case g.TYPE_RLE_GREY:this.use_rle=!0;break;case g.TYPE_GREY:this.use_grey=!0}this.parse(c)};
g.prototype.checkHeader=function(){switch(this.header.image_type){case g.TYPE_INDEXED:case g.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||this.header.colormap_size!==24||this.header.colormap_type!==1)throw Error("Targa::checkHeader() - Invalid type colormap data for indexed type");break;case g.TYPE_RGB:case g.TYPE_GREY:case g.TYPE_RLE_RGB:case g.TYPE_RLE_GREY:if(this.header.colormap_type)throw Error("Targa::checkHeader() - Invalid type colormap data for colormap type");break;case g.TYPE_NO_DATA:throw Error("Targa::checkHeader() - No data on this TGA file");
default:throw Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'");}if(this.header.width<=0||this.header.height<=0)throw Error("Targa::checkHeader() - Invalid image size");if(this.header.pixel_size!==8&&this.header.pixel_size!==16&&this.header.pixel_size!==24&&this.header.pixel_size!==32)throw Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'");};g.prototype.parse=function(c){var i;var b,a,d;b=this.header;a=b.pixel_size>>3;d=b.width*b.height*a;if(this.use_pal)this.palettes=
c.subarray(this.offset,this.offset+=b.colormap_length*a);if(this.use_rle){b=new Uint8Array(d);for(var e,f,j=0,h=new Uint8Array(a);j<d;)if(e=c[this.offset++],f=(e&127)+1,e&128){for(e=0;e<a;++e)h[e]=c[this.offset++];for(e=0;e<f;++e)b.set(h,j+e*a);j+=a*f}else{f*=a;for(e=0;e<f;++e)b[j+e]=c[this.offset++];j+=f}}else i=c.subarray(this.offset,this.offset+=this.use_pal?b.width*b.height:d),b=i;this.image=b};g.prototype.getImageData=function(c){var b=this.header.width,a=this.header.height,d,e,f,j;j=c||document&&
document.createElement("canvas").getContext("2d").createImageData(b,a)||{width:b,height:a,data:new Uint8Array(b*a*4)};switch((this.header.flags&g.ORIGIN_MASK)>>g.ORIGIN_SHIFT){default:case g.ORIGIN_UL:c=0;d=1;f=b;b=0;e=1;break;case g.ORIGIN_BL:c=0;d=1;f=b;b=a-1;a=e=-1;break;case g.ORIGIN_UR:c=b-1;f=d=-1;b=0;e=1;break;case g.ORIGIN_BR:c=b-1,f=d=-1,b=a-1,a=e=-1}this["getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits"](j.data,b,e,a,c,d,f);return j};g.prototype.getCanvas=function(){var c=
document.createElement("canvas"),b=c.getContext("2d"),a=b.createImageData(this.header.width,this.header.height);c.width=this.header.width;c.height=this.header.height;b.putImageData(this.getImageData(a),0,0);return c};g.prototype.getDataURL=function(c){return this.getCanvas().toDataURL(c||"image/png")};g.prototype.getImageData8bits=function(c,b,a,d,e,f,j){var h=this.image,g=this.palettes,i=this.header.width,l=0,m,o;for(o=b;o!==d;o+=a)for(m=e;m!==j;m+=f,l++)b=h[l],c[(m+i*o)*4+3]=255,c[(m+i*o)*4+2]=
g[b*3+0],c[(m+i*o)*4+1]=g[b*3+1],c[(m+i*o)*4+0]=g[b*3+2];return c};g.prototype.getImageData16bits=function(c,b,a,d,e,f,j){var h=this.image,g=this.header.width,i=0,l,m;for(m=b;m!==d;m+=a)for(l=e;l!==j;l+=f,i+=2)b=h[i+0]+(h[i+1]<<8),c[(l+g*m)*4+0]=(b&31744)>>7,c[(l+g*m)*4+1]=(b&992)>>2,c[(l+g*m)*4+2]=(b&31)>>3,c[(l+g*m)*4+3]=b&32768?0:255;return c};g.prototype.getImageData24bits=function(c,b,a,d,e,f,j){var h=this.image,g=this.header.width,i=0,l;for(l=b;l!==d;l+=a)for(b=e;b!==j;b+=f,i+=3)c[(b+g*l)*4+
3]=255,c[(b+g*l)*4+2]=h[i+0],c[(b+g*l)*4+1]=h[i+1],c[(b+g*l)*4+0]=h[i+2];return c};g.prototype.getImageData32bits=function(c,b,a,d,e,f,j){var h=this.image,g=this.header.width,i=0,l;for(l=b;l!==d;l+=a)for(b=e;b!==j;b+=f,i+=4)c[(b+g*l)*4+2]=h[i+0],c[(b+g*l)*4+1]=h[i+1],c[(b+g*l)*4+0]=h[i+2],c[(b+g*l)*4+3]=h[i+3];return c};g.prototype.getImageDataGrey8bits=function(c,b,a,d,e,f,j){var h=this.image,g=this.header.width,i=0,l,m;for(m=b;m!==d;m+=a)for(l=e;l!==j;l+=f,i++)b=h[i],c[(l+g*m)*4+0]=b,c[(l+g*m)*
4+1]=b,c[(l+g*m)*4+2]=b,c[(l+g*m)*4+3]=255;return c};g.prototype.getImageDataGrey16bits=function(c,b,a,d,e,f,g){var h=this.image,k=this.header.width,i=0,l;for(l=b;l!==d;l+=a)for(b=e;b!==g;b+=f,i+=2)c[(b+k*l)*4+0]=h[i+0],c[(b+k*l)*4+1]=h[i+0],c[(b+k*l)*4+2]=h[i+0],c[(b+k*l)*4+3]=h[i+1];return c};g.prototype.isSupported=function(){return!0};g.prototype.toString=function(){return"TgaLoader"};return g});
define("goo/util/SimpleResourceUtil",[],function(){function g(){}g.countdown=function(c,b,a){c[0]--;if(c[0]===0)b.onSuccess(a)};g.loadTextAsset=function(c,b,a,d,e,f){var j=new XMLHttpRequest;j.open("GET",a[b],!0);j.onreadystatechange=function(){if(j.readyState===4)if(j.status>=200&&j.status<=299)e[d[b]]=j.responseText,g.countdown(c,f,e);else f.onError(j.statusText)};j.send()};g.loadTextAssets=function(c,b,a){for(var d=[c.length],e={},f=0,j=c.length;f<j;f++)g.loadTextAsset(d,f,c,b,e,a)};g.loadBinaryAsArrayBuffer=
function(c,b){var a=new XMLHttpRequest;a.open("GET",c);a.responseType="arraybuffer";a.onload=function(){if(a.status!==404)b.onSuccess(a.response);else a.onerror(null)};a.onerror=function(){b.onError(null)};a.send()};return g});
define("goo/util/Latch",[],function(){function g(c,b){this.count=c;this.callback=b}g.prototype.countDown=function(){this.count--;this.isDone()&&this.callback&&this.callback.done?this.callback.done():this.callback&&this.callback.progress&&this.callback.progress(this.count)};g.prototype.isDone=function(){return this.count===0};return g});
define("goo/renderer/TextureCreator","goo/loaders/Loader,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/tga/TgaLoader,goo/util/SimpleResourceUtil,goo/renderer/Util,goo/util/Latch".split(","),function(g,c,b,a,d,e,f){function j(d){d=d||{};this.verticalFlip=d.verticalFlip!==void 0?d.verticalFlip:!0;this._loader=d.loader!==void 0?d.loader:new g;this.textureLoaders={".dds":new b,".tga":new a}}function h(a,b){return a.indexOf(b,a.length-b.length)!==-1}j.cache={};j.UNSUPPORTED_FALLBACK=".png";
j.clearCache=function(){j.cache={}};j.prototype.loadTexture2D=function(a,b,d){if(j.cache[a]!==void 0)return d&&d(),j.cache[a];var f=function(a){r.load(a,t,p.verticalFlip,0,a.byteLength);j._finishedLoading();d&&d()}.bind(this),o=function(b){console.warn("Error loading texture: "+a+" | "+b)}.bind(this),p=this,n;for(n in this.textureLoaders)if(h(a.toLowerCase(),n)){var r=this.textureLoaders[n];if(!r||!r.isSupported()){a=a.substring(0,a.length-n.length);a+=j.UNSUPPORTED_FALLBACK;b=b||{};b.flipY=!1;break}var t=
new c(e.clone(j.DEFAULT_TEXTURE_2D.image),b);t.image.dataReady=!1;t.a=a;j.cache[a]=t;this._loader.load(a,null,g.ARRAY_BUFFER).then(f,o);return t}if(j.cache[a]!==void 0)return d&&d(),j.cache[a];var q=new c(null,b);j.cache[a]=q;this._loader.loadImage(a).then(function(a){q.setImage(a);j._finishedLoading(a);d&&d()}).then(null,function(a){console.error(a)});return q};j.prototype.loadTextureVideo=function(a,b){if(j.cache[a]!==void 0)return j.cache[a];var d=document.createElement("video");d.loop=typeof b===
"boolean"?b:!0;d.addEventListener("error",function(){console.warn("Couldn't load video URL ["+a+"]")},!1);var f=new c(d,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});f.readyCallback=function(){if(d.readyState>=3){console.log("Video ready: "+d.videoWidth+", "+d.videoHeight);d.width=d.videoWidth;d.height=d.videoHeight;if(e.isPowerOfTwo(d.width)===!1||e.isPowerOfTwo(d.height)===!1)f.generateMipmaps=!1,f.minFilter="BilinearNoMipMaps";d.play();return d.dataReady=!0}return!1};f.updateCallback=function(){return!d.paused};
d.crossOrigin="anonymous";d.src=a;return j.cache[a]=f};j.prototype.loadTextureWebCam=function(){var a=document.createElement("video");a.autoplay=!0;a.loop=!0;var b=new c(a,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});b.readyCallback=function(){if(a.readyState>=3){console.log("WebCam video ready: "+a.videoWidth+", "+a.videoHeight);a.width=a.videoWidth;a.height=a.videoHeight;if(e.isPowerOfTwo(a.width)===!1||e.isPowerOfTwo(a.height)===!1)b.generateMipmaps=!1,b.minFilter="BilinearNoMipMaps";return a.dataReady=
!0}return!1};b.updateCallback=function(){return!a.paused};window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia?navigator.getUserMedia({video:!0},function(b){a.src=window.URL.createObjectURL(b)},function(a){console.warn("Unable to capture WebCam. Please reload the page.",a)}):console.warn("No support for WebCam getUserMedia found!");return b};j.prototype.loadTextureCube=
function(a,b){var d=new c(null,b);d.variant="CUBE";for(var e=[],h=new f(6,{done:function(){for(var a=e[0].width,b=e[0].height,f=0;f<6;f++){var c=e[f];if(a!==c.width||b!==c.height)d.generateMipmaps=!1,d.minFilter="BilinearNoMipMaps",console.error("Images not all the same size!")}d.setImage(e);d.image.dataReady=!0;d.image.width=a;d.image.height=b}}),g=this,j=0;j<a.length;j++)(function(b){var d=a[b];typeof d==="string"?g._loader.loadImage(d).then(function(a){e[b]=a;h.countDown()}):(e[b]=d,h.countDown())})(j);
return d};j._globalCallback=null;j._finishedLoading=function(a){if(j._globalCallback)try{j._globalCallback(a)}catch(b){console.error("Error in texture callback:",b)}};d=new Uint8Array([255,255,255,255]);j.DEFAULT_TEXTURE_2D=new c(d,null,1,1);j.DEFAULT_TEXTURE_CUBE=new c([d,d,d,d,d,d],null,1,1);j.DEFAULT_TEXTURE_CUBE.variant="CUBE";return j});
define("goo/renderer/pass/RenderTarget",["goo/math/Vector2"],function(g){function c(b,a,d){this._glFrameBuffer=this._glRenderBuffer=this.glTexture=null;this.width=Math.floor(b);this.height=Math.floor(a);d=d||{};this.wrapS=d.wrapS!==void 0?d.wrapS:"EdgeClamp";this.wrapT=d.wrapT!==void 0?d.wrapT:"EdgeClamp";this.magFilter=d.magFilter!==void 0?d.magFilter:"Bilinear";this.minFilter=d.minFilter!==void 0?d.minFilter:"BilinearNoMipMaps";this.anisotropy=d.anisotropy!==void 0?d.anisotropy:1;this.offset=new g(0,
0);this.repeat=new g(1,1);this.format=d.format!==void 0?d.format:"RGBA";this.type=d.type!==void 0?d.type:"UnsignedByte";this.variant="2D";this.depthBuffer=d.depthBuffer!==void 0?d.depthBuffer:!0;this.stencilBuffer=d.stencilBuffer!==void 0?d.stencilBuffer:!0;this.generateMipmaps=!1}c.prototype.clone=function(){var b=new c(this.width,this.height);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.anisotropy=this.anisotropy;b.minFilter=this.minFilter;b.offset.copy(this.offset);b.repeat.copy(this.repeat);
b.format=this.format;b.type=this.type;b.variant=this.variant;b.depthBuffer=this.depthBuffer;b.stencilBuffer=this.stencilBuffer;b.generateMipmaps=this.generateMipmaps;return b};return c});
define("goo/entities/Entity",[],function(){function g(b,a){this._world=b;this._components=[];Object.defineProperty(this,"id",{value:g.entityCount++,writable:!1});this.name=a!==void 0?a:"Entity_"+this.id;this.skip=!1}function c(b){return b.charAt(0).toLowerCase()+b.substr(1)}g.prototype.addToWorld=function(){this._world.addEntity(this)};g.prototype.removeFromWorld=function(){this._world.removeEntity(this)};g.prototype.setComponent=function(b){if(this.hasComponent(b.type))for(var a=0;a<this._components.length;a++){if(this._components[a].type===
b.type){this._components[a]=b;break}}else this._components.push(b);this[c(b.type)]=b;if(b.type==="TransformComponent")b.entity=this;this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,b,"addedComponent")};g.prototype.hasComponent=function(b){return this[c(b)]!==void 0};g.prototype.getComponent=function(b){return this[c(b)]};g.prototype.clearComponent=function(b){var a=this[c(b)],d=this._components.indexOf(a);if(d!==-1){a=this._components[d];if(a.type==="TransformComponent")a.entity=
void 0;this._components.splice(d,1)}delete this[c(b)];this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,a,"removedComponent")};g.prototype.toString=function(){return this.name};g.entityCount=0;return g});
define("goo/renderer/ShaderCall",[],function(){function g(a,b,e){this.context=a;this.location=b;this.location.value=void 0;if(e)switch(e){case "float":this.call=this.uniform1f;break;case "bool":case "int":case "integer":case "sampler2D":case "sampler3D":case "samplerCube":this.call=this.uniform1i;break;case "floatarray":this.call=this.uniform1fv;break;case "intarray":this.call=this.uniform1iv;break;case "vec2":this.call=this.uniform2fv;break;case "vec3":this.call=this.uniform3fv;break;case "vec4":this.call=
this.uniform4fv;break;case "mat2":this.call=this.uniformMatrix2fv;break;case "mat3":this.call=this.uniformMatrix3fv;break;case "mat4":this.call=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+e;}}function c(a,b,e){if(e<0)return!1;for(;e--;)if(a[e]!==b[e])return!1;return!0}function b(a,b){for(var e=a.length;e--;)if(a[e]!==b[e])return!1;return!0}g.prototype.uniform1f=function(a){if(this.location.value!==a)this.context.uniform1f(this.location,a),this.location.value=a};g.prototype.uniform1fv=
function(a){var d=this.location.value;if(!(d!==void 0&&b(a,d)))this.context.uniform1fv(this.location,a),this.location.value=a.slice()};g.prototype.uniform1i=function(a){if(this.location.value!==a)this.context.uniform1i(this.location,a),this.location.value=a};g.prototype.uniform1iv=function(a){var d=this.location.value;if(!(d!==void 0&&b(a,d)))this.context.uniform1iv(this.location,a),this.location.value=a.slice()};g.prototype.uniform2f=function(a,b){var e=this.location.value;if(!(e!==void 0&&e.length===
2&&e[0]===a&&e[1]===b))this.context.uniform2f(this.location,a,b),this.location.value=[a,b]};g.prototype.uniform2fv=function(a){var d=this.location.value;if(d!==void 0){if(b(a,d))return}else d=this.location.value=new Float64Array(a.length);this.context.uniform2fv(this.location,a);for(var e=a.length;e--;)d[e]=a[e]};g.prototype.uniform2i=function(a,b){var e=this.location.value;if(!(e!==void 0&&e.length===2&&e[0]===a&&e[1]===b))this.context.uniform2i(this.location,a,b),this.location.value=[a,b]};g.prototype.uniform2iv=
function(a){var d=this.location.value;if(!(d!==void 0&&b(a,d)))this.context.uniform2iv(this.location,a),this.location.value=a.slice()};g.prototype.uniform3f=function(a,b,e){var f=this.location.value;if(!(f!==void 0&&f.length===3&&f[0]===a&&f[1]===b&&f[2]===e))this.context.uniform3f(this.location,a,b,e),this.location.value=[a,b,e]};g.prototype.uniform3fv=function(a){var d=this.location.value;if(d!==void 0){if(b(a,d))return}else d=this.location.value=new Float64Array(a.length);this.context.uniform3fv(this.location,
a);for(var e=a.length;e--;)d[e]=a[e]};g.prototype.uniform3i=function(a,b,e){var f=this.location.value;if(!(f!==void 0&&f.length===3&&f[0]===a&&f[1]===b&&f[2]===e))this.context.uniform3i(this.location,a,b,e),this.location.value=[a,b,e]};g.prototype.uniform3iv=function(a){var d=this.location.value;if(!(d!==void 0&&b(a,d)))this.context.uniform3iv(this.location,a),this.location.value=a.slice()};g.prototype.uniform4f=function(a,b,e,f){var c=this.location.value;if(!(c!==void 0&&c.length===4&&c[0]===a&&
c[1]===b&&c[2]===e&&c[3]===f))this.context.uniform4f(this.location,a,b,e,f),this.location.value=[a,b,e,f]};g.prototype.uniform4fv=function(a){var d=this.location.value;if(d!==void 0){if(b(a,d))return}else d=this.location.value=new Float64Array(a.length);this.context.uniform4fv(this.location,a);for(var e=a.length;e--;)d[e]=a[e]};g.prototype.uniform4i=function(a,b,e,f){var c=this.location.value;if(!(c!==void 0&&c.length===4&&c[0]===a&&c[1]===b&&c[2]===e&&c[3]===f))this.context.uniform4i(this.location,
a,b,e,f),this.location.value=[a,b,e,f]};g.prototype.uniform4iv=function(a){var d=this.location.value;if(!(d!==void 0&&b(a,d)))this.context.uniform4iv(this.location,a),this.location.value=a.slice()};g.prototype.uniformMatrix2fv=function(a,b){b=b===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(c(e.data,a.data,4))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix2fv(this.location,b,a.data)}else this.context.uniformMatrix2fv(this.location,b,a)};g.prototype.uniformMatrix3fv=
function(a,b){b=b===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(c(e.data,a.data,9))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix3fv(this.location,b,a.data)}else this.context.uniformMatrix3fv(this.location,b,a)};g.prototype.uniformMatrix4fv=function(a,b){b=b===!0;if(a.data){var e=this.location.value;if(e!==void 0)if(c(e.data,a.data,16))return;else e.copy(a);else this.location.value=a.clone();this.context.uniformMatrix4fv(this.location,b,a.data)}else this.context.uniformMatrix4fv(this.location,
b,a)};return g});
define("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(g,c){function b(){c.call(this,4,4);arguments.length===0?this.setIdentity():this.set(arguments)}b.prototype=Object.create(c.prototype);b.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]);b.IDENTITY=new b(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);b.add=function(a,d,e){e||(e=new b);d instanceof b?(e.e00=a.e00+d.e00,e.e10=a.e10+d.e10,
e.e20=a.e20+d.e20,e.e30=a.e30+d.e30,e.e01=a.e01+d.e01,e.e11=a.e11+d.e11,e.e21=a.e21+d.e21,e.e31=a.e31+d.e31,e.e02=a.e02+d.e02,e.e12=a.e12+d.e12,e.e22=a.e22+d.e22,e.e32=a.e32+d.e32,e.e03=a.e03+d.e03,e.e13=a.e13+d.e13,e.e23=a.e23+d.e23,e.e33=a.e33+d.e33):(e.e00=a.e00+d,e.e10=a.e10+d,e.e20=a.e20+d,e.e30=a.e30+d,e.e01=a.e01+d,e.e11=a.e11+d,e.e21=a.e21+d,e.e31=a.e31+d,e.e02=a.e02+d,e.e12=a.e12+d,e.e22=a.e22+d,e.e32=a.e32+d,e.e03=a.e03+d,e.e13=a.e13+d,e.e23=a.e23+d,e.e33=a.e33+d);return e};b.prototype.add=
function(a){return b.add(this,a,this)};b.sub=function(a,d,e){e||(e=new b);d instanceof b?(e.e00=a.e00-d.e00,e.e10=a.e10-d.e10,e.e20=a.e20-d.e20,e.e30=a.e30-d.e30,e.e01=a.e01-d.e01,e.e11=a.e11-d.e11,e.e21=a.e21-d.e21,e.e31=a.e31-d.e31,e.e02=a.e02-d.e02,e.e12=a.e12-d.e12,e.e22=a.e22-d.e22,e.e32=a.e32-d.e32,e.e03=a.e03-d.e03,e.e13=a.e13-d.e13,e.e23=a.e23-d.e23,e.e33=a.e33-d.e33):(e.e00=a.e00-d,e.e10=a.e10-d,e.e20=a.e20-d,e.e30=a.e30-d,e.e01=a.e01-d,e.e11=a.e11-d,e.e21=a.e21-d,e.e31=a.e31-d,e.e02=a.e02-
d,e.e12=a.e12-d,e.e22=a.e22-d,e.e32=a.e32-d,e.e03=a.e03-d,e.e13=a.e13-d,e.e23=a.e23-d,e.e33=a.e33-d);return e};b.prototype.sub=function(a){return b.sub(this,a,this)};b.mul=function(a,d,e){e||(e=new b);d instanceof b?(e.e00=a.e00*d.e00,e.e10=a.e10*d.e10,e.e20=a.e20*d.e20,e.e30=a.e30*d.e30,e.e01=a.e01*d.e01,e.e11=a.e11*d.e11,e.e21=a.e21*d.e21,e.e31=a.e31*d.e31,e.e02=a.e02*d.e02,e.e12=a.e12*d.e12,e.e22=a.e22*d.e22,e.e32=a.e32*d.e32,e.e03=a.e03*d.e03,e.e13=a.e13*d.e13,e.e23=a.e23*d.e23,e.e33=a.e33*d.e33):
(e.e00=a.e00*d,e.e10=a.e10*d,e.e20=a.e20*d,e.e30=a.e30*d,e.e01=a.e01*d,e.e11=a.e11*d,e.e21=a.e21*d,e.e31=a.e31*d,e.e02=a.e02*d,e.e12=a.e12*d,e.e22=a.e22*d,e.e32=a.e32*d,e.e03=a.e03*d,e.e13=a.e13*d,e.e23=a.e23*d,e.e33=a.e33*d);return e};b.prototype.mul=function(a){return b.mul(this,a,this)};b.div=function(a,d,e){e||(e=new b);d instanceof b?(e.e00=a.e00/d.e00,e.e10=a.e10/d.e10,e.e20=a.e20/d.e20,e.e30=a.e30/d.e30,e.e01=a.e01/d.e01,e.e11=a.e11/d.e11,e.e21=a.e21/d.e21,e.e31=a.e31/d.e31,e.e02=a.e02/d.e02,
e.e12=a.e12/d.e12,e.e22=a.e22/d.e22,e.e32=a.e32/d.e32,e.e03=a.e03/d.e03,e.e13=a.e13/d.e13,e.e23=a.e23/d.e23,e.e33=a.e33/d.e33):(d=1/d,e.e00=a.e00*d,e.e10=a.e10*d,e.e20=a.e20*d,e.e30=a.e30*d,e.e01=a.e01*d,e.e11=a.e11*d,e.e21=a.e21*d,e.e31=a.e31*d,e.e02=a.e02*d,e.e12=a.e12*d,e.e22=a.e22*d,e.e32=a.e32*d,e.e03=a.e03*d,e.e13=a.e13*d,e.e23=a.e23*d,e.e33=a.e33*d);return e};b.prototype.div=function(a){return b.div(this,a,this)};b.combine=function(a,d,e){e||(e=new b);var f=a.data,a=f[0],c=f[4],h=f[8],g=f[12],
i=f[1],l=f[5],m=f[9],o=f[13],p=f[2],n=f[6],r=f[10],t=f[14],q=f[3],v=f[7],y=f[11],f=f[15],s=d.data,d=s[0],u=s[4],z=s[8],w=s[12],A=s[1],x=s[5],B=s[9],D=s[13],C=s[2],F=s[6],G=s[10],H=s[14],I=s[3],J=s[7],K=s[11],s=s[15],E=e.data;E[0]=a*d+c*A+h*C+g*I;E[4]=a*u+c*x+h*F+g*J;E[8]=a*z+c*B+h*G+g*K;E[12]=a*w+c*D+h*H+g*s;E[1]=i*d+l*A+m*C+o*I;E[5]=i*u+l*x+m*F+o*J;E[9]=i*z+l*B+m*G+o*K;E[13]=i*w+l*D+m*H+o*s;E[2]=p*d+n*A+r*C+t*I;E[6]=p*u+n*x+r*F+t*J;E[10]=p*z+n*B+r*G+t*K;E[14]=p*w+n*D+r*H+t*s;E[3]=q*d+v*A+y*C+f*I;
E[7]=q*u+v*x+y*F+f*J;E[11]=q*z+v*B+y*G+f*K;E[15]=q*w+v*D+y*H+f*s;return e};b.prototype.combine=function(a){return b.combine(this,a,this)};b.transpose=function(a,d){d||(d=new b);var e=a.data,f=d.data;if(d===a){var c=e[4],h=e[8],g=e[12],i=e[9],l=e[13],m=e[14];f[4]=e[1];f[8]=e[2];f[12]=e[3];f[9]=e[6];f[13]=e[7];f[14]=e[11];f[1]=c;f[2]=h;f[3]=g;f[6]=i;f[7]=l;f[11]=m;return d}f[0]=e[0];f[1]=e[4];f[2]=e[8];f[3]=e[12];f[4]=e[1];f[5]=e[5];f[6]=e[9];f[7]=e[13];f[8]=e[2];f[9]=e[6];f[10]=e[10];f[11]=e[14];f[12]=
e[3];f[13]=e[7];f[14]=e[11];f[15]=e[15];return d};b.prototype.transpose=function(){return b.transpose(this,this)};b.invert=function(a,d){d||(d=new b);if(d===a)return c.copy(b.invert(a),d);var e=a.determinant();if(Math.abs(e)<g.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};var f=a.data,j=d.data,e=1/e;j[0]=(f[5]*(f[10]*f[15]-f[14]*f[11])-f[9]*(f[6]*f[15]-f[14]*f[7])+f[13]*(f[6]*f[11]-f[10]*f[7]))*e;j[1]=(f[1]*(f[14]*f[11]-f[10]*f[15])-f[9]*(f[14]*f[3]-
f[2]*f[15])+f[13]*(f[10]*f[3]-f[2]*f[11]))*e;j[2]=(f[1]*(f[6]*f[15]-f[14]*f[7])-f[5]*(f[2]*f[15]-f[14]*f[3])+f[13]*(f[2]*f[7]-f[6]*f[3]))*e;j[3]=(f[1]*(f[10]*f[7]-f[6]*f[11])-f[5]*(f[10]*f[3]-f[2]*f[11])+f[9]*(f[6]*f[3]-f[2]*f[7]))*e;j[4]=(f[4]*(f[14]*f[11]-f[10]*f[15])-f[8]*(f[14]*f[7]-f[6]*f[15])+f[12]*(f[10]*f[7]-f[6]*f[11]))*e;j[5]=(f[0]*(f[10]*f[15]-f[14]*f[11])-f[8]*(f[2]*f[15]-f[14]*f[3])+f[12]*(f[2]*f[11]-f[10]*f[3]))*e;j[6]=(f[0]*(f[14]*f[7]-f[6]*f[15])-f[4]*(f[14]*f[3]-f[2]*f[15])+f[12]*
(f[6]*f[3]-f[2]*f[7]))*e;j[7]=(f[0]*(f[6]*f[11]-f[10]*f[7])-f[4]*(f[2]*f[11]-f[10]*f[3])+f[8]*(f[2]*f[7]-f[6]*f[3]))*e;j[8]=(f[4]*(f[9]*f[15]-f[13]*f[11])-f[8]*(f[5]*f[15]-f[13]*f[7])+f[12]*(f[5]*f[11]-f[9]*f[7]))*e;j[9]=(f[0]*(f[13]*f[11]-f[9]*f[15])-f[8]*(f[13]*f[3]-f[1]*f[15])+f[12]*(f[9]*f[3]-f[1]*f[11]))*e;j[10]=(f[0]*(f[5]*f[15]-f[13]*f[7])-f[4]*(f[1]*f[15]-f[13]*f[3])+f[12]*(f[1]*f[7]-f[5]*f[3]))*e;j[11]=(f[0]*(f[9]*f[7]-f[5]*f[11])-f[4]*(f[9]*f[3]-f[1]*f[11])+f[8]*(f[5]*f[3]-f[1]*f[7]))*e;
j[12]=(f[4]*(f[13]*f[10]-f[9]*f[14])-f[8]*(f[13]*f[6]-f[5]*f[14])+f[12]*(f[9]*f[6]-f[5]*f[10]))*e;j[13]=(f[0]*(f[9]*f[14]-f[13]*f[10])-f[8]*(f[1]*f[14]-f[13]*f[2])+f[12]*(f[1]*f[10]-f[9]*f[2]))*e;j[14]=(f[0]*(f[13]*f[6]-f[5]*f[14])-f[4]*(f[13]*f[2]-f[1]*f[14])+f[12]*(f[5]*f[2]-f[1]*f[6]))*e;j[15]=(f[0]*(f[5]*f[10]-f[9]*f[6])-f[4]*(f[1]*f[10]-f[9]*f[2])+f[8]*(f[1]*f[6]-f[5]*f[2]))*e;return d};b.prototype.invert=function(){return b.invert(this,this)};b.prototype.isOrthogonal=function(){var a;a=this.e00*
this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31;if(Math.abs(a)>g.EPSILON)return!1;a=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32;if(Math.abs(a)>g.EPSILON)return!1;a=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33;if(Math.abs(a)>g.EPSILON)return!1;a=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32;if(Math.abs(a)>g.EPSILON)return!1;a=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33;if(Math.abs(a)>
g.EPSILON)return!1;a=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33;return Math.abs(a)>g.EPSILON?!1:!0};b.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30;if(Math.abs(a-1)>g.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31;if(Math.abs(a-1)>g.EPSILON)return!1;a=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32;if(Math.abs(a-1)>g.EPSILON)return!1;a=this.e03*
this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33;return Math.abs(a-1)>g.EPSILON?!1:!0};b.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};b.prototype.determinant=function(){var a=this.data;return a[0]*(a[5]*a[10]*a[15]+a[9]*a[14]*a[7]+a[13]*a[6]*a[11]-a[13]*a[10]*a[7]-a[9]*a[6]*a[15]-a[5]*a[14]*a[11])-a[4]*(a[1]*a[10]*a[15]+a[9]*a[14]*a[3]+a[13]*a[2]*a[11]-a[13]*a[10]*a[3]-a[9]*a[2]*a[15]-a[1]*a[14]*a[11])+a[8]*(a[1]*a[6]*a[15]+a[5]*a[14]*a[3]+a[13]*a[2]*
a[7]-a[13]*a[6]*a[3]-a[5]*a[2]*a[15]-a[1]*a[14]*a[7])-a[12]*(a[1]*a[6]*a[11]+a[5]*a[10]*a[3]+a[9]*a[2]*a[7]-a[9]*a[6]*a[3]-a[5]*a[2]*a[11]-a[1]*a[10]*a[7])};b.prototype.setIdentity=function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this};b.prototype.setRotationFromVector=function(a){var b=Math.sin(a.x),e=Math.cos(a.x),f=Math.sin(a.y),c=Math.cos(a.y),h=Math.sin(a.z),a=Math.cos(a.z);this.e00=a*c;this.e10=
h*c;this.e20=0-f;this.e01=a*f*b-h*e;this.e11=h*f*b+a*e;this.e21=c*b;this.e02=a*f*e+h*b;this.e12=h*f*e-a*b;this.e22=c*e;return this};b.prototype.setRotationFromQuaternion=function(a){var b=a.lengthSquared(),b=b>0?2/b:0,e=a.x*b,f=a.y*b,c=a.z*b,b=a.w*e,h=a.w*f,g=a.w*c;e*=a.x;var i=a.x*f,l=a.x*c;f*=a.y;var m=a.y*c,a=a.z*c;this.e00=1-f-a;this.e10=i+g;this.e20=l-h;this.e01=i-g;this.e11=1-e-a;this.e21=m+b;this.e02=l+h;this.e12=m-b;this.e22=1-e-f;return this};b.prototype.setTranslation=function(a){this.e03=
a.x;this.e13=a.y;this.e23=a.z;return this};b.prototype.getTranslation=function(a){a.x=this.data[12];a.y=this.data[13];a.z=this.data[14];return this};b.prototype.getScale=function(a){var b=Math.sqrt(a.setd(this.data[0],this.data[4],this.data[8]).lengthSquared()),e=Math.sqrt(a.setd(this.data[1],this.data[5],this.data[9]).lengthSquared()),f=Math.sqrt(a.setd(this.data[2],this.data[6],this.data[10]).lengthSquared());a.x=b;a.y=e;a.z=f;return this};b.prototype.setScale=function(a){this.e00*=a.x;this.e10*=
a.y;this.e20*=a.z;this.e01*=a.x;this.e11*=a.y;this.e21*=a.z;this.e02*=a.x;this.e12*=a.y;this.e22*=a.z;return this};b.prototype.applyPre=function(a){var b=a.data[0],e=a.data[1],f=a.data[2],c=a.data[3],h=this.data;a.data[0]=h[0]*b+h[1]*e+h[2]*f+h[3]*c;a.data[1]=h[4]*b+h[5]*e+h[6]*f+h[7]*c;a.data[2]=h[8]*b+h[9]*e+h[10]*f+h[11]*c;a.data[3]=h[12]*b+h[13]*e+h[14]*f+h[15]*c;return a};b.prototype.applyPost=function(a){var b=a.data[0],e=a.data[1],f=a.data[2],c=a.data[3],h=this.data;a.data[0]=h[0]*b+h[4]*e+
h[8]*f+h[12]*c;a.data[1]=h[1]*b+h[5]*e+h[9]*f+h[13]*c;a.data[2]=h[2]*b+h[6]*e+h[10]*f+h[14]*c;a.data[3]=h[3]*b+h[7]*e+h[11]*f+h[15]*c;return a};b.prototype.applyPostPoint=function(a){var b=a.data[0],e=a.data[1],f=a.data[2],c=this.data;a.data[0]=c[0]*b+c[4]*e+c[8]*f+c[12];a.data[1]=c[1]*b+c[5]*e+c[9]*f+c[13];a.data[2]=c[2]*b+c[6]*e+c[10]*f+c[14];return a};b.prototype.applyPostVector=function(a){var b=a.x,e=a.y,f=a.z,c=this.data;a.x=c[0]*b+c[4]*e+c[8]*f;a.y=c[1]*b+c[5]*e+c[9]*f;a.z=c[2]*b+c[6]*e+c[10]*
f;return a};b.prototype.copy=function(a){var b=this.data,a=a.data;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};b.prototype.clone=function(){var a=this.data;return new b(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])};return b});
define("goo/entities/managers/EntityManager",[],function(){function g(){this.type="EntityManager";this._entitiesById=[];this._entityCount=0}g.prototype.added=function(c){this.containsEntity(c)||(this._entitiesById[c.id]=c,this._entityCount++)};g.prototype.removed=function(c){this.containsEntity(c)&&(delete this._entitiesById[c.id],this._entityCount--)};g.prototype.containsEntity=function(c){return this._entitiesById[c.id]!==void 0};g.prototype.getEntityById=function(c){return this._entitiesById[c]};
g.prototype.getEntityByName=function(c){for(var b in this._entitiesById){var a=this._entitiesById[b];if(a.name===c)return a}};g.prototype.size=function(){return this._entityCount};g.prototype.getEntities=function(){var c=[],b;for(b in this._entitiesById)c.push(this._entitiesById[b]);return c};g.prototype.getTopEntities=function(){var c=[],b;for(b in this._entitiesById){var a=this._entitiesById[b];a.transformComponent?a.transformComponent.parent||c.push(a):c.push(a)}return c};return g});
define("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4"],function(g,c,b){function a(){this.matrix=new b;this.translation=new g;this.rotation=new c;this.scale=new g(1,1,1);this.tmpVec=new g;this.tmpVec2=new g;this.tmpMat1=new c}a.combine=function(b,e,f){if(b.scale.data[0]!==b.scale.data[1]||b.scale.data[0]!==b.scale.data[2])throw{name:"NonUniformScaleException",message:"Non-uniform scaling in left hand transform, cannot resolve combined transform"};var f=f||new a,
g=f.tmpVec;g.setv(e.translation);b.rotation.applyPost(g);g.mulv(b.scale);g.addv(b.translation);var h=f.tmpVec2;h.setv(e.scale);h.mulv(b.scale);var k=f.tmpMat1;c.combine(b.rotation,e.rotation,k);f.rotation.copy(k);f.scale.setv(h);f.translation.setv(g);return f};a.prototype.combine=function(b){return a.combine(this,b,this)};a.prototype.multiply=function(a,e){b.combine(a.matrix,e.matrix,this.matrix);this.tmpMat1.data.set(a.rotation.data);this.tmpMat1.multiplyDiagonalPost(a.scale,this.tmpMat1);this.rotation.data.set(e.rotation.data);
this.rotation.multiplyDiagonalPost(e.scale,this.rotation);c.combine(this.tmpMat1,this.rotation,this.rotation);this.translation.setv(e.translation);this.tmpMat1.applyPost(this.translation).addv(a.translation);this.scale.setv(a.scale).mulv(e.scale)};a.prototype.setIdentity=function(){this.matrix.setIdentity();this.translation.setv(g.ZERO);this.rotation.setIdentity();this.scale.setv(g.ONE)};a.prototype.applyForward=function(a,b){b.setv(a);this.matrix.applyPostPoint(b);return b};a.prototype.applyForwardVector=
function(a,b){b.copy(a);b.set(b.x*this.scale.x,b.y*this.scale.y,b.z*this.scale.z);this.rotation.applyPost(b);return b};a.prototype.update=function(){var a=this.matrix.data,b=this.rotation.data,f=this.scale.data,c=this.translation.data;a[0]=f[0]*b[0];a[1]=f[0]*b[1];a[2]=f[0]*b[2];a[3]=0;a[4]=f[1]*b[3];a[5]=f[1]*b[4];a[6]=f[1]*b[5];a[7]=0;a[8]=f[2]*b[6];a[9]=f[2]*b[7];a[10]=f[2]*b[8];a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1};a.prototype.copy=function(a){this.matrix.copy(a.matrix);this.translation.setv(a.translation);
this.rotation.copy(a.rotation);this.scale.setv(a.scale)};a.prototype.setRotationXYZ=function(a,b,f){this.rotation.fromAngles(a,b,f)};a.prototype.lookAt=function(a,b){this.tmpVec.setv(this.translation).subv(a).normalize();this.rotation.lookAt(this.tmpVec,b)};a.prototype.invert=function(b){b||(b=new a);b.matrix.copy(this.matrix);b.matrix.invert();var e=b.rotation.copy(this.rotation);e.multiplyDiagonalPost(this.scale,e).invert();b.translation.copy(this.translation);b.rotation.applyPost(b.translation).invert();
return b};a.prototype.toString=function(){return""+this.matrix};return a});
define("goo/entities/components/TransformComponent",["goo/math/Transform","goo/math/Vector3","goo/entities/components/Component"],function(g,c,b){function a(){this.type="TransformComponent";this.parent=null;this.children=[];this.transform=new g;this.worldTransform=new g;this._dirty=!0;this._updated=!1}a.prototype=Object.create(b.prototype);a.prototype.setTranslation=function(a,b,f){if(a instanceof Array){if(a.length!==3)throw Error("length of the array argument to setTranslation must be 3");for(b=
0;b<3;b++)if(typeof a[b]!=="number")throw Error("elements of the array argument to setTranslation must be of type number");this.transform.translation.seta(a)}else if(a instanceof c)this.transform.translation.setv(a);else if(typeof a==="number"&&typeof b==="number"&&typeof f==="number")this.transform.translation.setd(a,b,f);else throw Error("arguments to setTranslation must be either 3 numbers or one Vector3 or one Array with 3 numbers.");this._dirty=!0};a.prototype.setRotation=function(a,b,f){this.transform.rotation.fromAngles(a,
b,f);this._dirty=!0};a.prototype.lookAt=function(a,b){this.transform.lookAt(a,b);this._dirty=!0};a.prototype.setUpdated=function(){this._dirty=!0};a.prototype.attachChild=function(a){for(var b=this;b;){if(b===a){console.warn("attachChild: An object can't be added as a descendant of itself.");return}b=b.parent}a.parent&&a.parent.detachChild(a);a.parent=this;this.children.push(a)};a.prototype.detachChild=function(a){if(a===this)console.warn("attachChild: An object can't be removed from itself.");else{var b=
this.children.indexOf(a);if(b!==-1)a.parent=null,this.children.splice(b,1)}};a.prototype.updateTransform=function(){this.transform.update()};a.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform);this._dirty=!1;this._updated=!0};return a});
define("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent"],function(g,c,b){function a(){this._managers=[];this._systems=[];this._addedEntities=[];this._changedEntities=[];this._removedEntities=[];this.entityManager=new c;this.setManager(this.entityManager);this.time=0;this.tpf=1}a.time=0;a.prototype.setManager=function(a){this._managers.push(a)};a.prototype.getManager=function(a){for(var b=0;b<this._managers.length;b++){var f=
this._managers[b];if(f.type===a)return f}};a.prototype.setSystem=function(a){this._systems.push(a)};a.prototype.getSystem=function(a){for(var b=0;b<this._systems.length;b++){var f=this._systems[b];if(f.type===a)return f}};a.prototype.createEntity=function(a){a=new g(this,a);a.setComponent(new b);return a};a.prototype.getEntities=function(){return this.entityManager.getEntities()};a.prototype.addEntity=function(a){this._addedEntities.push(a)};a.prototype.removeEntity=function(a){this._removedEntities.push(a)};
a.prototype.changedEntity=function(a,b,f){a={entity:a};if(b!==void 0)a.component=b;if(f!==void 0)a.eventType=f;this._changedEntities.push(a)};a.prototype.process=function(){this._check(this._addedEntities,function(a,b){a.added&&a.added(b);if(a.addedComponent)for(var d=0;d<b._components.length;d++)a.addedComponent(b,b._components[d])});this._check(this._changedEntities,function(a,b){a.changed&&a.changed(b.entity);if(b.eventType!==void 0&&a[b.eventType])a[b.eventType](b.entity,b.component)});this._check(this._removedEntities,
function(a,b){a.removed&&a.removed(b);if(a.removedComponent)for(var d=0;d<b._components.length;d++)a.removedComponent(b,b._components[d])});for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.passive||b._process(this.tpf)}};a.prototype._check=function(a,b){for(var f=0;f<a.length;f++){for(var c=a[f],h=0;h<this._managers.length;h++)b(this._managers[h],c);for(h=0;h<this._systems.length;h++)b(this._systems[h],c)}a.length=0};return a});
define("goo/renderer/RenderQueue",["goo/math/Vector3"],function(g){function c(){var b=this,a=new g;this.opaqueSorter=function(d,e){var f=d.meshRendererComponent.materials[0],c=e.meshRendererComponent.materials[0];if(f===null||c===null)return 0;if(f===c)return f=d.meshRendererComponent.worldBound,c=e.meshRendererComponent.worldBound,f=a.setv(b.camera.translation).subv(f.center).lengthSquared(),c=a.setv(b.camera.translation).subv(c.center).lengthSquared(),f-c;f=f.shader;c=c.shader;if(f===null||c===
null)return 0;return f._id===c._id?(f=d.meshRendererComponent.worldBound,c=e.meshRendererComponent.worldBound,f=a.setv(b.camera.translation).subv(f.center).lengthSquared(),c=a.setv(b.camera.translation).subv(c.center).lengthSquared(),f-c):f._id-c._id};this.transparentSorter=function(d,e){var f=d.meshRendererComponent.worldBound,c=e.meshRendererComponent.worldBound,f=a.setv(b.camera.translation).subv(f.center).lengthSquared();return a.setv(b.camera.translation).subv(c.center).lengthSquared()-f};this.bucketSorter=
function(a,b){return a-b}}c.prototype.sort=function(b,a){var d=0;this.camera=a;for(var e={},f=[],g=0;g<b.length;g++){var h=b[g],k=h.meshRendererComponent;if(!k||k.materials.length===0)b[d]=h,d++;else{var i=k.materials[0].getRenderQueue(),k=e[i];k||(k=[],e[i]=k,f.push(i));k.push(h)}}f.length>1&&f.sort(this.bucketSorter);for(h=0;h<f.length;h++){g=f[h];k=e[g];g<=c.TRANSPARENT?k.sort(this.opaqueSorter):k.sort(this.transparentSorter);for(g=0;g<k.length;g++)b[d]=k[g],d++}};c.BACKGROUND=0;c.OPAQUE=1E3;c.TRANSPARENT=
2E3;c.OVERLAY=3E3;return c});
define("goo/renderer/Shader","goo/renderer/ShaderCall,goo/math/Matrix4x4,goo/math/Vector3,goo/entities/World,goo/renderer/RenderQueue,goo/renderer/Util".split(","),function(g,c,b,a,d,e){function f(a,b){if(!b.vshader||!b.fshader)throw Error("Missing shader sources for shader: "+a);this.shaderDefinition=this.originalShaderDefinition=b;this.name=a;this.origVertexSource=this.vertexSource=b.vshader;this.origFragmentSource=this.fragmentSource=b.fshader;this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping=
{};this.uniformMapping={};this.uniformCallMapping={};this.textureSlots=[];this.textureSlotsNaming={};this.currentCallbacks={};this.overridePrecision=b.precision||null;this.processors=b.processors||[];this.defines=b.defines||{};this.attributes=b.attributes||{};this.uniforms=b.uniforms||{};this.renderQueue=d.OPAQUE;this._id=f.id++;this.errorOnce=!1}var j=window.WebGLRenderingContext;f.id=0;f.prototype.clone=function(){return new f(this.name,e.clone({precision:this.precision,processors:this.processors,
defines:this.defines,attributes:this.attributes,uniforms:this.uniforms,vshader:this.origVertexSource,fshader:this.origFragmentSource}))};f.prototype.cloneOriginal=function(){return new f(this.name,this.originalShaderDefinition)};var h=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;f.prototype.apply=function(a,b){var d=b.context,e=b.rendererRecord;this.shaderProgram===null&&(this._investigateShaders(),this.addDefines(this.defines),
this.addPrecision(this.overridePrecision||b.shaderPrecision),this.compile(b));var f=!1;if(e.usedProgram!==this.shaderProgram)d.useProgram(this.shaderProgram),e.usedProgram=this.shaderProgram,f=!0;if(this.attributes){var d=a.meshData.attributeMap,c;for(c in this.attributes)if(e=d[this.attributes[c]]){var h=this.attributeIndexMapping[c];h!==void 0&&(f&&b.context.enableVertexAttribArray(h),b.bindVertexAttribute(h,e))}}if(this.uniforms)try{for(var g in this.uniforms)this._bindUniform(g,a);this.errorOnce=
!1}catch(j){if(this.errorOnce===!1)console.error(j.stack),this.errorOnce=!0}};f.prototype._bindUniform=function(a,b){var d=this.uniformCallMapping[a];if(d!==void 0){var e=b.material.uniforms[a]||this.uniforms[a];typeof e==="string"?(e=this.currentCallbacks[a])?e(d,b):(e=this.textureSlotsNaming[a],e!==void 0&&d.call(e.index)):(e=typeof e==="function"?e(b):e,d.call(e))}};f.prototype.rebuild=function(){this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping=
{};this.uniformCallMapping={};this.currentCallbacks={};this.vertexSource=this.origVertexSource;this.fragmentSource=this.origFragmentSource};f.prototype._investigateShaders=function(){this.textureSlots=[];this.textureSlotsNaming={};f.investigateShader(this.vertexSource,this);f.investigateShader(this.fragmentSource,this)};f.investigateShader=function(a,b){h.lastIndex=0;for(var d=h.exec(a);d!==null;){var e={format:d[2]},f=d[1],c=d[3];if(d[4])if(e.format==="float")e.format="floatarray";else if(e.format===
"int")e.format="intarray";"attribute"===f?b.attributeMapping[c]=e:(e.format.indexOf("sampler")===0&&(d={format:e.format,name:c,mapping:b.uniforms[c],index:b.textureSlots.length},b.textureSlots.push(d),b.textureSlotsNaming[d.name]=d),b.uniformMapping[c]=e);d=h.exec(a)}};f.prototype.compile=function(a){var a=a.context,b=this._getShader(a,j.VERTEX_SHADER,this.vertexSource),d=this._getShader(a,j.FRAGMENT_SHADER,this.fragmentSource);(b===null||d===null)&&console.error("Shader error - no shaders");this.shaderProgram=
a.createProgram();var e=a.getError();(this.shaderProgram===null||e!==j.NO_ERROR)&&console.error("Shader error: "+e+" [shader: "+this.name+"]");a.attachShader(this.shaderProgram,b);a.attachShader(this.shaderProgram,d);a.linkProgram(this.shaderProgram);a.getProgramParameter(this.shaderProgram,j.LINK_STATUS)||console.error("Could not initialise shaders: "+a.getProgramInfoLog(this.shaderProgram));for(var f in this.attributeMapping)b=a.getAttribLocation(this.shaderProgram,f),b!==-1&&(this.attributeIndexMapping[f]=
b);for(f in this.uniformMapping)if(b=a.getUniformLocation(this.shaderProgram,f),b===null){d=this.textureSlots.length;for(b=0;b<d;b++)if(e=this.textureSlots[b],e.name===f){this.textureSlots.splice(b,1);for(delete this.textureSlotsNaming[e.name];b<d-1;b++)this.textureSlots[b].index--;break}}else this.uniformCallMapping[f]=new g(a,b,this.uniformMapping[f].format);if(this.uniforms){if(this.uniforms.$link){a=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link];for(b=0;b<a.length;b++)for(f in d=
a[b],d)this.uniforms[f]=d[f];delete this.uniforms.$link}for(var c in this.uniforms)f=this.uniforms[c],this.defaultCallbacks[f]&&(this.currentCallbacks[c]=this.defaultCallbacks[f])}};var k=/\bERROR: \d+:(\d+):\s(.+)\b/g;f.prototype._getShader=function(a,b,d){var e=a.createShader(b);a.shaderSource(e,d);a.compileShader(e);if(!a.getShaderParameter(e,j.COMPILE_STATUS)){a=a.getShaderInfoLog(e);b=b===j.VERTEX_SHADER?"VertexShader":"FragmentShader";k.lastIndex=0;var f=k.exec(a);if(f!==null)for(;f!==null;){var e=
d.split("\n"),c=f[1],f=f[2];console.error("Error in "+b+" - ["+this.name+"]["+this._id+"] at line "+c+":");console.error("\tError: "+f);console.error("\tSource: "+e[c-1]);f=k.exec(a)}else console.error("Error in "+b+" - ["+this.name+"]["+this._id+"] "+a);return null}return e};var i=/\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;f.prototype.addPrecision=function(a){i.lastIndex=0;if(i.exec(this.vertexSource)===null)this.vertexSource="precision "+a+" float;\n"+this.vertexSource;i.lastIndex=0;if(i.exec(this.fragmentSource)===
null)this.fragmentSource="precision "+a+" float;\n"+this.fragmentSource};f.prototype.addDefines=function(a){if(a)a=this.generateDefines(a),this.vertexSource=a+"\n"+this.vertexSource,this.fragmentSource=a+"\n"+this.fragmentSource};f.prototype.generateDefines=function(a){var b=[],d;for(d in a){var e=a[d];e!==!1&&b.push("#define "+d+" "+e)}return b.join("\n")};f.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,
uniforms:this.uniforms}};f.prototype.toString=function(){return this.name};f.PROJECTION_MATRIX="PROJECTION_MATRIX";f.VIEW_MATRIX="VIEW_MATRIX";f.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX";f.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX";f.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX";f.WORLD_MATRIX="WORLD_MATRIX";for(b=0;b<8;b++)f["LIGHT"+b]="LIGHT"+b;f.CAMERA="CAMERA";f.AMBIENT="AMBIENT";f.EMISSIVE="EMISSIVE";f.DIFFUSE="DIFFUSE";f.SPECULAR="SPECULAR";f.SPECULAR_POWER="SPECULAR_POWER";
f.NEAR_PLANE="NEAR_PLANE";f.FAR_PLANE="FAR_PLANE";f.MAIN_NEAR_PLANE="NEAR_PLANE";f.MAIN_FAR_PLANE="FAR_PLANE";f.TIME="TIME";f.RESOLUTION="RESOLUTION";f.LIGHT_PROJECTION_MATRIX="LIGHT_PROJECTION_MATRIX";f.LIGHT_VIEW_MATRIX="LIGHT_VIEW_MATRIX";f.LIGHT_VIEW_PROJECTION_MATRIX="LIGHT_VIEW_PROJECTION_MATRIX";f.LIGHT_NEAR_PLANE="LIGHT_NEAR_PLANE";f.LIGHT_FAR_PLANE="LIGHT_FAR_PLANE";f.LIGHT_DEPTH_SCALE="LIGHT_DEPTH_SCALE";f.DIFFUSE_MAP="DIFFUSE_MAP";f.NORMAL_MAP="NORMAL_MAP";f.SPECULAR_MAP="SPECULAR_MAP";
f.LIGHT_MAP="LIGHT_MAP";f.SHADOW_MAP="SHADOW_MAP";f.AO_MAP="AO_MAP";f.EMISSIVE_MAP="EMISSIVE_MAP";f.DEPTH_MAP="DEPTH_MAP";f.prototype.defaultCallbacks={};(function(b){var d=new c;b[f.PROJECTION_MATRIX]=function(a,b){var d=b.camera.getProjectionMatrix();a.uniformMatrix4fv(d)};b[f.VIEW_MATRIX]=function(a,b){var d=b.camera.getViewMatrix();a.uniformMatrix4fv(d)};b[f.WORLD_MATRIX]=function(a,b){a.uniformMatrix4fv(b.transform!==void 0?b.transform.matrix:d)};b[f.VIEW_INVERSE_MATRIX]=function(a,b){var d=
b.camera.getViewInverseMatrix();a.uniformMatrix4fv(d)};b[f.VIEW_PROJECTION_MATRIX]=function(a,b){var d=b.camera.getViewProjectionMatrix();a.uniformMatrix4fv(d)};b[f.VIEW_PROJECTION_INVERSE_MATRIX]=function(a,b){var d=b.camera.getViewProjectionInverseMatrix();a.uniformMatrix4fv(d)};for(var e=0;e<16;e++)b[f["TEXTURE"+e]]=function(a){return function(b){b.uniform1i(a)}}(e);for(e=0;e<8;e++)b[f["LIGHT"+e]]=function(a){return function(b,d){var e=d.lights[a];e!==void 0?b.uniform3f(e.translation.data[0],e.translation.data[1],
e.translation.data[2]):b.uniform3f(-20,20,20)}}(e);b[f.LIGHTCOUNT]=function(a,b){a.uniform1i(b.lights.length)};b[f.CAMERA]=function(a,b){var d=b.camera.translation;a.uniform3f(d.data[0],d.data[1],d.data[2])};b[f.NEAR_PLANE]=function(a,b){a.uniform1f(b.camera.near)};b[f.FAR_PLANE]=function(a,b){a.uniform1f(b.camera.far)};b[f.MAIN_NEAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.near)};b[f.MAIN_FAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.far)};var h=[0,0,0,1],g=[0,0,0,0],j=[1,1,1,1],i=[0.8,
0.8,0.8,1];b[f.AMBIENT]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.ambient:h)};b[f.EMISSIVE]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.emissive:g)};b[f.DIFFUSE]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.diffuse:j)};b[f.SPECULAR]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.specular:i)};b[f.SPECULAR_POWER]=function(a,b){var d=b.material.materialState!==
void 0?b.material.materialState.shininess:16,d=Math.max(d,1);a.uniform1f(d)};b[f.TIME]=function(b){b.uniform1f(a.time)};b[f.LIGHT_PROJECTION_MATRIX]=function(a,b){var d=b.lightCamera.getProjectionMatrix();a.uniformMatrix4fv(d)};b[f.LIGHT_VIEW_MATRIX]=function(a,b){var d=b.lightCamera.getViewMatrix();a.uniformMatrix4fv(d)};b[f.LIGHT_VIEW_PROJECTION_MATRIX]=function(a,b){var d=b.lightCamera.getViewProjectionMatrix();a.uniformMatrix4fv(d)};b[f.LIGHT_NEAR_PLANE]=function(a,b){a.uniform1f(b.lightCamera.near)};
b[f.LIGHT_FAR_PLANE]=function(a,b){a.uniform1f(b.lightCamera.far)};b[f.LIGHT_DEPTH_SCALE]=function(a,b){a.uniform1f(1/(b.lightCamera.far-b.lightCamera.near))};b[f.RESOLUTION]=function(a,b){a.uniform2f(b.renderer.viewportWidth,b.renderer.viewportHeight)}})(f.prototype.defaultCallbacks);return f});
define("goo/renderer/Material",["goo/renderer/Shader"],function(g){function c(b){this.name=b;this.shader=null;this.uniforms={};this._textureMaps={};this.materialState=void 0;this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"};this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"};this.depthState={enabled:!0,write:!0};this.offsetState={enabled:!1,factor:1,units:1};this.flat=this.wireframe=!1;this.renderQueue=null}c.prototype.setTexture=
function(b,a){this._textureMaps[b]=a};c.prototype.getTexture=function(b){return this._textureMaps[b]};c.prototype.removeTexture=function(b){delete this._textureMaps[b]};c.prototype.getTextures=function(){var b=[],a;for(a in this._textureMaps)b.push(this._textureMaps[a]);return b};c.prototype.getTextureEntries=function(){return this._textureMaps};c.prototype.getRenderQueue=function(){if(this.renderQueue!==null)return this.renderQueue;else if(this.shader!==null)return this.shader.renderQueue;return 1E3};
c.prototype.setRenderQueue=function(b){this.renderQueue=b};c.store=[];c.hash=[];c.createShader=function(b,a){var d=c.store.indexOf(b);if(d!==-1)return c.hash[d];d=new g(a||null,b);if(d.name===null)d.name="DefaultShader"+d._id;c.store.push(b);c.hash.push(d);return d};c.clearShaderCache=function(){c.store.length=0;c.hash.length=0};c.createMaterial=function(b,a){var d=new c(a||"DefaultMaterial");d.shader=c.createShader(b);return d};c.createEmptyMaterial=function(b,a){var d=new c(a||"Empty Material");
d.empty();if(b)d.shader=c.createShader(b);return d};c.prototype.empty=function(){this.cullState={};this.blendState={};this.depthState={};this.offsetState={};this.flat=this.renderQueue=this.wireframe=void 0;this._textureMaps={};this.shader=void 0;this.uniforms={}};return c});
define("goo/renderer/shaders/ShaderFragment",[],function(){function g(){}g.noisecommon="vec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}";g.noise2d=[g.noisecommon,"float snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}"].join("\n");
g.noise3d=[g.noisecommon,"vec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat snoise(vec3 v) {\n\tconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i  = floor(v + dot(v, C.yyy) );\n\tvec3 x0 =   v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min( g.xyz, l.zxy );\n\tvec3 i2 = max( g.xyz, l.zxy );\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i); \n\tvec4 p = permute( permute( permute( \n         i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n       + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n       + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3  ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\tvec4 x = x_ *ns.x + ns.yyyy;\n\tvec4 y = y_ *ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4( x.xy, y.xy );\n\tvec4 b1 = vec4( x.zw, y.zw );\n\tvec4 s0 = floor(b0)*2.0 + 1.0;\n\tvec4 s1 = floor(b1)*2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\tvec3 p0 = vec3(a0.xy,h.x);\n\tvec3 p1 = vec3(a0.zw,h.y);\n\tvec3 p2 = vec3(a1.xy,h.z);\n\tvec3 p3 = vec3(a1.zw,h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );\n}"].join("\n");
g.methods={packDepth:"vec4 packDepth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = fract( depth * bit_shift );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}",unpackDepth:"float unpackDepth( const in vec4 rgba_depth ) {\n\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\tfloat depth = dot( rgba_depth, bit_shift );\n\treturn depth;\n}",
packDepth16:"vec2 packDepth16( const in float depth ) {\n\tconst vec2 bias = vec2(1.0 / 255.0, 0.0);\n\tvec2 res = vec2(depth, fract(depth * 255.0));\n\treturn res - (res.yy * bias);\n}",unpackDepth16:"float unpackDepth16( const in vec2 rg_depth ) {\n\treturn rg_depth.x + (rg_depth.y / 255.0);\n}"};return g});
define("goo/renderer/light/Light",["goo/math/Vector3"],function(g){return function(){this.translation=new g;this.color=new g(1,1,1);this.specularIntensity=this.intensity=1;this.shadowCaster=!1;this.shadowSettings={type:"Blur",projection:"Perspective",fov:55,size:100,near:1,far:1E3};this.changedColor=this.changedProperties=!1}});
define("goo/renderer/light/PointLight",["goo/math/Vector3","goo/renderer/light/Light"],function(g,c){function b(){c.call(this);this.range=1E3}b.prototype=Object.create(c.prototype);b.prototype.update=function(a){a.matrix.getTranslation(this.translation)};return b});
define("goo/renderer/light/DirectionalLight",["goo/math/Vector3","goo/renderer/light/Light"],function(g,c){function b(){c.call(this);this.direction=new g}b.prototype=Object.create(c.prototype);b.prototype.update=function(a){a.matrix.getTranslation(this.translation);this.direction.setd(0,0,-1);a.matrix.applyPostVector(this.direction)};return b});
define("goo/renderer/light/SpotLight",["goo/math/Vector3","goo/renderer/light/Light"],function(g,c){function b(){c.call(this);this.direction=new g;this.range=1E3;this.angle=45;this.exponent=16}b.prototype=Object.create(c.prototype);b.prototype.update=function(a){a.matrix.getTranslation(this.translation);this.direction.setd(0,0,-1);a.matrix.applyPostVector(this.direction)};return b});
define("goo/util/TangentGenerator",["goo/math/Vector2","goo/math/Vector3","goo/renderer/MeshData"],function(g,c,b){function a(){}a.addTangentBuffer=function(a,e){function f(a){for(var b=[],d=0;d<a.length;d+=3)b.push(new c(a[d+0],a[d+1],a[d+2]));return b}var e=e||0,j=a.getAttributeBuffer(b.POSITION);if(!j)throw Error("Vertex buffer is null!");var h=a.getAttributeBuffer(b.NORMAL);if(!h)throw Error("Normal buffer is null!");var k=a.getAttributeBuffer("TEXCOORD"+e);!k&&e!==0&&(k=a.getAttributeBuffer(b.TEXCOORD0));
if(!k)throw Error("Texture buffer is null!");var i=a.getIndexBuffer();if(!i)throw Error("Index buffer is null!");for(var l=a.vertexCount,m=a.indexCount/3,o=[],p=[],n=0;n<l;n++)o[n]=new c,p[n]=new c;j=f(j);h=f(h);n=function(a){for(var b=[],d=0;d<a.length;d+=2)b.push(new g(a[d+0],a[d+1]));return b}(k);for(k=0;k<m;k++){var r=i[k*3],t=i[k*3+1],q=i[k*3+2],v=j[r],y=j[t],s=j[q],u=n[r],z=n[t],w=n[q],A=y.x-v.x,x=s.x-v.x,B=y.y-v.y,D=s.y-v.y,y=y.z-v.z,v=s.z-v.z,s=z.x-u.x,C=w.x-u.x,z=z.y-u.y,w=w.y-u.y,u=1/(s*
w-C*z);isFinite(u)!==!1&&(w=new c((w*A-z*x)*u,(w*B-z*D)*u,(w*y-z*v)*u),A=new c((s*x-C*A)*u,(s*D-C*B)*u,(s*v-C*y)*u),o[r].add(w),o[t].add(w),o[q].add(w),p[r].add(A),p[t].add(A),p[q].add(A))}a.attributeMap[b.TANGENT]=b.createAttribute(4,"Float");a.rebuildData(a.vertexCount,a.indexCount,!0);i=a.getAttributeBuffer(b.TANGENT);m=new c;j=new c;for(k=0;k<l;k++)n=h[k],r=o[k],t=n.dot(r),m.copy(r).sub(j.copy(n).mul(t)).normalize(),i[k*4+0]=m.x,i[k*4+1]=m.y,i[k*4+2]=m.z,t=m.copy(n).cross(r).dot(p[k]),i[k*4+3]=
t<0?-1:1;return i};return a});
define("goo/renderer/shaders/ShaderBuilder","goo/renderer/shaders/ShaderFragment,goo/renderer/MeshData,goo/renderer/light/PointLight,goo/renderer/light/DirectionalLight,goo/renderer/light/SpotLight,goo/math/MathUtils,goo/util/TangentGenerator".split(","),function(g,c,b,a,d,e,f){function j(){}g=new a;g.translation.setd(10,10,10);g.direction.setd(1,1,1).normalize();j.defaultLight=g;j.uber={processor:function(a,b){var d=b.meshData.attributeMap,e=b.material._textureMaps;a.defines=a.defines||{};for(var g in d)a.defines[g]||
(a.defines[g]=!0);for(var j in e)if(e[j]!==void 0&&j!=="SHADOW_MAP"&&(a.defines[j]||(a.defines[j]=!0),j==="DIFFUSE_MAP")){var p=e[j].repeat;a.uniforms.diffuseRepeat=a.uniforms.diffuseRepeat||[1,1];a.uniforms.diffuseRepeat[0]=p.x;a.uniforms.diffuseRepeat[1]=p.y}for(g in a.defines)g==="MAX_POINT_LIGHTS"||g==="MAX_DIRECTIONAL_LIGHTS"||g==="MAX_SPOT_LIGHTS"||g==="SHADOW_TYPE"||g==="JOINT_COUNT"||g==="WEIGHTS"||g==="PHYSICALLY_BASED_SHADING"||!d[g]&&!e[g]&&delete a.defines[g];a.defines.NORMAL&&a.defines.NORMAL_MAP&&
!b.meshData.getAttributeBuffer(c.TANGENT)&&f.addTangentBuffer(b.meshData)}};j.light={processor:function(f,c){f.uniforms.materialAmbient=f.uniforms.materialAmbient||"AMBIENT";f.uniforms.materialEmissive=f.uniforms.materialEmissive||"EMISSIVE";f.uniforms.materialDiffuse=f.uniforms.materialDiffuse||"DIFFUSE";f.uniforms.materialSpecular=f.uniforms.materialSpecular||"SPECULAR";f.uniforms.materialSpecularPower=f.uniforms.materialSpecularPower||"SPECULAR_POWER";var g=0;f.uniforms.pointLightColor=f.uniforms.pointLightColor||
[];f.uniforms.pointLight=f.uniforms.pointLight||[];var j=0;f.uniforms.directionalLightColor=f.uniforms.directionalLightColor||[];f.uniforms.directionalLightDirection=f.uniforms.directionalLightDirection||[];var m=0;f.uniforms.spotLightColor=f.uniforms.spotLightColor||[];f.uniforms.spotLight=f.uniforms.spotLight||[];f.uniforms.spotLightDirection=f.uniforms.spotLightDirection||[];f.uniforms.spotLightAngle=f.uniforms.spotLightAngle||[];f.uniforms.spotLightExponent=f.uniforms.spotLightExponent||[];for(var o=
c.lights,p=0;p<o.length;p++){var n=o[p];if(n instanceof b)f.uniforms.pointLight[g*4+0]=n.translation.data[0],f.uniforms.pointLight[g*4+1]=n.translation.data[1],f.uniforms.pointLight[g*4+2]=n.translation.data[2],f.uniforms.pointLight[g*4+3]=n.range,f.uniforms.pointLightColor[g*4+0]=n.color.data[0]*n.intensity,f.uniforms.pointLightColor[g*4+1]=n.color.data[1]*n.intensity,f.uniforms.pointLightColor[g*4+2]=n.color.data[2]*n.intensity,f.uniforms.pointLightColor[g*4+3]=n.specularIntensity,g++;else if(n instanceof
a)f.uniforms.directionalLightDirection[j*3+0]=n.direction.data[0],f.uniforms.directionalLightDirection[j*3+1]=n.direction.data[1],f.uniforms.directionalLightDirection[j*3+2]=n.direction.data[2],f.uniforms.directionalLightColor[j*4+0]=n.color.data[0]*n.intensity,f.uniforms.directionalLightColor[j*4+1]=n.color.data[1]*n.intensity,f.uniforms.directionalLightColor[j*4+2]=n.color.data[2]*n.intensity,f.uniforms.directionalLightColor[j*4+3]=n.specularIntensity,j++;else if(n instanceof d)f.uniforms.spotLight[m*
4+0]=n.translation.data[0],f.uniforms.spotLight[m*4+1]=n.translation.data[1],f.uniforms.spotLight[m*4+2]=n.translation.data[2],f.uniforms.spotLight[m*4+3]=n.range,f.uniforms.spotLightColor[m*4+0]=n.color.data[0]*n.intensity,f.uniforms.spotLightColor[m*4+1]=n.color.data[1]*n.intensity,f.uniforms.spotLightColor[m*4+2]=n.color.data[2]*n.intensity,f.uniforms.spotLightColor[m*4+3]=n.specularIntensity,f.uniforms.spotLightDirection[m*3+0]=n.direction.data[0],f.uniforms.spotLightDirection[m*3+1]=n.direction.data[1],
f.uniforms.spotLightDirection[m*3+2]=n.direction.data[2],f.uniforms.spotLightAngle[m]=Math.cos(n.angle*e.DEG_TO_RAD),f.uniforms.spotLightExponent[m]=n.exponent,m++}if(f.pointCount!==g)f.defines=f.defines||{},f.defines.MAX_POINT_LIGHTS=g,f.uniforms.pointLight.length=g*4,f.uniforms.pointLightColor.length=g*4,f.pointCount=g;if(f.directionalCount!==j)f.defines=f.defines||{},f.defines.MAX_DIRECTIONAL_LIGHTS=j,f.uniforms.directionalLightDirection.length=j*3,f.uniforms.directionalLightColor.length=j*4,f.directionalCount=
j;if(f.spotCount!==m)f.defines=f.defines||{},f.defines.MAX_SPOT_LIGHTS=m,f.uniforms.spotLight.length=m*4,f.uniforms.spotLightColor.length=m*4,f.uniforms.spotLightDirection.length=m*3,f.uniforms.spotLightAngle.length=m*1,f.uniforms.spotLightExponent.length=m*1,f.spotCount=m;g=c.material._textureMaps;f.defines=f.defines||{};if(g.SHADOW_MAP&&c.lights.length>0)f.defines.SHADOW_TYPE=c.lights[0].shadowSettings.type==="Blur"?1:0;g.SHADOW_MAP!==void 0&&!f.defines.SHADOW_MAP?(f.defines.SHADOW_MAP=!0,f.uniforms.lightViewProjectionMatrix=
"LIGHT_VIEW_PROJECTION_MATRIX",f.uniforms.lightPos="LIGHT0",f.uniforms.cameraScale="LIGHT_DEPTH_SCALE",f.uniforms.shadowMap="SHADOW_MAP"):g.SHADOW_MAP===void 0&&f.defines.SHADOW_MAP&&delete f.defines.SHADOW_MAP},prevertex:"#ifdef SHADOW_MAP\nuniform mat4 lightViewProjectionMatrix;\nvarying vec4 lPosition;\nconst mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);\n#endif",vertex:"#ifdef SHADOW_MAP\nlPosition = ScaleMatrix * lightViewProjectionMatrix * worldPos;\n#endif",
prefragment:"uniform vec4 materialAmbient;\nuniform vec4 materialEmissive;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\n#ifndef MAX_DIRECTIONAL_LIGHTS\n#define MAX_DIRECTIONAL_LIGHTS 0\n#endif\n#ifndef MAX_POINT_LIGHTS\n#define MAX_POINT_LIGHTS 0\n#endif\n#ifndef MAX_SPOT_LIGHTS\n#define MAX_SPOT_LIGHTS 0\n#endif\n#if MAX_DIRECTIONAL_LIGHTS > 0\nuniform vec4 directionalLightColor[MAX_DIRECTIONAL_LIGHTS];\nuniform vec3 directionalLightDirection[MAX_DIRECTIONAL_LIGHTS];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec4 pointLight[MAX_POINT_LIGHTS];\nuniform vec4 pointLightColor[MAX_POINT_LIGHTS];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec4 spotLightColor[MAX_SPOT_LIGHTS];\nuniform vec4 spotLight[MAX_SPOT_LIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOT_LIGHTS];\nuniform float spotLightAngle[MAX_SPOT_LIGHTS];\nuniform float spotLightExponent[MAX_SPOT_LIGHTS];\n#endif\n#ifdef SHADOW_MAP\n#ifndef SHADOW_TYPE\n#define SHADOW_TYPE 0\n#endif\nuniform vec3 lightPos;\nuniform float cameraScale;\nvarying vec4 lPosition;\nuniform sampler2D shadowMap;\nfloat ChebychevInequality(in vec2 moments, in float t) {\nif ( t <= moments.x ) return 1.0;\nfloat variance = moments.y - (moments.x * moments.x);\nvariance = max(variance, 0.02);\nfloat d = t - moments.x;\nreturn variance / (variance + d * d);\n}\nfloat VsmFixLightBleed(in float pMax, in float amount) {\nreturn clamp((pMax - amount) / (1.0 - amount), 0.0, 1.0);\n}\n#endif",
fragment:"#ifdef SPECULAR_MAP\nfloat specularStrength = texture2D(specularMap, texCoord0).x;\n#else\nfloat specularStrength = 1.0;\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3(0.0);\nvec3 pointSpecular = vec3(0.0);\nfor (int i = 0; i < MAX_POINT_LIGHTS; i++) {\nvec3 lVector = normalize(pointLight[i].xyz - vWorldPos.xyz);\nfloat lDistance = 1.0 - min((length(pointLight[i].xyz - vWorldPos.xyz) / pointLight[i].w), 1.0);\nfloat dotProduct = dot(N, lVector);\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max(dotProduct, 0.0);\nfloat pointDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);\nvec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapRGB);\n#else\nfloat pointDiffuseWeight = max(dotProduct, 0.0);\n#endif\npointDiffuse += materialDiffuse.rgb * pointLightColor[i].rgb * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize(lVector + normalize(viewPosition));\nfloat pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);\nfloat pointSpecularWeight = pointLightColor[i].a * specularStrength * max(pow(pointDotNormalHalf, materialSpecularPower), 0.0);\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = (materialSpecularPower + 2.0001 ) / 8.0;\nvec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);\npointSpecular += schlick * pointLightColor[i].rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += materialSpecular.rgb * pointLightColor[i].rgb * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3(0.0);\nvec3 spotSpecular = vec3(0.0);\nfor (int i = 0; i < MAX_SPOT_LIGHTS; i++) {\nvec3 lVector = normalize(spotLight[i].xyz - vWorldPos.xyz);\nfloat lDistance = 1.0 - min((length(spotLight[i].xyz - vWorldPos.xyz) / spotLight[i].w), 1.0);\nfloat spotEffect = dot(normalize(-spotLightDirection[i]), lVector);\nif (spotEffect > spotLightAngle[i]) {\nspotEffect = max(pow(spotEffect, spotLightExponent[i]), 0.0);\nfloat dotProduct = dot(N, lVector);\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max(dotProduct, 0.0);\nfloat spotDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);\nvec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapRGB);\n#else\nfloat spotDiffuseWeight = max(dotProduct, 0.0);\n#endif\nspotDiffuse += materialDiffuse.rgb * spotLightColor[i].rgb * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize(lVector + normalize(viewPosition));\nfloat spotDotNormalHalf = max(dot(N, spotHalfVector), 0.0);\nfloat spotSpecularWeight = spotLightColor[i].a * specularStrength * max(pow(spotDotNormalHalf, materialSpecularPower), 0.0);\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = (materialSpecularPower + 2.0001) / 8.0;\nvec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);\nspotSpecular += schlick * spotLightColor[i].rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += materialSpecular.rgb * spotLightColor[i].rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIRECTIONAL_LIGHTS > 0\nvec3 dirDiffuse  = vec3(0.0);\nvec3 dirSpecular = vec3(0.0);\nfor(int i = 0; i < MAX_DIRECTIONAL_LIGHTS; i++) {\nvec4 lDirection = vec4(-directionalLightDirection[i], 0.0);\nvec3 dirVector = normalize(lDirection.xyz);\nfloat dotProduct = dot(N, dirVector);\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max(dotProduct, 0.0);\nfloat dirDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);\nvec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapRGB);\n#else\nfloat dirDiffuseWeight = max(dotProduct, 0.0);\n#endif\ndirDiffuse += materialDiffuse.rgb * directionalLightColor[i].rgb * dirDiffuseWeight;\nvec3 dirHalfVector = normalize(dirVector + normalize(viewPosition));\nfloat dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);\nfloat dirSpecularWeight = directionalLightColor[i].a * specularStrength * max(pow(dirDotNormalHalf, materialSpecularPower), 0.0);\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = (materialSpecularPower + 2.0001) / 8.0;\nvec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);\ndirSpecular += schlick * directionalLightColor[i].rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += materialSpecular.rgb * directionalLightColor[i].rgb * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3(0.0);\nvec3 totalSpecular = vec3(0.0);\n#if MAX_DIRECTIONAL_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\nfloat shadow = 1.0;\n#ifdef SHADOW_MAP\nvec3 depth = lPosition.xyz / lPosition.w;\ndepth.z = length(vWorldPos.xyz - lightPos) * cameraScale;\nif (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && depth.z >= 0.0 && depth.z <= 1.0) {\n#if SHADOW_TYPE == 0\ndepth.z *= 0.96;\nfloat shadowDepth = texture2D(shadowMap, depth.xy).x;\nif ( depth.z > shadowDepth ) shadow = 0.5;\n#elif SHADOW_TYPE == 1\nvec4 texel = texture2D(shadowMap, depth.xy);\nvec2 moments = vec2(texel.x, texel.y);\nshadow = ChebychevInequality(moments, depth.z);\n#endif\nshadow = clamp(shadow, 0.0, 1.0);\n}\n#endif\nvec3 ambientLightColor = vec3(1.0, 1.0, 1.0);\n#ifdef METAL\nfinal_color.xyz = final_color.xyz * (materialEmissive.rgb + totalDiffuse * shadow + ambientLightColor * materialAmbient.rgb + totalSpecular * shadow);\n#else\nfinal_color.xyz = final_color.xyz * (materialEmissive.rgb + totalDiffuse * shadow + ambientLightColor * materialAmbient.rgb) + totalSpecular * shadow;\n#endif"};
j.animation={processor:function(a,b){var d=b.currentPose;a.defines=a.defines||{};if(d){if(!a.uniforms.jointPalette)a.uniforms.jointPalette=j.animation.jointPalette;a.defines.JOINT_COUNT=Math.max(b.meshData.paletteMap.length*3,80)}else delete a.defines.JOINT_COUNT},jointPalette:function(a){var b=a.meshData;if(a=a.currentPose){var a=a._matrixPalette,d=b.store;if(!d)d=new Float32Array(b.paletteMap.length*12),b.store=d;for(var f,e=0;e<b.paletteMap.length;e++){f=a[b.paletteMap[e]];for(var c=0;c<12;c++)d[e*
12+c]=f.data[j.animation.order[c]]}return d}},order:[0,4,8,12,1,5,9,13,2,6,10,14],prevertex:"#ifdef JOINTIDS\nattribute vec4 vertexJointIDs;\n#endif\n#ifdef WEIGHTS\nattribute vec4 vertexWeights;\n#endif\n#ifdef JOINT_COUNT\nuniform vec4 jointPalette[JOINT_COUNT];\n#endif",vertex:"#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)\nint x = 3*int(vertexJointIDs.x);\nint y = 3*int(vertexJointIDs.y);\nint z = 3*int(vertexJointIDs.z);\nint w = 3*int(vertexJointIDs.w);\nmat4 mat = mat4(0.0);\nmat += mat4(\n\tjointPalette[x+0].x, jointPalette[x+1].x, jointPalette[x+2].x, 0,\n\tjointPalette[x+0].y, jointPalette[x+1].y, jointPalette[x+2].y, 0,\n\tjointPalette[x+0].z, jointPalette[x+1].z, jointPalette[x+2].z, 0,\n\tjointPalette[x+0].w, jointPalette[x+1].w, jointPalette[x+2].w, 1\n) * vertexWeights.x;\nmat += mat4(\n\tjointPalette[y+0].x, jointPalette[y+1].x, jointPalette[y+2].x, 0,\n\tjointPalette[y+0].y, jointPalette[y+1].y, jointPalette[y+2].y, 0,\n\tjointPalette[y+0].z, jointPalette[y+1].z, jointPalette[y+2].z, 0,\n\tjointPalette[y+0].w, jointPalette[y+1].w, jointPalette[y+2].w, 1\n) * vertexWeights.y;\nmat += mat4(\n\tjointPalette[z+0].x, jointPalette[z+1].x, jointPalette[z+2].x, 0,\n\tjointPalette[z+0].y, jointPalette[z+1].y, jointPalette[z+2].y, 0,\n\tjointPalette[z+0].z, jointPalette[z+1].z, jointPalette[z+2].z, 0,\n\tjointPalette[z+0].w, jointPalette[z+1].w, jointPalette[z+2].w, 1\n) * vertexWeights.z;\nmat += mat4(\n\tjointPalette[w+0].x, jointPalette[w+1].x, jointPalette[w+2].x, 0,\n\tjointPalette[w+0].y, jointPalette[w+1].y, jointPalette[w+2].y, 0,\n\tjointPalette[w+0].z, jointPalette[w+1].z, jointPalette[w+2].z, 0,\n\tjointPalette[w+0].w, jointPalette[w+1].w, jointPalette[w+2].w, 1\n) * vertexWeights.w;\nwMatrix = wMatrix * mat / mat[3][3];\n#endif"};
return j});
define("goo/renderer/shaders/ShaderLib",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/shaders/ShaderBuilder","goo/entities/World"],function(g,c,b,a,d){function e(){}e.uber={processors:[a.uber.processor,a.light.processor,a.animation.processor],attributes:{vertexPosition:g.POSITION,vertexNormal:g.NORMAL,vertexTangent:g.TANGENT,vertexColor:g.COLOR,vertexUV0:g.TEXCOORD0,vertexUV1:g.TEXCOORD1,vertexJointIDs:g.JOINTIDS,vertexWeights:g.WEIGHTS},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,diffuseMap:c.DIFFUSE_MAP,diffuseRepeat:[1,1],normalMap:c.NORMAL_MAP,specularMap:c.SPECULAR_MAP,emissiveMap:c.EMISSIVE_MAP,aoMap:c.AO_MAP,lightMap:c.LIGHT_MAP,color:[1,1,1]},vshader:["attribute vec3 vertexPosition;\n#ifdef NORMAL\nattribute vec3 vertexNormal;\n#endif\n#ifdef TANGENT\nattribute vec4 vertexTangent;\n#endif\n#ifdef COLOR\nattribute vec4 vertexColor;\n#endif\n#ifdef TEXCOORD0\nattribute vec2 vertexUV0;\nvarying vec2 texCoord0;\n#endif\n#ifdef TEXCOORD1\nattribute vec2 vertexUV1;\nvarying vec2 texCoord1;\n#endif\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\n#ifdef NORMAL\nvarying vec3 normal;\n#endif\n#ifdef TANGENT\nvarying vec3 binormal;\nvarying vec3 tangent;\n#endif\n#ifdef COLOR\nvarying vec4 color;\n#endif",
a.light.prevertex,a.animation.prevertex,"void main(void) {\nmat4 wMatrix = worldMatrix;",a.animation.vertex,"vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);\nvWorldPos = worldPos.xyz;\ngl_Position = viewProjectionMatrix * worldPos;\nviewPosition = cameraPosition - worldPos.xyz;\n#ifdef NORMAL\n\tnormal = normalize((wMatrix * vec4(vertexNormal, 0.0)).xyz);\n#endif\n#ifdef TANGENT\n\ttangent = normalize((wMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);\n\tbinormal = cross(normal, tangent) * vec3(vertexTangent.w);\n#endif\n#ifdef COLOR\n\tcolor = vertexColor;\n#endif\n#ifdef TEXCOORD0\n\ttexCoord0 = vertexUV0;\n#endif\n#ifdef TEXCOORD1\n\ttexCoord1 = vertexUV1;\n#endif",
a.light.vertex,"}"].join("\n"),fshader:["#ifdef DIFFUSE_MAP\nuniform sampler2D diffuseMap;\n#endif\n#ifdef NORMAL_MAP\nuniform sampler2D normalMap;\n#endif\n#ifdef SPECULAR_MAP\nuniform sampler2D specularMap;\n#endif\n#ifdef EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#ifdef AO_MAP\nuniform sampler2D aoMap;\n#endif\n#ifdef LIGHT_MAP\nuniform sampler2D lightMap;\n#endif\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\n#ifdef NORMAL\nvarying vec3 normal;\n#endif\n#ifdef TANGENT\nvarying vec3 binormal;\nvarying vec3 tangent;\n#endif\n#ifdef COLOR\nvarying vec4 color;\n#endif\n#ifdef TEXCOORD0\nvarying vec2 texCoord0;\n#endif\n#ifdef TEXCOORD1\nvarying vec2 texCoord1; //Use for lightmap\n#endif",
a.light.prefragment,"void main(void)\n{\nvec4 final_color = vec4(1.0);\n#ifdef DIFFUSE_MAP\nfinal_color *= texture2D(diffuseMap, texCoord0);\n#endif\n#ifdef COLOR\nfinal_color *= color;\n#endif\n#ifdef AO_MAP\n#ifdef TEXCOORD1\nfinal_color *= texture2D(aoMap, texCoord1);\n#else\nfinal_color *= texture2D(aoMap, texCoord0);\n#endif\n#endif\n#ifdef LIGHT_MAP\n#ifdef TEXCOORD1\nfinal_color *= texture2D(lightMap, texCoord1) * 2.0 - 0.5;\n#else\nfinal_color *= texture2D(lightMap, texCoord0) * 2.0 - 0.5;\n#endif\n#else\n#if defined(TANGENT) && defined(NORMAL_MAP)\nmat3 tangentToWorld = mat3(tangent, binormal, normal);\nvec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);\nvec3 worldNormal = (tangentToWorld * tangentNormal);\nvec3 N = normalize(worldNormal);\n#elif defined(NORMAL)\nvec3 N = normalize(normal);\n#else\nvec3 N = vec3(0.0, 1.0, 0.0);\n#endif",
a.light.fragment,"#endif\n#ifdef EMISSIVE_MAP\nvec3 emissive = texture2D(emissiveMap, texCoord0).rgb;\nfinal_color.xyz += final_color.xyz * emissive;\n#endif\ngl_FragColor = final_color;\n}"].join("\n")};e.screenCopy={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};
e.copy={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,opacity:1,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);\n}"};
e.copyPure={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,opacity:1,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 col = texture2D(diffuseMap, texCoord0);\n\tgl_FragColor = vec4(col.rgb, col.a * opacity);\n}"};
e.simple={attributes:{vertexPosition:g.POSITION},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nvoid main(void)\n{\n\tgl_FragColor = vec4(1.0);\n}"};e.simpleColored={attributes:{vertexPosition:g.POSITION},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform vec3 color;\nvoid main(void)\n{\n\tgl_FragColor = vec4(color, 1.0);\n}"};e.simpleLit={processors:[a.light.processor],defines:{NORMAL:!0},attributes:{vertexPosition:g.POSITION,vertexNormal:g.NORMAL},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA},vshader:["attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;",a.light.prevertex,"varying vec3 normal;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n vWorldPos = worldPos.xyz;\n\tgl_Position = viewProjectionMatrix * worldPos;",a.light.vertex,"\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tviewPosition = cameraPosition - worldPos.xyz;\n}"].join("\n"),
fshader:["#ifdef SPECULAR_MAP\nuniform sampler2D specularMap;\n#ifdef TEXCOORD0\nvarying vec2 texCoord0;\n#endif\n#endif",a.light.prefragment,"#ifdef NORMAL\nvarying vec3 normal;\n#endif\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvoid main(void)\n{\n #ifdef NORMAL\n\tvec3 N = normalize(normal);\n #else\n vec3 N = vec3(0,0,1);\n #endif\n\tvec4 final_color = vec4(1.0);",a.light.fragment,"\tgl_FragColor = final_color;\n}"].join("\n")};e.billboard={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},
uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,viewMatrix:c.VIEW_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(0.0, 0.0, 0.0, 1.0) + projectionMatrix * vec4(vertexPosition.x, vertexPosition.y, 0.0, 0.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};e.textured={defines:{TEXCOORD0:!0,DIFFUSE_MAP:!0},attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\n#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\n#endif\nvoid main(void)\n{\n #if defined(TEXCOORD0) && defined(DIFFUSE_MAP)\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n #else\n gl_FragColor = vec4(1.0);\n #endif\n}"};e.texturedLit={processors:[a.light.processor],attributes:{vertexPosition:g.POSITION,vertexNormal:g.NORMAL,vertexUV0:g.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,diffuseMap:c.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;",a.light.prevertex,"varying vec3 normal;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvarying vec2 texCoord0;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n vWorldPos = worldPos.xyz;\n\tgl_Position = viewProjectionMatrix * worldPos;",
a.light.vertex,"\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\ttexCoord0 = vertexUV0;\n\tviewPosition = cameraPosition - worldPos.xyz;\n}"].join("\n"),fshader:["uniform sampler2D diffuseMap;",a.light.prefragment,"varying vec3 normal;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec3 N = normalize(normal);\n\tvec4 final_color = texture2D(diffuseMap, texCoord0);",a.light.fragment,"\tgl_FragColor = final_color;\n}"].join("\n")};e.convolution=
{defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:g.POSITION,uv:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,uImageIncrement:[0.001953125,0],cKernel:[]},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cKernel[ KERNEL_SIZE_INT ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvec2 imageCoord = vUv;\n\tvec4 sum = vec4( 0.0 );\n\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\timageCoord += uImageIncrement;\n\t}\n\tgl_FragColor = sum;\n}",buildKernel:function(a){var b,d,e,c,g=2*Math.ceil(a*3)+1;g>25&&(g=25);c=(g-1)*0.5;d=Array(g);for(b=
e=0;b<g;++b)d[b]=Math.exp(-((b-c)*(b-c))/(2*a*a)),e+=d[b];for(b=0;b<g;++b)d[b]/=e;return d}};e.showDepth={attributes:{vertexPosition:g.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,near:c.NEAR_PLANE,far:c.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform float near;\nuniform float far;\nvoid main(void)\n{\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat d = 1.0 - smoothstep( near, far, depth );\n\tgl_FragColor = vec4(d);\n}"};e.showNormals={defines:{NORMAL:!0},attributes:{vertexPosition:g.POSITION,vertexNormal:g.NORMAL},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 normal;\nvoid main() {\nnormal = vec3(worldMatrix * vec4(vertexNormal, 0.0));\ngl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform float opacity;\n#ifdef NORMAL\nvarying vec3 normal;\n#else\nvec3 normal = vec3(0,0,1);\n#endif\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( normal ) + 0.5, opacity );\n}"};e.bokehShader={attributes:{position:g.POSITION,uv:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tColor:c.DIFFUSE_MAP,tDepth:c.DEPTH_MAP,focus:1,aspect:1,aperture:0.025,maxblur:1},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"};
e.particles={attributes:{vertexPosition:g.POSITION,vertexColor:g.COLOR,vertexUV0:g.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void) {\n    texCoord0 = vertexUV0;\n    color = vertexColor;\n\t gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n   if (color.a == 0.0 || texCol.a == 0.0) discard;\n\telse gl_FragColor = texCol * color;\n}"};e.sepia={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,amount:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"};
e.dotscreen={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,tSize:[256,256],center:[0.5,0.5],angle:1.57,scale:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"};
e.vignette={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,offset:1,darkness:1.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"};e.film={attributes:e.copy.attributes,uniforms:{tDiffuse:c.DIFFUSE_MAP,time:function(){return d.time},nIntensity:0.5,sIntensity:0.5,sCount:1024,grayscale:0,$link:e.copy.uniforms},
vshader:e.copy.vshader,fshader:"precision mediump float;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );\n\tfloat x = texCoord0.x * texCoord0.y * time * 1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\n\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\n\tvec2 sc = vec2( sin( texCoord0.y * sCount ), cos( texCoord0.y * sCount ) );\n\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\n\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\n\tif( grayscale ) {\n\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n\t}\n\tgl_FragColor = vec4( cResult, cTextureScreen.a );\n}"};
e.bleachbypass={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"};
e.horizontalTiltShift={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,h:0.0078125,r:0.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x,            vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"};
e.colorify={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"};e.normalmap={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,heightMap:c.DIFFUSE_MAP,resolution:[512,512],
height:0.05},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"};
e.ssao={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,tDepth:c.DEPTH_MAP,size:[512,512],cameraNear:c.MAIN_NEAR_PLANE,cameraFar:c.MAIN_FAR_PLANE,fogNear:c.MAIN_NEAR_PLANE,fogFar:c.MAIN_FAR_PLANE,fogEnabled:0,onlyAO:0,aoClamp:0.3,lumInfluence:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform bool onlyAO;\nuniform vec2 size;\nuniform float aoClamp;\nuniform float lumInfluence;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 16;\nconst float radius = 2.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0003;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst vec3 onlyAOColor = vec3( 1.0, 1.0, 1.0 );\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"};
e.skinning={defines:{JOINT_COUNT:56,WEIGHTS:4},attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0,vertexWeights:g.WEIGHTS,vertexJointIDs:g.JOINTIDS},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.DIFFUSE_MAP,jointPalette:function(a){var a=a.meshData,b=a.currentPose;if(b){var b=b._matrixPalette,d=a.paletteMap.length*16,e=a.store;if(!e)e=new Float32Array(d),a.store=e;for(var c=0;c<a.paletteMap.length;c++)for(var d=b[a.paletteMap[c]],g=0;g<4;g++)for(var m=
0;m<4;m++)e[c*16+g*4+m]=d.data[m*4+g];return e}}},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nattribute vec4 vertexWeights;\nattribute vec4 vertexJointIDs;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 jointPalette[JOINT_COUNT];\nvarying vec2 texCoord0;\nvoid main(void) {\n\tmat4 mat = mat4(0.0);\n\tmat += jointPalette[int(vertexJointIDs.x)] * vertexWeights.x;\n\tmat += jointPalette[int(vertexJointIDs.y)] * vertexWeights.y;\n\tmat += jointPalette[int(vertexJointIDs.z)] * vertexWeights.z;\n\tmat += jointPalette[int(vertexJointIDs.w)] * vertexWeights.w;\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * mat * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};e.rgbshift={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,amount:0.005,angle:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float amount;\nuniform float angle;\nvarying vec2 vUv;\nvoid main() {\nvec2 offset = amount * vec2( cos(angle), sin(angle));\nvec4 cr = texture2D(tDiffuse, vUv + offset);\nvec4 cga = texture2D(tDiffuse, vUv);\nvec4 cb = texture2D(tDiffuse, vUv - offset);\ngl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n}"};e.brightnesscontrast={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,brightness:0,contrast:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float brightness;\nuniform float contrast;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb += brightness;\nif (contrast > 0.0) {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n} else {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n}\n}"};
e.luminosity={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"};
e.point={attributes:{vertexPosition:g.POSITION,vertexColor:g.COLOR},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,pointSize:2},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform float pointSize;\nvarying vec4 color;\nvoid main(void) {\n\tcolor = vertexColor;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_PointSize = pointSize;\n}",fshader:"precision mediump float;\nvarying vec4 color;\nvoid main(void)\n{\n\tgl_FragColor = color;\n}"};
e.toon={attributes:{vertexPosition:g.POSITION,vertexNormal:g.NORMAL},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,lightPosition:c.LIGHT0,HighlightColour:[0.9,0.8,0.7,1],MidColour:[0.65,0.55,0.45,1],ShadowColour:[0.4,0.3,0.2,1],HighlightSize:0.2,ShadowSize:0.01,OutlineWidth:0.15},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 N;\nvarying vec3 V;\nvarying vec3 L;\nvoid main()\n{\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tN = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tL = lightPosition - worldPos.xyz;\n\tV = cameraPosition - worldPos.xyz;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:"precision mediump float;\nuniform vec4 HighlightColour;\nuniform vec4 MidColour;\nuniform vec4 ShadowColour;\nuniform float HighlightSize;\nuniform float ShadowSize;\nuniform float OutlineWidth;\nvarying vec3 N;\nvarying vec3 L;\nvarying vec3 V;\nvoid main()\n{\n\tvec3 n = normalize(N);\n\tvec3 l = normalize(L);\n\tvec3 v = normalize(V);\n    float lambert = dot(l,n);\n    vec4 colour = MidColour;\n    if (lambert > 1.0 - HighlightSize) colour = HighlightColour;\n    if (lambert < ShadowSize) colour = ShadowColour;\n    if (dot(n,v) < OutlineWidth) colour = vec4(0.0,0.0,0.0,1.0);\n    gl_FragColor = colour;\n}"};
e.differenceOfGaussians={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,gaussBlurredImage1:"BLUR1",gaussBlurredImage2:"BLUR2",originalImage:"ORIGINAL",threshold:0.01},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D gaussBlurredImage1;\nuniform sampler2D gaussBlurredImage2;\nuniform sampler2D originalImage;\nuniform float threshold;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 blur1 = texture2D(gaussBlurredImage1, texCoord0);\n\tvec4 blur2 = texture2D(gaussBlurredImage2, texCoord0);\n\tvec4 originalColor = texture2D(originalImage, texCoord0);\n\tvec3 col = clamp(blur1.rgb - blur2.rgb, 0.0, 1.0);\n\tfloat value = (col.r + col.g + col.b) / 3.0;\n\tvalue = step(threshold, value);\n\tvec3 outputColor = mix(originalColor.rgb, vec3(value), value);\n\tgl_FragColor = vec4(outputColor, 1.0);\n}"};
e.downsample={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\n}"};
e.boxfilter={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,viewport:[128,128]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform vec2 viewport;\nvarying vec2 vUv;\nvoid main() {\nvec3 result = vec3(0.0);\nfor(int x=-1; x<=1; x++) {\n\tfor(int y=-1; y<=1; y++) {\n\t\tresult += texture2D(tDiffuse, vUv + vec2(x, y) / viewport).rgb;\n\t}\n}\ngl_FragColor = vec4(result / vec3(9.0), 1.0);\n}"};e.lightDepth={defines:{SHADOW_TYPE:0},attributes:{vertexPosition:g.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,
cameraScale:c.LIGHT_DEPTH_SCALE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 worldPosition;\nvoid main(void) {\nworldPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\ngl_Position = projectionMatrix * worldPosition;\n}",fshader:"#ifndef SHADOW_TYPE\n#define SHADOW_TYPE 0\n#endif\nuniform float cameraScale;\nvarying vec4 worldPosition;\nvoid main(void)\n{\nfloat linearDepth = length(worldPosition) * cameraScale;\n#if SHADOW_TYPE == 0\ngl_FragColor = vec4(linearDepth);\n#elif SHADOW_TYPE == 1\ngl_FragColor = vec4(linearDepth, linearDepth * linearDepth, 0.0, 0.0);\n#endif\n}"};
e.packDepth={attributes:{vertexPosition:g.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,farPlane:c.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",
b.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};e.pickingShader={defines:{WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:g.POSITION,vertexJointIDs:g.JOINTIDS,vertexWeights:g.WEIGHTS},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraFar:c.FAR_PLANE,id:function(a){return a.renderable.id+1}},processors:[a.animation.processor],
vshader:["attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform float cameraFar;",a.animation.prevertex,"varying float depth;\nvoid main() {\nmat4 wMatrix = worldMatrix;",a.animation.vertex,"vec4 mvPosition = viewMatrix * wMatrix * vec4( vertexPosition, 1.0 );\ndepth = length(mvPosition.xyz) / cameraFar;\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fshader:["uniform float id;\nvarying float depth;",b.methods.packDepth16,
"void main() {\nvec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);\nvec2 packedDepth = packDepth16(depth);\ngl_FragColor = vec4(packedId, packedDepth);\n}"].join("\n")};return e});
define("goo/shapes/Cylinder",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(g,c,b,a){function d(a,b,e){this.radialSamples=a!==void 0?a:8;this.radius=b!==void 0?b:0.5;this.textureMode=e!==void 0?e:d.TextureModes.Polar;this.viewInside=!1;a=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);g.call(this,a,2*(this.radialSamples+1)+2,12*this.radialSamples);this.rebuild()}function e(a,b,d){a[d*3+0]=a[b*3+0];a[d*3+1]=a[b*3+1];a[d*3+2]=a[b*3+2]}d.prototype=Object.create(g.prototype);
d.prototype.rebuild=function(){for(var f=this.getAttributeBuffer(g.POSITION),c=this.getAttributeBuffer(g.NORMAL),h=this.getAttributeBuffer(g.TEXCOORD0),k=this.getIndexBuffer(),i=1/this.radialSamples,l=2/3,m=[],o=[],p=0;p<this.radialSamples;p++){var n=a.TWO_PI*i*p;o[p]=Math.cos(n);m[p]=Math.sin(n)}m[this.radialSamples]=m[0];o[this.radialSamples]=o[0];for(var n=0,r=new b,t=new b,q=new b,v=1;v<3;v++){var y=a.HALF_PI*(-1+l*v),s=Math.sin(y),p=this.radius*s,u=t.set(0,0,0);u.z=v-1.5;for(var z=Math.sqrt(Math.abs(this.radius*
this.radius-p*p)),w,A=n,p=0;p<this.radialSamples;p++){var x=p*i;w=q.set(o[p],m[p],0);b.mul(w,z,r);f[n*3+0]=u.x+r.x;f[n*3+1]=u.y+r.y;f[n*3+2]=u.z+r.z;w=r.set(f[n*3+0],f[n*3+1],f[n*3+2]);w.normalize();this.viewInside?(c[n*3+0]=-w.x,c[n*3+1]=-w.y,c[n*3+2]=-w.z):(c[n*3+0]=w.x,c[n*3+1]=w.y,c[n*3+2]=w.z);this.textureMode===d.TextureModes.Linear?(h[n*2+0]=x,h[n*2+1]=0.5*(s+1)):this.textureMode===d.TextureModes.Projected?(h[n*2+0]=x,h[n*2+1]=a.HALF_PI+Math.asin(s)/Math.PI):this.textureMode===d.TextureModes.Polar&&
(x=(a.HALF_PI-Math.abs(y))/Math.PI,w=x*m[p]+0.5,h[n*2+0]=x*o[p]+0.5,h[n*2+1]=w);n++}e(f,A,n);e(c,A,n);this.textureMode===d.TextureModes.Linear?(h[n*2+0]=1,h[n*2+1]=0.5*(s+1)):this.textureMode===d.TextureModes.Projected?(h[n*2+0]=1,h[n*2+1]=a.INV_PI*(a.HALF_PI+Math.asin(s))):this.textureMode===d.TextureModes.Polar&&(x=(a.HALF_PI-Math.abs(y))/Math.PI,h[n*2+0]=x+0.5,h[n*2+1]=0.5);n++}f[n*3+0]=0;f[n*3+1]=0;f[n*3+2]=-0.5;this.viewInside?(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=1):(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=
-1);this.textureMode===d.TextureModes.Polar?(h[n*2+0]=0.5,h[n*2+1]=0.5):(h[n*2+0]=0.5,h[n*2+1]=0);n++;f[n*3+0]=0;f[n*3+1]=0;f[n*3+2]=0.5;this.viewInside?(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=-1):(c[n*3+0]=0,c[n*3+1]=0,c[n*3+2]=1);this.textureMode===d.TextureModes.Polar?(h[n*2+0]=0.5,h[n*2+1]=0.5):(h[n*2+0]=0.5,h[n*2+1]=1);c=n=f=0;h=c+1;n+=this.radialSamples+1;i=n;l=i+1;for(n=0;n<this.radialSamples;n++)this.viewInside?(k[f++]=c++,k[f++]=i,k[f++]=h,k[f++]=h++,k[f++]=i++,k[f++]=l++):(k[f++]=c++,k[f++]=h,k[f++]=
i,k[f++]=h++,k[f++]=l++,k[f++]=i++);for(n=0;n<this.radialSamples;n++)this.viewInside?(k[f++]=n,k[f++]=n+1,k[f++]=this.vertexCount-2):(k[f++]=n,k[f++]=this.vertexCount-2,k[f++]=n+1);c=this.radialSamples+1;for(n=0;n<this.radialSamples;n++)this.viewInside?(k[f++]=n+c,k[f++]=this.vertexCount-1,k[f++]=n+1+c):(k[f++]=n+c,k[f++]=n+1+c,k[f++]=this.vertexCount-1);return this};d.TextureModes=new c("Linear","Projected","Polar");return d});
define("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(g,c,b){function a(a,b,d,c){this._circleSamples=a!==void 0?a:8;this._radialSamples=b!==void 0?b:8;this._tubeRadius=d!==void 0?d:1;this._centerRadius=c!==void 0?c:2;this.viewInside=!1;a=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);g.call(this,a,(this._circleSamples+1)*(this._radialSamples+1),6*this._circleSamples*this._radialSamples);this.rebuild()}function d(a,b,d){a[d*3+0]=a[b*3+0];a[d*3+1]=a[b*
3+1];a[d*3+2]=a[b*3+2]}a.prototype=Object.create(g.prototype);a.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(g.POSITION),f=this.getAttributeBuffer(g.NORMAL),j=this.getAttributeBuffer(g.TEXCOORD0),h=this.getIndexBuffer(),k=1/this._circleSamples,i=1/this._radialSamples,l=0,m=new c,o=new c,p=new c,n=0;n<this._circleSamples;n++){var r=n*k,t=b.TWO_PI*r,q=Math.cos(t),t=Math.sin(t);m.set(q,t,0);c.mul(m,this._centerRadius,o);q=l;for(t=0;t<this._radialSamples;t++){var v=t*i,y=b.TWO_PI*v,
s=Math.cos(y),y=Math.sin(y);p.copy(m).mul(s);p.z+=y;p.normalize();this.viewInside?(f[l*3+0]=-p.x,f[l*3+1]=-p.y,f[l*3+2]=-p.z):(f[l*3+0]=p.x,f[l*3+1]=p.y,f[l*3+2]=p.z);p.mul(this._tubeRadius).add(o);a[l*3+0]=p.x;a[l*3+1]=p.y;a[l*3+2]=p.z;j[l*2+0]=v;j[l*2+1]=r;l++}d(a,q,l);d(f,q,l);j[l*2+0]=1;j[l*2+1]=r;l++}for(n=0;n<=this._radialSamples;n++,l++)d(a,n,l),d(f,n,l),k=j,i=n,m=l,k[m*2+0]=k[i*2+0],k[m*2+1]=k[i*2+1],j[l*2+1]=1;for(n=f=a=0;n<this._circleSamples;n++){j=f;k=j+1;f+=this._radialSamples+1;i=f;
m=i+1;for(l=0;l<this._radialSamples;l++)this.viewInside?(h[a++]=j++,h[a++]=k,h[a++]=i,h[a++]=k++,h[a++]=m++,h[a++]=i++):(h[a++]=j++,h[a++]=i,h[a++]=k,h[a++]=k++,h[a++]=i++,h[a++]=m++)}return this};return a});
define("goo/shapes/ShapeCreator",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus"],function(g,c,b,a,d){function e(){}e.createQuad=function(a,b,d,e){return new c(a,b,d,e)};e.createBox=function(a,b,d,e,c){return new g(a,b,d,e,c)};e.createSphere=function(a,d,e,c){return new b(a,d,e,c)};e.createCylinder=function(b,d,e){return new a(b,d,e)};e.createTorus=function(a,b,e,c){return new d(a,b,e,c)};return e});
define("goo/util/Handy",[],function(){function g(){}g.deepFreeze=function(c){var b,a;Object.freeze(c);for(a in c)b=c[a],c.hasOwnProperty(a)&&!(typeof b!=="object"||Object.isFrozen(b))&&g.deepFreeze(b)};g.defineProperty=function(c,b,a,d){var e=a;Object.defineProperty(c,b,{get:function(){return e},set:function(a){e=a;d(e)},configurable:!0,enumerable:!0})};g.addListener=function(c,b,a,d){var e=c[b];Object.defineProperty(c,b,{get:function(){a&&a();return e},set:function(a){e=a;d&&d(e)},configurable:!0,
enumerable:!0})};return g});
define("goo/math/Plane",["goo/math/Vector3"],function(g){function c(b,a){this.normal=b!==void 0?new g(b):new g(g.UNIT_Y);this.constant=isNaN(a)?0:a}c.XZ=new c(g.UNIT_Y,0);c.XY=new c(g.UNIT_Z,0);c.YZ=new c(g.UNIT_X,0);c.prototype.pseudoDistance=function(b){return this.normal.dot(b)-this.constant};c.prototype.setPlanePoints=function(b,a,d){this.normal.set(a).subtractLocal(b);this.normal.crossLocal(d.x-b.x,d.y-b.y,d.z-b.z).normalizeLocal();this.constant=this.normal.dot(b);return this};c.prototype.reflectVector=
function(b,a){var d=a;d===null&&(d=new g);var e=this.normal.dot(b)*2;d.set(b).subtractLocal(this.normal.x*e,this.normal.y*e,this.normal.z*e);return d};return c});
define("goo/math/Ray",["goo/math/Vector3","goo/math/MathUtils"],function(g,c){function b(a,b){this.origin=a||new g;this.direction=b||(new g).copy(g.UNIT_Z);this.calcVec1=new g;this.calcVec2=new g;this.calcVec3=new g;this.calcVec4=new g}b.prototype.intersects=function(a,b,e){if(a.length===3)return this.intersectsTriangle(a[0],a[1],a[2],b,e);else if(a.length===4)return this.intersectsTriangle(a[0],a[1],a[2],b,e)||this.intersectsTriangle(a[0],a[2],a[3],b,e);return!1};b.prototype.intersectsTriangle=function(a,
b,e,f,j){var h=this.calcVec1.set(this.origin).sub(a),b=this.calcVec2.set(b).sub(a),a=this.calcVec3.set(e).sub(a),k=this.calcVec4.set(b).cross(a),e=this.direction.dot(k),i;if(e>c.EPSILON)i=1;else if(e<-c.EPSILON)i=-1,e=-e;else return!1;var a=i*this.direction.dot(g.cross(h,a,a)),l=!1;if(a>=0&&(b=i*this.direction.dot(b.cross(h)),b>=0&&a+b<=e&&(h=-i*h.dot(k),h>=0))){if(!j)return!0;e=1/e;h*=e;f?j.setd(h,a*e,b*e):j.setv(this.origin).add_d(this.direction.x*h,this.direction.y*h,this.direction.z*h);l=!0}return l};
b.prototype.getDistanceToPrimitive=function(a){var b=this.calcVec1;return this.intersects(a,!1,b)?this.origin.distance(b.x,b.y,b.z):Infinity};b.prototype.intersectsPlane=function(a,b){var e=a.normal,f=e.dot(this.direction);if(Math.abs(f)<1.0E-5)return!1;e=(-e.dot(this.origin)+a.constant)/f;if(e<1.0E-5)return!1;b!==null&&b.set(this.direction).multiplyLocal(e).addLocal(this.origin);return!0};b.prototype.distanceSquared=function(a,b){var e=this.calcVec1;e.set(a).subtractLocal(this.origin);var f=this.direction.dot(e);
f>0?(e.set(this.direction).multiplyLocal(f),e.addLocal(this.origin)):e.set(this.origin);b!==null&&b.set(e);a.subtract(e,e);return e.lengthSquared()};return b});
define("goo/renderer/Camera","goo/util/Handy,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/math/Plane,goo/math/MathUtils,goo/math/Ray,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume".split(","),function(g,c,b,a,d,e,f,j,h,k){function i(e,f,h,j){this.translation=new c(0,0,0);this._left=new c(-1,0,0);this._up=new c(0,1,0);this._direction=new c(0,0,-1);g.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0});
g.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0});this._depthRangeDirty=!0;this._frustumNear=1;this._frustumFar=2;this._frustumLeft=-0.5;this._frustumTop=this._frustumRight=0.5;this._frustumBottom=-0.5;this._coeffLeft=[];this._coeffRight=[];this._coeffBottom=[];this._coeffTop=[];this._viewPortLeft=0;this._viewPortTop=this._viewPortRight=1;this._viewPortBottom=0;this._planeQuantity=6;this._worldPlane=[];for(var k=0;k<i.FRUSTUM_PLANES;k++)this._worldPlane[k]=new d;
this._newDirection=new c;this.projectionMode=i.Perspective;this._updateInverseMVPMatrix=this._updateMVPMatrix=this._updatePMatrix=this._updateInverseMVMatrix=this._updateMVMatrix=!0;this.modelView=new a;this.modelViewInverse=new a;this.projection=new a;this.modelViewProjection=new a;this.modelViewProjectionInverse=new a;this._viewPortDirty=this._depthRangeDirty=!0;this._planeState=0;this._clipPlane=new b;this._qCalc=new b;this._corners=[];for(k=0;k<8;k++)this._corners.push(new c);this._extents=new c;
this.vNearPlaneCenter=new c;this.vFarPlaneCenter=new c;this.direction=new c;this.left=new c;this.up=new c;this.planeNormal=new c;this.changedProperties=!0;this.setFrustumPerspective(e,f,h,j);this.onFrameChange()}i.LEFT_PLANE=0;i.RIGHT_PLANE=1;i.BOTTOM_PLANE=2;i.TOP_PLANE=3;i.FAR_PLANE=4;i.NEAR_PLANE=5;i.FRUSTUM_PLANES=6;i.Perspective=0;i.Parallel=1;i.Custom=2;i.Outside=0;i.Inside=1;i.Intersects=2;i.prototype.normalize=function(){this._left.normalize();this._up.normalize();this._direction.normalize();
this.onFrameChange()};i.prototype.setFrustumPerspective=function(a,b,d,f){if(a!==void 0&&a!==null)this.fov=a;if(b!==void 0&&b!==null)this.aspect=b;if(d!==void 0&&d!==null)this.near=d;if(f!==void 0&&f!==null)this.far=f;if(this.fov!==void 0)a=Math.tan(this.fov*e.DEG_TO_RAD*0.5)*this.near,b=a*this.aspect,this._frustumLeft=-b,this._frustumRight=b,this._frustumBottom=-a,this._frustumTop=a,this._frustumNear=this.near,this._frustumFar=this.far,this.onFrustumChange()};i.prototype.setFrustum=function(a,b,
d,e,f,c){this.near=this._frustumNear=a;this.far=this._frustumFar=b;this._frustumLeft=d;this._frustumRight=e;this._frustumTop=f;this._frustumBottom=c;this.onFrustumChange()};i.prototype.copy=function(a){this.translation.setv(a.translation);this._left.setv(a._left);this._up.setv(a._up);this._direction.setv(a._direction);this.fov=a.fov;this.aspect=a.aspect;this.near=a.near;this.far=a.far;this._frustumLeft=a._frustumLeft;this._frustumRight=a._frustumRight;this._frustumBottom=a._frustumBottom;this._frustumTop=
a._frustumTop;this._frustumNear=a._frustumNear;this._frustumFar=a._frustumFar;this.projectionMode=a.projectionMode;this._depthRangeDirty=!0;this.onFrustumChange();this.onFrameChange()};i.prototype.setFrame=function(a,b,d,e){this._left.copy(b);this._up.copy(d);this._direction.copy(e);this.translation.copy(a);this.onFrameChange()};i.prototype.lookAt=function(a,b){this._newDirection.copy(a).sub(this.translation).normalize();this._newDirection.equals(this._direction)||(this._direction.copy(this._newDirection),
this._up.copy(b).normalize(),this._up.equals(c.ZERO)&&this._up.copy(c.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(c.ZERO)&&(this._direction.x!==0?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange())};i.prototype.makeDirty=function(){this._viewPortDirty=this._depthRangeDirty=!0};i.prototype.update=function(){this._depthRangeDirty=
!0;this.onFrustumChange();this.onFrameChange()};i.prototype.setViewPort=function(){console.warn("Camera.setViewPort() not implemented.")};i.prototype.contains=function(a){if(!a)return i.Inside;for(var b=i.Inside,d=i.FRUSTUM_PLANES-1;d>=0;d--)switch(a.whichSide(this._worldPlane[d])){case k.Inside:return i.Outside;case k.Intersects:b=i.Intersects}return b};i.prototype.onFrustumChange=function(){if(this.projectionMode===i.Perspective){var a=this._frustumNear*this._frustumNear,b=this._frustumRight*this._frustumRight,
d=this._frustumBottom*this._frustumBottom,e=this._frustumTop*this._frustumTop,f=1/Math.sqrt(a+this._frustumLeft*this._frustumLeft);this._coeffLeft[0]=this._frustumNear*f;this._coeffLeft[1]=-this._frustumLeft*f;f=1/Math.sqrt(a+b);this._coeffRight[0]=-this._frustumNear*f;this._coeffRight[1]=this._frustumRight*f;f=1/Math.sqrt(a+d);this._coeffBottom[0]=this._frustumNear*f;this._coeffBottom[1]=-this._frustumBottom*f;f=1/Math.sqrt(a+e);this._coeffTop[0]=-this._frustumNear*f;this._coeffTop[1]=this._frustumTop*
f}else this.projectionMode===i.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1),this._coeffRight[1]=0,this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1),this._coeffTop[1]=0);this.changedProperties=this._updateInverseMVPMatrix=this._updateInverseMVMatrix=
this._updateMVPMatrix=this._updatePMatrix=!0};i.prototype.onFrameChange=function(){var a=this._direction.dot(this.translation),b=this.planeNormal;b.x=this._left.x*this._coeffLeft[0];b.y=this._left.y*this._coeffLeft[0];b.z=this._left.z*this._coeffLeft[0];b.add([this._direction.x*this._coeffLeft[1],this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]);this._worldPlane[i.LEFT_PLANE].normal.copy(b);this._worldPlane[i.LEFT_PLANE].constant=this.translation.dot(b);b.x=this._left.x*
this._coeffRight[0];b.y=this._left.y*this._coeffRight[0];b.z=this._left.z*this._coeffRight[0];b.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]);this._worldPlane[i.RIGHT_PLANE].normal.copy(b);this._worldPlane[i.RIGHT_PLANE].constant=this.translation.dot(b);b.x=this._up.x*this._coeffBottom[0];b.y=this._up.y*this._coeffBottom[0];b.z=this._up.z*this._coeffBottom[0];b.add([this._direction.x*this._coeffBottom[1],this._direction.y*
this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]);this._worldPlane[i.BOTTOM_PLANE].normal.copy(b);this._worldPlane[i.BOTTOM_PLANE].constant=this.translation.dot(b);b.x=this._up.x*this._coeffTop[0];b.y=this._up.y*this._coeffTop[0];b.z=this._up.z*this._coeffTop[0];b.add([this._direction.x*this._coeffTop[1],this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]);this._worldPlane[i.TOP_PLANE].normal.copy(b);this._worldPlane[i.TOP_PLANE].constant=this.translation.dot(b);if(this.projectionMode===
i.Parallel)this._frustumRight>this._frustumLeft?(this._worldPlane[i.LEFT_PLANE].constant=this._worldPlane[i.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[i.RIGHT_PLANE].constant=this._worldPlane[i.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[i.LEFT_PLANE].constant=this._worldPlane[i.LEFT_PLANE].contant-this._frustumLeft,this._worldPlane[i.RIGHT_PLANE].constant=this._worldPlane[i.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[i.TOP_PLANE].constant=
this._worldPlane[i.TOP_PLANE].contant+this._frustumTop,this._worldPlane[i.BOTTOM_PLANE].constant=this._worldPlane[i.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[i.TOP_PLANE].constant=this._worldPlane[i.TOP_PLANE].contant-this._frustumTop,this._worldPlane[i.BOTTOM_PLANE].constant=this._worldPlane[i.BOTTOM_PLANE].contant+this._frustumBottom);b.copy(this._direction).invert();this._worldPlane[i.FAR_PLANE].normal.copy(b);this._worldPlane[i.FAR_PLANE].constant=-(a+this._frustumFar);this._worldPlane[i.NEAR_PLANE].normal.copy(this._direction);
this._worldPlane[i.NEAR_PLANE].constant=a+this._frustumNear;this._updateInverseMVPMatrix=this._updateInverseMVMatrix=this._updateMVPMatrix=this._updateMVMatrix=!0};i.prototype.updateProjectionMatrix=function(){if(this.projectionMode===i.Parallel){this.projection.setIdentity();var a=this.projection.data;a[0]=2/(this._frustumRight-this._frustumLeft);a[5]=2/(this._frustumTop-this._frustumBottom);a[10]=-2/(this._frustumFar-this._frustumNear);a[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-
this._frustumLeft);a[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom);a[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===i.Perspective)this.projection.setIdentity(),a=this.projection.data,a[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),a[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),a[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),a[9]=(this._frustumTop+
this._frustumBottom)/(this._frustumTop-this._frustumBottom),a[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),a[11]=-1,a[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),a[15]=0};i.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var a=this.modelView.data;a[0]=-this._left.x;a[4]=-this._left.y;a[8]=-this._left.z;a[1]=this._up.x;a[5]=this._up.y;a[9]=this._up.z;a[2]=-this._direction.x;a[6]=-this._direction.y;a[10]=
-this._direction.z;a[12]=this._left.dot(this.translation);a[13]=-this._up.dot(this.translation);a[14]=this._direction.dot(this.translation)};i.prototype.getPickRay=function(a,b,d,e,g){g||(g=new f);var h=new c,j=new c;this.getWorldCoordinates(a,e-b,d,e,0,h);this.getWorldCoordinates(a,e-b,d,e,0.3,j).sub(h).normalize();g.origin.copy(h);g.direction.copy(j);return g};i.prototype.getWorldCoordinates=function(a,d,e,f,g,h){h||(h=new c);this.checkInverseModelViewProjection();var j=new b;j.set((a/e-this._viewPortLeft)/
(this._viewPortRight-this._viewPortLeft)*2-1,(d/f-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1,g*2-1,1);this.modelViewProjectionInverse.applyPost(j);j.mul(1/j.w);h.x=j.x;h.y=j.y;h.z=j.z;return h};i.prototype.getScreenCoordinates=function(a,b,d,e){e=this.getNormalizedDeviceCoordinates(a,e);e.x=(e.x+1)*(this._viewPortRight-this._viewPortLeft)/2*b;e.y=(e.y+1)*(this._viewPortTop-this._viewPortBottom)/2*d;e.z=(e.z+1)/2;return e};i.prototype.getFrustumCoordinates=function(a,b){b=this.getNormalizedDeviceCoordinates(a,
b);b.x=(b.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft;b.y=(b.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom;b.z=(b.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear;return b};i.prototype.getNormalizedDeviceCoordinates=function(a,d){d||(d=new c);this.checkModelViewProjection();var e=new b;e.set(a.x,a.y,a.z,1);this.modelViewProjection.applyPost(e);e.mul(1/e.w);d.x=e.x;d.y=e.y;d.z=e.z;return d};i.prototype.checkModelView=function(){if(this._updateMVMatrix)this.updateModelViewMatrix(),
this._updateMVMatrix=!1};i.prototype.checkProjection=function(){if(this._updatePMatrix)this.updateProjectionMatrix(),this._updatePMatrix=!1};i.prototype.checkModelViewProjection=function(){if(this._updateMVPMatrix)this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1};i.prototype.checkInverseModelView=function(){if(this._updateInverseMVMatrix)this.checkModelView(),a.invert(this.modelView,this.modelViewInverse),
this._updateInverseMVMatrix=!1};i.prototype.checkInverseModelViewProjection=function(){if(this._updateInverseMVPMatrix)this.checkModelViewProjection(),a.invert(this.modelViewProjection,this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1};i.prototype.getViewMatrix=function(){this.checkModelView();return this.modelView};i.prototype.getProjectionMatrix=function(){this.checkProjection();return this.projection};i.prototype.getViewProjectionMatrix=function(){this.checkModelViewProjection();
return this.modelViewProjection};i.prototype.getViewInverseMatrix=function(){this.checkInverseModelView();return this.modelViewInverse};i.prototype.getViewProjectionInverseMatrix=function(){this.checkInverseModelViewProjection();return this.modelViewProjectionInverse};i.prototype.pack=function(a){for(var d=a.center,e=this._corners,f=this._extents,c=0;c<e.length;c++)e[c].set(d);a instanceof j?f.setd(a.xExtent,a.yExtent,a.zExtent):a instanceof h&&f.setd(a.radius,a.radius,a.radius);e[0].add_d(f.x,f.y,
f.z);e[1].add_d(f.x,-f.y,f.z);e[2].add_d(f.x,f.y,-f.z);e[3].add_d(f.x,-f.y,-f.z);e[4].add_d(-f.x,f.y,f.z);e[5].add_d(-f.x,-f.y,f.z);e[6].add_d(-f.x,f.y,-f.z);e[7].add_d(-f.x,-f.y,-f.z);for(var f=this.getViewMatrix(),a=Number.MAX_VALUE,d=-Number.MAX_VALUE,g=new b,c=0;c<e.length;c++)g.setd(e[c].x,e[c].y,e[c].z,1),f.applyPre(g),a=Math.min(-g.z,a),d=Math.max(-g.z,d);a=Math.min(Math.max(this._frustumNear,a),this._frustumFar);d=Math.max(a,Math.min(this._frustumFar,d));e=a/this._frustumNear;this._frustumLeft*=
e;this._frustumRight*=e;this._frustumTop*=e;this._frustumBottom*=e;this._frustumNear=a;this._frustumFar=d};i.prototype.calculateFrustumCorners=function(a,b){var a=a!==void 0?a:this._frustumNear,b=b!==void 0?b:this._frustumFar,d=(this._frustumTop-this._frustumBottom)*a*0.5/this._frustumNear,e=(this._frustumRight-this._frustumLeft)*a*0.5/this._frustumNear,f=(this._frustumTop-this._frustumBottom)*b*0.5/this._frustumNear,c=(this._frustumRight-this._frustumLeft)*b*0.5/this._frustumNear;this.projectionMode===
i.Parallel&&(d=(this._frustumTop-this._frustumBottom)*0.5,e=(this._frustumRight-this._frustumLeft)*0.5,f=(this._frustumTop-this._frustumBottom)*0.5,c=(this._frustumRight-this._frustumLeft)*0.5);var g=this.vNearPlaneCenter,h=this.vFarPlaneCenter,j=this.direction,k=this.left,l=this.up;j.setv(this._direction).mul(a);g.setv(this.translation).addv(j);j.setv(this._direction).mul(b);h.setv(this.translation).addv(j);k.setv(this._left).mul(e);l.setv(this._up).mul(d);this._corners[0].setv(g).subv(k).subv(l);
this._corners[1].setv(g).addv(k).subv(l);this._corners[2].setv(g).addv(k).addv(l);this._corners[3].setv(g).subv(k).addv(l);k.setv(this._left).mul(c);l.setv(this._up).mul(f);this._corners[4].setv(h).subv(k).subv(l);this._corners[5].setv(h).addv(k).subv(l);this._corners[6].setv(h).addv(k).addv(l);this._corners[7].setv(h).subv(k).addv(l);return this._corners};var l=function(a){if(a>0)return 1;else if(a<0)return-1;return 0};i.prototype.setToObliqueMatrix=function(a,d){var d=d||0,e=this._clipPlane.setv(a);
this.getViewMatrix().applyPost(e);e.w=this.translation.y*a.y+d;this._updatePMatrix=!0;var f=this.getProjectionMatrix();this._qCalc.setd((l(e.x)+f[8])/f[0],(l(e.y)+f[9])/f[5],-1,(1+f[10])/f[14]);e.mul(2/b.dot(e,this._qCalc));f[2]=e.x;f[6]=e.y;f[10]=e.z+1;f[14]=e.w;this._updateInverseMVPMatrix=this._updateMVPMatrix=!0};return i});
define("goo/renderer/pass/FullscreenUtil",["goo/shapes/ShapeCreator","goo/renderer/Camera","goo/math/Vector3"],function(g,c,b){function a(){}var d=new c;d.projectionMode=c.Parallel;d.setFrustum(-1,1,-1,1,1,-1);d._left.copy(b.UNIT_X).invert();d._up.copy(b.UNIT_Y);d._direction.copy(b.UNIT_Z);d.onFrameChange();a.camera=d;a.quad=g.createQuad(2,2);return a});
define("goo/renderer/pass/FullscreenPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(g,c,b){function a(a){this.material=g.createMaterial(a||b.simple);this.useReadBuffer=!0;this.renderToScreen=!1;this.renderable={meshData:c.quad,materials:[this.material]};this.enabled=!0;this.clear=!1;this.needsSwap=!0}a.prototype.render=function(a,b,f){this.useReadBuffer&&this.material.setTexture("DIFFUSE_MAP",f);this.renderToScreen?a.render(this.renderable,
c.camera,[],null,this.clear):a.render(this.renderable,c.camera,[],b,this.clear)};return a});
define("goo/renderer/shadow/ShadowHandler","goo/math/Vector3,goo/renderer/pass/FullscreenPass,goo/renderer/Camera,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/renderer/pass/RenderTarget,goo/math/Vector4".split(","),function(g,c,b,a,d,e,f){function j(){this.shadowY=this.shadowX=512;this.shadowSettings={type:"Blur",projection:"Perspective",fov:55,size:100,near:1,far:1E3};this.lightCam=new b(this.shadowSettings.fov,1,this.shadowSettings.near,this.shadowSettings.far);this.currentSettings=
this.shadowSettings;this.depthMaterial=a.createMaterial(d.lightDepth,"depthMaterial");this.shadowTarget=new e(this.shadowX,this.shadowY,{type:"Float"});this.shadowTargetDown=new e(this.shadowX/2,this.shadowY/2,{type:"Float"});this.shadowResult=this.shadowBlurred=new e(this.shadowX/2,this.shadowY/2,{type:"Float"});this.fullscreenPass=new c;this.downsample=a.createShader(d.downsample,"downsample");this.boxfilter=a.createShader(d.boxfilter,"boxfilter");this.boxfilter.uniforms.viewport=[this.shadowX/
2,this.shadowY/2];this.oldClearColor=new f(0,0,0,0);this.shadowClearColor=new f(1,1,1,1);this.renderList=[];this.shadowList=[];this.upVector=g.UNIT_Z;this.tmpVec=new g}j.prototype._testStatesEqual=function(a,b){for(var d in a)if(a[d]!==b[d])return!1;return!0};j.prototype.checkShadowRendering=function(a,d,e,f){for(var c=a.shadowCount=0;c<f.length;c++){var j=f[c];if(j.shadowCaster){var p=this.lightCam;p.translation.copy(j.translation);j.direction?(this.tmpVec.setv(j.translation).addv(j.direction),p.lookAt(this.tmpVec,
this.upVector)):p.lookAt(g.ZERO,g.UNIT_Y);if(!this._testStatesEqual(this.currentSettings,j.shadowSettings)){if(j.shadowSettings.projection==="Perspective")p.setFrustumPerspective(j.shadowSettings.fov,1,j.shadowSettings.near,j.shadowSettings.far);else if(j.shadowSettings.projection==="Parallel"){var n=j.shadowSettings.size;p.setFrustum(j.shadowSettings.near,j.shadowSettings.far,-n,n,n,-n);p.projectionMode=b.Parallel}p.update();j.shadowSettings.type==="Blur"?(this.depthMaterial.cullState.cullFace="Back",
this.depthMaterial.shader.defines.SHADOW_TYPE=1):this.depthMaterial.shader.defines.SHADOW_TYPE=0;for(var r in j.shadowSettings)this.currentSettings[r]=j.shadowSettings[r];console.log("updated light")}p.onFrameChange();this.oldClearColor.copy(a.clearColor);a.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a);for(n=this.shadowList.length=0;n<e.length;n++){var t=e[n];t.meshRendererComponent&&t.meshRendererComponent.castShadows&&this.shadowList.push(t)}d.process(p,
this.shadowList,this.renderList);a.render(this.renderList,p,[],this.shadowTarget,!0,this.depthMaterial);switch(j.shadowSettings.type){case "Blur":this.fullscreenPass.material.shader=this.downsample;this.fullscreenPass.render(a,this.shadowTargetDown,this.shadowTarget,0);this.fullscreenPass.material.shader=this.boxfilter;this.fullscreenPass.render(a,this.shadowBlurred,this.shadowTargetDown,0);this.shadowResult=this.shadowBlurred;break;case "None":this.shadowResult=this.shadowTarget;break;default:this.shadowResult=
this.shadowTarget}a.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a);a.shadowCount++}}};return j});
define("goo/renderer/Renderer","goo/renderer/RendererRecord,goo/renderer/Util,goo/renderer/TextureCreator,goo/renderer/pass/RenderTarget,goo/math/Vector4,goo/entities/Entity,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/math/Transform,goo/renderer/RenderQueue,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler".split(","),function(g,c,b,a,d,e,f,j,h,k,i,l,m,o,p,n){function r(a){var a=a||{},b=
a.canvas;if(b===void 0)b=document.createElement("canvas"),b.width=500,b.height=500;this.domElement=b;this._alpha=a.alpha!==void 0?a.alpha:!1;this._premultipliedAlpha=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0;this._antialias=a.antialias!==void 0?a.antialias:!1;this._stencil=a.stencil!==void 0?a.stencil:!1;this._preserveDrawingBuffer=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1;this._onError=a.onError;var e={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,
stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer};this.context=null;if(window.WebGLRenderingContext){for(var f=["experimental-webgl","webgl","moz-webgl","webkit-3d"],c=0;c<f.length;c++)try{if((this.context=b.getContext(f[c],e))&&typeof this.context.getParameter==="function")break}catch(k){}if(!this.context)throw{name:"GooWebGLError",message:"WebGL is supported but disabled",supported:!0,enabled:!1};}else throw{name:"GooWebGLError",message:"WebGL is not supported",supported:!1,
enabled:!1};if(a.debug){var l=new XMLHttpRequest;l.open("GET","/js/goo/lib/webgl-debug.js",!1);l.onreadystatechange=function(){l.readyState===4&&l.status>=200&&l.status<=299&&window.eval.call(window,l.responseText)};l.send(null);typeof window.WebGLDebugUtils==="undefined"?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),a.validate?(console.log('Running with "undefined arguments" validation.'),this.context=
window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),t)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))}this.rendererRecord=new g;this.glExtensionCompressedTextureS3TC=j.SUPPORTS_DDS=h.isSupported(this.context);this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float");this.glExtensionTextureFloatLinear=this.context.getExtension("OES_texture_float_linear");this.glExtensionTextureHalfFloat=this.context.getExtension("OES_texture_half_float");
this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives");this.glExtensionTextureFilterAnisotropic=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic");this.glExtensionDepthTexture=this.context.getExtension("WEBGL_depth_texture")||this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture");
this.glExtensionElementIndexUInt=this.context.getExtension("OES_element_index_uint");this.glExtensionTextureFloat||console.log("Float textures not supported.");this.glExtensionTextureFloatLinear||console.log("Float textures with linear filtering not supported.");this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported.");this.glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported.");this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported.");
this.glExtensionDepthTexture||console.log("Depth textures not supported.");this.glExtensionElementIndexUInt||console.log("32 bit indices not supported.");if(this.context.getShaderPrecisionFormat===void 0)this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}};this.capabilities={maxTexureSize:this.context.getParameter(q.MAX_TEXTURE_SIZE),maxCubemapSize:this.context.getParameter(q.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:this.context.getParameter(q.MAX_RENDERBUFFER_SIZE),
maxViewPortDims:this.context.getParameter(q.MAX_VIEWPORT_DIMS),maxVertexTextureUnits:this.context.getParameter(q.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentTextureUnits:this.context.getParameter(q.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTextureUnits:this.context.getParameter(q.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.context.getParameter(q.MAX_VERTEX_ATTRIBS),maxVertexUniformVectors:this.context.getParameter(q.MAX_VERTEX_UNIFORM_VECTORS),maxFragmentUniformVectors:this.context.getParameter(q.MAX_FRAGMENT_UNIFORM_VECTORS),
maxVaryingVectors:this.context.getParameter(q.MAX_VARYING_VECTORS),aliasedPointSizeRange:this.context.getParameter(q.ALIASED_POINT_SIZE_RANGE),aliasedLineWidthRange:this.context.getParameter(q.ALIASED_LINE_WIDTH_RANGE),samples:this.context.getParameter(q.SAMPLES),sampleBuffers:this.context.getParameter(q.SAMPLE_BUFFERS),depthBits:this.context.getParameter(q.DEPTH_BITS),stencilBits:this.context.getParameter(q.STENCIL_BITS),subpixelBits:this.context.getParameter(q.SUBPIXEL_BITS),supportedExtensionsList:this.context.getSupportedExtensions(),
renderer:this.context.getParameter(q.RENDERER),vendor:this.context.getParameter(q.VENDOR),version:this.context.getParameter(q.VERSION),shadingLanguageVersion:this.context.getParameter(q.SHADING_LANGUAGE_VERSION),vertexShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_FLOAT),vertexShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_FLOAT),vertexShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,
this.context.LOW_FLOAT),fragmentShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_FLOAT),fragmentShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_FLOAT),fragmentShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_FLOAT),vertexShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_INT),vertexShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,
this.context.MEDIUM_INT),vertexShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_INT),fragmentShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_INT),fragmentShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_INT),fragmentShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_INT)};this.shaderPrecision=a.shaderPrecision||
"highp";this.shaderPrecision=this.shaderPrecision==="highp"&&this.capabilities.vertexShaderHighpFloat.precision>0&&this.capabilities.fragmentShaderHighpFloat.precision>0?"highp":this.shaderPrecision!=="lowp"&&this.capabilities.vertexShaderMediumpFloat.precision>0&&this.capabilities.fragmentShaderMediumpFloat.precision>0?"mediump":"lowp";this.downScale=a.downScale||1;this.clearColor=new d;this.setClearColor(0.3,0.3,0.3,1);this.context.clearDepth(1);this.context.clearStencil(0);this.context.stencilMask(0);
this.context.enable(q.DEPTH_TEST);this.context.depthFunc(q.LEQUAL);this.currentHeight=this.currentWidth=this.viewportHeight=this.viewportWidth=this.viewportY=this.viewportX=0;this._overrideMaterials=[];this._mergedMaterial=new i("Merged Material");this.renderQueue=new o;this.info={calls:0,vertices:0,indices:0,reset:function(){this.indices=this.vertices=this.calls=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}};this.shadowCount=0;this.shadowHandler=
new n;this.hardwarePicking=null}function t(a,b){for(var d=0;d<b.length;++d)b[d]===void 0&&console.error("undefined passed to gl."+a+"("+window.WebGLDebugUtils.glFunctionArgsToString(a,b)+")")}var q=window.WebGLRenderingContext;r.prototype.onDebugError=function(a,b,d){for(var a="WebGL error "+window.WebGLDebugUtils.glEnumToString(a)+" in "+b+"(",e=0;e<d.length;++e)a+=(e===0?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(b,e,d[e]);a+=")";console.error(a);this._onError&&this._onError(a)};r.mainCamera=
null;r.prototype.checkResize=function(a){var b=this.domElement.offsetWidth/this.downScale,d=this.domElement.offsetHeight/this.downScale;(b!==this.domElement.width||d!==this.domElement.height)&&this.setSize(b,d);b=this.domElement.width/this.domElement.height;if(a&&a.aspect!==b)a.aspect=b,a.setFrustumPerspective(),a.onFrameChange()};r.prototype.setSize=function(a,b){this.domElement.width=a;this.domElement.height=b;this.setViewport(0,0,a,b);if(this.hardwarePicking!==null)this.hardwarePicking.pickingTarget=
null};r.prototype.setViewport=function(a,b,d,e){this.viewportX=a!==void 0?a:0;this.viewportY=b!==void 0?b:0;this.viewportWidth=d!==void 0?d:this.domElement.width;this.viewportHeight=e!==void 0?e:this.domElement.height;this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight)};r.prototype.setClearColor=function(a,b,d,e){this.clearColor.set(a,b,d,e);this.context.clearColor(a,b,d,e)};r.prototype.bindData=function(a){var b=a.glBuffer;if(b!==null){if(this.setBoundBuffer(b,
a.target),a._dataNeedsRefresh)this.context.bufferSubData(this.getGLBufferTarget(a.target),0,a.data),a._dataNeedsRefresh=!1}else b=this.context.createBuffer(),a.glBuffer=b,this.rendererRecord.invalidateBuffer(a.target),this.setBoundBuffer(b,a.target),this.context.bufferData(this.getGLBufferTarget(a.target),a.data,this.getGLBufferUsage(a._dataUsage))};r.prototype.updateShadows=function(a,b,d){this.shadowHandler.checkShadowRendering(this,a,b,d)};r.prototype.render=function(a,b,d,e,f,g){this._overrideMaterials=
g?g instanceof Array?g:[g]:[];if(b){if(r.mainCamera===null)r.mainCamera=b;this.setRenderTarget(e);f===void 0||f===null||f===!0?this.clear():typeof f==="object"&&this.clear(f.color,f.depth,f.stencil);d={camera:b,mainCamera:r.mainCamera,lights:d,lightCamera:this.shadowHandler?this.shadowHandler.lightCam:null,renderer:this};if(Array.isArray(a)){this.renderQueue.sort(a,b);for(b=0;b<a.length;b++)this.fillRenderInfo(a[b],d),this.renderMesh(d)}else this.fillRenderInfo(a,d),this.renderMesh(d);e&&c.isPowerOfTwo(e.width)&&
c.isPowerOfTwo(e.height)&&this.updateRenderTargetMipmap(e)}};r.prototype.fillRenderInfo=function(a,b){a instanceof e?(b.meshData=a.meshDataComponent.meshData,b.materials=a.meshRendererComponent.materials,b.transform=a.particleComponent?m.IDENTITY:a.transformComponent.worldTransform,a.meshDataComponent.currentPose?b.currentPose=a.meshDataComponent.currentPose:delete b.currentPose):(b.meshData=a.meshData,b.materials=a.materials,b.transform=a.transform);b.renderable=a};r.prototype.override=function(a,
b,d){d.empty();for(var e in d)if(d.hasOwnProperty(e))if(d[e]instanceof Object&&e!=="shader"){for(var f in a[e])d[e][f]=a[e][f];for(f in b[e])d[e][f]===void 0&&(d[e][f]=b[e][f])}else d[e]=a[e],d[e]===void 0&&(d[e]=b[e])};r.prototype.renderMesh=function(a){var s;var b=a.meshData;if(!(b.vertexData===null||b.vertexData!==null&&b.vertexData.data.byteLength===0||b.indexData!==null&&b.indexData.data.byteLength===0)){this.bindData(b.vertexData);for(var d=a.materials,e=null,f=b,c=0,c=this._overrideMaterials.length===
0?d.length:Math.max(this._overrideMaterials.length,d.length),g=0;g<c;g++){var h,j;g<d.length&&(h=d[g]);g<this._overrideMaterials.length?j=this._overrideMaterials[g]:this._overrideMaterials.length>0&&(j=this._overrideMaterials[0]);h&&j?(this.override(j,h,this._mergedMaterial),h=this._mergedMaterial):j&&(h=j);if(h.shader){h.errorOnce=!1;this.shadowCount>0?h.setTexture("SHADOW_MAP",this.shadowHandler.shadowResult):h.getTexture("SHADOW_MAP")&&h.removeTexture("SHADOW_MAP");if(h.wireframe&&e!=="wire"){if(!b.wireframeData)b.wireframeData=
b.buildWireframeData();b=b.wireframeData;this.bindData(b.vertexData);e="wire"}else if(h.flat&&e!=="flat"){if(!b.flatMeshData)b.flatMeshData=b.buildFlatMeshData();b=b.flatMeshData;this.bindData(b.vertexData);e="flat"}else!h.wireframe&&!h.flat&&e!==null&&(b=f,this.bindData(b.vertexData),e=null);a.material=h;a.meshData=b;var i=h.shader;if(i.processors||i.defines){if(i.processors)for(var k=0;k<i.processors.length;k++)i.processors[k](i,a);for(var l=Object.keys(i.defines),n=l.length,m=[],k=0;k<n;k++){var o=
l[k];m.push(o+"_"+i.defines[o])}m.sort();k=m.join("_")+"_"+i.name;l=this.rendererRecord.shaderCache=this.rendererRecord.shaderCache||{};if(l[k]){if(i=l[k],i!==h.shader){for(o in h.shader.uniforms)i.uniforms[o]=h.shader.uniforms[o];h.shader=i}}else s=h.shader=i.clone(),i=s,l[k]=i}i.apply(a,this);this.updateDepthTest(h);this.updateCulling(h);this.updateBlending(h);this.updateOffset(h);this.updateTextures(h);this.updateLineAndPointSettings(h);b.getIndexBuffer()!==null?(this.bindData(b.getIndexData()),
b.getIndexLengths()!==null?this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),b.getIndexLengths()):this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),[b.getIndexBuffer().length])):b.getIndexLengths()!==null?this.drawArraysVBO(b.getIndexModes(),b.getIndexLengths()):this.drawArraysVBO(b.getIndexModes(),[b.vertexCount]);this.info.calls++;this.info.vertices+=b.vertexCount;this.info.indices+=b.indexCount}else if(!h.errorOnce)console.warn("No shader set on material: "+h.name),h.errorOnce=
!0}}};r.prototype.readPixels=function(a,b,d,e,f){this.context.readPixels(a,b,d,e,q.RGBA,q.UNSIGNED_BYTE,f)};r.prototype.drawElementsVBO=function(a,b,d){for(var e=0,f=0,c=a.type=a.type||this.getGLArrayType(a),a=this.getGLByteSize(a),g=0;g<d.length;g++){var h=d[g];this.context.drawElements(this.getGLIndexMode(b[f]),h,c,e*a);e+=h;f<b.length-1&&f++}};r.prototype.drawArraysVBO=function(a,b){for(var d=0,e=0,f=0;f<b.length;f++){var c=b[f];this.context.drawArrays(this.getGLIndexMode(a[e]),d,c);d+=c;e<a.length-
1&&e++}};r.prototype.pick=function(b,d,e,f,c,g,h){if(this.viewportWidth*this.viewportHeight===0)c.id=-1,c.depth=0;else{if(this.hardwarePicking===null)g=i.createEmptyMaterial(p.pickingShader,"pickingMaterial"),g.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.hardwarePicking={pickingTarget:new a(this.viewportWidth/4,this.viewportHeight/4,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),pickingMaterial:g,
pickingBuffer:new Uint8Array(4)},g=!1;else if(this.hardwarePicking.pickingTarget===null)this.hardwarePicking.pickingTarget=new a(this.viewportWidth/4,this.viewportHeight/4,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),g=!1;e=Math.floor(e/4);f=Math.floor((this.viewportHeight-f)/4);g?this.setRenderTarget(this.hardwarePicking.pickingTarget):(h&&(this.context.enable(q.SCISSOR_TEST),this.context.scissor(e,f,1,1)),this.render(b,d,[],this.hardwarePicking.pickingTarget,!0,this.hardwarePicking.pickingMaterial),
h&&this.context.disable(q.SCISSOR_TEST));this.readPixels(e,f,1,1,this.hardwarePicking.pickingBuffer);b=(this.hardwarePicking.pickingBuffer[2]/255+this.hardwarePicking.pickingBuffer[3]/65025)*d.far;c.id=this.hardwarePicking.pickingBuffer[0]*255+this.hardwarePicking.pickingBuffer[1]-1;c.depth=b}};r.prototype.updateLineAndPointSettings=function(a){var b=this.rendererRecord.lineRecord,a=a.lineWidth||1;if(b.lineWidth!==a)this.context.lineWidth(a),b.lineWidth=a};r.prototype.updateDepthTest=function(a){var b=
this.rendererRecord.depthRecord,a=a.depthState;if(b.enabled!==a.enabled)a.enabled?this.context.enable(q.DEPTH_TEST):this.context.disable(q.DEPTH_TEST),b.enabled=a.enabled;if(b.write!==a.write)a.write?this.context.depthMask(!0):this.context.depthMask(!1),b.write=a.write};r.prototype.updateCulling=function(a){var b=this.rendererRecord.cullRecord,d=a.cullState.cullFace,e=a.cullState.frontFace,a=a.cullState.enabled;if(b.enabled!==a)a?this.context.enable(q.CULL_FACE):this.context.disable(q.CULL_FACE),
b.enabled=a;if(b.cullFace!==d)this.context.cullFace(d==="Front"?q.FRONT:d==="Back"?q.BACK:q.FRONT_AND_BACK),b.cullFace=d;if(b.frontFace!==e){switch(e){case "CCW":this.context.frontFace(q.CCW);break;case "CW":this.context.frontFace(q.CW)}b.frontFace=e}};r.prototype.updateTextures=function(d){for(var e=this.context,f=d.shader.textureSlots,g=0;g<f.length;g++){var h=f[g],j=d.getTexture(h.mapping);if(j!==void 0){if(j===null||j instanceof a===!1&&(j.image===void 0||j.checkDataReady()===!1))if(h.format===
"sampler2D")j=b.DEFAULT_TEXTURE_2D;else if(h.format==="samplerCube")j=b.DEFAULT_TEXTURE_CUBE;h=this.rendererRecord.textureRecord[g];h===void 0&&(h=this.rendererRecord.textureRecord[g]={});j.glTexture===null?(j.glTexture=e.createTexture(),this.updateTexture(e,j,g,h)):j instanceof a===!1&&j.checkNeedsUpdate()?(this.updateTexture(e,j,g,h),j.needsUpdate=!1):this.bindTexture(e,j,g,h);h=j.image!==void 0?j.image:j;h=c.isPowerOfTwo(h.width)&&c.isPowerOfTwo(h.height);this.updateTextureParameters(j,h)}}};r.prototype.updateTextureParameters=
function(a,b){var d=this.context,e=a.textureRecord;if(e===void 0)e={},a.textureRecord=e;if(e.magFilter!==a.magFilter){var f=this.getGLType(a.variant);d.texParameteri(f,q.TEXTURE_MAG_FILTER,this.getGLMagFilter(a.magFilter));e.magFilter=a.magFilter}var c=b?a.minFilter:this.getFilterFallback(a.minFilter);if(e.minFilter!==c)f=this.getGLType(a.variant),d.texParameteri(f,q.TEXTURE_MIN_FILTER,this.getGLMinFilter(c)),e.minFilter=c;c=b?a.wrapS:"EdgeClamp";if(e.wrapS!==c){var f=this.getGLType(a.variant),g=
this.getGLWrap(c,d);d.texParameteri(f,q.TEXTURE_WRAP_S,g);e.wrapS=c}c=b?a.wrapT:"EdgeClamp";if(e.wrapT!==c)f=this.getGLType(a.variant),g=this.getGLWrap(c,d),d.texParameteri(f,q.TEXTURE_WRAP_T,g),e.wrapT=c};r.prototype.bindTexture=function(a,b,d,e){if(e.boundTexture===void 0||b.glTexture!==void 0&&e.boundTexture!==b.glTexture)a.activeTexture(q.TEXTURE0+d),a.bindTexture(this.getGLType(b.variant),b.glTexture),e.boundTexture=b.glTexture};r.prototype.getGLType=function(a){switch(a){case "2D":return q.TEXTURE_2D;
case "CUBE":return q.TEXTURE_CUBE_MAP}throw"invalid texture type: "+a;};r.prototype.loadCompressedTexture=function(a,b,d,e){var f=d.image.mipmapSizes,c=0,g=0,j=d.image.width,i=d.image.height,k=h.getDdsExtension(a),l=k.COMPRESSED_RGBA_S3TC_DXT5_EXT;if(d.format==="PrecompressedDXT1")l=k.COMPRESSED_RGB_S3TC_DXT1_EXT;else if(d.format==="PrecompressedDXT1A")l=k.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if(d.format==="PrecompressedDXT3")l=k.COMPRESSED_RGBA_S3TC_DXT3_EXT;else if(d.format==="PrecompressedDXT5")l=
k.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw Error("Unhandled compression format: "+e.getDataFormat().name());if(typeof f==="undefined"||f===null)e instanceof Uint8Array?a.compressedTexImage2D(b,0,l,j,i,0,e):a.compressedTexImage2D(b,0,l,j,i,0,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));else{d.generateMipmaps=!1;for(k=0;k<f.length;k++)g=f[k],a.compressedTexImage2D(b,k,l,j,i,0,new Uint8Array(e.buffer,e.byteOffset+c,g)),j=~~(j/2)>1?~~(j/2):1,i=~~(i/2)>1?~~(i/2):1,c+=g;e=1+Math.ceil(Math.log(Math.max(d.image.height,
d.image.width))/Math.log(2));c=f[f.length-1];if(f.length<e)for(k=f.length;k<e;k++)c=~~((j+3)/4)*~~((i+3)/4)*d.image.bpp*2,a.compressedTexImage2D(b,k,l,j,i,0,new Uint8Array(c)),j=~~(j/2)>1?~~(j/2):1,i=~~(i/2)>1?~~(i/2):1}};r.prototype.updateTexture=function(a,b,d,e){a.activeTexture(q.TEXTURE0+d);a.bindTexture(this.getGLType(b.variant),b.glTexture);e.boundTexture=b.glTexture;a.pixelStorei(q.UNPACK_ALIGNMENT,1);a.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,b.flipY);d=b.image;if(b.variant==="2D")if(d){if(!d.isCompressed&&
(b.generateMipmaps||d.width>this.capabilities.maxTexureSize||d.height>this.capabilities.maxTexureSize))this.checkRescale(b,d,d.width,d.height,this.capabilities.maxTexureSize),d=b.image;d.isData===!0?d.isCompressed?this.loadCompressedTexture(a,q.TEXTURE_2D,b,d.data):a.texImage2D(q.TEXTURE_2D,0,this.getGLInternalFormat(b.format),d.width,d.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),d.data):a.texImage2D(q.TEXTURE_2D,0,this.getGLInternalFormat(b.format),this.getGLInternalFormat(b.format),
this.getGLPixelDataType(b.type),d);b.generateMipmaps&&!d.isCompressed&&a.generateMipmap(q.TEXTURE_2D)}else a.texImage2D(q.TEXTURE_2D,0,this.getGLInternalFormat(b.format),b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null);else if(b.variant==="CUBE"){if(d&&(b.generateMipmaps||d.width>this.capabilities.maxCubemapSize||d.height>this.capabilities.maxCubemapSize)){for(e=0;e<f.CUBE_FACES.length;e++)this.checkRescale(b,d.data[e],d.width,d.height,this.capabilities.maxCubemapSize);
d=b.image}for(e=0;e<f.CUBE_FACES.length;e++){var c=f.CUBE_FACES[e];d?d.isData===!0?d.isCompressed?this.loadCompressedTexture(a,this.getGLCubeMapFace(c),b,d.data[e]):a.texImage2D(this.getGLCubeMapFace(c),0,this.getGLInternalFormat(b.format),d.width,d.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),d.data[e]):a.texImage2D(this.getGLCubeMapFace(c),0,this.getGLInternalFormat(b.format),this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),d.data[e]):
a.texImage2D(this.getGLCubeMapFace(c),0,this.getGLInternalFormat(b.format),b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null)}d&&b.generateMipmaps&&!d.isCompressed&&a.generateMipmap(q.TEXTURE_CUBE_MAP)}};r.prototype.checkRescale=function(a,b,d,e,f){var g=c.nearestPowerOfTwo(d),h=c.nearestPowerOfTwo(e),g=Math.min(g,f),h=Math.min(h,f);if(d!==g||e!==h)f=document.createElement("canvas"),f.width=g,f.height=h,f.getContext("2d").drawImage(b,0,0,d,e,0,0,g,h),document.body.appendChild(f),
f.dataReady=!0,a.image=f,f.parentNode.removeChild(f)};r.prototype.getGLWrap=function(a){switch(a){case "Repeat":return q.REPEAT;case "MirroredRepeat":return q.MIRRORED_REPEAT;case "EdgeClamp":return q.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+a;};r.prototype.getGLInternalFormat=function(a){switch(a){case "RGBA":return q.RGBA;case "RGB":return q.RGB;case "Alpha":return q.ALPHA;case "Luminance":return q.LUMINANCE;case "LuminanceAlpha":return q.LUMINANCE_ALPHA;default:throw"Unsupported format: "+
a;}};r.prototype.getGLPixelDataType=function(a){switch(a){case "UnsignedByte":return q.UNSIGNED_BYTE;case "UnsignedShort565":return q.UNSIGNED_SHORT_5_6_5;case "UnsignedShort4444":return q.UNSIGNED_SHORT_4_4_4_4;case "UnsignedShort5551":return q.UNSIGNED_SHORT_5_5_5_1;case "Float":return q.FLOAT;default:throw"Unsupported type: "+a;}};r.prototype.getFilterFallback=function(a){switch(a){case "NearestNeighborNoMipMaps":case "NearestNeighborNearestMipMap":case "NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";
case "BilinearNoMipMaps":case "Trilinear":case "BilinearNearestMipMap":return"BilinearNoMipMaps";default:return"NearestNeighborNoMipMaps"}};r.prototype.getGLMagFilter=function(a){switch(a){case "Bilinear":return q.LINEAR;case "NearestNeighbor":return q.NEAREST}throw"invalid MagnificationFilter type: "+a;};r.prototype.getGLMinFilter=function(a){switch(a){case "BilinearNoMipMaps":return q.LINEAR;case "Trilinear":return q.LINEAR_MIPMAP_LINEAR;case "BilinearNearestMipMap":return q.LINEAR_MIPMAP_NEAREST;
case "NearestNeighborNoMipMaps":return q.NEAREST;case "NearestNeighborNearestMipMap":return q.NEAREST_MIPMAP_NEAREST;case "NearestNeighborLinearMipMap":return q.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+a;};r.prototype.getGLBufferTarget=function(a){return a==="ElementArrayBuffer"?q.ELEMENT_ARRAY_BUFFER:q.ARRAY_BUFFER};r.prototype.getGLArrayType=function(a){if(a instanceof Uint8Array)return q.UNSIGNED_BYTE;else if(a instanceof Uint16Array)return q.UNSIGNED_SHORT;else if(a instanceof
Uint32Array)return q.UNSIGNED_INT;else if(a instanceof Int8Array)return q.UNSIGNED_BYTE;else if(a instanceof Int16Array)return q.UNSIGNED_SHORT;else if(a instanceof Int32Array)return q.UNSIGNED_INT;return null};r.prototype.getGLByteSize=function(a){if(!(a instanceof Uint8Array))if(a instanceof Uint16Array)return 2;else if(a instanceof Uint32Array)return 4;else if(!(a instanceof Int8Array))if(a instanceof Int16Array)return 2;else if(a instanceof Int32Array)return 4;return 1};r.prototype.getGLCubeMapFace=
function(a){switch(a){case "PositiveX":return q.TEXTURE_CUBE_MAP_POSITIVE_X;case "NegativeX":return q.TEXTURE_CUBE_MAP_NEGATIVE_X;case "PositiveY":return q.TEXTURE_CUBE_MAP_POSITIVE_Y;case "NegativeY":return q.TEXTURE_CUBE_MAP_NEGATIVE_Y;case "PositiveZ":return q.TEXTURE_CUBE_MAP_POSITIVE_Z;case "NegativeZ":return q.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+a;};r.prototype.getGLBufferUsage=function(a){var b=q.STATIC_DRAW;switch(a){case "StaticDraw":b=q.STATIC_DRAW;break;case "DynamicDraw":b=
q.DYNAMIC_DRAW;break;case "StreamDraw":b=q.STREAM_DRAW}return b};r.prototype.getGLIndexMode=function(a){var b=q.TRIANGLES;switch(a){case "Triangles":b=q.TRIANGLES;break;case "TriangleStrip":b=q.TRIANGLE_STRIP;break;case "TriangleFan":b=q.TRIANGLE_FAN;break;case "Lines":b=q.LINES;break;case "LineStrip":b=q.LINE_STRIP;break;case "LineLoop":b=q.LINE_LOOP;break;case "Points":b=q.POINTS}return b};r.prototype.updateBlending=function(a){var b=this.rendererRecord.blendRecord,d=this.context,e=a.blendState.blending;
if(e!==b.blending)e==="NoBlending"?d.disable(q.BLEND):e==="AdditiveBlending"?(d.enable(q.BLEND),d.blendEquation(q.FUNC_ADD),d.blendFunc(q.SRC_ALPHA,q.ONE)):e==="SubtractiveBlending"?(d.enable(q.BLEND),d.blendEquation(q.FUNC_ADD),d.blendFunc(q.ZERO,q.ONE_MINUS_SRC_COLOR)):e==="MultiplyBlending"?(d.enable(q.BLEND),d.blendEquation(q.FUNC_ADD),d.blendFunc(q.DST_COLOR,q.ONE_MINUS_SRC_ALPHA)):e==="AlphaBlending"?(d.enable(q.BLEND),d.blendEquation(q.FUNC_ADD),d.blendFunc(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA)):
e==="CustomBlending"?d.enable(q.BLEND):(d.enable(q.BLEND),d.blendEquationSeparate(q.FUNC_ADD,q.FUNC_ADD),d.blendFuncSeparate(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA,q.ONE,q.ONE_MINUS_SRC_ALPHA)),b.blending=e;if(e==="CustomBlending"){var e=a.blendState.blendEquation,f=a.blendState.blendSrc,a=a.blendState.blendDst;if(e!==b.blendEquation)d.blendEquation(this.getGLBlendParam(e)),b.blendEquation=e;if(f!==b.blendSrc||a!==b.blendDst)d.blendFunc(this.getGLBlendParam(f),this.getGLBlendParam(a)),b.blendSrc=f,b.blendDst=
a}else b.blendEquation=null,b.blendSrc=null,b.blendDst=null};r.prototype.updateOffset=function(a){var b=this.rendererRecord.offsetRecord,d=this.context,e=a.offsetState.enabled,f=a.offsetState.factor,a=a.offsetState.units;if(b.enabled!==e)e?d.enable(q.POLYGON_OFFSET_FILL):d.disable(q.POLYGON_OFFSET_FILL),b.enabled=e;if(e&&(b.factor!==f||b.units!==a))d.polygonOffset(f,a),b.factor=f,b.units=a};r.prototype.setBoundBuffer=function(a,b){var d=this.rendererRecord.currentBuffer[b];if(!d.valid||d.buffer!==
a)this.context.bindBuffer(this.getGLBufferTarget(b),a),d.buffer=a,d.valid=!0};r.prototype.bindVertexAttribute=function(a,b){this.context.vertexAttribPointer(a,b.count,this.getGLDataType(b.type),b.normalized,b.stride,b.offset)};r.prototype.getGLDataType=function(a){switch(a){case "Float":case "HalfFloat":case "Double":return q.FLOAT;case "Byte":return q.BYTE;case "UnsignedByte":return q.UNSIGNED_BYTE;case "Short":return q.SHORT;case "UnsignedShort":return q.UNSIGNED_SHORT;case "Int":return q.INT;case "UnsignedInt":return q.UNSIGNED_INT;
default:throw"Unknown datatype: "+a;}};r.prototype.getGLBlendParam=function(a){switch(a){case "AddEquation":return q.FUNC_ADD;case "SubtractEquation":return q.FUNC_SUBTRACT;case "ReverseSubtractEquation":return q.FUNC_REVERSE_SUBTRACT;case "ZeroFactor":return q.ZERO;case "OneFactor":return q.ONE;case "SrcColorFactor":return q.SRC_COLOR;case "OneMinusSrcColorFactor":return q.ONE_MINUS_SRC_COLOR;case "SrcAlphaFactor":return q.SRC_ALPHA;case "OneMinusSrcAlphaFactor":return q.ONE_MINUS_SRC_ALPHA;case "DstAlphaFactor":return q.DST_ALPHA;
case "OneMinusDstAlphaFactor":return q.ONE_MINUS_DST_ALPHA;case "DstColorFactor":return q.DST_COLOR;case "OneMinusDstColorFactor":return q.ONE_MINUS_DST_COLOR;case "SrcAlphaSaturateFactor":return q.SRC_ALPHA_SATURATE;default:throw"Unknown blend param: "+a;}};r.prototype.clear=function(a,b,d){var e=0;if(a===void 0||a)e|=q.COLOR_BUFFER_BIT;if(b===void 0||b)e|=q.DEPTH_BUFFER_BIT;if(d===void 0||d)e|=q.STENCIL_BUFFER_BIT;a=this.rendererRecord.depthRecord;if(a.write!==!0)this.context.depthMask(!0),a.write=
!0;this.context.clear(e)};r.prototype.flush=function(){this.context.flush()};r.prototype.finish=function(){this.context.finish()};r.prototype.setupFrameBuffer=function(a,b,d){this.context.bindFramebuffer(q.FRAMEBUFFER,a);this.context.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,d,b.glTexture,0)};r.prototype.setupRenderBuffer=function(a,b){this.context.bindRenderbuffer(q.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(this.context.renderbufferStorage(q.RENDERBUFFER,q.DEPTH_COMPONENT16,b.width,
b.height),this.context.framebufferRenderbuffer(q.FRAMEBUFFER,q.DEPTH_ATTACHMENT,q.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(this.context.renderbufferStorage(q.RENDERBUFFER,q.DEPTH_STENCIL,b.width,b.height),this.context.framebufferRenderbuffer(q.FRAMEBUFFER,q.DEPTH_STENCIL_ATTACHMENT,q.RENDERBUFFER,a)):this.context.renderbufferStorage(q.RENDERBUFFER,q.RGBA4,b.width,b.height)};r.prototype.setRenderTarget=function(a){if(a&&!a._glFrameBuffer){if(a.depthBuffer===void 0)a.depthBuffer=!0;if(a.stencilBuffer===
void 0)a.stencilBuffer=!0;a.glTexture=this.context.createTexture();var b=c.isPowerOfTwo(a.width)&&c.isPowerOfTwo(a.height),d=this.getGLInternalFormat(a.format),e=this.getGLDataType(a.type);a._glFrameBuffer=this.context.createFramebuffer();a._glRenderBuffer=this.context.createRenderbuffer();this.context.bindTexture(q.TEXTURE_2D,a.glTexture);this.updateTextureParameters(a,b);this.context.texImage2D(q.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null);this.setupFrameBuffer(a._glFrameBuffer,a,q.TEXTURE_2D);
this.setupRenderBuffer(a._glRenderBuffer,a);a.generateMipmaps&&b&&this.context.generateMipmap(q.TEXTURE_2D);this.context.bindTexture(q.TEXTURE_2D,null);this.context.bindRenderbuffer(q.RENDERBUFFER,null);this.context.bindFramebuffer(q.FRAMEBUFFER,null)}var f;a?(b=a._glFrameBuffer,f=e=0,d=a.width,a=a.height):(b=null,e=this.viewportX,f=this.viewportY,d=this.viewportWidth,a=this.viewportHeight);if(b!==this.rendererRecord.currentFrameBuffer)this.context.bindFramebuffer(q.FRAMEBUFFER,b),this.context.viewport(e,
f,d,a),this.rendererRecord.currentFrameBuffer=b,this.rendererRecord.textureRecord=[];this.currentWidth=d;this.currentHeight=a};r.prototype.updateRenderTargetMipmap=function(a){this.context.bindTexture(q.TEXTURE_2D,a.glTexture);this.context.generateMipmap(q.TEXTURE_2D);this.context.bindTexture(q.TEXTURE_2D,null)};r.prototype.getCapabilitiesString=function(){var a=[],b;for(b in this.capabilities){var d=this.capabilities[b],e="";if(d instanceof ArrayBufferView){e+="[";for(var f=0;f<d.length;f++)e+=d[f],
f<d.length-1&&(e+=",");e+="]"}else e=d;a.push(b+": "+e)}return a.join("\n")};r.prototype._deallocateMeshData=function(){};r.prototype._deallocateTexture=function(){};r.prototype._deallocateRenderTarget=function(){};r.prototype._deallocateShader=function(){};return r});
define("goo/addons/howler/systems/HowlerSystem",["goo/entities/systems/System","goo/math/Vector3","goo/renderer/Renderer"],function(g,c,b){function a(a){g.call(this,"HowlerSystem",["HowlerComponent"]);this.settings=a||{};this.settings.scale=this.settings.scale||1}a.prototype=Object.create(g.prototype);a.prototype.deleted=function(a){var a=a.howlerComponent.sounds,b;for(b in a)a[b].stop()};a.prototype.process=function(a){for(var e=0;e<a.length;e++){var f=a[e],g=f.howlerComponent.sounds,h=new c;h.copy(f.transformComponent.transform.translation);
var f=b.mainCamera.getViewMatrix().applyPostPoint(h),k;for(k in g)g[k].pos3d(f.data[0]*this.settings.scale,f.data[1]*this.settings.scale,f.data[2]*this.settings.scale)}};return a});
define("goo/addons/scripts/PolyBoundingScript",[],function(){function g(c){this.collidables=c||[]}g.prototype.addCollidable=function(c){this.collidables.push(c)};g.prototype.removeAllAt=function(c,b,a){this.collidables=this.collidables.filter(function(d){if(d.bottom<=a&&d.top>=a)return!window.PolyK.ContainsPoint(d.poly,c,b)})};g.prototype.run=function(c){for(var c=c.transformComponent,b=c.transform.translation,a=0;a<this.collidables.length;a++){var d=this.collidables[a];if(d.bottom<=b.data[1]&&d.top>=
b.data[1]&&window.PolyK.ContainsPoint(d.poly,b.data[0],b.data[2])){a=window.PolyK.ClosestEdge(d.poly,b.data[0],b.data[2]);b.data[0]=a.point.x;b.data[2]=a.point.y;c.setUpdated();break}}};return g});
define("goo/addons/soundmanager2/components/SoundManager2Component",["goo/entities/components/Component"],function(g){function c(b){this.type="SoundManager2Component";this.settings=b||{};this.sounds={}}c.prototype=Object.create(g.prototype);c.prototype.addSound=function(b,a){this.sounds[b]=a};c.prototype.playSound=function(b){this.sounds[b].soundObject.play()};return c});
define("goo/addons/soundmanager2/systems/SoundManager2System",["goo/entities/systems/System"],function(g){function c(){g.call(this,"SoundManager2System",["SoundManager2Component","TransformComponent"]);this.isReady=!1;window.soundManager?window.soundManager.bind(this).setup({url:"swf",onready:function(){this.isReady=!0},ontimeout:function(){console.warn("Failed to load soundmanager")}}):console.warn("SoundManager2System: soundManager global not found")}c.prototype=Object.create(g.prototype);c.prototype.inserted=
function(b){for(var b=b.soundManager2Component,a=0;a<b.sounds.length;a++){var d=b.sounds[a],e=window.soundManager.createSound(d);d.soundObject=e}};c.prototype.deleted=function(){};c.prototype.process=function(){};return c});
define("goo/entities/components/MeshDataComponent",["goo/renderer/bounds/BoundingSphere","goo/entities/components/Component"],function(g,c){function b(a){this.type="MeshDataComponent";this.meshData=a;this.modelBound=new g;this.autoCompute=!0;this.currentPose=null}b.prototype=Object.create(c.prototype);b.prototype.setModelBound=function(a,b){this.modelBound=a;this.autoCompute=b};b.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&this.modelBound!==null){var a=this.meshData.getAttributeBuffer("POSITION");
if(a!==void 0)this.modelBound.computeFromPoints(a),this.autoCompute=!1}};return b});
define("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component"],function(g){function c(){this.type="MeshRendererComponent";this.materials=[];this.worldBound=null;this.cullMode="Dynamic";this.isPickable=this.receiveShadows=this.castShadows=!1;this.isReflectable=!0}c.prototype=Object.create(g.prototype);c.prototype.updateBounds=function(b,a){this.worldBound=b.transform(a,this.worldBound)};return c});
define("goo/addons/terrain/Terrain","goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/renderer/TextureCreator".split(","),function(g,c,b,a,d,e){function f(b){var d=a.createMaterial(j),f=(new e).loadTexture2D("../resources/head_diffuse.jpg");d.setTexture("DIFFUSE_MAP",f);var c=a.createMaterial(j);c.setTexture("HEIGHT_MAP",f);c.wireframe=!0;this.material=d;this.material2=c;d=b.createEntity();d.addToWorld();
for(f=0;f<6;f++)c=this.createClipmapLevel(b,f,f===0),d.transformComponent.attachChild(c.transformComponent)}f.prototype.createClipmapLevel=function(a,b,d){var e=a.createEntity(),f=Math.pow(2,b);e.transformComponent.transform.scale.set(f,f,1);f=(2*Math.pow(-1,b+1)+Math.pow(2,b+1))/6;b=b%2===0?f:-f;e.transformComponent.transform.translation.set(b,-b,0);e.addToWorld();this.createQuadEntity(a,e,0,0,3,3);this.createQuadEntity(a,e,3,0,3,3);this.createQuadEntity(a,e,6,0,2,3);this.createQuadEntity(a,e,8,
0,3,3);this.createQuadEntity(a,e,11,0,3,3);this.createQuadEntity(a,e,0,3,3,3);this.createQuadEntity(a,e,11,3,3,3);this.createQuadEntity(a,e,0,6,3,2);this.createQuadEntity(a,e,11,6,3,2);this.createQuadEntity(a,e,0,8,3,3);this.createQuadEntity(a,e,11,8,3,3);this.createQuadEntity(a,e,0,11,3,3);this.createQuadEntity(a,e,3,11,3,3);this.createQuadEntity(a,e,6,11,2,3);this.createQuadEntity(a,e,8,11,3,3);this.createQuadEntity(a,e,11,11,3,3);d&&this.createQuadEntity(a,e,3,4,7,7);return e};f.prototype.createQuadEntity=
function(a,b,d,e,f,j){d=this.createGrid(d,e,f,j);a=a.createEntity();b.transformComponent.attachChild(a.transformComponent);b=new g(d);a.setComponent(b);b=new c;b.materials.push(this.material2);a.setComponent(b);a.addToWorld();return a};f.prototype.createGrid=function(a,d,e,f){for(var c=b.defaultMap([b.POSITION,b.TEXCOORD0]),c=new b(c,(e+1)*(f+1),e*f*6),g=c.getAttributeBuffer(b.POSITION),j=c.getAttributeBuffer(b.TEXCOORD0),n=c.getIndexBuffer(),r=0;r<e+1;r++)for(var t=0;t<f+1;t++){var q=t*(e+1)+r;g[q*
3+0]=r+a-7;g[q*3+1]=t+d-7;g[q*3+2]=0;j[q*2+0]=(r+a)/15;j[q*2+1]=(t+d)/15}for(r=0;r<e;r++)for(t=0;t<f;t++)q=t*(e+1)+r,a=t*e+r,n[a*6+0]=q,n[a*6+1]=q+1,n[a*6+2]=q+e+1,n[a*6+3]=q+1,n[a*6+4]=q+e+1+1,n[a*6+5]=q+e+1;return c};var j={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,diffuseMap:"DIFFUSE_MAP",time:d.TIME},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform float time;\nuniform sampler2D diffuseMap;\nvarying vec4 texCol;\nvoid main(void) {\n\ttexCol = texture2D(diffuseMap, vertexUV0 + vec2(time*0.0));\n\tfloat height = length(texCol.rgb);\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * \n\t\tvec4(vertexPosition.x,vertexPosition.y,height*5.0, 1.0);\n}",
fshader:"precision mediump float;\nvarying vec4 texCol;\nvoid main(void)\n{\n\tgl_FragColor = texCol;\n}"};return f});
define("goo/entities/EventHandler",[],function(){function g(){}g.listeners=[];g.dispatch=function(){if(arguments.length===0)throw Error("Event needs to specify a callback as first argument");for(var c=arguments[0],b=Array.prototype.slice.call(arguments,1),a=0;a<g.listeners.length;a++){var d=g.listeners[a];d[c]&&d[c].apply(null,b)}};g.addListener=function(c){g.listeners.indexOf(c)===-1&&g.listeners.push(c)};g.removeListener=function(c){c=g.listeners.indexOf(c);c!==-1&&g.listeners.splice(c,1)};return g});
define("goo/addons/water/FlatWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/math/Vector3,goo/math/Vector4,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/entities/EventHandler,goo/renderer/shaders/ShaderFragment".split(","),function(g,c,b,a,d,e,f,j,h,k,i,l){function m(c){c=c||{};this.useRefraction=c.useRefraction!==void 0?c.useRefraction:!0;this.waterCamera=new b(45,1,0.1,2E3);this.renderList=
[];this.waterPlane=new a;var g=Math.floor(window.innerWidth/(c.divider||2)),i=Math.floor(window.innerHeight/(c.divider||2));this.reflectionTarget=new d(g,i);if(this.useRefraction)this.refractionTarget=new d(g,i),this.depthTarget=new d(g,i);g=j.createMaterial(o,"WaterMaterial");g.shader.defines.REFRACTION=this.useRefraction;g.cullState.enabled=!1;c=c.normalsUrl||"../resources/water/waternormals3.png";g.setTexture("NORMAL_MAP",(new h).loadTexture2D(c));g.setTexture("REFLECTION_MAP",this.reflectionTarget);
this.useRefraction&&(g.setTexture("REFRACTION_MAP",this.refractionTarget),g.setTexture("DEPTH_MAP",this.depthTarget));this.waterMaterial=g;this.followCam=!0;this.calcVect=new e;this.camReflectDir=new e;this.camReflectUp=new e;this.camReflectLeft=new e;this.camLocation=new e;this.camReflectPos=new e;this.offset=new e;this.clipPlane=new f;this.waterEntity=null;this.depthMaterial=j.createMaterial(p,"depth")}m.prototype.process=function(a,b,d,e,f){var b=b.filter(function(a){return a.meshRendererComponent.isReflectable}),
c=this.waterPlane;this.waterCamera.copy(e);c.constant=this.waterEntity.transformComponent.transform.translation.y;var g=e.translation.y>c.constant;this.waterEntity.skip=!0;if(g){this.useRefraction&&(d.process(this.waterCamera,b,this.renderList),this.clipPlane.setd(c.normal.x,-c.normal.y,c.normal.z,c.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),a.render(this.renderList,this.waterCamera,f,this.depthTarget,!0,this.depthMaterial),a.render(this.renderList,this.waterCamera,f,this.refractionTarget,
!0));var h=this.calcVect,j=this.camReflectDir,i=this.camReflectUp,k=this.camReflectLeft,l=this.camLocation,m=this.camReflectPos;l.set(e.translation);var o=c.pseudoDistance(l);h.set(c.normal).mul(o*2);m.set(l.sub(h));l.set(e.translation).add(e._direction);o=c.pseudoDistance(l);h.set(c.normal).mul(o*2);j.set(l.sub(h)).sub(m).normalize();l.set(e.translation).add(e._up);o=c.pseudoDistance(l);h.set(c.normal).mul(o*2);i.set(l.sub(h)).sub(m).normalize();k.set(i).cross(j).normalize();this.waterCamera.translation.set(m);
this.waterCamera._direction.set(j);this.waterCamera._up.set(i);this.waterCamera._left.set(k);this.waterCamera.normalize();this.waterCamera.update();if(this.skybox&&this.followCam)h=this.skybox.transformComponent.worldTransform,h.translation.setv(m),h.update()}this.waterMaterial.shader.uniforms.abovewater=g;d.process(this.waterCamera,b,this.renderList);a.setRenderTarget(this.reflectionTarget);a.clear();if(this.skybox)if(this.skybox instanceof Array){this.clipPlane.setd(c.normal.x,c.normal.y,c.normal.z,
c.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane,10);for(b=0;b<this.skybox.length;b++)a.render(this.skybox[b],this.waterCamera,f,this.reflectionTarget,!1),this.skybox[b].skip=!0}else a.render(this.skybox,this.waterCamera,f,this.reflectionTarget,!1),this.skybox.skip=!0;this.clipPlane.setd(c.normal.x,c.normal.y,c.normal.z,c.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane);a.render(this.renderList,this.waterCamera,f,this.reflectionTarget,!1);this.waterEntity.skip=!1;if(this.skybox)if(this.skybox instanceof
Array)for(b=0;b<this.skybox.length;b++)this.skybox[b].skip=!1;else this.skybox.skip=!1;if(g&&this.skybox&&this.followCam)a=e.translation,h=this.skybox.transformComponent.worldTransform,h.translation.setv(a).addv(this.offset),h.update(),this.waterCamera._updatePMatrix=!0};m.prototype.setSkyBox=function(a){this.skybox=a;if(a.meshRendererComponent)this.skybox.meshRendererComponent.materials[0].depthState.enabled=!1,this.skybox.meshRendererComponent.materials[0].renderQueue=0,this.skybox.meshRendererComponent.cullMode=
"Never"};m.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial};var o={defines:{REFRACTION:!1},attributes:{vertexPosition:g.POSITION,vertexNormal:g.NORMAL},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",refraction:"REFRACTION_MAP",depthmap:"DEPTH_MAP",vertexTangent:[1,0,0,1],waterColor:[0.0625,0.0625,
0.0625],abovewater:!0,fogColor:[1,1,1],sunDirection:[0.66,0.66,0.33],sunColor:[1,1,0.5],sunShininess:100,sunSpecPower:4,fogStart:0,fogScale:2E3,timeMultiplier:1,time:c.TIME,distortionMultiplier:0.025,fresnelPow:2,normalMultiplier:3,fresnelMultiplier:1,waterScale:5,doFog:!0,resolution:c.RESOLUTION},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float waterScale;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvoid main(void) {\n\tworldPos = (worldMatrix * vec4(vertexPosition, 1.0)).xyz;\n\ttexCoord0 = worldPos.xz * waterScale;\n\tmat3 normalMatrix = mat3(worldMatrix);\n\tvec3 n = normalize(normalMatrix * vec3(vertexNormal.x, vertexNormal.y, -vertexNormal.z));\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewCoords;\n}",
fshader:["uniform sampler2D normalMap;\nuniform sampler2D reflection;\n#ifdef REFRACTION\nuniform sampler2D refraction;\nuniform sampler2D depthmap;\n#endif\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec3 fogColor;\nuniform float fogStart;\nuniform float fogScale;\nuniform float time;\nuniform float timeMultiplier;\nuniform float distortionMultiplier;\nuniform float fresnelPow;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform float sunShininess;\nuniform float sunSpecPower;\nuniform float normalMultiplier;\nuniform float fresnelMultiplier;\nuniform bool doFog;\nuniform vec2 resolution;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvec4 combineTurbulence(in vec2 coords) {\n\tfloat t = time * timeMultiplier;\n\tvec4 coarse1 = texture2D(normalMap, coords * vec2(0.0012, 0.001) + vec2(0.019 * t, 0.021 * t));\n\tvec4 coarse2 = texture2D(normalMap, coords * vec2(0.001, 0.0011) + vec2(-0.017 * t, 0.016 * t));\n\tvec4 detail1 = texture2D(normalMap, coords * vec2(0.008) + vec2(0.06 * t, 0.03 * t));\n\tvec4 detail2 = texture2D(normalMap, coords * vec2(0.006) + vec2(0.05 * t, -0.04 * t));\n\treturn (detail1 * 0.25 + detail2 * 0.25 + coarse1 * 0.75 + coarse2 * 1.0) / 2.25 - 0.48;\n}\n#ifdef REFRACTION",
l.methods.unpackDepth,"#endif\nvoid main(void)\n{\n\tfloat fogDist = clamp((viewCoords.z-fogStart)/fogScale,0.0,1.0);\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = combineTurbulence(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(normalMultiplier, normalMultiplier, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector * vec3(fresnelMultiplier, fresnelMultiplier, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfresnel *= 1.0 - fogDist;\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm = pow(fresnelTerm, fresnelPow);\n\tfresnelTerm = clamp(fresnelTerm, 0.0, 1.0);\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tprojCoord.y -= 1.0 / resolution.y;\n#ifdef REFRACTION\n\tfloat depthUnpack = unpackDepth(texture2D(depthmap, projCoord));\n\tif (depthUnpack > 0.5) {depthUnpack = 0.0;}\n\tfloat depth2 = clamp(depthUnpack * 400.0, 0.0, 1.0);\n\tvec2 projCoordRefr = vec2(projCoord);\n\tprojCoordRefr += (normalVector.xy * distortionMultiplier) * (depth2);\n\tprojCoordRefr = clamp(projCoordRefr, 0.001, 0.999);\n\tdepthUnpack = unpackDepth(texture2D(depthmap, projCoordRefr));\n\tfloat depth = clamp(depthUnpack * 40.0, 0.8, 1.0);\n#endif\n\tprojCoord += (normalVector.xy * distortionMultiplier);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tvec4 waterColorX = vec4(waterColor, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 sunSpecReflection = normalize(reflect(-sunDirection, normalVector));\n\t\tfloat sunSpecDirection = max(0.0, dot(localView, sunSpecReflection));\n\t\tvec3 specular = pow(sunSpecDirection, sunShininess) * sunSpecPower * sunColor;\n\t\tvec4 endColor = waterColorX;\n#ifdef REFRACTION\n\t\tvec4 refractionColor = texture2D(refraction, projCoordRefr) * vec4(0.6);\n\t\tendColor = mix(refractionColor, waterColorX, depth);\n#endif\n\t\tendColor = mix(endColor, reflectionColor, fresnelTerm);\n\t\tif (doFog) {\n\t\t\tgl_FragColor = (vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist)) * (1.0-fogDist) + vec4(fogColor, 1.0) * fogDist;\n\t\t} else {\n\t\t\tgl_FragColor = vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist);\n\t\t}\n\t}\n}"].join("\n")},
p={attributes:{vertexPosition:g.POSITION},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,farPlane:c.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * vPosition;\n}",fshader:["uniform float farPlane;",l.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = abs(vPosition.y) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};
return m});
define("goo/addons/water/ProjectedGridWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/renderer/pass/FullscreenPass,goo/math/Vector3,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/renderer/shaders/ShaderFragment".split(","),function(g,c,b,a,d,e,f,j,h,k,i){function l(c){this.waterCamera=new b(45,1,0.1,2E3);this.renderList=[];this.waterPlane=new a;var c=c||{},i=window.innerWidth/(c.divider||
4),l=window.innerHeight/(c.divider||4);this.renderTarget=new d(i,l);i=window.innerWidth/(c.divider||1);l=window.innerHeight/(c.divider||1);this.heightTarget=new d(i,l,{type:"Float"});this.normalTarget=new d(i,l,{});this.fullscreenPass=new e(k.normalmap);this.fullscreenPass.material.shader.uniforms.resolution=[i,l];c=this.waterMaterial=j.createMaterial(m,"WaterMaterial");c.cullState.enabled=!1;c.setTexture("NORMAL_MAP",(new h).loadTexture2D("../resources/water/waternormals3.png"));c.setTexture("REFLECTION_MAP",
this.renderTarget);c.setTexture("BUMP_MAP",this.heightTarget);c.setTexture("NORMAL_MAP_COARSE",this.normalTarget);c=this.materialWire=j.createMaterial(k.simple,"mat");c.wireframe=!0;c.wireframeColor=[0,0,0];this.calcVect=new f;this.camReflectDir=new f;this.camReflectUp=new f;this.camReflectLeft=new f;this.camLocation=new f;this.camReflectPos=new f;this.waterEntity=null;c=this.projData=new g(g.defaultMap([g.POSITION]),4,6);c.getAttributeBuffer(g.POSITION).set([0,0,0,1,0,0,1,1,0,0,1,0]);c.getIndexBuffer().set([1,
3,0,2,3,1]);i=j.createMaterial(o,"mat");this.projRenderable={meshData:c,materials:[i]}}l.prototype.updateHelper=function(a,b,d,e){var f=this.projData.getAttributeBuffer(g.POSITION);f[0]=a.x/a.w;f[1]=0;f[2]=a.z/a.w;f[3]=b.x/b.w;f[4]=0;f[5]=b.z/b.w;f[6]=d.x/d.w;f[7]=0;f[8]=d.z/d.w;f[9]=e.x/e.w;f[10]=0;f[11]=e.z/e.w;this.projData.setVertexDataUpdated()};l.prototype.process=function(a,b,d,e,f){var c=this.waterEntity.meshDataComponent.meshData;c.update(e);this.waterMaterial.shader.uniforms.intersectBottomLeft=
[c.intersectBottomLeft.x,c.intersectBottomLeft.y,c.intersectBottomLeft.z,c.intersectBottomLeft.w];this.waterMaterial.shader.uniforms.intersectBottomRight=[c.intersectBottomRight.x,c.intersectBottomRight.y,c.intersectBottomRight.z,c.intersectBottomRight.w];this.waterMaterial.shader.uniforms.intersectTopLeft=[c.intersectTopLeft.x,c.intersectTopLeft.y,c.intersectTopLeft.z,c.intersectTopLeft.w];this.waterMaterial.shader.uniforms.intersectTopRight=[c.intersectTopRight.x,c.intersectTopRight.y,c.intersectTopRight.z,
c.intersectTopRight.w];this.updateHelper(c.intersectBottomLeft,c.intersectBottomRight,c.intersectTopRight,c.intersectTopLeft);a.render(this.projRenderable,e,f,this.heightTarget,!0);this.fullscreenPass.render(a,this.normalTarget,this.heightTarget,0);var g=this.waterPlane;this.waterCamera.copy(e);g.constant=this.waterEntity.transformComponent.transform.translation.y;if(c=e.translation.y>g.constant){var h=this.calcVect,j=this.camReflectDir,i=this.camReflectUp,k=this.camReflectLeft,l=this.camLocation,
m=this.camReflectPos;l.set(e.translation);var o=g.pseudoDistance(l);h.set(g.normal).mul(o*2);m.set(l.sub(h));l.set(e.translation).add(e._direction);o=g.pseudoDistance(l);h.set(g.normal).mul(o*2);j.set(l.sub(h)).sub(m).normalize();l.set(e.translation).add(e._up);o=g.pseudoDistance(l);h.set(g.normal).mul(o*2);i.set(l.sub(h)).sub(m).normalize();k.set(i).cross(j).normalize();this.waterCamera.translation.set(m);this.waterCamera._direction.set(j);this.waterCamera._up.set(i);this.waterCamera._left.set(k);
this.waterCamera.normalize();this.waterCamera.update();if(this.skybox)g=this.skybox.transformComponent.worldTransform,g.translation.setv(m),g.update()}this.waterMaterial.shader.uniforms.abovewater=c;this.waterEntity.skip=!0;this.renderList.length=0;d.process(this.waterCamera,b,this.renderList);a.render(this.renderList,this.waterCamera,f,this.renderTarget,!0);this.waterEntity.skip=!1;if(c&&this.skybox)a=e.translation,g=this.skybox.transformComponent.worldTransform,g.translation.setv(a),g.update()};
l.prototype.setSkyBox=function(a){this.skybox=a};l.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.cullMode="Never";this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial;a=this.waterEntity.meshDataComponent.meshData;this.waterMaterial.shader.uniforms.density=[a.densityX,a.densityY]};var m={attributes:{vertexUV0:g.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,
normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",bump:"BUMP_MAP",normalMapCoarse:"NORMAL_MAP_COARSE",vertexNormal:[0,-1,0],vertexTangent:[1,0,0,1],waterColor:[15,15,15],abovewater:!0,fogColor:[1,1,1,1],sunDirection:[0.66,-0.1,0.66],coarseStrength:0.25,detailStrength:2,fogStart:0,camNear:c.NEAR_PLANE,camFar:c.FAR_PLANE,time:c.TIME,intersectBottomLeft:[0,0,0,0],intersectTopLeft:[0,0,0,0],intersectTopRight:[0,0,0,0],intersectBottomRight:[0,0,0,0],grid:!1,heightMultiplier:50,density:[1,1]},vshader:"attribute vec2 vertexUV0;\nuniform vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float time;\nuniform vec3 sunDirection;\nuniform float coarseStrength;\nuniform float heightMultiplier;\nuniform sampler2D bump;\nuniform vec4 intersectBottomLeft;\nuniform vec4 intersectTopLeft;\nuniform vec4 intersectTopRight;\nuniform vec4 intersectBottomRight;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nvoid main(void) {\n\tvec4 pointTop = mix(intersectTopLeft, intersectTopRight, vertexUV0.x);\n\tvec4 pointBottom = mix(intersectBottomLeft, intersectBottomRight, vertexUV0.x);\n\tvec4 pointFinal = mix(pointTop, pointBottom, 1.0 - vertexUV0.y);\n\tpointFinal.xz /= pointFinal.w;\n\tpointFinal.y = 0.0;\n\tvec4 screenpos = projectionMatrix * viewMatrix * worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tvec2 projCoord = screenpos.xy / screenpos.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat height = texture2D(bump, projCoord).x;\n\tpointFinal.y = height * heightMultiplier;\n\ttexCoord1 = vertexUV0;\n\tvec4 pos = worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tworldPos = pos.xyz;\n\ttexCoord0 = worldPos.xz * 2.0;\n\tmat3 normalMatrix = mat3(worldMatrix);\n vec3 n = normalize(normalMatrix * vertexNormal);\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tsunDir = sunDirection * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * pos;\n\tgl_Position = viewCoords;\n}",
fshader:"uniform sampler2D normalMap;\nuniform sampler2D reflection;\nuniform sampler2D normalMapCoarse;\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec4 fogColor;\nuniform float time;\nuniform bool grid;\nuniform vec2 density;\nuniform float camNear;\nuniform float camFar;\nuniform float fogStart;\nuniform float coarseStrength;\nuniform float detailStrength;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nconst vec3 sunColor = vec3(1.0, 0.96, 0.96);\nvec4 getNoise(vec2 uv) {\n    vec2 uv0 = (uv/123.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/127.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(time/51.0, time/47.0);\n    vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(time/59.0, time/-63.0);\n    vec4 noise = (texture2D(normalMap, uv0)) +\n                 (texture2D(normalMap, uv1)) +\n                 (texture2D(normalMap, uv2)*3.0) +\n                 (texture2D(normalMap, uv3)*3.0);\n    return noise/4.0-1.0;\n}\nvoid sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse,\n              inout vec3 diffuseColor, inout vec3 specularColor){\n    vec3 reflection = normalize(reflect(-sunDir, surfaceNormal));\n    float direction = max(0.0, dot(eyeDirection, reflection));\n    specularColor += pow(direction, shiny)*sunColor*spec;\n    diffuseColor += max(dot(sunDir, surfaceNormal),0.0)*sunColor*diffuse;\n}\nvoid main(void)\n{\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat fs = camFar * fogStart;\n\tfloat fogDist = clamp(max(viewCoords.z - fs, 0.0)/(camFar - camNear - fs), 0.0, 1.0);\n\tvec3 coarseNormal = texture2D(normalMapCoarse, projCoord).xyz * 2.0 - 1.0;\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = getNoise(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(1.8 * detailStrength, 1.8 * detailStrength, 1.0) + coarseNormal.xyz * vec3(1.8 * coarseStrength, 1.8 * coarseStrength, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector*vec3(1.0, 1.0, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tprojCoord += (normalVector.xy * 0.05);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n vec4 waterColorX = vec4(waterColor / 255.0, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular = vec3(0.0);\n\t    sunLight(normalVector, localView, 100.0, 2.0, 0.4, diffuse, specular);\n\t\tvec4 endColor = mix(waterColorX,reflectionColor,fresnelTerm);\n\t\tgl_FragColor = mix(vec4(diffuse*0.0 + specular, 1.0) + mix(endColor,reflectionColor,fogDist), fogColor, fogDist);\n\t}\n\tif (grid) {\n\t\tvec2 low = abs(fract(texCoord1*density)-0.5);\n\t\tfloat dist = 1.0 - step(min(low.x, low.y), 0.05);\n\t\tgl_FragColor *= vec4(dist);\n\t}\n}"},
o={attributes:{vertexPosition:g.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,time:c.TIME},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;\nvoid main(void) {\n\tworldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tviewCoords = viewMatrix * worldPos;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:["precision mediump float;\nuniform float time;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;",i.noise3d,"vec4 getNoise(sampler2D map, vec2 uv) {\n    vec2 uv0 = (uv/223.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/327.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(697.0, 983.0)+vec2(time/151.0, time/147.0);\n    vec2 uv3 = uv/vec2(791.0, 877.0)-vec2(time/259.0, time/263.0);\n    vec4 noise = (texture2D(map, uv0)*0.0) +\n                 (texture2D(map, uv1)*0.0) +\n                 (texture2D(map, uv2)*0.0) +\n                 (texture2D(map, uv3)*10.0);\n    return noise/5.0-1.0;\n}\nvoid main(void)\n{\n\tfloat fogDist = clamp(-viewCoords.z / 1000.0, 0.0, 1.0);\n\tgl_FragColor = vec4((snoise(vec3(worldPos.xz * 0.008, time * 0.4))+snoise(vec3(worldPos.xz * 0.02, time * 0.8))*0.5)/10.0);\n}"].join("\n")};
return l});define("goo/animation/Joint",["goo/math/Transform"],function(g){function c(b){this._name=b;this._parentIndex=this._index=0;this._inverseBindPose=new g}c.NO_PARENT=-32768;return c});
define("goo/animation/Skeleton",["goo/animation/Joint"],function(g){function c(b,a){this._name=b;this._joints=a}c.prototype.copy=function(){for(var b=this._name,a=this._joints,d=[],e=0,f=a.length;e<f;e++){var j=a[e],h=new g(j._name);h._index=j._index;h._parentIndex=j._parentIndex;h._inverseBindPose.copy(j._inverseBindPose);h._inverseBindPose.update();d[e]=h}return new c(b,d)};return c});
define("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(g,c,b){function a(a){this._skeleton=a;this._localTransforms=[];this._globalTransforms=[];this._matrixPalette=[];this._poseListeners=[];for(var a=this._skeleton._joints.length,e=0;e<a;e++)this._localTransforms[e]=new g;for(e=0;e<a;e++)this._globalTransforms[e]=new g;for(e=0;e<a;e++)this._matrixPalette[e]=new b;this.setToBindPose()}a.prototype.setToBindPose=function(){for(var a=0;a<this._localTransforms.length;a++){this._localTransforms[a].matrix.copy(this._skeleton._joints[a]._inverseBindPose.matrix).invert();
var e=this._skeleton._joints[a]._parentIndex;e!==c.NO_PARENT&&b.combine(this._skeleton._joints[e]._inverseBindPose.matrix,this._localTransforms[a].matrix,this._localTransforms[a].matrix)}this.updateTransforms()};a.prototype.updateTransforms=function(){for(var a=0;a<this._skeleton._joints.length;a++){var e=this._skeleton._joints[a]._parentIndex;e!==c.NO_PARENT?b.combine(this._globalTransforms[e].matrix,this._localTransforms[a].matrix,this._globalTransforms[a].matrix):this._globalTransforms[a].matrix.copy(this._localTransforms[a].matrix);
b.combine(this._globalTransforms[a].matrix,this._skeleton._joints[a]._inverseBindPose.matrix,this._matrixPalette[a])}this.firePoseUpdated()};a.prototype.firePoseUpdated=function(){for(var a=this._poseListeners.length;--a>=0;)this._poseListeners[a].poseUpdated(this)};return a});
define("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(g,c){function b(a){this._rotation=(new g).copy(a?a._rotation:g.IDENTITY);this._scale=(new c).copy(a?a._scale:c.ONE);this._translation=(new c).copy(a?a._translation:c.ZERO)}b.prototype.applyTo=function(a){a.setIdentity();a.rotation.copyQuaternion(this._rotation);a.scale.setv(this._scale);a.translation.setv(this._translation);a.update()};b.prototype.set=function(a){this._rotation.copy(a._rotation);this._scale.copy(a._scale);
this._translation.copy(a._translation)};b.prototype.blend=function(a,d,e){var e=e?e:new b,f=0,c=0,h=0,k=0,i=0,l=0,m,o;o=1-d;m=this._translation;k+=m.x*o;i+=m.y*o;l+=m.z*o;m=this._scale;f+=m.x*o;c+=m.y*o;h+=m.z*o;o=d;m=a._translation;k+=m.x*o;i+=m.y*o;l+=m.z*o;m=a._scale;f+=m.x*o;c+=m.y*o;h+=m.z*o;e._scale.setd(f,c,h);e._translation.setd(k,i,l);g.slerp(this._rotation,a._rotation,o,e._rotation);return e};return b});
define("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData"],function(g,c){function b(a,b,e){this._sourceA=a?a:null;this._sourceB=b?b:null;this.blendWeight=e?e:null}b.prototype.getSourceData=function(){var a=this._sourceA?this._sourceA.getSourceData():null,d=this._sourceB?this._sourceB.getSourceData():null;return b.combineSourceData(a,d,this.blendWeight)};b.prototype.setTime=function(a){var b=!1,e=!1;this._sourceA&&(b=this._sourceA.setTime(a));this._sourceB&&
(e=this._sourceB.setTime(a));return b||e};b.prototype.resetClips=function(a){this._sourceA&&this._sourceA.resetClips(a);this._sourceB&&this._sourceB.resetClips(a)};b.prototype.setTimeScale=function(a){this._sourceA.setTimeScale(a);this._sourceB.setTimeScale(a)};b.prototype.isActive=function(){var a=!1;this._sourceA&&(a=a||this._sourceA.isActive());this._sourceB&&(a=a||this._sourceB.isActive());return a};b.combineSourceData=function(a,d,e,f){if(d){if(!a)return d}else return a;var f=f?f:{},g;for(g in a){var h=
a[g],k=d[g];isNaN(h)?f[g]=h instanceof c?k?h.blend(k,e,f[g]):h:h:b.blendFloatValues(f,g,e,h,k)}for(g in d)f[g]||(f[g]=d[g]);return f};b.blendFloatValues=function(a,b,e,f,c){a[b]=isNaN(c)?f:g.lerp(e,f[0],c[0])};return b});
define("goo/animation/clip/AnimationClipInstance",["goo/entities/World"],function(g){function c(){this._active=!0;this._loopCount=0;this._timeScale=1;this._prevUnscaledClockTime=this._prevClockTime=this._startTime=0;this._clipStateObjects={};this._animationListeners=[]}c.prototype.setTimeScale=function(b,a){a=a||g.time;if(this._active&&this._timeScale!==b)if(this._timeScale!==0&&b!==0){var d=a,e=d-this._startTime;e*=this._timeScale;e/=b;this._startTime=d-e}else if(this._timeScale===0)this._startTime=
a-this._prevUnscaledClockTime;this._timeScale=b};c.prototype.getApplyTo=function(b){var a=b._channelName,d=this._clipStateObjects[a];d||(d=b.createStateDataObject(),this._clipStateObjects[a]=d);return d};return c});
define("goo/animation/blendtree/ClipSource",["goo/math/MathUtils","goo/animation/clip/AnimationClipInstance"],function(g,c){function b(a,b,e){this._clip=a;this._clipInstance=new c;this._filterChannels={};if(b&&e){this._filter=["Exclude","Include"].indexOf(b)>-1?b:null;for(a=0;a<e.length;a++)this._filterChannels[e[a]]=!0}}b.prototype.setTime=function(a){var b=this._clipInstance;if(!b._startTime)b._startTime=a;if(b._active){b._timeScale!==0?(b._prevUnscaledClockTime=a-b._startTime,a=b._timeScale*b._prevUnscaledClockTime,
b._prevClockTime=a):a=b._prevClockTime;var e=this._clip._maxTime;if(e===-1)return!1;if(e!==0&&(b._loopCount===-1||b._loopCount>1&&e*b._loopCount>=Math.abs(a)?a<0?a=e+a%e:a%=e:a<0&&(a=e+a),a>e||a<0))a=g.clamp(a,0,e),b._active=!1;this._clip.update(a,b)}return b._active};b.prototype.resetClips=function(a){this._clipInstance._startTime=a;this._clipInstance._active=!0};b.prototype.setTimeScale=function(a){this._clipInstance.setTimeScale(a)};b.prototype.isActive=function(){return this._clipInstance._active&&
this._clip._maxTime!==-1};b.prototype.getSourceData=function(){if(!this._filter||!this._filterChannels)return this._clipInstance._clipStateObjects;var a=this._clipInstance._clipStateObjects,b={},e=this._filter==="Include",f;for(f in a)this._filterChannels[f]!==void 0===e&&(b[f]=a[f]);return b};return b});
define("goo/animation/clip/AbstractAnimationChannel",[],function(){function g(c,b,a){this._blendType=a||"Linear";this._channelName=c;this._times=(b instanceof Array||b instanceof Float32Array)&&b.length?new Float32Array(b):[];this._lastStartFrame=0}g.prototype.getSampleCount=function(){return this._times.length};g.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0};g.prototype.updateSample=function(c,b){var a=this._times.length;if(a){var d=a-1;if(c<0||a===
1)this.setCurrentSample(0,0,b);else if(c>=this._times[d])this.setCurrentSample(d,0,b);else{d=0;if(c>=this._times[this._lastStartFrame])for(var e=this._lastStartFrame;e<a-1;e++){if(this._times[e]>=c)break;d=e}else for(e=0;e<this._lastStartFrame;e++){if(this._times[e]>=c)break;d=e}this.setCurrentSample(d,(c-this._times[d])/(this._times[d+1]-this._times[d]),b);this._lastFrame=d}}};return g});
define("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(g,c,b,a){function d(d,f,c,h,k,i){g.call(this,d,f,i);if(c.length/4!==f.length||h.length/3!==f.length||k.length/3!==f.length)throw Error("All provided arrays must be the same length (accounting for type)! Channel: "+d);this._rotations=new Float32Array(c);this._translations=new Float32Array(h);this._scales=new Float32Array(k);
this.tmpVec=new a;this.tmpQuat=new b;this.tmpQuat2=new b}d.prototype=Object.create(g.prototype);d.prototype.createStateDataObject=function(){return new c};d.prototype.setCurrentSample=function(a,d,c){var g=a*4,k=a*3,i=(a+1)*4,a=(a+1)*3;d===0?(c._rotation.data[0]=this._rotations[g+0],c._rotation.data[1]=this._rotations[g+1],c._rotation.data[2]=this._rotations[g+2],c._rotation.data[3]=this._rotations[g+3],c._translation.data[0]=this._translations[k+0],c._translation.data[1]=this._translations[k+1],
c._translation.data[2]=this._translations[k+2],c._scale.data[0]=this._scales[k+0],c._scale.data[1]=this._scales[k+1],c._scale.data[2]=this._scales[k+2]):d===1?(c._rotation.data[0]=this._rotations[i+0],c._rotation.data[1]=this._rotations[i+1],c._rotation.data[2]=this._rotations[i+2],c._rotation.data[3]=this._rotations[i+3],c._translation.data[0]=this._translations[a+0],c._translation.data[1]=this._translations[a+1],c._translation.data[2]=this._translations[a+2],c._scale.data[0]=this._scales[a+0],c._scale.data[1]=
this._scales[a+1],c._scale.data[2]=this._scales[a+2]):(c._rotation.data[0]=this._rotations[g+0],c._rotation.data[1]=this._rotations[g+1],c._rotation.data[2]=this._rotations[g+2],c._rotation.data[3]=this._rotations[g+3],this.tmpQuat.data[0]=this._rotations[i+0],this.tmpQuat.data[1]=this._rotations[i+1],this.tmpQuat.data[2]=this._rotations[i+2],this.tmpQuat.data[3]=this._rotations[i+3],c._rotation.equals(this.tmpQuat)||(b.slerp(c._rotation,this.tmpQuat,d,this.tmpQuat2),c._rotation.setv(this.tmpQuat2)),
c._translation.data[0]=(1-d)*this._translations[k+0]+d*this._translations[a+0],c._translation.data[1]=(1-d)*this._translations[k+1]+d*this._translations[a+1],c._translation.data[2]=(1-d)*this._translations[k+2]+d*this._translations[a+2],c._scale.data[0]=(1-d)*this._scales[k+0]+d*this._scales[a+0],c._scale.data[1]=(1-d)*this._scales[k+1]+d*this._scales[a+1],c._scale.data[2]=(1-d)*this._scales[k+2]+d*this._scales[a+2])};d.prototype.getData=function(a,b){var d=b?b:new c;d.setRotation(this._rotations[a]);
d.setScale(this._scales[a]);d.setTranslation(this._translations[a]);return d};return d});
define("goo/animation/clip/JointData",["goo/animation/clip/TransformData"],function(g){function c(b){g.call(this,b);this._jointIndex=b?b._jointIndex:0}c.prototype=Object.create(g.prototype);c.prototype.constructor=c;c.prototype.set=function(b){g.prototype.set.call(this,b);this._jointIndex=b._jointIndex};c.prototype.blend=function(b,a,d){if(d){if(d instanceof c)d._jointIndex=this._jointIndex}else d=new c,d._jointIndex=this._jointIndex;return g.prototype.blend.call(this,b,a,d)};return c});
define("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel","goo/animation/clip/JointData"],function(g,c){function b(a,d,e,f,c,h,k){g.call(this,b.JOINT_CHANNEL_NAME+d,e,f,c,h,k);this._jointName=a;this._jointIndex=d}b.prototype=Object.create(g.prototype);b.JOINT_CHANNEL_NAME="_jnt";b.prototype.createStateDataObject=function(){return new c};b.prototype.setCurrentSample=function(a,b,e){g.prototype.setCurrentSample.call(this,a,b,e);e._jointIndex=this._jointIndex};b.prototype.getData=
function(a,b){var e=b?b:new c;g.prototype.getData.call(this,a,e);e._jointIndex=this._jointIndex;return e};return b});
define("goo/animation/blendtree/ExclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(g,c){function b(a){c.call(this,a);this._disabledChannels={}}b.prototype=Object.create(c.prototype);b.prototype.clearDisabled=function(){this._disabledChannels={}};b.prototype.addDisabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._disabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._disabledChannels[arguments[a]]=
!0};b.prototype.addDisabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var b=g.JOINT_CHANNEL_NAME+arguments[0][a];this._disabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=g.JOINT_CHANNEL_NAME+arguments[a],this._disabledChannels[b]=!0};b.prototype.getSourceData=function(){var a=c.prototype.getSourceData.call(this),b={},e;for(e in a)this._disabledChannels[e]||(b[e]=a[e]);return b};return b});
define("goo/animation/blendtree/FrozenClipSource",[],function(){function g(c,b){this._source=c;this._time=b}g.prototype.getSourceData=function(){return this._source.getSourceData()};g.prototype.resetClips=function(){this._source.resetClips(0)};g.prototype.setTime=function(){this._source.setTime(this._time);return!0};g.prototype.isActive=function(){return!0};g.prototype.setTimeScale=function(){};return g});
define("goo/animation/blendtree/InclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(g,c){function b(a){c.call(this,a);this._enabledChannels={}}b.prototype=Object.create(c.prototype);b.prototype.clearEnabled=function(){this._enabledChannels={}};b.prototype.addEnabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._enabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._enabledChannels[arguments[a]]=
!0};b.prototype.addEnabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var b=g.JOINT_CHANNEL_NAME+arguments[0][a];this._enabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=g.JOINT_CHANNEL_NAME+arguments[a],this._enabledChannels[b]=!0};b.prototype.getSourceData=function(){var a=c.prototype.getSourceData.call(this),b={},e;for(e in this._enabledChannels)this._enabledChannels[e]&&(b[e]=a[e]);return b};return b});
define("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData","goo/animation/clip/JointChannel","goo/animation/clip/JointData"],function(g,c,b,a){function d(a){this._sourceName=a?a:null;this._data={}}d.prototype.setTranslation=function(b,d){var c=this._data[b];c instanceof a&&c._translation.setv(d)};d.prototype.setScale=function(b,d){var c=this._data[b];c instanceof a&&c._scale.setv(d)};d.prototype.setRotation=function(b,d){var c=this._data[b];
c instanceof a&&c._rotation.set(d)};d.prototype.initFromClip=function(a,b){if(b)for(var d=0,c=b.length;d<c;d++){var g=b[d],i=a.findChannelByName(g),i=i.getData(0);this._data[g]=i}else{d=0;for(c=a._channels.length;d<c;d++)i=a._channels[d],g=i._channelName,i=i.getData(0),this._data[g]=i}};d.prototype.resetClips=function(){};d.prototype.setTimeScale=function(){};d.prototype.setTime=function(){return!0};d.prototype.isActive=function(){return!0};d.prototype.getChannelData=function(a){return this._data[a]};
d.prototype.getSourceData=function(){return this._data};return d});
define("goo/animation/clip/AnimationClip",[],function(){function g(c,b){this._name=c;this._channels=b||[];this._maxTime=-1;this.updateMaxTimeIndex()}g.prototype.update=function(c,b){for(var a=0,d=this._channels.length;a<d;++a){var e=this._channels[a],f=b.getApplyTo(e);e.updateSample(c,f)}};g.prototype.addChannel=function(c){this._channels.push(c);this.updateMaxTimeIndex()};g.prototype.removeChannel=function(c){c=this._channels.indexOf(c);return c>=0?(this._channels.splice(c,1),this.updateMaxTimeIndex(),
!0):!1};g.prototype.findChannelByName=function(c){for(var b=0,a=this._channels.length;b<a;++b){var d=this._channels[b];if(c===d._channelName)return d}return null};g.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;for(var c,b=0;b<this._channels.length;b++)if(c=this._channels[b].getMaxTime(),c>this._maxTime)this._maxTime=c};g.prototype.toString=function(){return this._name+this._channels.length};return g});
define("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(g,c){function b(a,b,e,f){g.call(this,a,b,f);this._values=e?e.slice(0):null}b.prototype=Object.create(g.prototype);b.prototype.createStateDataObject=function(){return[0]};b.prototype.setCurrentSample=function(a,b,e){e[0]=c.lerp(b,this._values[a],this._values[a+1])};b.prototype.getData=function(a,b){var e=b||[];e[0]=this._values[a];return e};return b});
define("goo/animation/clip/TriggerData",[],function(){function g(){this._currentTriggers=[];this._currentIndex=-1;this.armed=!1}g.prototype.arm=function(c,b){if(b===null||b.length===0)this._currentTriggers.length=0,this.armed=!1;else if(c!==this._currentIndex){for(var a=this._currentTriggers.length=0,d=b.length;a<d;a++)b[a]&&b[a]!==""&&this._currentTriggers.push(b[a]);this.armed=!0}this._currentIndex=c};return g});
define("goo/animation/clip/TriggerChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData"],function(g,c){function b(a,b,e,f){g.call(this,a,b,f);this._keys=e?e.slice(0):null;this.guarantee=!1}b.prototype=Object.create(g.prototype);b.prototype.createStateDataObject=function(){return new c};b.prototype.setCurrentSample=function(a,b,e){var f=e._currentIndex,a=b!==1?a:a+1;if(f===a||!this.guarantee)e.arm(a,[this._keys[a]]);else{b=[];if(f>a){for(f+=1;f<this._keys.length;f++)b.push(this._keys[f]);
f=-1}for(f+=1;f<=a;f++)b.push(this._keys[f]);e.arm(a,b)}};return b});define("goo/animation/state/AbstractState",[],function(){function g(){this._globalStartTime=0}g.prototype.update=function(){};g.prototype.postUpdate=function(){};g.prototype.getCurrentSourceData=function(){};g.prototype.resetClips=function(c){this._globalStartTime=c};return g});
define("goo/animation/state/SteadyState",["goo/animation/state/AbstractState"],function(g){function c(b){g.call(this);this._name=b;this._transitions={};this._sourceTree=null}c.prototype=Object.create(g.prototype);c.prototype.update=function(b){if(!this._sourceTree.setTime(b)&&this.onFinished)this.onFinished()};c.prototype.getCurrentSourceData=function(){return this._sourceTree.getSourceData()};c.prototype.resetClips=function(b){g.prototype.resetClips.call(this,b);this._sourceTree.resetClips(b)};c.prototype.setTimeScale=
function(b){this._sourceTree.setTimeScale(b)};return c});
define("goo/animation/layer/AnimationLayer",["goo/animation/state/SteadyState","goo/entities/World"],function(g,c){function b(a){this._name=a;this._steadyStates={};this._layerBlender=this._currentState=null;this._transitions={};this._transitionStates={}}b.BASE_LAYER_NAME="-BASE_LAYER-";b.prototype.getStates=function(){return Object.keys(this._steadyStates)};b.prototype.getTransitions=function(){var a;a=this._currentState?Object.keys(this._currentState._transitions):[];if(this._transitions)for(var b in this._transitions)a.indexOf(b)===
-1&&a.push(b);a.sort();return a};b.prototype.update=function(a){this._currentState&&this._currentState.update(a||c.time)};b.prototype.postUpdate=function(){this._currentState&&this._currentState.postUpdate()};b.prototype.transitionTo=function(a,b){var b=b||c.time,e=this._currentState,f;e&&e._transitions&&(f=e._transitions[a]||e._transitions["*"]);!f&&this._transitions&&(f=this._transitions[a]||this._transitions["*"]);if(e instanceof g&&f){var j=this._transitionStates[f.type];this._doTransition(j,
e,this._steadyStates[a],f,b);return!0}else if(!e&&(f=this._transitions[a]))if(j=this._transitionStates[f.type])return this._doTransition(j,null,this._steadyStates[a],f,b),!0;return!1};b.prototype._doTransition=function(a,b,e,f,c){if(b){a._sourceState=b;if(!a.isValid(f.timeWindow||[-1,-1],c)){console.warn("State not in allowed time window");return}b.onFinished=null}a._targetState=e;a.readFromConfig(f);a.resetClips(c);this.setCurrentState(a)};b.prototype.setCurrentState=function(a,b,e){e=e||c.time;
if(this._currentState=a)b&&a.resetClips(e),a.onFinished=function(){this.setCurrentState(a._targetState||null);this.update()}.bind(this)};b.prototype.getCurrentState=function(){return this._currentState};b.prototype.setCurrentStateByName=function(a,b,e){if(a){var f=this._steadyStates[a];if(f)return this.setCurrentState(f,b,e),!0;else console.warn("unable to find SteadyState named: "+a)}return!1};b.prototype.getCurrentSourceData=function(){return this._layerBlender!==null?this._layerBlender.getBlendedSourceData():
this._currentState!==null?this._currentState.getCurrentSourceData():null};b.prototype.updateLayerBlending=function(a){if(this._layerBlender)this._layerBlender._layerA=a,this._layerBlender._layerB=this};b.prototype.clearCurrentState=function(){this.setCurrentState(null)};b.prototype.resetClips=function(a){this._currentState&&this._currentState.resetClips(a||c.time)};b.prototype.setTimeScale=function(a){this._currentState&&this._currentState.setTimeScale(a)};return b});
define("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(g){function c(){this._layerB=this._layerA=this._blendWeight=null}c.prototype.getBlendedSourceData=function(){var b=this._layerA.getCurrentSourceData(),a=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData():null;return g.combineSourceData(b,a,this._blendWeight)};return c});
define("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractState","goo/animation/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(g,c,b){function a(){g.call(this);this._targetState=this._sourceState=null;this._percent=0;this._onFinished=this._sourceData=null;this._fadeTime=0;this._blendType="Linear"}a.prototype=Object.create(g.prototype);a.prototype.update=function(a){a-=this._globalStartTime;if(a>this._fadeTime&&this.onFinished)this.onFinished();else switch(a/=this._fadeTime,
this._blendType){case "SCurve3":this._percent=b.scurve3(a);break;case "SCurve5":this._percent=b.scurve5(a);break;default:this._percent=a}};a.prototype.readFromConfig=function(a){if(a){if(a.fadeTime!==void 0)this._fadeTime=a.fadeTime;if(a.blendType!==void 0)this._blendType=a.blendType}};a.prototype.getCurrentSourceData=function(){var a=this._sourceState?this._sourceState.getCurrentSourceData():null,b=this._targetState?this._targetState.getCurrentSourceData():null;if(!this._sourceData)this._sourceData=
{};return c.combineSourceData(a,b,this._percent,this._sourceData)};a.prototype.isValid=function(a,b){var f=b-this._sourceState._globalStartTime,c=a[0],g=a[1];return c<=0?g<=0?!0:f<=g:g<=0?f>=c:c<=g?c<=f&&f<=g:f>=c||f<=g};a.prototype.resetClips=function(a){g.prototype.resetClips.call(this,a);this._sourceData={};this._percent=0};a.prototype.setTimeScale=function(a){this._sourceState&&this._sourceState.setTimeScale(a);this._targetState&&this._targetState.setTimeScale(a)};return a});
define("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTransitionState"],function(g){function c(){g.call(this)}c.prototype=Object.create(g.prototype);c.prototype.update=function(b){g.prototype.update.call(this,b);this._sourceState!==null&&this._sourceState.update(b);this._targetState!==null&&this._targetState.update(b)};c.prototype.postUpdate=function(){this._sourceState!==null&&this._sourceState.postUpdate();this._targetState!==null&&this._targetState.postUpdate()};c.prototype.resetClips=
function(b){g.prototype.resetClips.call(this,b);this._targetState!==null&&this._targetState.resetClips(b)};return c});
define("goo/animation/state/FrozenTransitionState",["goo/animation/state/AbstractTransitionState"],function(g){function c(){g.call(this)}c.prototype=Object.create(g.prototype);c.prototype.update=function(b){g.prototype.update.call(this,b);this._targetState!==null&&this._targetState.update(b)};c.prototype.postUpdate=function(){this._targetState!==null&&this._targetState.postUpdate()};c.prototype.resetClips=function(b){g.prototype.resetClips.call(this,b);this._targetState.resetClips(b)};return c});
define("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(g){function c(){g.call(this)}c.prototype=Object.create(g.prototype);c.prototype.resetClips=function(b){g.prototype.resetClips.call(this,b);this._targetState.resetClips(this._sourceState._globalStartTime)};return c});
define("goo/entities/systems/PickingSystem",["goo/entities/systems/System"],function(g){function c(b){g.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]);this.passive=!0;this.onPick=this.pickRay=null;b=b||{};this.setPickLogic(b.pickLogic||null)}c.prototype=Object.create(g.prototype);c.prototype.setPickLogic=function(b){(this.pickLogic=b)&&this.interests.indexOf("MeshDataComponent")===-1&&this.interests.push("MeshDataComponent")};c.prototype.inserted=function(b){b.meshRendererComponent.isPickable&&
this.pickLogic&&this.pickLogic.added(b)};c.prototype.deleted=function(b){this.pickLogic&&this.pickLogic.removed(b)};c.prototype.process=function(b){if(this.pickRay&&this.onPick){for(var a=[],d=0;d<b.length;d++){var e=b[d],f=e.meshRendererComponent;f.isPickable&&(this.pickLogic?(this.pickLogic.isConstructed(e)||this.pickLogic.added(e),(f=this.pickLogic.getPickResult(this.pickRay,e))&&f.distances&&f.distances.length&&a.push({entity:e,intersection:f})):f.worldBound&&(f=f.worldBound.intersectsRayWhere(this.pickRay))&&
f.distances.length&&a.push({entity:e,intersection:f}))}a.sort(function(a,b){return a.intersection.distances[0]-b.intersection.distances[0]});this.onPick(a)}};return c});
define("goo/picking/BoundingTree",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Vector3"],function(g,c,b){function a(b){this.worldBound=this.localBound=this.rightTree=this.leftTree=null;this.boundType=b?b:a.BOUNDTYPE_BOX}a.BOUNDTYPE_SPHERE="sphere";a.BOUNDTYPE_BOX="box";a.MAX_PRIMITIVES_PER_LEAF=16;a.prototype.construct=function(a){if(!a.meshRendererComponent||!a.meshDataComponent||!a.transformComponent)console.warn("Entity missing required components for boundingtree construction: ",
a);else{var b=a.meshDataComponent.meshData;b.updatePrimitiveCounts();if(b.getSectionCount()===1){this.primitiveIndices=[];for(var f=0,b=b.getPrimitiveCount(0);f<b;f++)this.primitiveIndices.push(f);this.createTree(a,0,0,this.primitiveIndices.length)}else this.split(a,0,b.getSectionCount())}};a.prototype.createTree=function(b,e,f,c){var g=b.meshDataComponent.meshData;this.section=e;this.start=f;this.end=c;if(this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(g,e,this.primitiveIndices,
f,c),!(c-f+1<=a.MAX_PRIMITIVES_PER_LEAF))){if(!this.leftTree)this.leftTree=new a(this.boundType);this.leftTree.primitiveIndices=this.primitiveIndices;this.leftTree.createTree(b,e,f,Math.floor((f+c)/2));if(!this.rightTree)this.rightTree=new a(this.boundType);this.rightTree.primitiveIndices=this.primitiveIndices;this.rightTree.createTree(b,e,Math.floor((f+c)/2),c)}};a.prototype.split=function(b,e,f){var c=f-e,g=Math.floor(c/2);if(g===1){var k=e;this.leftTree=new a(this.boundType);this.leftTree.primitiveIndices=
[];for(var i=0;i<this.leftTree.primitiveIndices.length;i++)this.leftTree.primitiveIndices.push(i);this.leftTree.createTree(b,k,0,this.leftTree.primitiveIndices.length)}else this.leftTree=new a(this.boundType),this.leftTree.split(b,e,e+g);if(c-g===1){k=e+1;this.rightTree=new a(this.boundType);this.rightTree._primitiveIndices=[];for(i=0;i<this.rightTree.primitiveIndices.length;i++)this.rightTree.primitiveIndices.push(i);this.rightTree.createTree(b,k,0,this.rightTree.primitiveIndices.length)}else this.rightTree=
new a(this.boundType),this.rightTree.split(b,e+g,f);this.localBound=this.leftTree.localBound.clone(this.localBound);this.localBound.merge(this.rightTree.localBound);this.worldBound=this.localBound.clone(this.worldBound)};a.prototype.createBounds=function(){switch(this.boundType){case a.BOUNDTYPE_BOX:this.localBound=new g;this.worldBound=new g;break;case a.BOUNDTYPE_SPHERE:this.localBound=new c,this.worldBound=new c}};a.prototype.findPick=function(a,e,f){f||(f={});var c=e.transformComponent.worldTransform;
this.localBound.transform(c,this.worldBound);if(!this.worldBound.intersectsRay(a))return f;this.leftTree&&this.leftTree.findPick(a,e,f);if(this.rightTree)this.rightTree.findPick(a,e,f);else if(!this.leftTree)for(var e=e.meshDataComponent.meshData,g=null,k=this.start;k<this.end;k++){for(var g=e.getPrimitiveVertices(this.primitiveIndices[k],this.section,g),i=0;i<g.length;i++)c.matrix.applyPostPoint(g[i]);i=new b;if(a.intersects(g,!1,i))f.distances=f.distances||[],f.distances.push(a.origin.distance(i)),
f.points=f.points||[],f.points.push(i)}return f};return a});
define("goo/picking/PrimitivePickLogic",["goo/picking/BoundingTree"],function(g){function c(){}c.prototype.getPickResult=function(b,a){var d=a.meshDataComponent.meshData.__boundingTree;return!d?null:d.findPick(b,a,{})};c.prototype.added=function(b){this.isConstructed(b)||this.rebuild(b)};c.prototype.removed=function(b){b.meshDataComponent.meshData.__boundingTree=null};c.prototype.isConstructed=function(b){return!!b.meshDataComponent.meshData.__boundingTree};c.prototype.rebuild=function(b){b.meshDataComponent.meshData.__boundingTree=
new g;b.meshDataComponent.meshData.__boundingTree.construct(b)};return c});define("goo/debug/components/MarkerComponent",["goo/entities/components/Component","goo/shapes/ShapeCreator"],function(g,c){function b(a){this.type="MarkerComponent";a=a.meshDataComponent.modelBound;this.meshData=c.createBox(a.radius*2,a.radius*2,a.radius*2)}b.prototype=Object.create(g.prototype);return b});
define("goo/debug/systems/MarkerSystem","goo/entities/systems/System,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/shapes/ShapeCreator,goo/debug/components/MarkerComponent,goo/renderer/Renderer".split(","),function(g,c,b,a,d,e){function f(a){g.call(this,"MarkerSystem",["MarkerComponent"]);this.material=c.createMaterial(b.simpleColored,"");this.material.depthState.enabled=!1;this.material.shader.uniforms.color=[0,1,0];this.material.wireframe=!0;this.goo=a;this.renderer=this.goo.renderer;
this.entities=[];this.goo.callbacks.push(function(){for(var a=0;a<this.entities.length;a++){var b=this.entities[a];b.hasComponent("MarkerComponent")&&this.goo.renderer.render({meshData:b.markerComponent.meshData,materials:[this.material],transform:b.transformComponent.transform},e.mainCamera,[],null,!1)}}.bind(this))}f.prototype=Object.create(g.prototype);f.prototype.process=function(a){this.entities=a};return f});
define("goo/debug/Debugger","goo/entities/Entity,goo/entities/managers/EntityManager,goo/entities/components/TransformComponent,goo/math/Ray,goo/entities/systems/PickingSystem,goo/picking/PrimitivePickLogic,goo/renderer/Renderer,goo/debug/components/MarkerComponent,goo/debug/systems/MarkerSystem".split(","),function(g,c,b,a,d,e,f,j,h){function k(a){this.goo=null;this.exportPicked=a||!1;this.oldPicked=this.picked=null}function i(){var a=document.createElement("div");a.id="debugdiv";var b='<span style="font-size: x-small;font-family: sans-serif">Filter</span><br /><textarea cols="30" id="debugparams">name, Compo, tran, data</textarea><br /><span style="font-size: x-small;font-family: sans-serif">Result</span><br /><textarea readonly rows="10" cols="30" id="debugtex">Click on an entity</textarea><br />';
b+='<hr /><span style="font-size: x-small;font-family: sans-serif">REPL</span><br /><textarea readonly rows="10" cols="30" id="replouttex">...</textarea><br /><textarea cols="30" id="replintex">entity.</textarea>';a.innerHTML=b;a.style.position="absolute";a.style.zIndex="2001";a.style.backgroundColor="#DDDDDD";a.style.left="10px";a.style.top="100px";a.style.webkitTouchCallout="none";a.style.webkitUserSelect="none";a.style.khtmlUserSelect="none";a.style.mozUserSelect="none";a.style.msUserSelect="none";
a.style.userSelect="none";a.style.padding="3px";a.style.borderRadius="6px";document.body.appendChild(a)}function l(a){return a.split(",").map(function(a){return a.replace(/(^[\s]+|[\s]+$)/g,"")}).filter(function(a){return a.length>0}).map(function(a){return RegExp(a)})}function m(a,b,d,e){if(b.length===0)return"No interests specified;\n\nSome popular interests: is, tran, Compo\n\nEvery entry separated by a comma is a regex";if(e<0)return d+"REACHED MAXIMUM DEPH\n";if(a===null)return d+"null\n";var f=
typeof a;if(f==="undefined"||f==="number"||f==="boolean"||f==="string"||a instanceof Array&&(typeof a[0]==="string"||typeof a[0]==="number"||typeof a[0]==="boolean"))return d+JSON.stringify(a)+"\n";if(Object.prototype.toString.call(a).indexOf("Array]")!==-1){if(a.length===0)a="[]";else{b="["+a[0];for(e=1;e<a.length;e++)b+=" "+a[e];b+="]";a=b}return d+a+"\n"}else{var f=[],c;for(c in a)if(a.hasOwnProperty(c)&&typeof a[c]!=="function")for(var g in b)if(b[g].test(c)){var h=m(a[c],b,d+" ",e-1);f.push(d+
c+"\n"+h);break}return f.join("")}}function o(a){var b=l(document.getElementById("debugparams").value);a&&console.log("==> ",a);a=m(a,b,"",20);document.getElementById("debugtex").value=a}k.prototype._setUpREPL=function(){var a="";document.getElementById("replintex").addEventListener("keyup",function(b){b.stopPropagation();var d=document.getElementById("replintex"),e=document.getElementById("replouttex");if(b.keyCode===13&&!b.shiftKey){a=b=d.value.substr(0,d.value.length-1);var f="";try{f+=eval(b)}catch(c){f+=
c}d.value="entity.";e.value+="\n-------\n"+f;o(this.picked)}else if(b.keyCode===38)d.value=a}.bind(this),!1)};k.prototype._setUpPicking=function(){document.addEventListener("mouseup",function(a){a.stopPropagation();this.goo.renderSystem.pick(a.pageX,a.pageY,function(a){if(a=this.goo.world.entityManager.getEntityById(a)){this.oldPicked=this.picked;this.picked=a;if(this.picked===this.oldPicked)this.picked=null;if(this.exportPicked)window.picked=this.picked;o(this.picked);var a=this.picked,b=this.oldPicked;
a!==b?(b!==null&&b.hasComponent("MarkerComponent")&&b.clearComponent("MarkerComponent"),a!==null&&a.setComponent(new j(a))):a.hasComponent("MarkerComponent")?a.clearComponent("MarkerComponent"):a.setComponent(new j(a))}}.bind(this))}.bind(this),!1)};k.prototype.inject=function(a){this.goo=a;i();this.goo.world.getSystem("MarkerSystem")||this.goo.world.setSystem(new h(this.goo));this._setUpPicking();document.getElementById("debugparams").addEventListener("keyup",function(){o(this.picked)}.bind(this));
this._setUpREPL();return this};return k});
define("goo/debug/EntityCounter",[],function(){function g(b){this.goo=null;this.skipFrames=b||20;this.texHandle=null}function c(){var b=document.createElement("div");b.id="_entitycounterdiv";b.innerHTML='<span style="font-size: x-small;font-family: sans-serif">Counter</span><br /><textarea cols="30" rows="6" id="_entitycountertex">...</textarea>';b.style.position="absolute";b.style.zIndex="2001";b.style.backgroundColor="#BBBBBB";b.style.left="10px";b.style.bottom="10px";b.style.webkitTouchCallout=
"none";b.style.webkitUserSelect="none";b.style.khtmlUserSelect="none";b.style.mozUserSelect="none";b.style.msUserSelect="none";b.style.userSelect="none";b.style.padding="3px";b.style.borderRadius="6px";document.body.appendChild(b);return document.getElementById("_entitycountertex")}g.prototype.inject=function(b){this.goo=b;this.texHandle=c();var a=this,d=0;this.goo.callbacks.push(function(){d--;if(d<=0){d=a.skipFrames;var b="",f;for(f in a.goo.world._systems){var c=a.goo.world._systems[f];b+=c.type+
": "+c._activeEntities.length+"\n"}a.texHandle.value=b}});return this};return g});define("goo/entities/components/CSSTransformComponent",["goo/entities/components/Component"],function(g){function c(b,a){g.call(this);this.type="CSSTransformComponent";this.domElement=b;this.scale=1;this.faceCamera=typeof a==="undefined"?!1:a}c.prototype=Object.create(g.prototype);return c});
define("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CSSTransformComponent"],function(g,c,b,a){function d(){}function e(a,d,h){for(var k=a.createEntity(d.name),i=0;i<d._components.length;i++){var l=d._components[i];if(l instanceof g)k.transformComponent.transform.copy(l.transform);else if(l instanceof c){var m=new c(l.meshData);m.modelBound=new l.modelBound.constructor;
if(l.currentPose)m.currentPose=l.currentPose;k.setComponent(m)}else if(l instanceof b){for(var o=new b,m=0;m<l.materials.length;m++)o.materials.push(l.materials[m]);k.setComponent(o)}else k.setComponent(l)}for(m=0;m<d.transformComponent.children.length;m++)i=e(a,d.transformComponent.children[m].entity,h),k.transformComponent.attachChild(i.transformComponent);h.callback&&h.callback(k);return k}d.clone=function(a,b,d){d=d||{};d.shareData=d.shareData||!0;d.shareMaterial=d.shareMaterial||!0;d.cloneHierarchy=
d.cloneHierarchy||!0;return e(a,b,d)};d.traverse=function(a,b,e){e=e!==void 0?e:0;b(a,e);for(var c=0;c<a.transformComponent.children.length;c++)d.traverse(a.transformComponent.children[c].entity,b,e+1)};d.updateWorldTransform=function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)d.updateWorldTransform(a.children[b])};d.createTypicalEntity=function(a,d,e,g){a=a.createEntity(g);d=new c(d);a.setComponent(d);d=new b;a.setComponent(d);e&&d.materials.push(e);return a};d.createDOMEntity=
function(b,d){var e=b.createEntity();e.setComponent(new a(d));return e};return d});
define("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(g){function c(){g.call(this,"TransformSystem",["TransformComponent"])}c.prototype=Object.create(g.prototype);c.prototype.removed=function(b){b=b.transformComponent;b.parent&&b.parent.detachChild(b);for(var a=b.children,d=0;d<a.length;d++)a[d].parent=null;b.parent=null;b.children=[]};c.prototype.process=function(b){var a,d;for(a=0;a<b.length;a++)d=b[a].transformComponent,d._updated=!1,d._dirty&&d.updateTransform();
for(a=0;a<b.length;a++)d=b[a].transformComponent,d._dirty&&this.updateWorldTransform(d)};c.prototype.updateWorldTransform=function(b){b.updateWorldTransform();for(var a=0;a<b.children.length;a++)this.updateWorldTransform(b.children[a])};return c});
define("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(g){function c(){}c.prototype.added=function(){};c.prototype.removed=function(){};c.prototype.process=function(b,a,d){for(var e=0,f=0;f<a.length;f++){var c=a[f];if(!c.skip)c.meshRendererComponent.cullMode==="Never"?(d[e++]=c,c.isVisible=!0):b.contains(c.meshRendererComponent.worldBound)!==g.Outside?(d[e++]=c,c.isVisible=!0):c.isVisible=!1}d.length=e};return c});
define("goo/entities/systems/RenderSystem","goo/entities/systems/System,goo/entities/EventHandler,goo/renderer/SimplePartitioner,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/renderer/Util".split(","),function(g,c,b,a,d,e){function f(){g.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]);this.entities=[];this.renderList=[];this.partitioner=new b;this.preRenderers=[];this.composers=[];this.doRender=!0;this._debugMaterials={};this.overrideMaterials=[];this.camera=null;
this.lights=[];this.currentTpf=0;var a=this;c.addListener({setCurrentCamera:function(b){a.camera=b},setLights:function(b){a.lights=b}});this.picking={doPick:!1,x:0,y:0,pickingStore:{},pickingCallback:function(a,b){console.log(a,b)},skipUpdateBuffer:!1}}f.prototype=Object.create(g.prototype);f.prototype.pick=function(a,b,d,e){this.picking.x=a;this.picking.y=b;this.picking.skipUpdateBuffer=e===void 0?!1:e;if(d)this.picking.pickingCallback=d;this.picking.doPick=!0};f.prototype.inserted=function(a){this.partitioner&&
this.partitioner.added(a)};f.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)};f.prototype.process=function(a,b){this.entities=a;this.currentTpf=b};f.prototype.render=function(a){a.checkResize(this.camera);if(this.doRender&&this.camera){a.updateShadows(this.partitioner,this.entities,this.lights);for(var b=0;b<this.preRenderers.length;b++)this.preRenderers[b].process(a,this.entities,this.partitioner,this.camera,this.lights);this.partitioner.process(this.camera,this.entities,
this.renderList);if(this.picking.doPick)a.pick(this.renderList,this.camera,this.picking.x,this.picking.y,this.picking.pickingStore,this.picking.skipUpdateBuffer),this.picking.pickingCallback(this.picking.pickingStore.id,this.picking.pickingStore.depth),this.picking.doPick=!1;if(this.composers.length>0)for(b=0;b<this.composers.length;b++)this.composers[b].render(a,this.currentTpf,this.camera,this.lights,null,!0,this.overrideMaterials);else a.render(this.renderList,this.camera,this.lights,null,!0,this.overrideMaterials)}};
f.prototype._createDebugMaterial=function(b){if(b!==""){var c;switch(b){case "wireframe":case "color":c=e.clone(d.simpleColored.fshader);break;case "lit":c=e.clone(d.simpleLit.fshader);break;case "texture":c=e.clone(d.textured.fshader);break;case "normals":c=e.clone(d.showNormals.fshader);break;case "simple":c=e.clone(d.simple.fshader)}var f=e.clone(d.uber);f.fshader=c;if(b!=="flat"){if(this._debugMaterials[b]=a.createMaterial(f,b),b==="wireframe")this._debugMaterials[b].wireframe=!0}else this._debugMaterials[b]=
a.createEmptyMaterial(null,b),this._debugMaterials[b].flat=!0}};f.prototype.setDebugMaterial=function(a){if(!a||a==="")this.overrideMaterials=[];else{var b=a.split("+");this.overrideMaterials=[];for(var d=0;d<b.length;d++)a=b[d],this._debugMaterials[a]||this._createDebugMaterial(a),a===""?this.overrideMaterials.push(null):this.overrideMaterials.push(this._debugMaterials[a])}};return f});
define("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System"],function(g){function c(){g.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"])}c.prototype=Object.create(g.prototype);c.prototype.process=function(b){for(var a=0;a<b.length;a++){var d=b[a],e=d.meshDataComponent,c=d.transformComponent,d=d.meshRendererComponent;e.autoCompute?(e.computeBoundFromPoints(),d.updateBounds(e.modelBound,c.worldTransform)):c._updated&&d.updateBounds(e.modelBound,
c.worldTransform)}};return c});define("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(g){function c(){g.call(this,"ScriptSystem",["ScriptComponent"])}c.prototype=Object.create(g.prototype);c.prototype.process=function(b,a){for(var d=0;d<b.length;d++)b[d].scriptComponent.run(b[d],a)};return c});
define("goo/entities/systems/LightingSystem",["goo/entities/systems/System","goo/entities/EventHandler"],function(g,c){function b(){g.call(this,"LightingSystem",["LightComponent","TransformComponent"]);this.lights=[]}b.prototype=Object.create(g.prototype);b.prototype.addedComponent=function(a,b){b.type==="LightComponent"&&this.lights.indexOf(b.light)===-1&&(this.lights.push(b.light),c.dispatch("setLights",this.lights))};b.prototype.removedComponent=function(a,b){if(b.type==="LightComponent"){var e=
this.lights.indexOf(b.light);e!==-1&&(this.lights.splice(e,1),c.dispatch("setLights",this.lights))}};b.prototype.process=function(a){for(var b=0;b<a.length;b++){var e=a[b],c=e.transformComponent,e=e.lightComponent;c._updated&&e.updateLight(c.worldTransform)}};return b});
define("goo/entities/managers/LightManager",["goo/entities/EventHandler"],function(g){function c(){this.type="LightManager";this.lights=[]}c.prototype.addedComponent=function(b,a){a.type==="LightComponent"&&this.lights.indexOf(a.light)===-1&&(this.lights.push(a.light),g.dispatch("setLights",this.lights))};c.prototype.removedComponent=function(b,a){if(a.type==="LightComponent"){var d=this.lights.indexOf(a.light);d!==-1&&(this.lights.splice(d,1),g.dispatch("setLights",this.lights))}};return c});
define("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/EventHandler","goo/renderer/Renderer"],function(g,c,b){function a(){g.call(this,"CameraSystem",["TransformComponent","CameraComponent"]);this.mainCamera=null}a.prototype=Object.create(g.prototype);a.prototype.findMainCamera=function(){for(var a=null,e=0;e<this._activeEntities.length;e++){var f=this._activeEntities[e].cameraComponent;if(!a||f.isMain)a=f.camera}c.dispatch("setCurrentCamera",a);b.mainCamera=a};a.prototype.inserted=
function(){this.findMainCamera()};a.prototype.deleted=function(){this.findMainCamera()};a.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],g=c.transformComponent,c=c.cameraComponent;g._updated&&c.updateCamera(g.worldTransform)}};return a});
define("goo/entities/systems/ParticlesSystem",["goo/entities/systems/System"],function(g){function c(){g.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]);this.passive=!1}c.prototype=Object.create(g.prototype);c.prototype.process=function(b,a){if(!(a>1))for(var d=0,e=b.length;d<e;d++){var c=b[d],g=c.particleComponent;if(g.enabled)try{this.updateParticles(c,g,a)}catch(h){console.log(h.stack)}}};c.prototype.updateParticles=function(b,
a,d){for(var e=0,c=-1,g,h=!1,k=!1;e<a.particleCount;){for(;g===void 0;)if(c++,a.emitters.length>c){g=a.emitters[c];if(g.influences.length)for(var i=0,l=g.influences.length;i<l;i++)g.influences[i].prepare(b,g);if(g.enabled){if(g.totalParticlesToSpawn!==0)g.particlesWaitingToRelease+=g.releaseRatePerSecond*d,g.particlesWaitingToRelease=Math.max(g.particlesWaitingToRelease,0),k=!0;g.particlesWaitingToRelease<1&&(g=void 0)}else g=void 0}else g=null;var m=a.particles[e];if(m.alive&&m.emitter&&m.emitter.influences.length){i=
0;for(l=m.emitter.influences.length;i<l;i++)m.emitter.influences[i].enabled&&m.emitter.influences[i].apply(d,m,e)}m.alive&&(m.update(d,b),k=h=!0);if(!m.alive&&g&&(g.particlesWaitingToRelease--,g.totalParticlesToSpawn>=1&&g.totalParticlesToSpawn--,m.respawnParticle(g),g.getEmissionPoint(m,b),g.getEmissionVelocity(m,b),g.particlesWaitingToRelease<1||g.totalParticlesToSpawn===0))g=void 0;e++}if(h)a.meshData.vertexData._dataNeedsRefresh=!0,b.meshDataComponent.autoCompute=!0;if(!k)a.enabled=!1};return c});
define("goo/util/Stats",[],function(){return function(){var g=Date.now(),c=g,b=g,a=0,d=Infinity,e=0,f=0,j=Infinity,h=0,k=0,i=0,l=document.createElement("div");l.id="stats";l.addEventListener("mousedown",function(a){a.preventDefault();y(++i%2)},!1);l.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var m=document.createElement("div");m.id="fps";m.style.cssText=
"padding:0 0 3px 3px;text-align:left;background-color:#002";l.appendChild(m);var o=document.createElement("div");o.id="fpsText";o.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";o.innerHTML="FPS";m.appendChild(o);var p=document.createElement("div");p.id="fpsGraph";p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(m.appendChild(p);p.children.length<74;){var n=document.createElement("span");n.style.cssText=
"width:1px;height:30px;float:left;background-color:#113";p.appendChild(n)}var r=document.createElement("div");r.id="ms";r.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";l.appendChild(r);var t=document.createElement("div");t.id="msText";t.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";t.innerHTML="MS";r.appendChild(t);var q=document.createElement("div");q.id="msGraph";q.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";
for(r.appendChild(q);q.children.length<74;)n=document.createElement("span"),n.style.cssText="width:1px;height:30px;float:left;background-color:#131",q.appendChild(n);n=document.createElement("div");n.id="info";n.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200";l.appendChild(n);var v=document.createElement("div");v.id="infoText";v.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";v.innerHTML="INFO";n.appendChild(v);
var y=function(a){i=a;switch(i){case 0:m.style.display="block";r.style.display="none";break;case 1:m.style.display="none",r.style.display="block"}};this.domElement=l;this.setMode=y;this.begin=function(){g=Date.now()};this.end=function(i){var l=Date.now();if(l>b+100){a=l-g;d=Math.min(d,a);e=Math.max(e,a);t.textContent=a+" MS ("+d+"-"+e+")";var n=Math.min(30,30-a/200*30);q.appendChild(q.firstChild).style.height=n+"px";b=l;if(i)v.innerHTML="Calls: "+i.calls+"<br>Vertices: "+i.vertices+"<br>Indices: "+
i.indices}k++;if(l>c+1E3)f=Math.round(k*1E3/(l-c)),j=Math.min(j,f),h=Math.max(h,f),o.textContent=f+" FPS ("+j+"-"+h+")",i=Math.min(30,30-f/(Math.min(500,h)+10)*30),p.appendChild(p.firstChild).style.height=i+"px",c=l,k=0;return l};this.update=function(a){g=this.end(a)}}});
define("goo/entities/systems/CSSTransformSystem",["goo/entities/systems/System","goo/renderer/Renderer","goo/math/Matrix4x4","goo/math/MathUtils","goo/math/Vector3"],function(g,c,b,a,d){function e(a){g.call(this,"CSSTransformSystem",["TransformComponent","CSSTransformComponent"]);this.renderer=a;this.viewDom=document.querySelector("#view");this.containerDom=document.querySelector("#cam1");this.containerDom2=document.querySelector("#cam2");this.tmpMatrix=new b;this.tmpMatrix2=new b;this.tmpVector=
new d}e.prototype=Object.create(g.prototype);var f=function(a){return Math.abs(a)<1.0E-6?0:a},j=["","-webkit-","-moz-","-ms-","-o-"],h=function(a,b,d){for(var e=0;e<j.length;e++)a.style[j[e]+b]=d},k=function(a){a=a.data;return"matrix3d("+f(a[0])+","+f(-a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(-a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+","+f(-a[9])+","+f(a[10])+","+f(a[11])+","+f(a[12])+","+f(-a[13])+","+f(a[14])+","+f(a[15])+")"};e.prototype.process=function(b){if(b.length!==0){var e=c.mainCamera,
f=0.5/Math.tan(a.DEG_TO_RAD*e.fov*0.5)*this.renderer.domElement.offsetHeight;h(this.viewDom,"perspective",f+"px");this.tmpMatrix.copy(e.getViewInverseMatrix());this.tmpMatrix2.copy(this.tmpMatrix);this.tmpMatrix.invert();this.tmpMatrix.setTranslation(new d(0,0,f));var g=k(this.tmpMatrix);h(this.containerDom,"transform",g);this.tmpMatrix2.e03=-this.tmpMatrix2.e03;this.tmpMatrix2.e23=-this.tmpMatrix2.e23;this.tmpMatrix2.setRotationFromVector(new d(0,0,0));g=k(this.tmpMatrix2);h(this.containerDom2,"transform",
g);for(f=0;f<b.length;f++){var g=b[f],j=g.getComponent("CSSTransformComponent"),n=j.domElement,r=j.scale,r=[r,-r,r].join(",");j.faceCamera?(g.transformComponent.worldTransform.matrix.getTranslation(this.tmpVector),this.tmpMatrix.copy(e.getViewInverseMatrix()),this.tmpMatrix.setTranslation(this.tmpVector)):this.tmpMatrix.copy(g.transformComponent.worldTransform.matrix);g="translate3d(-50%,-50%,0) "+k(this.tmpMatrix)+"scale3d("+r+")";h(n,"transform",g);n.parentNode!==this.containerDom2&&this.containerDom2.appendChild(n)}}};
return e});define("goo/entities/systems/AnimationSystem",["goo/entities/systems/System","goo/entities/World"],function(g,c){function b(){g.call(this,"AnimationSystem",["AnimationComponent"])}b.prototype=Object.create(g.prototype);b.prototype.process=function(a){for(var b=0;b<a.length;b++){var e=a[b],f=e.animationComponent;f.update(c.time);f.apply(e.transformComponent);f.postUpdate()}};return b});
define("goo/shapes/TextureGrid",["goo/renderer/MeshData"],function(g){function c(a,b){this.matrix=a;this.textureUnitsPerLine=b||8;for(var e=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]),c,j=c=0;j<a.length;j++)c+=a[j].length;g.call(this,e,c*4,c*6);this.rebuild()}function b(a){var b=[];a.split("\n").forEach(function(a){a=a.split("").map(function(a){return a.charCodeAt(0)});b.push(a)});return b}c.prototype=Object.create(g.prototype);c.prototype.rebuild=function(){for(var a=[],b=[],e=[],c=[],j=0,h=
0;h<this.matrix.length;h++)for(var k=0;k<this.matrix[h].length;k++){a.push(k,-h-1,0,k,-h,0,k+1,-h,0,k+1,-h-1,0);b.push(0,0,1,0,0,1,0,0,1,0,0,1);var i=this.matrix[h][k]%this.textureUnitsPerLine/this.textureUnitsPerLine,l=Math.floor(this.matrix[h][k]/this.textureUnitsPerLine)/this.textureUnitsPerLine,l=1-l;c.push(i,l-1/this.textureUnitsPerLine,i,l,i+1/this.textureUnitsPerLine,l,i+1/this.textureUnitsPerLine,l-1/this.textureUnitsPerLine);e.push(j+3,j+1,j+0,j+2,j+1,j+3);j+=4}this.getAttributeBuffer(g.POSITION).set(a);
this.getAttributeBuffer(g.NORMAL).set(b);this.getAttributeBuffer(g.TEXCOORD0).set(c);this.getIndexBuffer().set(e);return this};c.fromString=function(a){return new c(b(a),16)};return c});
define("goo/entities/systems/TextSystem",["goo/entities/systems/System","goo/shapes/TextureGrid","goo/entities/components/MeshDataComponent"],function(g,c,b){function a(){g.call(this,"TextSystem",["TextComponent"])}a.prototype=Object.create(g.prototype);a.prototype.process=function(a){for(var e=0;e<a.length;e++){var f=a[e],g=f.textComponent;if(g.dirty)f.hasComponent("MeshDataComponent")?f.getComponent("MeshDataComponent").meshData=c.fromString(g.text):(g=c.fromString(g.text),g=new b(g),f.setComponent(g)),
this.dirty=!1}};return a});
define("goo/util/MeshBuilder",["goo/renderer/MeshData","goo/math/Vector3","goo/entities/EntityUtils"],function(g,c,b){function a(){this.meshDatas=[];this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0;this.indexLengths=[];this.indexModes=[]}a.prototype.addEntity=function(a){b.traverse(a,function(){a.transformComponent._dirty&&a.transformComponent.updateTransform()});b.traverse(a,function(){a.transformComponent._dirty&&b.updateWorldTransform(a.transformComponent)});b.traverse(a,
function(){a.meshDataComponent&&this.addMeshData(a.meshDataComponent.meshData,a.transformComponent.worldTransform)})};var d=new c;a.prototype.addMeshData=function(a,b){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);else this.vertexCounter+a.vertexCount>=65536&&(console.log("Mesh size limit reached, creating new mesh"),this._generateMesh());var c=a.attributeMap,h;for(h in c){var k=c[h],i=this.vertexData[h];if(!i)this.vertexData[h]=
{},i=this.vertexData[h],i.array=[],i.map={count:k.count,type:k.type,stride:k.stride,offset:k.offset,normalized:k.normalized};var l=a.getAttributeBuffer(h),m=l.length,o=i.array;if(h===g.POSITION)for(i=0;i<m;i+=3)d.setd(l[i+0],l[i+1],l[i+2]),b.matrix.applyPostPoint(d),o[this.vertexCounter*k.count+i+0]=d[0],o[this.vertexCounter*k.count+i+1]=d[1],o[this.vertexCounter*k.count+i+2]=d[2];else if(h===g.NORMAL)for(i=0;i<m;i+=3)d.setd(l[i+0],l[i+1],l[i+2]),b.rotation.applyPost(d),o[this.vertexCounter*k.count+
i+0]=d[0],o[this.vertexCounter*k.count+i+1]=d[1],o[this.vertexCounter*k.count+i+2]=d[2];else if(h===g.TANGENT)for(i=0;i<m;i+=3)d.setd(l[i+0],l[i+1],l[i+2]),b.rotation.applyPost(d),o[this.vertexCounter*k.count+i+0]=d[0],o[this.vertexCounter*k.count+i+1]=d[1],o[this.vertexCounter*k.count+i+2]=d[2];else for(i=0;i<m;i++)o[this.vertexCounter*k.count+i]=l[i]}c=a.getIndexBuffer();i=0;for(h=a.indexCount;i<h;i++)this.indexData[this.indexCounter+i]=c[i]+this.vertexCounter;this.vertexCounter+=a.vertexCount;
this.indexCounter+=a.indexCount;this.indexLengths=a.indexLengths?this.indexLengths.concat(a.indexLengths):this.indexLengths.concat(a.getIndexBuffer().length);this.indexModes=this.indexModes.concat(a.indexModes)};a.prototype._generateMesh=function(){var a={},b;for(b in this.vertexData){var d=this.vertexData[b];a[b]=d.map}a=new g(a,this.vertexCounter,this.indexCounter);for(b in this.vertexData)d=this.vertexData[b].array,a.getAttributeBuffer(b).set(d);a.getIndexBuffer().set(this.indexData);a.indexLengths=
this.indexLengths;a.indexModes=this.indexModes;this.meshDatas.push(a);this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0;this.indexLengths=[];this.indexModes=[]};a.prototype.build=function(){this.vertexCounter>0&&this._generateMesh();return this.meshDatas};return a});
define("goo/util/LightPointer","goo/renderer/MeshData,goo/util/MeshBuilder,goo/math/Transform,goo/shapes/ShapeCreator,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/math/MathUtils,goo/renderer/light/PointLight,goo/renderer/light/DirectionalLight,goo/renderer/light/SpotLight".split(","),function(g,c,b,a,d,e,f,j,h,k,i,l){function m(){}function o(a,b){for(var a=a||1,b=b||8,d=[],e=[],c=Math.PI*2/b,f=0,h=
0;f<b;f++,h+=c)d.push(Math.cos(h)*a,Math.sin(h)*a,0),e.push(f,f+1);e[e.length-1]=0;c=new g(g.defaultMap([g.POSITION]),b,e.length);c.getAttributeBuffer(g.POSITION).set(d);c.getIndexBuffer().set(e);c.indexLengths=null;c.indexModes=["Lines"];return c}function p(d){if(d instanceof k){var e=new c,f=new b,j=d.range,j=j||1,d=new c,j=o(j,128),m;m=new b;d.addMeshData(j,m);m=new b;m.rotation.fromAngles(0,Math.PI/2,0);m.update();d.addMeshData(j,m);m=new b;m.rotation.fromAngles(Math.PI/2,Math.PI/2,0);m.update();
d.addMeshData(j,m);d=d.build()[0];j=a.createSphere(8,8,0.1);e.addMeshData(d,f);e.addMeshData(j,f);return e.build()[0]}if(d instanceof i){e=new c;f=new b;f.scale.setd(1,1,-1);f.update();d=new c;for(m=0;m<2;m++){var p=o(2,64),j=new b;j.translation.set(0,0,10*m);j.update();d.addMeshData(p,j)}p=4;j=[];m=[];for(var s=Math.PI*2/p,u=0,z=0;u<p;u++,z+=s)j.push(Math.cos(z),Math.sin(z),0),j.push(Math.cos(z),Math.sin(z),1),m.push(u*2,u*2+1);p=new g(g.defaultMap([g.POSITION]),p*2,m.length);p.getAttributeBuffer(g.POSITION).set(j);
p.getIndexBuffer().set(m);p.indexLengths=null;p.indexModes=["Lines"];j=new b;j.scale.set(2,2,20);j.update();d.addMeshData(p,j);d=d.build()[0];j=a.createSphere(8,8,0.1);e.addMeshData(d,f);e.addMeshData(j,f);return e.build()[0]}if(d instanceof l){e=new c;f=new b;m=d.angle;j=d.range;m=m||45;j=j||1;d=new c;j/=2;m=Math.sin(m*h.DEG_TO_RAD)*j;for(s=1;s<=2;s++)u=o(m*s,64),p=new b,p.translation.set(0,0,j*s),p.update(),d.addMeshData(u,p);for(var u=4,p=[0,0,0],s=[],z=Math.PI*2/u,w=0,A=0;w<u;w++,A+=z)p.push(Math.cos(A),
Math.sin(A),1),s.push(0,w+1);u=new g(g.defaultMap([g.POSITION]),u+1,s.length);u.getAttributeBuffer(g.POSITION).set(p);u.getIndexBuffer().set(s);u.indexLengths=null;u.indexModes=["Lines"];p=new b;p.scale.set(m*2,m*2,j*2);p.update();d.addMeshData(u,p);d=d.build()[0];j=a.createSphere(8,8,0.1);e.addMeshData(j,f);f.scale.setd(1,1,-1);f.update();e.addMeshData(d,f);return e.build()[0]}}m.getMeshData=function(a){return p(a)};m.attachPointer=function(a){var b=a.getComponent("lightComponent").light,c=p(b),
c=new d(c);a.setComponent(c);c=new e;a.setComponent(c);c=f.createMaterial(j.simpleColored,"");c.uniforms.color=[b.color.data[0],b.color.data[1],b.color.data[2]];a.meshRendererComponent.materials.push(c);return a};m.removeMesh=function(a){a.clearComponent("meshDataComponent");a.clearComponent("meshRendererComponent");return a};return m});
define("goo/entities/systems/LightDebugSystem","goo/entities/systems/System,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/util/LightPointer".split(","),function(g,c,b,a,d,e){function f(){g.call(this,"LightDebugSystem",["LightDebugComponent"])}f.prototype=Object.create(g.prototype);f.prototype.inserted=function(f){var g=f.lightComponent.light,k=e.getMeshData(g);f.setComponent(new c(k));k=a.createMaterial(d.simpleColored,
"");k.uniforms.color=[g.color.data[0],g.color.data[1],g.color.data[2]];g=new b;g.materials.push(k);f.setComponent(g);g.updateBounds(f.meshDataComponent.modelBound,f.transformComponent.worldTransform)};f.prototype.process=function(a){for(var b=0;b<a.length;b++){var d=a[b],c=d.lightComponent.light;if(c.changedProperties)c.changedProperties=!1,d.meshDataComponent.meshData=e.getMeshData(c),d.meshRendererComponent.updateBounds(d.meshDataComponent.modelBound,d.transformComponent.worldTransform);if(c.changedColor)c.changedColor=
!1,d.meshRendererComponent.materials[0].uniforms.color=[c.color.data[0],c.color.data[1],c.color.data[2]]}};f.prototype.deleted=function(a){a.clearComponent("MeshDataComponent");a.clearComponent("MeshRendererComponent")};return f});
define("goo/util/FrustumViewer","goo/renderer/MeshData,goo/util/MeshBuilder,goo/math/Transform,goo/shapes/ShapeCreator,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/shapes/Box,goo/shapes/Cylinder".split(","),function(g,c,b,a,d,e,f,j,h,k){function i(){}function l(a,b,d,e){var c,f,h,i,j,k,l,m,A,x,B,D,C,F,G,H,I,J,K,E,L;c=Math.tan(a*Math.PI/180/2);K=-c*e*b;E=c*e;L=-e;H=-c*e*b;I=-c*e;J=-e;C=c*e*b;F=-c*e;
G=-e;a=c*e*b;B=c*e;D=-e;m=-c*d*b;A=c*d;x=-d;j=-c*d*b;k=-c*d;l=-d;e=c*d*b;h=-c*d;i=-d;b*=c*d;c*=d;f=-d;d=[];d.push(K,E,L);d.push(H,I,J);d.push(C,F,G);d.push(a,B,D);d.push(m,A,x);d.push(j,k,l);d.push(e,h,i);d.push(b,c,f);a=[];a.push(0,1);a.push(1,2);a.push(2,3);a.push(3,0);a.push(4,5);a.push(5,6);a.push(6,7);a.push(7,4);a.push(0,4);a.push(1,5);a.push(2,6);a.push(3,7);B=new g(g.defaultMap([g.POSITION]),8,24);B.getAttributeBuffer(g.POSITION).set(d);B.getIndexBuffer().set(a);B.indexLengths=null;B.indexModes=
["Lines"];return B}function m(a){var d=new c,e=new b,a=l(a.fov,a.aspect,a.near,a.far);d.addMeshData(a,e);var a=new k(32,0.6),f=new k(32,0.6),i=new h(0.3,1,1.6),j=new h(0.2,0.15,0.7);j.applyFunction(g.POSITION,function(a){return[a.x+a.x/((a.z+1.1)*0.3),a.y+a.y/((a.z+1.1)*0.3),a.z]});e.translation.setd(0,0,0);e.update();d.addMeshData(j,e);e.translation.setd(0,0,1.3);e.update();d.addMeshData(i,e);e.scale.setd(1,1,0.5);e.setRotationXYZ(0,Math.PI/2,0);e.translation.setd(0,1.2,0.6);e.update();d.addMeshData(a,
e);e.translation.setd(0,1.2,2);e.update();d.addMeshData(f,e);return d.build()[0]}i.getMeshData=function(a){return m(a)};i.attachGuide=function(a){var b=a.getComponent("CameraComponent").camera,b=l(b.fov,b.aspect,b.near,b.far-b.far/1E3),b=new d(b);a.setComponent(b);var b=new e,c=f.createMaterial(j.simpleColored,"");c.uniforms.color=[0.5,0.7,1];b.materials.push(c);a.setComponent(b);return a};i.removeMesh=function(a){a.hasComponent("cameraComponent")&&(a.clearComponent("meshDataComponent"),a.clearComponent("meshRendererComponent"));
return a};return i});
define("goo/entities/systems/CameraDebugSystem","goo/entities/systems/System,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/util/FrustumViewer".split(","),function(g,c,b,a,d,e){function f(){g.call(this,"CameraDebugSystem",["CameraDebugComponent"])}f.prototype=Object.create(g.prototype);f.prototype.inserted=function(f){var g=e.getMeshData(f.cameraComponent.camera);f.setComponent(new c(g));g=a.createMaterial(d.simpleColored,
"");g.uniforms.color=[0.4,0.7,1];var k=new b;k.materials.push(g);f.setComponent(k);k.updateBounds(f.meshDataComponent.modelBound,f.transformComponent.worldTransform)};f.prototype.process=function(a){for(var b=0;b<a.length;b++){var d=a[b],c=d.cameraComponent.camera;if(c.changedProperties)d.meshDataComponent.meshData=e.getMeshData(c),d.meshRendererComponent.updateBounds(d.meshDataComponent.modelBound,d.transformComponent.worldTransform),c.changedProperties=!1}};f.prototype.deleted=function(a){a.clearComponent("MeshDataComponent");
a.clearComponent("MeshRendererComponent")};return f});
define("goo/util/GameUtils",[],function(){function g(){}g.supported={fullscreen:!0,pointerLock:!0};g.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()};g.requestPointerLock=function(){document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()};g.exitPointerLock=function(){document.exitPointerLock&&document.exitPointerLock()};
g.togglePointerLock=function(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()};g.addVisibilityChangeListener=function(c){if(typeof c==="function"){for(var b=["","ms","moz","webkit"],a,d,e=0;e<b.length;++e){var f=b[e]+(b[e].length===0?"hidden":"Hidden"),g=b[e]+"visibilitychange";if(typeof document[f]!=="undefined"){a=f;d=g;break}}typeof document.addEventListener!=="undefined"&&
typeof a!=="undefined"&&document.addEventListener(d,function(){document[a]?c(!0):c(!1)})}};g.initAllShims=function(c){this.initAnimationShims();this.initFullscreenShims(c);this.initPointerLockShims(c)};g.initAnimationShims=function(){for(var c=0,b=["ms","moz","webkit","o"],a=0;a<b.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame===
void 0)window.requestAnimationFrame=function(a){var b=Date.now(),f=Math.max(0,16-(b-c)),g=window.setTimeout(function(){a(b+f)},f);c=b+f;return g};if(window.cancelAnimationFrame===void 0)window.cancelAnimationFrame=function(a){clearTimeout(a)}};g.initFullscreenShims=function(c){function b(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenchange",!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenerror",!0,
!1,null);document.dispatchEvent(a)}var c=c||window,d=(c.HTMLElement||c.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var e=function(){if("webkitIsFullScreen"in document)return function(){return document.webkitFullscreenEnabled};if("mozFullScreenEnabled"in document)return function(){return document.mozFullScreenEnabled};g.supported.fullscreen=!1;return function(){return!1}}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:e})}document.hasOwnProperty("fullscreenElement")||
(e=function(){for(var a=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],b=function(b){return function(){return document[a[b]]}},d=0;d<a.length;d++)if(a[d]in document)return b(d);return function(){return null}}(),Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:e}));document.addEventListener("webkitfullscreenchange",b,!1);document.addEventListener("mozfullscreenchange",b,!1);document.addEventListener("webkitfullscreenerror",
a,!1);document.addEventListener("mozfullscreenerror",a,!1);if(!d.requestFullScreen)d.requestFullScreen=function(){return d.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(c.Element.ALLOW_KEYBOARD_INPUT)}:d.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}();if(!document.cancelFullScreen)document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}()};g.initPointerLockShims=function(c){function b(){var a=
document.createEvent("CustomEvent");a.initCustomEvent("pointerlockchange",!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockerror",!0,!1,null);document.dispatchEvent(a)}var c=c||window,d=(c.HTMLElement||c.Element).prototype,c=c.MouseEvent.prototype;"movementX"in c||Object.defineProperty(c,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}});"movementY"in c||
Object.defineProperty(c,"movementY",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementY||this.mozMovementY||0}});if(!navigator.pointer)navigator.pointer=navigator.webkitPointer||navigator.mozPointer;document.addEventListener("webkitpointerlockchange",b,!1);document.addEventListener("webkitpointerlocklost",b,!1);document.addEventListener("mozpointerlockchange",b,!1);document.addEventListener("mozpointerlocklost",b,!1);document.addEventListener("webkitpointerlockerror",
a,!1);document.addEventListener("mozpointerlockerror",a,!1);document.hasOwnProperty("pointerLockElement")||(c=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}(),Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:c}));if(!d.requestPointerLock)d.requestPointerLock=function(){if(d.webkitRequestPointerLock)return function(){this.webkitRequestPointerLock()};
if(d.mozRequestPointerLock)return function(){this.mozRequestPointerLock()};if(navigator.pointer)return function(){navigator.pointer.lock(this,b,a)};g.supported.pointerLock=!1;return function(){}}();if(!document.exitPointerLock)document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}()};return g});
define("goo/util/Logo",[],function(){function g(){}g.blue="#2A3276";g.white="#FFFFFF";var c={color:g.blue,shadow:!1};g.getLogo=function(b){var b=b||{},a;for(a in c)b[a]===void 0&&(b[a]=c[a]);a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("version","1.1");a.setAttribute("xmlns","http://www.w3.org/2000/svg");a.setAttribute("x","0px");a.setAttribute("y","0px");a.setAttribute("viewBox","0 0 396.603 277.343");a.setAttribute("enable-background","new 0 0 396.603 277.343");
a.setAttribute("xml:space","preserve");b.width&&a.setAttribute("width",b.width);b.height&&a.setAttribute("height",b.height);var d=document.createElementNS("http://www.w3.org/2000/svg","g");a.appendChild(d);var e=document.createElementNS("http://www.w3.org/2000/svg","filter");e.setAttribute("id","insetShadow");var f=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");f.setAttribute("in","SourceAlpha");f.setAttribute("stdDeviation","0");var g=document.createElementNS("http://www.w3.org/2000/svg",
"feOffset");g.setAttribute("dx","0");g.setAttribute("dy","-5");g.setAttribute("result","offsetblur");var h=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer"),k=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");k.setAttribute("type","linear");k.setAttribute("slope","0.5");h.appendChild(k);var k=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),i=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode"),l=document.createElementNS("http://www.w3.org/2000/svg",
"feMergeNode");l.setAttribute("in","SourceGraphic");k.appendChild(i);k.appendChild(l);e.appendChild(f);e.appendChild(g);e.appendChild(h);e.appendChild(k);d.appendChild(e);f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d","M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z");
f.setAttribute("fill",b.color);b.shadow&&(d.appendChild(e),f.setAttribute("style","filter:url(#insetShadow)"));d.appendChild(f);return(new XMLSerializer).serializeToString(a)};return g});
define("goo/entities/GooRunner","goo/entities/World,goo/entities/systems/TransformSystem,goo/entities/systems/RenderSystem,goo/renderer/Renderer,goo/renderer/Material,goo/renderer/Util,goo/renderer/shaders/ShaderLib,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/LightingSystem,goo/entities/managers/LightManager,goo/entities/systems/CameraSystem,goo/entities/systems/ParticlesSystem,goo/util/Stats,goo/entities/systems/CSSTransformSystem,goo/entities/systems/AnimationSystem,goo/entities/systems/TextSystem,goo/entities/systems/LightDebugSystem,goo/entities/systems/CameraDebugSystem,goo/util/GameUtils,goo/util/Logo".split(","),function(g,
c,b,a,d,e,f,j,h,k,i,l,m,o,p,n,r,t,q,v,y){function s(d){d=d||{};this.world=new g;this.renderer=new a(d);this.world.setSystem(new h);this.world.setSystem(new c);this.world.setSystem(new l);this.world.setSystem(new p(this.renderer));this.world.setSystem(new m);this.world.setSystem(new j);this.world.setSystem(new k);this.world.setSystem(new n);this.world.setSystem(new t);this.world.setSystem(new q);this.renderSystem=new b;this.world.setSystem(this.renderSystem);this.doRender=this.doProcess=!0;v.initAllShims();
this.tpfSmoothingCount=d.tpfSmoothingCount!==void 0?d.tpfSmoothingCount:10;if(d.showStats)this.stats=new o,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement);if(d.logo===void 0||d.logo){var e=this._buildLogo(d.logo);document.body.appendChild(e)}this.callbacks=[];this.callbacksPreProcess=[];this.callbacksPreRender=[];this._takeSnapshots=[];var f=this;this.start=-1;this.run=function(a){try{f._updateFrame(a)}catch(b){b instanceof
Error?console.error(b.stack):console.error(b)}};this.animationId=0;d.manuallyStartGameLoop||this.startGameLoop(this.run);d.debugKeys&&this._addDebugKeys();v.addVisibilityChangeListener(function(a){a?this.stopGameLoop():this.startGameLoop()}.bind(this))}var u=[],z=0;s.prototype._updateFrame=function(a){if(this.start<0)this.start=a;var b=(a-this.start)/1E3;if(b<0||b>1)this.start=a;else{b=Math.max(Math.min(b,0.5),1.0E-4);u[z]=b;z=(z+1)%this.tpfSmoothingCount;for(var d=b=0;d<u.length;d++)b+=u[d];b/=u.length;
this.world.tpf=b;this.world.time+=this.world.tpf;g.time=this.world.time;this.start=a;for(d=0;d<this.callbacksPreProcess.length;d++)this.callbacksPreProcess[d](this.world.tpf);this.doProcess&&this.world.process();for(d=0;d<this.callbacksPreRender.length;d++)this.callbacksPreRender[d](this.world.tpf);this.renderer.info.reset();this.doRender&&this.renderSystem.render(this.renderer);for(d=0;d<this.callbacks.length;d++)this.callbacks[d](this.world.tpf);this.stats&&this.stats.update(this.renderer.info);
if(this._takeSnapshots.length){try{for(var e=this.renderer.domElement.toDataURL(),d=this._takeSnapshots.length-1;d>=0;d--)this._takeSnapshots[d](e)}catch(c){console.error("Failed to take snapshot",c.message)}this._takeSnapshots=[]}}this.animationId=window.requestAnimationFrame(this.run)};s.prototype._buildLogo=function(a){var b=document.createElement("div"),d=y.getLogo({width:"70px",height:"50px",color:y.blue});b.innerHTML='<a style="text-decoration: none;" href="http://www.gooengine.com" target="_blank"><span style="color: #EEE; font-family: Helvetica, sans-serif; font-size: 11px; display: inline-block; margin-top: 14px; margin-right: -3px; vertical-align: top;">Powered by</span>'+
d+"</a>";b.style.position="absolute";b.style.zIndex="2000";a==="topright"?(b.style.top="10px",b.style.right="10px"):a==="topleft"?(b.style.top="10px",b.style.left="10px"):a==="bottomright"?(b.style.bottom="10px",b.style.right="10px"):a==="bottomleft"?(b.style.bottom="10px",b.style.left="10px"):(b.style.top="10px",b.style.right="10px");b.id="goologo";b.style.webkitTouchCallout="none";b.style.webkitUserSelect="none";b.style.khtmlUserSelect="none";b.style.mozUserSelect="none";b.style.msUserSelect="none";
b.style.userSelect="none";b.ondragstart=function(){return!1};return b};s.prototype._addDebugKeys=function(){document.addEventListener("keydown",function(a){a.which===32&&a.shiftKey?v.toggleFullScreen():a.which===13&&a.shiftKey?v.togglePointerLock():a.which===49&&a.shiftKey?this.renderSystem.setDebugMaterial():(a.which===50||a.which===222)&&a.shiftKey?this.renderSystem.setDebugMaterial("normals"):a.which===51&&a.shiftKey?this.renderSystem.setDebugMaterial("lit"):a.which===52&&a.shiftKey?this.renderSystem.setDebugMaterial("color"):
a.which===53&&a.shiftKey?this.renderSystem.setDebugMaterial("wireframe"):a.which===54&&a.shiftKey?this.renderSystem.setDebugMaterial("flat"):(a.which===55||a.which===191)&&a.shiftKey?this.renderSystem.setDebugMaterial("texture"):a.which===56&&a.shiftKey&&this.renderSystem.setDebugMaterial("+wireframe")}.bind(this),!1);document.addEventListener("mousedown",function(a){a.shiftKey&&this.renderSystem.pick(a.clientX,a.clientY,function(a,b){var d=this.world.entityManager.getEntityById(a);console.log("Picked entity:",
d,"At depth:",b)}.bind(this))}.bind(this),!1)};s.prototype.setEventHandlers=function(a){if(a&&(a.onClick&&this.renderer.domElement.addEventListener("mousedown",function(b){this.renderSystem.picking.doPick||this.renderSystem.pick(b.clientX,b.clientY,function(b,d){var e=this.world.entityManager.getEntityById(b);a.onClick(e,d)}.bind(this))}.bind(this),!1),a.onChange)){var b;this.renderer.domElement.addEventListener("mousemove",function(d){this.renderSystem.picking.doPick||this.renderSystem.pick(d.clientX,
d.clientY,function(d,e){var c=this.world.entityManager.getEntityById(d);c!==b&&(a.onChange(b,c,e),b=c)}.bind(this))}.bind(this),!1)}};s.prototype.startGameLoop=function(){if(!this.animationId)this.start=-1,this.animationId=window.requestAnimationFrame(this.run)};s.prototype.stopGameLoop=function(){window.cancelAnimationFrame(this.animationId);this.animationId=0};s.prototype.takeSnapshot=function(a){this._takeSnapshots.push(a)};return s});
define("goo/entities/components/AnimationComponent","goo/entities/components/Component,goo/entities/World,goo/animation/layer/AnimationLayer,goo/animation/clip/JointData,goo/animation/clip/TransformData,goo/animation/clip/TriggerData".split(","),function(g,c,b,a,d,e){function f(a){this.type="AnimationComponent";this.layers=[];this.floats={};this._updateRate=1/60;this._lastUpdate=0;this._triggerCallbacks={};this.layers.push(new b(b.BASE_LAYER_NAME));this._skeletonPose=a}f.prototype=Object.create(g.prototype);
f.prototype.transitionTo=function(a){return this.layers[0].transitionTo(a)};f.prototype.getStates=function(){return this.layers[0].getStates()};f.prototype.getCurrentState=function(){return this.layers[0].getCurrentState()};f.prototype.getTransitions=function(){return this.layers[0].getTransitions()};f.prototype.update=function(a){a=a||c.time;if(this._updateRate!==0){if(a>this._lastUpdate&&a-this._lastUpdate<this._updateRate)return;this._lastUpdate=a-(a-this._lastUpdate)%this._updateRate}for(var b=
0,d=this.layers.length;b<d;b++)this.layers[b].update(a)};f.prototype.apply=function(b){var c=this.getCurrentSourceData(),f=this._skeletonPose;if(c){for(var g in c){var l=c[g];if(l instanceof a)f&&l._jointIndex>=0&&l.applyTo(f._localTransforms[l._jointIndex]);else if(l instanceof d)b&&(l.applyTo(b.transform),b.updateTransform(),this._updateWorldTransform(b));else if(l instanceof e){if(l.armed){for(var m=0,o=l._currentTriggers.length;m<o;m++){var p=this._triggerCallbacks[l._currentTriggers[m]];if(p&&
p.length)for(var n=0,r=p.length;n<r;n++)p[n]()}l.armed=!1}}else l instanceof Array&&(this.floats[g]=l[0])}f&&f.updateTransforms()}};f.prototype._updateWorldTransform=function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)this._updateWorldTransform(a.children[b])};f.prototype.postUpdate=function(){for(var a=0,b=this.layers.length;a<b;a++)this.layers[a].postUpdate()};f.prototype.getCurrentSourceData=function(){for(var a=this.layers.length-1,b=0;b<a;b++)this.layers[b+1].updateLayerBlending(this.layers[b]);
return this.layers[a].getCurrentSourceData()};f.prototype.addLayer=function(a,b){isNaN(b)?this.layers.push(a):this.layers.splice(b,0,a)};f.prototype.resetClips=function(a){for(var b=0;b<this.layers.length;b++)this.layers[b].resetClips(a)};f.prototype.setTimeScale=function(a){for(var b=0;b<this.layers.length;b++)this.layers[b].setTimeScale(a)};return f});
define("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3"],function(g,c){function b(a){this.type="CameraComponent";this.camera=a;this.leftVec=new c(-1,0,0);this.upVec=new c(0,1,0);this.dirVec=new c(0,0,-1)}b.prototype=Object.create(g.prototype);b.prototype.setUpVector=function(a){a===0?(this.leftVec.setd(0,-1,0),this.upVec.setd(1,0,0),this.dirVec.setd(0,0,-1)):a===2?(this.leftVec.setd(-1,0,0),this.upVec.setd(0,0,1),this.dirVec.setd(0,-1,0)):(this.leftVec.setd(-1,
0,0),this.upVec.setd(0,1,0),this.dirVec.setd(0,0,-1))};b.prototype.updateCamera=function(a){this.camera._left.setv(this.leftVec);a.matrix.applyPostVector(this.camera._left);this.camera._up.setv(this.upVec);a.matrix.applyPostVector(this.camera._up);this.camera._direction.setv(this.dirVec);a.matrix.applyPostVector(this.camera._direction);a.matrix.getTranslation(this.camera.translation);this.camera.update()};return b});
define("goo/entities/components/CameraDebugComponent",["goo/entities/components/Component"],function(g){function c(){this.type="CameraDebugComponent"}c.prototype=Object.create(g.prototype);return c});define("goo/entities/components/LightComponent",["goo/entities/components/Component"],function(g){function c(b){this.type="LightComponent";this.light=b}c.prototype=Object.create(g.prototype);c.prototype.updateLight=function(b){this.light.update(b)};return c});
define("goo/entities/components/LightDebugComponent",["goo/entities/components/Component"],function(g){function c(){this.type="LightDebugComponent"}c.prototype=Object.create(g.prototype);return c});
define("goo/particles/ParticleUtils",["goo/math/Vector3"],function(g){function c(){}c.getRandomVelocityOffY=function(b,a,d,e,f){a+=Math.random()*(d-a);d=Math.PI*2*Math.random();b.x=Math.cos(d)*Math.sin(a);b.y=Math.cos(a);b.z=Math.sin(d)*Math.sin(a);f&&c.applyEntityTransformVector(b,f);b.mul(e);return b};c.randomPointInCube=function(b,a,d,e,c){b.x=Math.random()*2*a-a+(c?c.x:0);b.y=Math.random()*2*d-d+(c?c.y:0);b.z=Math.random()*2*e-e+(c?c.z:0);return b};c.createConstantForce=function(b){var a=new g(b);
return{enabled:!0,prepare:function(){},apply:function(b,e){e.velocity.x+=a.x*b;e.velocity.y+=a.y*b;e.velocity.z+=a.z*b}}};c.applyEntityTransformPoint=function(b,a){return!a.transformComponent||!a.transformComponent.worldTransform?b:a.transformComponent.worldTransform.applyForward(b,b)};c.applyEntityTransformVector=function(b,a){return!a.transformComponent||!a.transformComponent.worldTransform?b:a.transformComponent.worldTransform.applyForwardVector(b,b)};c.applyTimeline=function(b,a){for(var d=b.age,
e=b.lifeSpan,c=0,g=0,h=0,k=0,i=e,l=e,m=e,o=e,p=0,n=0,r=null,t=null,q=null,v=null,y=null,s=null,u=null,z=null,w=null,n=0,A=a.length;n<A;n++){var x=a[n];p+=(x.timeOffset?x.timeOffset:0)*e;s===null&&(p>d?x.color!==void 0&&(i=p,s=x):x.color!==void 0&&(c=p,r=x));u===null&&(p>d?x.mass!==void 0&&(l=p,u=x):x.mass!==void 0&&(g=p,t=x));p<=d&&x.uvIndex!==void 0&&(y=x);z===null&&(p>d?x.size!==void 0&&(m=p,z=x):x.size!==void 0&&(h=p,q=x));w===null&&(p>d?x.spin!==void 0&&(o=p,w=x):x.spin!==void 0&&(k=p,v=x))}n=
(d-c)/(i-c);e=r!==null?r.color:[1,1,1,1];s=s!==null?s.color:e;b.color.data[0]=(1-n)*e[0]+n*s[0];b.color.data[1]=(1-n)*e[1]+n*s[1];b.color.data[2]=(1-n)*e[2]+n*s[2];b.color.data[3]=(1-n)*e[3]+n*s[3];n=(d-g)/(l-g);e=t!==null?t.mass:1;s=u!==null?u.mass:e;b.mass=(1-n)*e+n*s;b.uvIndex=y!==null?y.uvIndex:0;n=(d-h)/(m-h);e=q!==null?q.size:1;s=z!==null?z.size:e;b.size=(1-n)*e+n*s;n=(d-k)/(o-k);e=v!==null?v.spin:0;s=w!==null?w.spin:e;b.spin=(1-n)*e+n*s};return c});
define("goo/particles/Particle",["goo/particles/ParticleUtils","goo/math/Vector","goo/math/Vector3","goo/math/Vector4","goo/renderer/MeshData"],function(g,c,b,a,d){function e(d,e){this.alive=!1;this.position=new b;this.velocity=new b;this.lifeSpan=0;this.parent=d;this.age=0;this.index=e;this.color=new a(1,0,0,1);this.spin=this.size=0;this.mass=1;this.emitter=null;this.uvIndex=0;this.lastUVIndex=-1;this.bbX=new b;this.bbY=new b;this.lastColor=new a}var f=new b;e.prototype.respawnParticle=function(a){this.emitter=
a;this.lifeSpan=a.nextParticleLifeSpan();this.alive=!0;this.age=0};e.prototype.update=function(a,e){if(this.alive)if(this.age+=a,this.age>this.lifeSpan)this.kill();else{this.position.add_d(this.velocity.x*a,this.velocity.y*a,this.velocity.z*a);g.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline);if(!c.equals(this.lastColor,this.color)){var k=this.parent.meshData.getAttributeBuffer(d.COLOR);k.set(this.color.data,this.index*16+0);k.set(this.color.data,
this.index*16+4);k.set(this.color.data,this.index*16+8);k.set(this.color.data,this.index*16+12);this.lastColor.setv(this.color)}this.emitter&&this.emitter.getParticleBillboardVectors(this,e);if(this.spin===0)this.bbX.muld(this.size,this.size,this.size),this.bbY.muld(this.size,this.size,this.size);else{var k=Math.cos(this.spin)*this.size,i=Math.sin(this.spin)*this.size,l=this.bbY.x,m=this.bbY.y,o=this.bbY.z;this.bbY.setv(this.bbX);this.bbX.muld(k,k,k).add_d(l*i,m*i,o*i);this.bbY.muld(-i,-i,-i).add_d(l*
k,m*k,o*k)}k=this.parent.meshData.getAttributeBuffer(d.POSITION);b.subv(this.position,this.bbX,f).subv(this.bbY);k.set(f.data,this.index*12+0);b.subv(this.position,this.bbX,f).addv(this.bbY);k.set(f.data,this.index*12+3);b.addv(this.position,this.bbX,f).addv(this.bbY);k.set(f.data,this.index*12+6);b.addv(this.position,this.bbX,f).subv(this.bbY);k.set(f.data,this.index*12+9);if(this.lastUVIndex!==this.uvIndex)k=this.parent.meshData.getAttributeBuffer(d.TEXCOORD0),i=this.uvIndex%this.parent.uRange/
this.parent.uRange,l=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,m=1/this.parent.uRange,o=1/this.parent.vRange,k.set([i+m,l-o],this.index*8+0),k.set([i+m,l],this.index*8+2),k.set([i,l],this.index*8+4),k.set([i,l-o],this.index*8+6),this.lastUVIndex=this.uvIndex}};e.prototype.kill=function(){this.alive=!1;var a=this.parent.meshData.getAttributeBuffer(d.POSITION),b=a.subarray(this.index*12,this.index*12+3);a.set(b,this.index*12+3);a.set(b,this.index*12+6);a.set(b,this.index*12+9)};
return e});
define("goo/particles/ParticleEmitter",["goo/particles/ParticleUtils","goo/renderer/Renderer"],function(g,c){function b(a){a=a||{};this.totalParticlesToSpawn=!isNaN(a.totalParticlesToSpawn)?a.totalParticlesToSpawn:-1;this.maxLifetime=!isNaN(a.maxLifetime)?a.maxLifetime:3;this.minLifetime=!isNaN(a.minLifetime)?a.minLifetime:2;this.timeline=a.timeline?a.timeline:void 0;this.influences=a.influences?a.influences:[];this.getEmissionPoint=a.getEmissionPoint?a.getEmissionPoint:function(a,b){var c=a.position;
c.setd(0,0,0);return g.applyEntityTransformPoint(c,b)};this.getEmissionVelocity=a.getEmissionVelocity?a.getEmissionVelocity:function(a,b){var c=a.velocity;c.setd(0,1,0);return g.applyEntityTransformVector(c,b)};this.getParticleBillboardVectors=a.getParticleBillboardVectors?a.getParticleBillboardVectors:b.CAMERA_BILLBOARD_FUNC;this.releaseRatePerSecond=!isNaN(a.releaseRatePerSecond)?a.releaseRatePerSecond:10;this.particlesWaitingToRelease=0;this.enabled=a.enabled!==void 0?a.enabled===!0:!0}b.CAMERA_BILLBOARD_FUNC=
function(a){var b=c.mainCamera;a.bbX.setv(b._left);a.bbY.setv(b._up)};b.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()};return b});
define("goo/entities/components/ParticleComponent",["goo/entities/components/Component","goo/particles/Particle","goo/particles/ParticleEmitter","goo/renderer/MeshData"],function(g,c,b,a){function d(a){this.type="ParticleComponent";g.call(this);a=a||{};this.emitters=[];if(a.emitters)for(var d=0,c=a.emitters.length;d<c;d++)this.emitters.push(new b(a.emitters[d]));this.timeline=a.timeline?a.timeline:[];this.uRange=isNaN(a.uRange)?1:a.uRange;this.vRange=isNaN(a.vRange)?1:a.vRange;this.recreateParticles(isNaN(a.particleCount)?
100:a.particleCount);this.enabled=!0}d.prototype=Object.create(g.prototype);d.prototype.generateMeshData=function(){var b=a.defaultMap([a.POSITION,a.COLOR,a.TEXCOORD0]);this.meshData=new a(b,this.particleCount*4,this.particleCount*6);for(var b=this.meshData.getAttributeBuffer(a.TEXCOORD0),d=this.meshData.getIndexBuffer(),c=0,g=this.particleCount;c<g;c++)b.set([1,0],c*8+0),b.set([1,1],c*8+2),b.set([0,1],c*8+4),b.set([0,0],c*8+6),d.set([c*4+0,c*4+3,c*4+1,c*4+1,c*4+3,c*4+2],c*6)};d.prototype.recreateParticles=
function(a){this.particleCount=a;this.particles=[];for(a=0;a<this.particleCount;a++)this.particles[a]=new c(this,a);this.generateMeshData()};return d});
define("goo/entities/components/PortalComponent",["goo/entities/components/Component","goo/renderer/pass/RenderTarget"],function(g,c){function b(a,b,e,f){b=b||200;this.options=e||{};this.options.preciseRecursion=!!this.options.preciseRecursion;this.options.autoUpdate=this.options.autoUpdate!==!1;this.options.alwaysRender=!!this.options.alwaysRender;this.overrideMaterial=f;this.doUpdate=!0;e=a.aspect;this.type="PortalComponent";this.camera=a;this.target=new c(b,b/e);if(this.options.preciseRecursion)this.secondaryTarget=
new c(b,b/e)}b.prototype=Object.create(g.prototype);b.prototype.requestUpdate=function(){this.doUpdate=!0};return b});define("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(g){function c(b){this.type="ScriptComponent";this.scripts=b instanceof Array?b:b?[b]:[]}c.prototype=Object.create(g.prototype);c.prototype.run=function(b,a){for(var d,c=0,f=this.scripts.length;c<f;c++)(d=this.scripts[c])&&d.run&&(d.enabled===void 0||d.enabled)&&d.run(b,a)};return c});
define("goo/entities/components/TextComponent",["goo/entities/components/Component","goo/shapes/TextureGrid","goo/entities/components/MeshDataComponent"],function(g){function c(b){this.type="TextComponent";this.text=b||"";this.dirty=!0}c.prototype=Object.create(g.prototype);c.prototype.setText=function(b){this.text=b;this.dirty=!0;return this};return c});
define("goo/entities/managers/DebugManager",[],function(){function g(){this.type="DebugManager";this._entities={}}g.prototype.added=function(c){this._entities[c.id]=c};g.prototype.removed=function(c){delete this._entities[c.id]};g.prototype.getEntities=function(){var c=[],b;for(b in this._entities)c.push(this._entities[b]);return c};return g});
define("goo/entities/systems/PortalSystem",["goo/entities/systems/System"],function(g){function c(b,a){g.call(this,"PortalSystem",["MeshRendererComponent","MeshDataComponent","PortalComponent"]);this.renderer=b;this.renderSystem=a;this.renderList=[]}c.prototype=Object.create(g.prototype);c.prototype.process=function(b){for(var a=0;a<b.length;a++){var d=b[a],c=d.portalComponent;if(c.options.autoUpdate||c.doUpdate){c.doUpdate=!1;var f=c.camera,g=c.target,h=c.secondaryTarget,k=c.overrideMaterial;if(c.alwaysRender||
d.isVisible)if(this.render(this.renderer,f,g,k),d.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP",g),c.options.preciseRecursion)d=g,c.target=h,c.secondaryTarget=d}}};c.prototype.render=function(b,a,d,c){b.updateShadows(this.renderSystem.partitioner,this.renderSystem.entities,this.renderSystem.lights);for(var f=0;f<this.renderSystem.preRenderers.length;f++)this.renderSystem.preRenderers[f].process(b,this.renderSystem.entities,this.renderSystem.partitioner,a,this.renderSystem.lights);this.renderSystem.partitioner.process(a,
this.renderSystem.entities,this.renderList);if(this.renderSystem.composers.length>0)for(f=0;f<this.renderSystem.composers.length;f++)this.renderSystem.composers[f].render(b,this.renderSystem.currentTpf,a,this.renderSystem.lights,null,!0);else b.render(this.renderList,a,this.renderSystem.lights,d,!0,c)};return c});
define("goo/loaders/BundleLoader",["goo/loaders/Loader","goo/util/rsvp","goo/renderer/Util"],function(g,c,b){function a(a){g.call(this,a);this._bundle={}}a.prototype=Object.create(g.prototype);a.prototype.addBundle=function(a){for(var b in a)a.hasOwnProperty(b)&&(this._bundle[b]=a[b])};a.prototype.load=function(a,e,f){if(this._bundle[a]){var f=new c.Promise,a=b.clone(this._bundle[a]),j=f.then(function(a){return typeof e==="function"?e(a):a});f.resolve(a);return j}return g.prototype.load.call(this,
a,e,f)};a.prototype.loadBundle=function(b){var c=a.prototype._parse.bind(this);return g.prototype.load.call(this,b,c)};a.prototype._parse=function(a){return this._bundle=JSON.parse(a)};return a});
define("goo/loaders/handlers/ConfigHandler",[],function(){function g(c,b,a,d){this.world=c;this.getConfig=b;this.updateObject=a;this.options=d}g.prototype.update=function(){};g.handlerClasses={};g.getHandler=function(c){return g.handlerClasses[c]};g._registerClass=function(c,b){b._type=c;return g.handlerClasses[c]=b};return g});
define("goo/loaders/handlers/ComponentHandler",[],function(){function g(c,b,a,d){this.world=c;this.getConfig=b;this.updateObject=a;this.options=d}g.prototype._prepare=function(){};g.prototype._create=function(){throw Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)");};g.prototype.update=function(c,b){this._prepare(b);return c==null||c[this.constructor._type+"Component"]==null?this._create(c,b):c[this.constructor._type+"Component"]};g.prototype.remove=function(c){c!=
null&&c.clearComponent(this.constructor._type+"Component");return c};g.handlerClasses={};g.getHandler=function(c){return g.handlerClasses[c]};g._registerClass=function(c,b){b._type=c;g.handlerClasses[c]=b};return g});define("goo/util/StringUtil",[],function(){return{endsWith:function(g,c){return g.indexOf(c,g.length-c.length)!==-1},startsWith:function(g,c){return g.indexOf(c)===0}}});
define("goo/util/PromiseUtil",["goo/util/rsvp"],function(g){return{createDummyPromise:function(c,b){var a;a=new g.Promise;b!=null?a.reject(b):a.resolve(c);return a},defer:function(c,b){var a,d,e;e=new g.Promise;if(b.apply)return a=new g.Promise,d=a.then(function(){return b()}),setTimeout(function(){a.resolve()},c),d;else setTimeout(function(){e.resolve(b)},c);return e}}});
define("goo/util/ObjectUtil",[],function(){var g={},c=Array.prototype,b=Object.prototype,a={},d=c.slice,e=b.toString,f=b.hasOwnProperty,b=Array.isArray,j=Object.keys,h=c.forEach;g.has=function(a,b){return f.call(a,b)};g.defaults=function(a){k(d.call(arguments,1),function(b){if(b)for(var d in b)if(typeof a[d]==="undefined"||a[d]===null)a[d]=b[d]});return a};g.extend=function(a){k(d.call(arguments,1),function(b){if(b)for(var d in b)a[d]=b[d]});return a};g.isObject=function(a){return a===Object(a)};
g.clone=function(a){return!g.isObject(a)?a:g.isArray(a)?a.slice():g.extend({},a)};g.keys=j||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],d;for(d in a)g.has(a,d)&&(b[b.length]=d);return b};g.isArray=b||function(a){return e.call(a)==="[object Array]"};var k=g.each=g.forEach=function(b,d,c){if(!(typeof b==="undefined"||b===null))if(h&&b.forEach===h)b.forEach(d,c);else if(b.length===+b.length)for(var e=0,f=b.length;e<f;e++){if(d.call(c,b[e],e,b)===a)break}else for(e in b)if(g.has(b,
e)&&d.call(c,b[e],e,b)===a)break};g.deepClone=function(a){if(!a)return a;var b;[Number,String,Boolean].forEach(function(d){a instanceof d&&(b=d(a))});if(typeof b=="undefined")if(Object.prototype.toString.call(a)==="[object Array]")b=[],a.forEach(function(a,d){b[d]=g.deepClone(a)});else if(typeof a=="object")if(a.nodeType&&typeof a.cloneNode=="function")b=a.cloneNode(!0);else if(a.prototype)b=a;else if(a instanceof Date)b=new Date(a);else{b={};for(var d in a)b[d]=g.deepClone(a[d])}else b=a;return b};
g.indexOf=function(a,b){for(var d=0;d<a.length;d++)if(d in a&&a[d]===b)return d;return-1};return g});
define("goo/loaders/handlers/CameraComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/CameraComponent,goo/renderer/Camera,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e){function f(){g.apply(this,arguments)}f.prototype=Object.create(g.prototype);g._registerClass("camera",f);f.prototype._prepare=function(a){return e.defaults(a,{fov:45,near:1,far:1E4})};f.prototype._create=function(a){var d=new b(45,1,1,1E3),d=new c(d);a.setComponent(d);
return d};f.prototype.update=function(a,b){var c=g.prototype.update.call(this,a,b);c.camera.setFrustumPerspective(b.fov,void 0,b.near,b.far);return d.createDummyPromise(c)};f.prototype.remove=function(a){a!=null&&a.cameraComponent!=null&&a.cameraComponent.camera!=null&&this.world.removeEntity(a.cameraComponent.camera);return g.prototype.remove.call(this,a)};return f});
define("goo/loaders/handlers/EntityHandler","goo/loaders/handlers/ConfigHandler,goo/loaders/handlers/ComponentHandler,goo/entities/Entity,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e){function f(){g.apply(this,arguments)}f.prototype=Object.create(g.prototype);g._registerClass("entity",f);f.prototype._prepare=function(){};f.prototype._create=function(a){var b=this.world.createEntity(a);b.ref=a;return b};f.prototype.update=function(b,f){function g(a){return a.ref===
b}var i=this.world.entityManager.getEntityByName(b);if(i==null){var l=this.world._addedEntities.filter(g);l!=null&&(i=l[0])}i==null&&(i=this._create(b));var l=[],m;for(m in f.components){var o=f.components[m],p=c.getHandler(m);if(p){if(this._componentHandlers==null)this._componentHandlers={};var n=this._componentHandlers[m];n?e.extend(n,{world:this._world,getConfig:this.getConfig,updateObject:this.updateObject,options:e.clone(this.options)}):n=this._componentHandlers[m]=new p(this.world,this.getConfig,
this.updateObject,this.options);o=n.update(i,o);o==null||o.then==null?console.error("Handler for "+m+" did not return promise"):l.push(o)}else console.warn("No componentHandler for "+m)}return l.length?a.all(l).then(function(){return i}):(console.error("No promises in "+b+" ",f),d.createDummyPromise(i))};f.prototype.remove=function(a){this.world.removeEntity(this.world.entityManager.getEntityByName(a))};return f});
define("goo/loaders/handlers/LightComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/LightComponent,goo/renderer/light/PointLight,goo/math/Vector,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e,f){function j(){g.apply(this,arguments)}j.prototype=Object.create(g.prototype);g._registerClass("light",j);j.prototype._prepare=function(a){f.defaults(a,{direction:[0,0,0],color:[1,1,1,1],attenuate:!0,shadowCaster:!1});a.shadowCaster&&f.defaults(a.shadowSettings,
{type:"Blur"})};j.prototype._create=function(a){var d=new c(new b);a.setComponent(d);return d};j.prototype.update=function(b,d){var c=g.prototype.update.call(this,b,d),j=c.light,m;for(m in d){var o=d[m];j.hasOwnProperty(m)&&(j[m]instanceof a?j[m].set(o):j[m]=f.clone(o))}return e.createDummyPromise(c)};return j});
define("goo/loaders/handlers/MaterialHandler","goo/loaders/handlers/ConfigHandler,goo/renderer/Material,goo/renderer/Util,goo/renderer/shaders/ShaderLib,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e,f){function j(){g.apply(this,arguments);this._objects={}}j.prototype=Object.create(g.prototype);g._registerClass("material",j);j.prototype._prepare=function(a){if(a.blendState==null)a.blendState={};f.defaults(a.blendState,{blending:"NoBlending",blendEquation:"AddEquation",
blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"});if(a.cullState==null)a.cullState={};f.defaults(a.cullState,{enabled:!0,cullFace:"Back",frontFace:"CCW"});if(a.depthState==null)a.depthState={};f.defaults(a.depthState,{enabled:!0,write:!0});if(a.renderQueue==null)a.renderQueue=-1};j.prototype._create=function(a){if(this._objects==null)this._objects={};return this._objects[a]=new c(a)};j.prototype.update=function(a,c){var g=this;this._prepare(c);if(this._objects[a]==null){this._create(a);
var j=this._objects[a];return this._getShaderObject(c.shaderRef,c.wireframe).then(function(e){if(e){if(c.wireframe)j.wireframe=c.wireframe;if(c.wireframeColor)j.wireframeColor=b.clone(c.wireframeColor);j.blendState=b.clone(c.blendState);j.cullState=b.clone(c.cullState);j.depthState=b.clone(c.depthState);j.renderQueue=c.renderQueue===-1?null:c.renderQueue;j.shader=e;j.uniforms={};for(var o in c.uniforms)j.uniforms[o]=f.clone(c.uniforms[o]);var p=[],e=function(a,b){return p.push(g.getConfig(b).then(function(d){return g.updateObject(b,
d,g.options).then(function(d){return{type:a,ref:b,texture:d}})}))},n;for(n in c.texturesMapping)e(n,c.texturesMapping[n]);return p.length?d.all(p).then(function(a){for(var b=0;b<a.length;b++){var d=a[b];d.texture!=null&&j.setTexture(d.type,d.texture)}return j}).then(null,function(a){return console.error("Error loading textures: "+a)}):j}else console.warn("Unknown shader",c.shaderRef,"- not updating material",a)})}else return e.createDummyPromise(this._objects[a])};j.prototype.remove=function(a){return delete this._objects[a]};
j.prototype._getShaderObject=function(b,f){var g=this;if(f){var j=new d.Promise,m=c.createShader(a.simple);j.resolve(m);return j}else return b!=null?this.getConfig(b).then(function(a){return g.updateObject(b,a,g.options)}):(j=c.createShader(a.texturedLit,"DefaultShader"),e.createDummyPromise(j))};return j});
define("goo/loaders/handlers/MeshDataComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/MeshDataComponent,goo/renderer/bounds/BoundingBox,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e){function f(){g.apply(this,arguments)}f.prototype=Object.create(g.prototype);g._registerClass("meshData",f);f.prototype._prepare=function(a){return e.defaults(a,{meshRef:null})};f.prototype._create=function(){};f.prototype.update=function(e,f){var k=
this,i,l;g.prototype.update.call(this,e,f);var m=f.meshRef;m||console.error("No meshRef in meshDataComponent for "+e.ref);var o=f.poseRef||f.pose;i=o?this.getConfig(o).then(function(a){return k.updateObject(o,a)}):d.createDummyPromise();l=this.getConfig(m).then(function(a){return k.updateObject(m,a)});return a.all([i,l]).then(function(a){var d=a[0],f=a[1],a=new c(f);if(f.boundingBox){var g=f.boundingBox.min,h=f.boundingBox.max,f=[h[0]-g[0],h[1]-g[1],h[2]-g[2]],g=[(h[0]+g[0])*0.5,(h[1]+g[1])*0.5,(h[2]+
g[2])*0.5],h=new b;h.xExtent=f[0];h.yExtent=f[1];h.zExtent=f[2];h.center.seta(g);a.modelBound=h;a.autoCompute=!1}if(d)a.currentPose=d;e.setComponent(a);return a})};return f});
define("goo/loaders/JsonUtils","goo/renderer/BufferUtils,goo/math/Transform,goo/math/Matrix3x3,goo/math/Matrix4x4,goo/math/Vector3,goo/math/Quaternion".split(","),function(g,c,b,a,d,e){function f(){}f.fillAttributeBufferFromCompressedString=function(a,b,d,c,e){var b=b.getAttributeBuffer(d),d=c.length,g=a.length/c.length,o,p,n,r,t;for(t=0;t<d;t++)if(c[t]===0)return;for(t=0;t<d;t++)for(r=o=0;r<g;r++)p=a.charCodeAt(r+t*g),n=r*d+t,o+=f.unzip(p),b[n]=(o+e[t])*c[t]};f.fillAttributeBuffer=function(a,b,d){b=
b.getAttributeBuffer(d);for(d=0;d<a.length;d++)b[d]=a[d]};f.getIntBuffer=function(a,b){var d=g.createIndexBuffer(a.length,b);d.set(a);return d};f.rewrap=function(a){a%=61404;a<0&&(a+=61404);return a};f.getIntBufferFromCompressedString=function(a,b){for(var d=0,c=g.createIndexBuffer(a.length,b),e=0;e<a.length;++e){var m=a.charCodeAt(e),d=m=d+f.unzip(m);c[e]=this.rewrap(m)}return c};f.unzip=function(a){a>=57344&&(a-=2048);a-=35;return a>>1^-(a&1)};f.parseTransform=function(a){var b=new c;b.translation=
f.parseVector3(a.translation);b.scale=f.parseVector3(a.scale);b.rotation=f.parseMatrix3(a.rotation);return b};f.parseTransformQuat=function(a){var b=new c;b.translation=f.parseVector3(a.translation);b.scale=f.parseVector3(a.scale);b.rotation=f.parseQuaternion(a.rotation).toRotationMatrix();return b};f.parseTransformEuler=function(a){var b=new c;b.translation=f.parseVector3(a.translation);b.scale=f.parseVector3(a.scale);a=f.parseVector3(a.rotation);b.setRotationXYZ(a.x,a.y,a.z);return b};f.parseTransformMatrix=
function(a){var b=new c;b.matrix=f.parseMatrix4(a.matrix);return b};f.parseMatrix3=function(a){var d=new b;d.e00=a[0];d.e01=a[1];d.e02=a[2];d.e10=a[3];d.e11=a[4];d.e12=a[5];d.e20=a[6];d.e21=a[7];d.e22=a[8];return d};f.parseMatrix4=function(b){var d=new a;d.e00=b[0];d.e01=b[1];d.e02=b[2];d.e03=b[3];d.e10=b[4];d.e11=b[5];d.e12=b[6];d.e13=b[7];d.e20=b[8];d.e21=b[9];d.e22=b[10];d.e23=b[11];d.e30=b[12];d.e31=b[13];d.e32=b[14];d.e33=b[15];return d};f.parseQuaternion=function(a){var b=new e;b.x=a[0];b.y=
a[1];b.z=a[2];b.w=a[3];return b};f.parseVector3=function(a){return new d(a[0],a[1],a[2])};f.parseChannelTimes=function(a,b){var d=a.times;if(d)if(b){var c=a.timeOffsetScale;return f.parseFloatArrayFromCompressedString(d,[c[1]],[c[0]])}else return d;return null};f.parseFloatLERPValues=function(a,b){var d=a.values;if(d)if(b){var c=a.offsetScale;return f.parseFloatArrayFromCompressedString(d,[c[1]],[c[0]])}else return d;return null};f.parseRotationSamples=function(a,b,d){return(a=a.rotationSamples)?
d?(b=1-(b+1>>1),d=1/-b,f.parseFloatArrayFromCompressedString(a,[d,d,d,d],[b,b,b,b])):f.parseQuaternionSamples(a):null};f.parseTranslationSamples=function(a,b,d){var c=a.uniformTranslation;if(c){for(var a=c[0],d=c[1],c=c[2],e=[],g=0;g<b;g++)e[g*3+0]=a,e[g*3+1]=d,e[g*3+2]=c;return e}return(b=a.translationSamples)?d?(a=a.translationOffsetScale,d=a[3],f.parseFloatArrayFromCompressedString(b,[d,d,d],[a[0],a[1],a[2]])):f.parseVector3Samples(b):null};f.parseScaleSamples=function(a,b,d){var c=a.uniformScale;
if(c){for(var a=c,d=a[0],c=a[1],a=a[2],e=[],g=0;g<b;g++)e[g*3+0]=d,e[g*3+1]=c,e[g*3+2]=a;return e}return(b=a.scaleSamples)?d?(a=a.scaleOffsetScale,d=a[0],c=a[1],e=a[2],a=a[3],f.parseFloatArrayFromCompressedString(b,[a,a,a],[d,c,e])):f.parseVector3Samples(b):null};f.parseQuaternionSamples=function(a){if(!a)return null;for(var b=[],d=new e,c=0,f=a.length;c<f;c++){var g=a[c];if(g==="*")b[c*4+0]=d.x,b[c*4+1]=d.y,b[c*4+2]=d.z,b[c*4+3]=d.w;else if(g instanceof Array&&g.length===4)d.set(g[0],g[1],g[2],g[3]),
b[c*4+0]=d.x,b[c*4+1]=d.y,b[c*4+2]=d.z,b[c*4+3]=d.w}return b};f.parseVector3Samples=function(a){if(!a)return null;for(var b=[],c=new d,e=0,f=a.length;e<f;e++){var g=a[e];if(g==="*")b[e*3+0]=c.x,b[e*3+1]=c.y,b[e*3+2]=c.z;else if(g instanceof Array&&g.length===3)c.set(g[0],g[1],g[2]),b[e*3+0]=c.x,b[e*3+1]=c.y,b[e*3+2]=c.z}return b};f.parseFloatArrayFromCompressedString=function(a,b,d){var c=[],e=b.length,g=a.length/b.length,o,p,n,r,t;for(t=0;t<e;t++)for(r=o=0;r<g;r++)p=a.charCodeAt(r+t*g),n=r*e+t,o+=
f.unzip(p),c[n]=(o+d[t])*b[t];return c};return f});define("goo/util/ArrayUtil",[],function(){return{getTypedArray:function(g,c){var b=c[0],a=c[1],d=c[2];if(d==="float32")return new Float32Array(g,b,a);else if(d==="uint8")return new Uint8Array(g,b,a);else if(d==="uint16")return new Uint16Array(g,b,a);else if(d==="uint32")return new Uint32Array(g,b,a);else throw Error("Binary format #{format} is not supported");},remove:function(g,c){var b=g.indexOf(c);b>-1&&g.splice(b,1)}}});
define("goo/loaders/handlers/MeshDataHandler","goo/loaders/handlers/ConfigHandler,goo/renderer/MeshData,goo/animation/SkeletonPose,goo/loaders/JsonUtils,goo/util/PromiseUtil,goo/util/ObjectUtil,goo/util/ArrayUtil".split(","),function(g,c,b,a,d,e,f){function j(){g.apply(this,arguments);this._objects={}}j.prototype=Object.create(g.prototype);g._registerClass("mesh",j);j.prototype.update=function(a,b){var c=this;return this._objects[a]?d.createDummyPromise(this._objects[a]):b.binaryData?this.getConfig(b.binaryData).then(function(d){if(!d)throw Error("Binary mesh data was empty");
return c._createMeshData(b,d).then(function(b){return c._objects[a]=b})}):this._createMeshData(b,null).then(function(b){return c._objects[a]=b})};j.prototype.remove=function(){};j.prototype._createMeshData=function(a,b){var c;a.compression&&a.compression.compressed&&(c={compressedVertsRange:a.compression.compressedVertsRange||16383,compressedColorsRange:a.compression.compressedColorsRange||255,compressedUnitVectorRange:a.compression.compressedUnitVectorRange||1023});var e=this._createMeshDataObject(a);
this._fillMeshData(e,a,b,c);if(a.pose)a.poseRef=a.pose;return d.createDummyPromise(e)};j.prototype._createMeshDataObject=function(a){var b,d,e,f,g;e=a.data||a;a.type==="SkinnedMesh"?(g=4,a=c.SKINMESH):(g=0,a=c.MESH);f=e.vertexCount;if(f===0)return null;d=e.indexLengths!=null?e.indexLengths[0]:e.indices!=null?e.indices.length:0;b={};if(e.vertices&&e.vertices.length>0)b.POSITION=c.createAttribute(3,"Float");if(e.normals&&e.normals.length>0)b.NORMAL=c.createAttribute(3,"Float");if(e.tangents&&e.tangents.length>
0)b.TANGENT=c.createAttribute(4,"Float");if(e.colors&&e.colors.length>0)b.COLOR=c.createAttribute(4,"Float");if(g>0&&e.weights)b.WEIGHTS=c.createAttribute(4,"Float");if(g>0&&e.joints)b.JOINTIDS=c.createAttribute(4,"Short");if(e.textureCoords&&e.textureCoords.length>0)for(g=0;g<e.textureCoords.length;g++)b["TEXCOORD"+g]=c.createAttribute(2,"Float");e=new c(b,f,d);e.type=a;return e};j.prototype._fillMeshData=function(b,d,e,g){var j=this,o=d.data||d,p;p=b.type===c.SKINMESH?4:0;var n=function(c,n){var o;
n!=null&&n.length&&(g&&typeof n==="string"?(o=j._getCompressionOptions(c,d,g),a.fillAttributeBufferFromCompressedString(n,b,c,o.scale,o.offset)):e?b.getAttributeBuffer(c).set(f.getTypedArray(e,n)):a.fillAttributeBuffer(n,b,c))};n(c.POSITION,o.vertices);n(c.NORMAL,o.normals);n(c.TANGENT,o.tangents);n(c.COLOR,o.colors);b.type===c.SKINMESH&&n(c.WEIGHTS,o.weights);if(o.textureCoords!=null&&o.textureCoords.length>0)for(var r=o.textureCoords,t=0;t<r.length;t++){var q=r[t];n("TEXCOORD"+t,q.UVs||q)}if(p>
0&&o.joints!=null&&o.joints.length>0)if(n=b.getAttributeBuffer(c.JOINTIDS),r=this._getIntBuffer(o.joints,32767,e,g),b.type===c.SKINMESH){for(var t=[],v=q=0;v<r.length;v++){var y=r[v];t[y]===void 0&&(t[y]=q++);n.set([t[y]],v)}n=[];for(y=0;y<t.length;y++)q=t[y],q!==null&&(n[q]=y);b.paletteMap=n;b.weightsPerVertex=p}else for(p=0;0<r.capacity();p++)n.putCast(p,r.get(p));o.indices&&b.getIndexBuffer().set(this._getIntBuffer(o.indices,o.vertexCount,e,g));if(o.indexModes)b.indexModes=o.indexModes.slice(0);
if(o.indexLengths)b.indexLengths=o.indexLengths.slice(0);if(o.boundingBox)b.boundingBox=o.boundingBox;return b};j.prototype._getIntBuffer=function(b,d,c,e){return b?e?a.getIntBufferFromCompressedString(b,d):c?f.getTypedArray(c,b):a.getIntBuffer(b,d):null};j.prototype._getCompressionOptions=function(a,b,d){var e,b=b.data||b;a===c.POSITION?(d=b.vertexOffsets,e={offset:[d.xOffset,d.yOffset,d.zOffset],scale:[b.vertexScale,b.vertexScale,b.vertexScale]}):a===c.WEIGHTS?(d=1/d.compressedVertsRange,e={offset:[0],
scale:[d]}):a===c.NORMAL?(b=1-(d.compressedUnitVectorRange+1>>1),d=1/-b,e={offset:[b,b,b],scale:[d,d,d]}):a===c.TANGENT?(b=1-(d.compressedUnitVectorRange+1>>1),d=1/-b,e={offset:[b,b,b,b],scale:[d,d,d,d]}):a===c.COLOR?(b=0,d=1/(d.compressedColorsRange+1),e={offset:[b,b,b,b],scale:[d,d,d,d]}):a.substr(0,8)==="TEXCOORD"&&(d=parseInt(a.substr(8)),d=b.textureCoords[d],e={offset:d.UVOffsets,scale:d.UVScales});return e};return j});
define("goo/loaders/handlers/MeshRendererComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshRendererComponent","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(g,c,b,a,d){function e(){g.apply(this,arguments)}e.prototype=Object.create(g.prototype);g._registerClass("meshRenderer",e);e.prototype._prepare=function(a){return d.defaults(a,{materialRefs:[],cullMode:"Dynamic",castShadows:!1,receiveShadows:!1})};e.prototype._create=function(a){var b=
new c;a.setComponent(b);return b};e.prototype.update=function(c,e){var h,k=g.prototype.update.call(this,c,e);h=e.materialRefs;if(!h||h.length===0)console.log("No material refs"),h=a.createDummyPromise([]);else{for(var i=[],l=0;l<h.length;l++)i.push(this._getMaterial(h[l]));h=b.all(i)}return h.then(function(a){var b;k.materials=a;for(b in e)a=e[b],b!=="materials"&&k.hasOwnProperty(b)&&(k[b]=d.clone(a));return k}).then(null,function(a){return console.error("Error handling materials "+a)})};e.prototype._getMaterial=
function(a){var b=this;return this.getConfig(a).then(function(d){return b.updateObject(a,d,b.options)})};return e});
define("goo/loaders/handlers/SceneHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp"],function(g,c){function b(){g.apply(this,arguments)}b.prototype=Object.create(g.prototype);g._registerClass("scene",b);b.prototype._prepare=function(){};b.prototype._create=function(){};b.prototype.update=function(a,b){var e=this,f=[];if(b.entityRefs!=null&&b.entityRefs.length){for(var g=function(a){return f.push(e.getConfig(a).then(function(b){return e.updateObject(a,b,e.options)}))},h=0;h<b.entityRefs.length;h++)g(b.entityRefs[h]);
return c.all(f).then(function(a){for(var b=0;b<a.length;b++){var d=a[b];(e.options.beforeAdd==null||e.options.beforeAdd.apply==null||e.options.beforeAdd(d))&&d.addToWorld()}}).then(null,function(a){return console.error("Error updating entities: "+a)})}else return console.warn("No entity refs in scene "+a),b};b.prototype.remove=function(){};return b});
define("goo/loaders/handlers/ShaderHandler","goo/loaders/handlers/ConfigHandler,goo/renderer/Material,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderLib,goo/renderer/shaders/ShaderBuilder,goo/util/rsvp,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e,f,j){function h(){g.apply(this,arguments)}h.prototype=Object.create(g.prototype);g._registerClass("shader",h);h.prototype._create=function(){};h.prototype.update=function(a,b){var d;if(b!=null&&b.attributes!=null&&b.uniforms!=
null){d={attributes:b.attributes,uniforms:b.uniforms};for(var g in d.uniforms){var h=d.uniforms[g];if(typeof h==="string"&&(h=h.match(/^function\s?\(([^\)]*)\)\s*\{(.*)\}$/),(h!=null?h.length:void 0)===3)){var p=h[1].replace(" ","").split(",");d.uniforms[g]=new Function(p,h[2])}}if(b.processors){d.processors=[];for(g=0;g<b.processors.length;g++)if(h=b.processors[g],e[h])d.processors.push(e[h].processor);else throw Error("Unknown processor: "+h);}if(b.defines)d.defines=b.defines}else d=this._getDefaultShaderDefinition();
g=[this.getConfig(b.vshaderRef),this.getConfig(b.fshaderRef)];return f.all(g).then(function(e){var f;f=e[0];e=e[1];if(f)if(e)return j.extend(d,{attributes:b.attributes||{},uniforms:b.uniforms||{},vshader:f,fshader:e}),c.createShader(d,a);else console.warn("Fragment shader",b.fshaderRef,"in shader",a,"not found");else console.warn("Vertex shader",b.vshaderRef,"in shader",a,"not found")})};h.prototype.remove=function(){};h.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:b.POSITION,
vertexNormal:b.NORMAL,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,cameraPosition:a.CAMERA,lightPosition:a.LIGHT0,diffuseMap:a.DIFFUSE_MAP,materialAmbient:a.AMBIENT,materialDiffuse:a.DIFFUSE,materialSpecular:a.SPECULAR,materialSpecularPower:a.SPECULAR_POWER}}};return h});
define("goo/loaders/handlers/SkeletonHandler","goo/loaders/handlers/ConfigHandler,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/loaders/JsonUtils,goo/util/PromiseUtil".split(","),function(g,c,b,a,d,e){function f(){g.apply(this,arguments)}f.prototype=Object.create(g.prototype);g._registerClass("skeleton",f);f.prototype._create=function(e){for(var f=[],g=0;g<e.joints.length;g++){var i=e.joints[g],l=new c(i.name);l._index=Math.round(i.index);l._parentIndex=Math.round(i.parentIndex);
l._inverseBindPose.copy((i.inverseBindPose.matrix?d.parseTransformMatrix:i.inverseBindPose.rotation.length===4?d.parseTransformQuat:i.inverseBindPose.rotation.length===3?d.parseTransformEuler:d.parseTransform)(i.inverseBindPose));i.inverseBindPose.matrix||l._inverseBindPose.update();f.push(l)}e=new b(e.name,f);e=new a(e);e.setToBindPose();return e};f.prototype.update=function(a,b){var d=this._create(b);return e.createDummyPromise(d)};f.prototype.remove=function(){};return f});
define("goo/loaders/handlers/TextureHandler","goo/loaders/handlers/ConfigHandler,goo/renderer/TextureCreator,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/tga/TgaLoader,goo/util/rsvp,goo/util/PromiseUtil,goo/renderer/Util,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e,f,j,h){function k(){g.apply(this,arguments);this._objects={}}k.prototype=Object.create(g.prototype);g._registerClass("texture",k);k.loaders={dds:a,tga:d};k.prototype._create=function(a,d){h.defaults(d,{verticalFlip:!0});
var e={wrapS:d.wrapU,wrapT:d.wrapV,magFilter:d.magFilter,minFilter:d.minFilter,repeat:d.repeat,offset:d.offset},e=this._objects[a]=new b(j.clone(c.DEFAULT_TEXTURE_2D.image),e);e.image.dataReady=!1;return e};k.prototype.update=function(a,b){var d=b.url,g=d!=null?d.split(".").pop().toLowerCase():void 0,h;if(g==="mp4")return d=new e.Promise,h=(new c).loadTextureVideo(b.url,!0),f.createDummyPromise(h);else{(h=this._objects[a])||(h=this._create(a,b));if(!b.url)return console.log("Texture "+a+" has no url"),
f.createDummyPromise(h);if(g in k.loaders){var j=new k.loaders[g];h.a=d;d=this.getConfig(d).then(function(a){j.load(a,h,b.verticalFlip,0,a.byteLength);return h}).then(null,function(a){return console.error("Error loading texture: ",a)})}else if(g==="jpg"||g==="jpeg"||g==="png"||g==="gif")d=this.getConfig(d).then(function(a){h.setImage(a);return h}).then(null,function(a){return console.error("Error loading texture: ",a)});else throw Error("Unknown texture type "+g);}return this.options!=null&&this.options.dontWaitForTextures?
f.createDummyPromise(h):d};k.prototype.remove=function(a){console.log("Deleting texture "+a);return delete this._objects[a]};return k});
define("goo/loaders/handlers/TransformComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/TransformComponent,goo/math/MathUtils,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,c,b,a,d,e){function f(){g.apply(this,arguments)}f.prototype=Object.create(g.prototype);g._registerClass("transform",f);f.prototype._prepare=function(a){return e.defaults(a,{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})};f.prototype._create=function(a){var b=new c;
a.setComponent(b);return b};f.prototype.update=function(a,c){var e=this,f=g.prototype.update.call(this,a,c);f.transform.translation.set(c.translation);c.rotation.length===3?f.transform.setRotationXYZ(b.radFromDeg(c.rotation[0]),b.radFromDeg(c.rotation[1]),b.radFromDeg(c.rotation[2])):f.transform.rotation.set(c.rotation);f.transform.scale.set(c.scale);c.parentRef!=null&&this.getConfig(c.parentRef).then(function(a){return e.updateObject(c.parentRef,a,e.options).then(function(a){if(a!=null){var b=f.parent;
if(b==null||b.entity!==a)return a.transformComponent.attachChild(f)}else return console.warn("Could not find parent with ref "+c.parentRef)})});f.setUpdated();return d.createDummyPromise(f)};f.prototype.remove=function(a){a=a.transformComponent;a.transform.translation.set(0,0,0);a.transform.setRotationXYZ(0,0,0);a.transform.scale.set(1,1,1);a.setUpdated()};return f});
define("goo/loaders/handlers/AnimationComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/AnimationComponent,goo/math/MathUtils,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,c,b,a,d){function e(){g.apply(this,arguments)}e.prototype=Object.create(g.prototype);g._registerClass("animation",e);e.prototype._prepare=function(){};e.prototype._create=function(a){var b=new c;a.setComponent(b);return b};e.prototype.update=function(b,c){var e=this,
k,i=g.prototype.update.call(this,b,c),l=c.layersRef,m=c.poseRef,o=[];m?k=this.getConfig(m).then(function(a){e.updateObject(m,a,e.options).then(function(a){return i._skeletonPose=a})}):(console.warn("No skeleton pose ref"),k=d.createDummyPromise());o.push(k);l?k=this._getAnimationLayers(l).then(function(a){return i.layers=a}):(console.warn("No animation tree ref"),k=d.createDummyPromise([]));o.push(k);return a.all(o).then(function(){return i})};e.prototype._getAnimationLayers=function(a){var b=this;
return this.getConfig(a).then(function(d){return b.updateObject(a,d,b.options)})};return e});
define("goo/loaders/handlers/AnimationLayersHandler","goo/loaders/handlers/ConfigHandler,goo/animation/layer/AnimationLayer,goo/animation/layer/LayerLERPBlender,goo/animation/state/SteadyState,goo/animation/blendtree/ClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/FrozenClipSource,goo/animation/state/FadeTransitionState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/FrozenTransitionState,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(g,
c,b,a,d,e,f,j,h,k,i,l,m,o){function p(){g.apply(this,arguments)}p.prototype=Object.create(g);g._registerClass("animation",p);p.prototype._create=function(a){var b=[];b.push(this._parseLayer(a.DEFAULT));for(var d in a){var c=a[d];d!=="DEFAULT"&&b.push(this._parseLayer(c))}return l.all(b).then(function(a){return a})};p.prototype._parseLayer=function(d){var e=this,f=[],g=new c(d.name);if(d.blendWeight!=null)g._layerBlender=new b,g._layerBlender._blendWeight=d.blendWeight;var h=function(a){return f.push(e._parseClipSource(j.clipSource).then(function(b){return a._sourceTree=
b}))},i;for(i in d.states){var j=d.states[i],k=new a(j.name);g._steadyStates[i]=k;h(k);if(j.transitions!=null)for(var m in j.transitions)if(k=j.transitions[m],g._steadyStates[m]!=null||m==="*")k=o.clone(k),g._steadyStates[i]._transitions[m]=k,g._transitionStates[k.type]==null&&(g._transitionStates[k.type]=this._getTransitionByType(k.type))}if(d.transitions!=null)for(m in d.transitions)if(k=d.transitions[m],g._steadyStates[m]!=null||m==="*")k=o.clone(k),g._transitions[m]=k,g._transitionStates[k.type]==
null&&(g._transitionStates[k.type]=this._getTransitionByType(k.type));d.defaultState!=null&&g.setCurrentStateByName(d.defaultState);return l.all(f).then(function(){return g})};p.prototype._parseClipSource=function(a){var b=this;switch(a.type){case "Clip":return this.getConfig(a.clipRef).then(function(c){return b.updateObject(a.clipRef,c,b.options).then(function(b){for(var b=new d(b,a.filter,a.channels),c=["loopCount","timeScale","active"],e=0;e<c.length;e++){var f=c[e];a[f]&&!isNaN(a[f])&&(b._clipInstance["_"+
f]=a[f])}return b})});case "Managed":var c=new e;return a.clipRef!=null?this.getConfig(a.clipRef).then(function(d){return b.updateObject(a.clipRef,d,b.options)}).then(function(b){return c.initJointsById(b,a.joints)}):m.createDummyPromise(c);case "Lerp":var g=[this._parseClipSource(a.clipSourceA),this._parseClipSource(a.clipSourceB)];return l.all(g).then(function(b){b=new f(b[0],b[1]);if(a.blendWeight)b.blendWeight=a.blendWeight;return b});case "Frozen":return this._parseClipSource(a.clipSource).then(function(b){return new j(b,
a.frozenTime||0)});default:return console.error("Unable to parse clip source"),m.createDummyPromise()}};p.prototype._getTransitionByType=function(a){switch(a){case "Fade":return new h;case "SyncFade":return new k;case "Frozen":return new i;default:return console.log("Defaulting to frozen transition type"),new i}};p.prototype.update=function(a,b){var d=this._create(b);return m.createDummyPromise(d)};return p});
define("goo/loaders/handlers/AnimationClipHandler","goo/loaders/handlers/ConfigHandler,goo/animation/clip/AnimationClip,goo/loaders/JsonUtils,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/clip/TriggerChannel,goo/util/PromiseUtil,goo/util/ArrayUtil".split(","),function(g,c,b,a,d,e,f,j,h){function k(){g.apply(this,arguments)}k.prototype=Object.create(g.prototype);g._registerClass("clip",k);k.prototype.update=function(a,
b){var d,c=this;return b.binaryData?this.getConfig(b.binaryData).then(function(a){if(!a)throw Error("Binary clip data was empty");return c._createAnimationClip(b,a)}):(d=this._createAnimationClip(b),j.createDummyPromise(d))};k.prototype._createAnimationClip=function(g,j){var k=new c(g.name),o=g.useCompression||!1,p=null;o&&(p=g.compressedRange||32767);if(g.channels&&g.channels.length)for(var n=0;n<g.channels.length;n++){var r,t,q,v,y,s=g.channels[n];r=j?h.getTypedArray(j,s.times):new Float32Array(b.parseChannelTimes(s,
o));y=s.blendType;var u=s.type;if(u==="Joint"||u==="Transform")j?(t=h.getTypedArray(j,s.rotationSamples),q=h.getTypedArray(j,s.translationSamples),v=h.getTypedArray(j,s.scaleSamples)):(t=b.parseRotationSamples(s,p,o),q=b.parseTranslationSamples(s,r.length,o),v=b.parseScaleSamples(s,r.length,o));if(u==="Joint")r=new a(s.jointName,s.jointIndex,r,t,q,v,y);else if(s.type==="Transform")r=new d(s.name,r,t,q,v,y);else if(s.type==="FloatLERP")r=new e(s.name,r,b.parseFloatLERPValues(s,o),y);else if(s.type===
"Trigger"){if(r=new f(s.name,r,s.keys),s.guarantee)r.guarantee=!0}else{console.warn("Unhandled channel type: "+s.type);continue}k.addChannel(r)}return k};return k});
define("goo/loaders/DynamicLoader","goo/loaders/handlers/ConfigHandler,goo/loaders/handlers/ComponentHandler,goo/util/Ajax,goo/renderer/TextureCreator,goo/util/rsvp,goo/util/StringUtil,goo/util/PromiseUtil,goo/util/ObjectUtil,goo/loaders/handlers/CameraComponentHandler,goo/loaders/handlers/EntityHandler,goo/loaders/handlers/LightComponentHandler,goo/loaders/handlers/MaterialHandler,goo/loaders/handlers/MeshDataComponentHandler,goo/loaders/handlers/MeshDataHandler,goo/loaders/handlers/MeshRendererComponentHandler,goo/loaders/handlers/SceneHandler,goo/loaders/handlers/ShaderHandler,goo/loaders/handlers/SkeletonHandler,goo/loaders/handlers/TextureHandler,goo/loaders/handlers/TransformComponentHandler,goo/loaders/handlers/AnimationComponentHandler,goo/loaders/handlers/AnimationLayersHandler,goo/loaders/handlers/AnimationClipHandler".split(","),function(g,
c,b,a,d,e,f,j){function h(a){this.options=a;j.defaults(this.options,{ajax:!0});if(this.options.world)this._world=this.options.world;else throw Error("World argument cannot be null");if(this.options.rootPath)this.setRootPath(this.options.rootPath);else throw Error("parameters.rootPath must be defined");this._configs={};if(this.options.ajax)this._ajax=new b}var k,i;k=/\.(shader|script|entity|material|scene|mesh|texture|skeleton|animation|clip|bundle)$/;i=j.keys(g.getHandler("texture").loaders);h.prototype.preloadCache=
function(a,b){b==null&&(b=!1);return b?this._configs=a:j.extend(this._configs,a)};h.prototype.loadFromConfig=function(a,b,d){d==null&&(d={});j.defaults(d,this.options);if(b!=null)d.noCache?this._configs=b:j.extend(this._configs,b);if(this._configs[a])throw Error(""+a+" not found in the supplied configs Available keys: \n"+j.keys(this._configs).join("\n"));return this.load(a,d)};h.prototype.loadFromBundle=function(a,b,d){var c=this;d==null&&(d={});j.defaults(d,this.options);return this._loadRef(b).then(function(e){d.noCache?
c._configs=e:j.extend(c._configs,e);if(c._configs[a]==null)throw Error(""+a+" not found in bundle "+b+". Available keys: \n"+j.keys(c._configs).join("\n"));return c.load(a,d)})};h.prototype.load=function(a,b){b==null&&(b={});return this.update(a,null,b)};h.prototype.update=function(a,b,c){var e=this;c==null&&(c={});j.defaults(c,this.options,{recursive:!0});b&&(this._configs[a]=b);this._objects={};g.getHandler(e._getTypeForRef(a));return this._loadRef(a).then(function(b){var f=0,h=[];if(c.recursive&&
g.getHandler(e._getTypeForRef(a)))for(var i=e._getRefsFromConfig(b),j=function(a){return h.push(e._loadRef(a).then(function(b){f++;c.progressCallback&&c.progressCallback.call&&c.progressCallback.call(null,f,h.length);return e._handle(a,b,c)}))},k=0;k<i.length;k++)j(i[k]);h.push(e._handle(a,b,c));return d.all(h)}).then(function(){return e._configs}).then(null,function(b){return console.error("Error updating "+a+" "+b)})};h.prototype.remove=function(a){delete this._objects[a];delete this._configs[a];
return this._handle(a,null)};h.prototype._handle=function(a,b,d){var c=this,e,h,i;d==null&&(d={});if(this._objects[a])if(this._objects[a].then)return this._objects[a];else{if(!d.noCache)return f.createDummyPromise(this._objects[a])}else if(i=this._getTypeForRef(a),h=g.getHandler(i)){if(this._handlers==null)this._handlers={};(e=this._handlers[i])?j.extend(e,{world:this._world,getConfig:this._loadRef.bind(this),updateObject:this._handle.bind(this),options:j.clone(d)}):e=this._handlers[i]=new h(this._world,
this._loadRef.bind(this),this._handle.bind(this),d);return b!=null?this._objects[a]=e.update(a,b).then(function(b){return c._objects[a]=b}):(e.remove(a),f.createDummyPromise(null))}else return console.warn("No handler for type "+i),f.createDummyPromise(null)};h.prototype._loadRef=function(a,d){var c,e=this;d==null&&(d=!1);if(this._configs[a]){if(this._configs[a].then)return this._configs[a];if(!d)return f.createDummyPromise(this._configs[a])}if(!this._ajax)return f.createDummyPromise(null);c=this._rootPath+
window.escape(a);c=this._isImageRef(a)?this._ajax.loadImage(c):this._isBinaryRef(a)?this._ajax.load(c,b.ARRAY_BUFFER):this._ajax.load(c);c=c.then(function(b){return k.test(a)?e._configs[a]=JSON.parse(b):e._configs[a]=b}).then(null,function(b){delete e._configs[a];return b});return this._configs[a]=c};h.prototype._getRefsFromConfig=function(a){var b=[],d=function(a,c){var f;if(e.endsWith(a,"Refs"))b=b.concat(c);else if(e.endsWith(a,"Ref"))b.push(c);else if(c instanceof Object)for(f in c)c.hasOwnProperty(f)&&
d(f,c[f])};d("",a);return b};h.prototype._getTypeForRef=function(a){return a.split(".").pop().toLowerCase()};h.prototype._isImageRef=function(a){a=this._getTypeForRef(a);return a==="png"||a==="jpg"||a==="jpeg"};h.prototype._isBinaryRef=function(a){a=this._getTypeForRef(a);return j.indexOf(i,a)>=0||a==="dat"};h.prototype.getCachedObjectForRef=function(a){return this._objects[a]};h.prototype.setRootPath=function(a){this._rootPath=a;a.length>1&&a.charAt(a.length-1)!=="/"&&(this._rootPath+="/")};return h});
define("goo/loaders/ShaderLoader",["goo/util/rsvp","goo/renderer/MeshData","goo/renderer/Shader","goo/loaders/Loader","goo/renderer/shaders/ShaderBuilder"],function(g,c,b,a,d){function e(b){if(typeof b==="undefined"||b===null)throw Error("ShaderLoader(): Argument `parameters` was undefined/null");if(typeof b.loader==="undefined"||!(b.loader instanceof a)||b.loader===null)throw Error("ShaderLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=b.loader;this._cache={};this._doCache=
b.cacheShader!==void 0?b.cacheShader:!0}e.prototype.load=function(a){if(this._cache[a]&&this._doCache)return this._cache[a];var b=this._parse.bind(this),d=this._loader.load(a,function(a){return b(a)});return this._cache[a]=d};e.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var c=[],e;if(a&&a.attributes&&a.uniforms){e={attributes:a.attributes,uniforms:a.uniforms};for(var k in e.uniforms)if(e.uniforms.hasOwnProperty(k)){var i=e.uniforms[k];if(typeof i==="string"&&(i=i.match(/^function\s?\(([^\)]+)\)\s*\{(.*)}$/))&&
i.length===3){var l=i[1].replace(" ","").split(",");e.uniforms[k]=new Function(l,i[2])}}if(a.defines)e.defines=a.defines;if(a.processors){e.processors=[];for(k=0;k<a.processors.length;k++)e.processors.push(d[a.processors[k]].processor)}}else e=this._getDefaultShaderDefinition();a&&a.vshaderRef&&a.fshaderRef&&(k=this._loader.load(a.vshaderRef).then(function(a){return e.vshader=a}),c.push(k),k=this._loader.load(a.fshaderRef).then(function(a){return e.fshader=a}),c.push(k));return c.length===0?(k=new g.Promise,
k.reject("Shader definition `"+a+"` does not seem to contain any shader data."),k):g.all(c).then(function(){return new b(a.name,e)})};e.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:c.POSITION,vertexNormal:c.NORMAL,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,lightPosition:b.LIGHT0,diffuseMap:b.DIFFUSE_MAP,materialAmbient:b.AMBIENT,materialDiffuse:b.DIFFUSE,materialSpecular:b.SPECULAR,
materialSpecularPower:b.SPECULAR_POWER}}};return e});
define("goo/loaders/MaterialLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/loaders/ShaderLoader,goo/renderer/shaders/ShaderLib".split(","),function(g,c,b,a,d,e,f,j){function h(a){if(typeof a==="undefined"||a===null)throw Error("MaterialLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("MaterialLoader(): Argument `parameters.loader` was invalid/undefined/null");
this._loader=a.loader;this._cache={};this._shaderLoader=new f(a);this._waitForTextures=a.waitForTextures!==void 0?a.waitForTextures:!0}h.prototype.load=function(a){if(this._cache[a])return this._cache[a];var b=this,c=this._loader.load(a,function(a){return b._parse(a)}).then(null,function(){return d.createMaterial(j.texturedLit,"DefaultShader")});return this._cache[a]=c};h.prototype._parse=function(b){function c(b,d){typeof d==="string"&&(d=JSON.parse(d));if(d.url){var f=new a({loader:e._loader});
if(e._waitForTextures){var h=new g.Promise;n[b]=f.loadTexture2D(d.url,null,function(){h.resolve()});return h}else n[b]=f.loadTexture2D(d.url)}else n[b]=null}typeof b==="string"&&(b=JSON.parse(b));var e=this,f=[],h,p={},n={},r=b.name||"DefaultMaterial";if(b){var t;(t=b.shaderRef)?t=this._shaderLoader.load(t).then(function(a){return h=a}):(t=new g.Promise,t.then(function(a){return h=a}),t.resolve(d.createShader(j.texturedLit,"DefaultShader")));f.push(t);if(b.uniforms)for(var q in b.uniforms)p[q]=b.uniforms[q];
if(b.texturesMapping&&Object.keys(b.texturesMapping).length)for(q in b.texturesMapping){t=b.texturesMapping[q];var v=c.bind(null,q);t=this._loader.load(t).then(v);f.push(t)}else if(b.textureRefs&&b.textureRefs.length){q=["DIFFUSE_MAP","NORMAL_MAP","SPECULAR_MAP"];for(var y=Math.min(b.textureRefs.length,q.length),s=0;s<y;s++)t=b.textureRefs[s],v=c.bind(null,q[s]),t=this._loader.load(t).then(v),f.push(t)}}return f.length===0?(t=new g.Promise,t.reject("Material definition `"+b+"` does not seem to contain a shader definition."),
t):g.all(f).then(function(){var a=new d(r);a.shader=h;a._textureMaps=n;a.materialState=void 0;a.uniforms=p;if(b){var c=function(a,b){if(b)for(var d in b)a[d]=b[d]};c(a.cullState,b.cullState);c(a.blendState,b.blendState);c(a.depthState,b.depthState);c(a.offsetState,b.offsetState);if(typeof b.renderQueue==="number"&&b.renderQueue>-1)a.renderQueue=b.renderQueue;if(typeof b.wireframe==="boolean")a.wireframe=b.wireframe}return a})};h.prototype._getDefaultMaterialState=function(){return{ambient:[0.1,0.1,
0.1,1],emissive:[0,0,0,0],diffuse:[1,1,1,1],specular:[0.8,0.8,0.8,1],shininess:16}};return h});
define("goo/loaders/SkeletonLoader",["goo/animation/Skeleton","goo/animation/SkeletonPose","goo/animation/Joint","goo/loaders/Loader","goo/loaders/JsonUtils"],function(g,c,b,a,d){function e(a){if(typeof a==="undefined"||a===null)throw Error("SkeletonLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||a.loader===null)throw Error("SkeletonLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}e.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var b=e.prototype._loadSkeleton.bind(this),d=e.prototype._parseSkeleton.bind(this),c=e.prototype._createSkeletonPose.bind(this),b=b(a).then(d).then(c);return this._cache[a]=b};e.prototype._loadSkeleton=function(a){return this._loader.load(a)};e.prototype._parseSkeleton=function(a){typeof a==="string"&&(a=JSON.parse(a));for(var c=a.Name,a=a.Joints,e=[],k=0,i=a.length;k<i;k++){var l=a[k],m=new b(l.Name);m._index=Math.round(l.Index);m._parentIndex=Math.round(l.ParentIndex);l.InverseBindPose.Matrix?m._inverseBindPose.copy(d.parseTransformMatrix(l.InverseBindPose)):
(l.InverseBindPose.Rotation.length===4?m._inverseBindPose.copy(d.parseTransformQuat(l.InverseBindPose)):l.InverseBindPose.Rotation.length===3?m._inverseBindPose.copy(d.parseTransformEuler(l.InverseBindPose)):m._inverseBindPose.copy(d.parseTransform(l.InverseBindPose)),m._inverseBindPose.update());e[k]=m}return new g(c,e)};e.prototype._createSkeletonPose=function(a){a=new c(a);a.setToBindPose();return a};return e});
define("goo/loaders/MeshLoader",["goo/util/rsvp","goo/loaders/JsonUtils","goo/renderer/MeshData","goo/loaders/SkeletonLoader"],function(g,c,b,a){function d(b){if(typeof b==="undefined"||b===null)throw Error("MeshLoader(): Argument `parameters` was undefined/null");if(typeof b.loader==="undefined"||b.loader===null)throw Error("MeshLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=b.loader;this._skeletonLoader=new a(b);this._cache={}}d.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var b=this,d=this._loader.load(a,function(a){return b._parse(a)});return this._cache[a]=d};d.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var d=new g.Promise;try{if(Object.keys(a).length===0)return d.reject("Empty meshdata"),d;if(a.compression)this.useCompression=a.compression.compressed||!1,this.compressedVertsRange=a.compression.compressedVertsRange||16383,this.compressedColorsRange=a.compression.compressedColorsRange||255,this.compressedUnitVectorRange=a.compression.compressedUnitVectorRange||
1023;var c=a.type==="SkinnedMesh"?"SkinnedMesh":"Mesh",h;a.type==="SkinnedMesh"?(h=this._parseMeshData(a.data||a,4,c),h.type=b.SKINMESH):(h=this._parseMeshData(a.data||a,0,c),h.type=b.MESH);a.pose?d=this._skeletonLoader.load(a.pose).then(function(a){h.currentPose=a;return h}):d.resolve(h)}catch(k){d.reject(k)}return d};d.prototype._parseMeshData=function(a,d,g){var h=a.vertexCount;if(h===0)return null;var k=a.indexLengths?a.indexLengths[0]:a.indices?a.indices.length:0,i={};if(a.vertices&&a.vertices.length>
0)i.POSITION=b.createAttribute(3,"Float");if(a.normals&&a.normals.length>0)i.NORMAL=b.createAttribute(3,"Float");if(a.tangents&&a.tangents.length>0)i.TANGENT=b.createAttribute(4,"Float");if(a.colors&&a.colors.length>0)i.COLOR=b.createAttribute(4,"Float");if(d>0&&a.weights)i.WEIGHTS=b.createAttribute(4,"Float");if(d>0&&a.joints)i.JOINTIDS=b.createAttribute(4,"Short");if(a.textureCoords&&a.textureCoords.length>0)for(var l in a.textureCoords)i["TEXCOORD"+l]=b.createAttribute(2,"Float");k=new b(i,h,k);
if(a.vertices&&a.vertices.length>0)this.useCompression?(l=a.vertexOffsets,c.fillAttributeBufferFromCompressedString(a.vertices,k,b.POSITION,[a.vertexScale,a.vertexScale,a.vertexScale],[l.xOffset,l.yOffset,l.zOffset])):c.fillAttributeBuffer(a.vertices,k,b.POSITION);d>0&&a.weights&&(this.useCompression?(i=1/this.compressedVertsRange,c.fillAttributeBufferFromCompressedString(a.weights,k,b.WEIGHTS,[i],[0])):c.fillAttributeBuffer(a.weights,k,b.WEIGHTS));a.normals&&a.normals.length>0&&(this.useCompression?
(l=1-(this.compressedUnitVectorRange+1>>1),i=1/-l,c.fillAttributeBufferFromCompressedString(a.normals,k,b.NORMAL,[i,i,i],[l,l,l])):c.fillAttributeBuffer(a.normals,k,b.NORMAL));a.tangents&&a.tangents.length>0&&(this.useCompression?(l=1-(this.compressedUnitVectorRange+1>>1),i=1/-l,c.fillAttributeBufferFromCompressedString(a.tangents,k,b.TANGENT,[i,i,i,i],[l,l,l,l])):c.fillAttributeBuffer(a.tangents,k,b.TANGENT));a.colors&&a.colors.length>0&&(this.useCompression?(l=0,i=255/(this.compressedColorsRange+
1),c.fillAttributeBufferFromCompressedString(a.colors,k,b.COLOR,[i,i,i,i],[l,l,l,l])):c.fillAttributeBuffer(a.colors,k,b.COLOR));if(a.textureCoords&&a.textureCoords.length>0)if(i=a.textureCoords,this.useCompression)for(l=0;l<i.length;l++){var m=i[l];c.fillAttributeBufferFromCompressedString(m.UVs,k,"TEXCOORD"+l,m.UVScales,m.UVOffsets)}else for(l=0;l<i.length;l++)c.fillAttributeBuffer(i[l],k,"TEXCOORD"+l);if(d>0&&a.joints)if(i=k.getAttributeBuffer(b.JOINTIDS),m=this.useCompression?c.getIntBufferFromCompressedString(a.joints,
32767):c.getIntBuffer(a.joints,32767),g==="SkinnedMesh"){var g=[],o=0;l=0;for(var p=m.length;l<p;l++){var n=m[l];g[n]===void 0&&(g[n]=o++);i.set([g[n]],l)}l=[];for(n=0;n<g.length;n++)o=g[n],o!==void 0&&(l[o]=n);k.paletteMap=l;k.weightsPerVertex=d}else{l=0;for(p=m.capacity();l<p;l++)i.putCast(l,m.get(l))}a.indices&&(this.useCompression?k.getIndexBuffer().set(c.getIntBufferFromCompressedString(a.indices,h)):k.getIndexBuffer().set(c.getIntBuffer(a.indices,h)));if(a.indexModes)if(d=a.indexModes,d.length===
1)k.indexModes[0]=d[0];else{h=[];for(l=0;l<d.length;l++)h[l]=d[l];k.indexModes=h}if(a.indexLengths){d=a.indexLengths;h=[];for(l=0;l<d.length;l++)h[l]=d[l];k.indexLengths=h}if(a.boundingBox)k.boundingBox=a.boundingBox;return k};return d});
define("goo/loaders/EntityLoader","goo/entities/Entity,goo/renderer/Camera,goo/entities/components/CameraComponent,goo/entities/components/TransformComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/MeshDataComponent,goo/renderer/MeshData,goo/math/Vector3,goo/math/MathUtils,goo/renderer/bounds/BoundingBox,goo/util/rsvp,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/Loader".split(","),function(g,c,b,a,d,e,f,j,h,k,i,l,m,o){function p(a){if(typeof a==="undefined"||
a===null)throw Error("EntityLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof o)||a.loader===null)throw Error("EntityLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("EntityLoader(): Argument `parameters.world` was undefined/null");this._loader=a.loader;this._world=a.world;this._cache={};this._materialLoader=new l(a);this._meshLoader=new m(a)}p.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var b=this._loader.load(a,function(b){return this._parse(b,a)}.bind(this));return this._cache[a]=b};p.prototype._parse=function(a,b){typeof a==="string"&&(a=JSON.parse(a));var d=[],c=[],e=this;if(a.components){var h;(h=a.components.transform)&&c.push(this._getTransformComponent(h));(h=a.components.camera)&&c.push(this._getCameraComponent(h));if(h=a.components.meshRenderer)h=this._getMeshRendererComponent(h).then(function(a){c.push(a);return a}),d.push(h);if(h=a.components.meshData)h=this._getMeshDataComponent(h).then(function(a){c.push(a);
return a}),d.push(h)}return c.length===0&&d.length===0?(h=new i.Promise,h.reject("Entity definition `"+a+"` does not seem to contain any components."),h):i.all(d).then(function(){var d=new g(e._world,a.name||b);d.ref=b;for(var h in c)c[h].type==="TransformComponent"&&d.clearComponent("transformComponent"),d.setComponent(c[h]);if(d.meshDataComponent&&d.meshDataComponent.meshData.type===f.SKINMESH&&d.meshRendererComponent&&d.meshRendererComponent.materials.length){var i=d.meshRendererComponent.materials,
j;h=0;for(var k=i.length;h<k;h++)if((j=i[h].shader.defines)&&j.JOINT_COUNT!==void 0&&j.WEIGHTS!==void 0)j.JOINT_COUNT=d.meshDataComponent.meshData.paletteMap.length,j.WEIGHTS=d.meshDataComponent.meshData.weightsPerVertex}return d})};p.prototype._getTransformComponent=function(b){var d=new a;d.transform.translation.set(b.translation);d.transform.scale.set(b.scale);d.transform.rotation.fromAngles(h.radFromDeg(b.rotation[0]),h.radFromDeg(b.rotation[1]),h.radFromDeg(b.rotation[2]));(b=b.parentRef)&&this.load(b).then(function(a){a.transformComponent.attachChild(d);
return a});return d};p.prototype._getCameraComponent=function(a){a=new c(a.fov||45,a.aspect||1,a.near||1,a.far||100);return new b(a)};p.prototype._getMeshRendererComponent=function(a){var b=[],c=this._materialLoader,e;for(e in a)if(e==="materialRefs")for(var f in a[e]){var g=c.load(a[e][f]);b.push(g)}return i.all(b).then(function(b){var c=new d,e;for(e in a)c.hasOwnProperty(e)&&e!=="materials"&&(c[e]=a[e]);for(var f in b)c.materials.push(b[f]);return c})};p.prototype._getMeshDataComponent=function(a){var b=
[],d=this._meshLoader,c;for(c in a)if(c==="meshRef"){var f=d.load(a[c]);b.push(f)}return i.all(b).then(function(a){var b=new e(a[0]);if(a[0].boundingBox){var d=a[0].boundingBox.min,c=a[0].boundingBox.max,a=[c[0]-d[0],c[1]-d[1],c[2]-d[2]],d=[(c[0]+d[0])*0.5,(c[1]+d[1])*0.5,(c[2]+d[2])*0.5],c=new k;c.xExtent=a[0];c.yExtent=a[1];c.zExtent=a[2];c.center.seta(d);b.modelBound=c;b.autoCompute=!1}return b})};return p});
define("goo/loaders/SceneLoader",["goo/loaders/Loader","goo/loaders/EntityLoader","goo/util/rsvp"],function(g,c,b){function a(a){if(typeof a==="undefined"||a===null)throw Error("SceneLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof g)||a.loader===null)throw Error("SceneLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("SceneLoader(): Argument `parameters.world` was undefined/null");
this._parameters=a;this._loader=a.loader;this._world=a.world;this._cacheShader=a.cacheShader}a.prototype.load=function(a){var b=this;return this._loader.load(a,function(c){return b._parse(c,a)})};a.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var e=[];if(a&&a.entityRefs&&a.entityRefs.length)for(var f=new c(this._parameters),g=0;g<a.entityRefs.length;++g)e.push(f.load(a.entityRefs[g]));this.globals=a.globals;return b.all(e).then(function(a){return a})};a.prototype._buildWorld=
function(a){for(var b=0;b<a.length;++b)a[b].addToWorld();this._world.process();return this._world};return a});
define("goo/loaders/ScriptLoader",["goo/util/rsvp","goo/loaders/Loader"],function(g,c){function b(a){if(typeof a==="undefined"||a===null)throw Error("ScriptLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof c)||a.loader===null)throw Error("ScriptLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}b.prototype.load=function(a,b){if(this._cache[a])return this._cache[a].then(function(a){return new a(b)});
var c=this._parse.bind(this),f=this._loader.load(a,function(a){return c(a)});this._cache[a]=f;return f.then(function(a){return new a(b)})};b.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));return this._loadScript(a.jsRef)};b.prototype._loadScript=function(a){var b=new g.Promise;require([this._loader.rootPath+a],function(a){b.resolve(a)});return b};return b});
define("goo/math/Matrix2x2",["goo/math/MathUtils","goo/math/Matrix"],function(g,c){function b(){c.call(this,2,2);arguments.length===0?this.setIdentity():this.set(arguments)}b.prototype=Object.create(c.prototype);b.prototype.setupAliases([["e00"],["e10"],["e01"],["e11"]]);b.IDENTITY=new b(1,0,0,1);b.add=function(a,d,c){c||(c=new b);d instanceof b?(c.e00=a.e00+d.e00,c.e10=a.e10+d.e10,c.e01=a.e01+d.e01,c.e11=a.e11+d.e11):(c.e00=a.e00+d,c.e10=a.e10+d,c.e01=a.e01+d,c.e11=a.e11+d);return c};b.prototype.add=
function(a){return b.add(this,a,this)};b.sub=function(a,d,c){c||(c=new b);d instanceof b?(c.e00=a.e00-d.e00,c.e10=a.e10-d.e10,c.e01=a.e01-d.e01,c.e11=a.e11-d.e11):(c.e00=a.e00-d,c.e10=a.e10-d,c.e01=a.e01-d,c.e11=a.e11-d);return c};b.prototype.sub=function(a){return b.sub(this,a,this)};b.mul=function(a,d,c){c||(c=new b);d instanceof b?(c.e00=a.e00*d.e00,c.e10=a.e10*d.e10,c.e01=a.e01*d.e01,c.e11=a.e11*d.e11):(c.e00=a.e00*d,c.e10=a.e10*d,c.e01=a.e01*d,c.e11=a.e11*d);return c};b.prototype.mul=function(a){return b.mul(this,
a,this)};b.div=function(a,d,c){c||(c=new b);d instanceof b?(c.e00=a.e00/d.e00,c.e10=a.e10/d.e10,c.e01=a.e01/d.e01,c.e11=a.e11/d.e11):(d=1/d,c.e00=a.e00*d,c.e10=a.e10*d,c.e01=a.e01*d,c.e11=a.e11*d);return c};b.prototype.div=function(a){return b.div(this,a,this)};b.combine=function(a,d,e){e||(e=new b);if(e===a||e===d)return c.copy(b.combine(a,d),e);e.e00=a.e00*d.e00+a.e01*d.e10;e.e10=a.e10*d.e00+a.e11*d.e10;e.e01=a.e00*d.e01+a.e01*d.e11;e.e11=a.e10*d.e01+a.e11*d.e11;return e};b.prototype.combine=function(a){return b.combine(this,
a,this)};b.transpose=function(a,d){d||(d=new b);if(d===a)return c.copy(b.transpose(a),d);d.e00=a.e00;d.e10=a.e01;d.e01=a.e10;d.e11=a.e11;return d};b.prototype.transpose=function(){return b.transpose(this,this)};b.invert=function(a,d){d||(d=new b);if(d===a)return c.copy(b.invert(a),d);var e=a.determinant();if(Math.abs(e)<g.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};e=1/e;d.e00=a.e11*e;d.e10=0-a.e10*e;d.e01=0-a.e01*e;d.e11=a.e00*e;return d};b.prototype.invert=
function(){return b.invert(this,this)};b.prototype.isOrthogonal=function(){return Math.abs(this.e00*this.e01+this.e10*this.e11)>g.EPSILON?!1:!0};b.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10;if(Math.abs(a-1)>g.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11;return Math.abs(a-1)>g.EPSILON?!1:!0};b.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};b.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10};b.prototype.setIdentity=
function(){this.set(b.IDENTITY);return this};return b});
define("goo/math/Versor",["goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Vector"],function(g,c,b){function a(){b.call(this,4);this.set(arguments.length!==0?arguments:[0,0,0,1])}a.prototype=Object.create(b.prototype);a.prototype.setupAliases([["x"],["y"],["z"],["w"]]);a.IDENTITY=new a(0,0,0,1);a.combine=function(d,c,f){f||(f=new a);if(f===d||f===c)return b.copy(a.combine(d,c),f);f.data[0]=d.data[3]*c.data[0]+c.data[3]*d.data[0]+c.data[2]*d.data[1]-c.data[1]*d.data[2];f.data[1]=d.data[3]*c.data[1]+
c.data[3]*d.data[1]+c.data[0]*d.data[2]-c.data[2]*d.data[0];f.data[2]=d.data[3]*c.data[2]+c.data[3]*d.data[2]+c.data[1]*d.data[0]-c.data[0]*d.data[1];f.data[3]=d.data[3]*c.data[3]-(d.data[0]*c.data[0]+d.data[1]*c.data[1]+d.data[2]*c.data[2]);return f};a.prototype.combine=function(b){return a.combine(this,b,this)};a.invert=function(b,c){c||(c=new a);c.data[0]=0-b.data[0];c.data[1]=0-b.data[1];c.data[2]=0-b.data[2];c.data[3]=b.data[3];return c};a.prototype.invert=function(){return a.invert(this,this)};
a.fromAngleAxis=function(b,c,f){var g=Math.sin(b*0.5),b=Math.cos(b*0.5);f||(f=new a);c.normalize();f.data[0]=c.data[0]*g;f.data[1]=c.data[1]*g;f.data[2]=c.data[2]*g;f.data[3]=b;return f};a.prototype.fromAngleAxis=function(b,c){return a.fromAngleAxis(b,c,this)};a.fromAngleNormalAxis=function(b,c,f){var g=Math.sin(b*0.5),b=Math.cos(b*0.5);f||(f=new a);f.data[0]=c.data[0]*g;f.data[1]=c.data[1]*g;f.data[2]=c.data[2]*g;f.data[3]=b;return f};a.prototype.fromAngleNormalAxis=function(b,c){return a.fromAngleNormalAxis(b,
c,this)};a.toMatrix3x3=function(a,b){b||(b=new g);var c=2*a.data[0]*a.data[0],j=2*a.data[1]*a.data[1],h=2*a.data[2]*a.data[2],k=2*a.data[0]*a.data[1],i=2*a.data[0]*a.data[2],l=2*a.data[1]*a.data[2],m=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],p=2*a.data[2]*a.data[3];b.e00=1-(j+h);b.e10=k+p;b.e20=i-o;b.e01=k-p;b.e11=1-(c+h);b.e21=l+m;b.e02=i+o;b.e12=l-m;b.e22=1-(c+j);return b};a.prototype.toMatrix3x3=function(b){return a.toMatrix3x3(this,b)};a.toMatrix4x4=function(a,b){b||(b=new c);var f=2*a.data[0]*
a.data[0],g=2*a.data[1]*a.data[1],h=2*a.data[2]*a.data[2],k=2*a.data[0]*a.data[1],i=2*a.data[0]*a.data[2],l=2*a.data[1]*a.data[2],m=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],p=2*a.data[2]*a.data[3];b.e00=1-(g+h);b.e10=k+p;b.e20=i-o;b.e30=0;b.e01=k-p;b.e11=1-(f+h);b.e21=l+m;b.e31=0;b.e02=i+o;b.e12=l-m;b.e22=1-(f+g);b.e32=0;b.e03=0;b.e13=0;b.e23=0;b.e33=1;return b};a.prototype.toMatrix4x4=function(b){return a.toMatrix4x4(this,b)};return a});
define("goo/noise/Noise",["goo/math/MathUtils"],function(g){function c(){}c.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,
82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5];c.split=
function(b){var a=Math.floor(b),b=g.scurve5(b-a);return{i0:a+0,i1:a+1,f0:1-b,f1:0+b}};c.fractal1d=function(b,a,d,c,f,g){for(var h=0,k=1,i=0,l=0;l<d;l++)h+=k*g.evaluate1d(b,a),i+=k,k*=c,b*=f;return h/i};c.fractal2d=function(b,a,d,c,f,g,h){for(var k=0,i=1,l=0,m=0;m<c;m++)k+=i*h.evaluate2d(b,a,d),l+=i,i*=f,b*=g,a*=g;return k/l};c.fractal3d=function(b,a,d,c,f,g,h,k){for(var i=0,l=1,m=0,o=0;o<f;o++)i+=l*k.evaluate3d(b,a,d,c),m+=l,l*=g,b*=h,a*=h,d*=h;return i/m};c.fractal4d=function(b,a,d,c,f,g,h,k,i){for(var l=
0,m=1,o=0,p=0;p<g;p++)l+=m*i.evaluate4d(b,a,d,c,f),o+=m,m*=h,b*=k,a*=k,d*=k,c*=k;return l/o};return c});
define("goo/noise/ValueNoise",["goo/noise/Noise"],function(g){function c(){g.call(this)}c.prototype=Object.create(g.prototype);c.sources=[0,1/15,2/15,0.2,4/15,5/15,0.4,7/15,8/15,0.6,10/15,11/15,0.8,13/15,14/15,1];c.evaluate1d=function(b,a){var d=g.split(b/a),e=g.shifter[d.i1&255]&15,f=0;f+=d.f0*c.sources[g.shifter[d.i0&255]&15];f+=d.f1*c.sources[e];return f};c.evaluate2d=function(b,a,d){var b=g.split(b/d),a=g.split(a/d),d=g.shifter[g.shifter[a.i0&255]+b.i1&255]&15,e=g.shifter[g.shifter[a.i1&255]+
b.i0&255]&15,f=g.shifter[g.shifter[a.i1&255]+b.i1&255]&15,j=0;j+=a.f0*b.f0*c.sources[g.shifter[g.shifter[a.i0&255]+b.i0&255]&15];j+=a.f0*b.f1*c.sources[d];j+=a.f1*b.f0*c.sources[e];j+=a.f1*b.f1*c.sources[f];return j};c.evaluate3d=function(b,a,d,e){var b=g.split(b/e),a=g.split(a/e),d=g.split(d/e),e=g.shifter[g.shifter[g.shifter[d.i0&255]+a.i0&255]+b.i1&255]&15,f=g.shifter[g.shifter[g.shifter[d.i0&255]+a.i1&255]+b.i0&255]&15,j=g.shifter[g.shifter[g.shifter[d.i0&255]+a.i1&255]+b.i1&255]&15,h=g.shifter[g.shifter[g.shifter[d.i1&
255]+a.i0&255]+b.i0&255]&15,k=g.shifter[g.shifter[g.shifter[d.i1&255]+a.i0&255]+b.i1&255]&15,i=g.shifter[g.shifter[g.shifter[d.i1&255]+a.i1&255]+b.i0&255]&15,l=g.shifter[g.shifter[g.shifter[d.i1&255]+a.i1&255]+b.i1&255]&15,m=0;m+=d.f0*a.f0*b.f0*c.sources[g.shifter[g.shifter[g.shifter[d.i0&255]+a.i0&255]+b.i0&255]&15];m+=d.f0*a.f0*b.f1*c.sources[e];m+=d.f0*a.f1*b.f0*c.sources[f];m+=d.f0*a.f1*b.f1*c.sources[j];m+=d.f1*a.f0*b.f0*c.sources[h];m+=d.f1*a.f0*b.f1*c.sources[k];m+=d.f1*a.f1*b.f0*c.sources[i];
m+=d.f1*a.f1*b.f1*c.sources[l];return m};c.evaluate4d=function(b,a,d,e,f){var b=g.split(b/f),a=g.split(a/f),d=g.split(d/f),e=g.split(e/f),f=g.shifter[g.shifter[g.shifter[g.shifter[e.i0&255]+d.i0&255]+a.i0&255]+b.i1&255]&15,j=g.shifter[g.shifter[g.shifter[g.shifter[e.i0&255]+d.i0&255]+a.i1&255]+b.i0&255]&15,h=g.shifter[g.shifter[g.shifter[g.shifter[e.i0&255]+d.i0&255]+a.i1&255]+b.i1&255]&15,k=g.shifter[g.shifter[g.shifter[g.shifter[e.i0&255]+d.i1&255]+a.i0&255]+b.i0&255]&15,i=g.shifter[g.shifter[g.shifter[g.shifter[e.i0&
255]+d.i1&255]+a.i0&255]+b.i1&255]&15,l=g.shifter[g.shifter[g.shifter[g.shifter[e.i0&255]+d.i1&255]+a.i1&255]+b.i0&255]&15,m=g.shifter[g.shifter[g.shifter[g.shifter[e.i0&255]+d.i1&255]+a.i1&255]+b.i1&255]&15,o=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&255]+d.i0&255]+a.i0&255]+b.i0&255]&15,p=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&255]+d.i0&255]+a.i0&255]+b.i1&255]&15,n=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&255]+d.i0&255]+a.i1&255]+b.i0&255]&15,r=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&
255]+d.i0&255]+a.i1&255]+b.i1&255]&15,t=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&255]+d.i1&255]+a.i0&255]+b.i0&255]&15,q=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&255]+d.i1&255]+a.i0&255]+b.i1&255]&15,v=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&255]+d.i1&255]+a.i1&255]+b.i0&255]&15,y=g.shifter[g.shifter[g.shifter[g.shifter[e.i1&255]+d.i1&255]+a.i1&255]+b.i1&255]&15,s=0;s+=e.f0*d.f0*a.f0*b.f0*c.sources[g.shifter[g.shifter[g.shifter[g.shifter[e.i0&255]+d.i0&255]+a.i0&255]+b.i0&255]&15];s+=
e.f0*d.f0*a.f0*b.f1*c.sources[f];s+=e.f0*d.f0*a.f1*b.f0*c.sources[j];s+=e.f0*d.f0*a.f1*b.f1*c.sources[h];s+=e.f0*d.f1*a.f0*b.f0*c.sources[k];s+=e.f0*d.f1*a.f0*b.f1*c.sources[i];s+=e.f0*d.f1*a.f1*b.f0*c.sources[l];s+=e.f0*d.f1*a.f1*b.f1*c.sources[m];s+=e.f1*d.f0*a.f0*b.f0*c.sources[o];s+=e.f1*d.f0*a.f0*b.f1*c.sources[p];s+=e.f1*d.f0*a.f1*b.f0*c.sources[n];s+=e.f1*d.f0*a.f1*b.f1*c.sources[r];s+=e.f1*d.f1*a.f0*b.f0*c.sources[t];s+=e.f1*d.f1*a.f0*b.f1*c.sources[q];s+=e.f1*d.f1*a.f1*b.f0*c.sources[v];
s+=e.f1*d.f1*a.f1*b.f1*c.sources[y];return s};return c});define("goo/particles/ParticleInfluence",[],function(){return function(g){g=g||{};this.prepare=g.prepare?g.prepare:function(){};this.apply=g.apply?g.apply:function(){};this.enabled=g.enabled!==void 0?g.enabled===!0:!0}});
define("goo/renderer/pass/BlurPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(g,c,b,a,d){function e(f){f=f||{};this.target=f.target!==void 0?f.target:null;var j=f.strength!==void 0?f.strength:1,h=f.kernelSize!==void 0?f.kernelSize:25,k=f.sigma!==void 0?f.sigma:4,i=f.sizeX!==void 0?f.sizeX:256,f=f.sizeY!==void 0?f.sizeY:256;this.renderTargetX=new b(i,f);this.renderTargetY=new b(i,f);this.renderable=
{meshData:c.quad,materials:[]};this.copyShader=a.clone(d.copyPure);this.copyShader.uniforms.opacity=j;this.copyMaterial=g.createMaterial(this.copyShader);this.convolutionShader=a.clone(d.convolution);this.convolutionShader.defines={KERNEL_SIZE_FLOAT:h.toFixed(1),KERNEL_SIZE_INT:h.toFixed(0)};this.convolutionShader.uniforms.uImageIncrement=e.blurX;this.convolutionShader.uniforms.cKernel=this.convolutionShader.buildKernel(k);this.convolutionMaterial=g.createMaterial(this.convolutionShader);this.enabled=
!0;this.needsSwap=this.clear=!1}e.prototype.render=function(a,b,d){this.renderable.materials[0]=this.convolutionMaterial;this.convolutionMaterial.setTexture("DIFFUSE_MAP",d);this.convolutionShader.uniforms.uImageIncrement=e.blurX;a.render(this.renderable,c.camera,[],this.renderTargetX,!0);this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX);this.convolutionShader.uniforms.uImageIncrement=e.blurY;a.render(this.renderable,c.camera,[],this.renderTargetY,!0);this.renderable.materials[0]=
this.copyMaterial;this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY);this.target!==null?a.render(this.renderable,c.camera,[],this.target,this.clear):a.render(this.renderable,c.camera,[],d,this.clear)};e.blurX=[0.001953125,0];e.blurY=[0,0.001953125];return e});define("goo/renderer/pass/BloomPass",["goo/renderer/pass/BlurPass"],function(g){function c(b){g.call(this,b);this.copyMaterial.blendState.blending="AdditiveBlending"}c.prototype=Object.create(g.prototype);return c});
define("goo/renderer/pass/Composer",["goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/renderer/shaders/ShaderLib"],function(g,c,b){function a(a){this.renderTarget1=a;if(this.renderTarget1===void 0)this.renderTarget1=new g(window.innerWidth||1,window.innerHeight||1);this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=new c(b.copy)}a.prototype.swapBuffers=function(){var a=this.readBuffer;
this.readBuffer=this.writeBuffer;this.writeBuffer=a};a.prototype.addPass=function(a){this.passes.push(a)};a.prototype.render=function(a,b,c,g){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var h,k,i=this.passes.length;for(k=0;k<i;k++)h=this.passes[k],h.enabled&&(h.render(a,this.writeBuffer,this.readBuffer,b,!1,c,g),h.needsSwap&&this.swapBuffers())};return a});
define("goo/renderer/pass/RenderPass",["goo/renderer/Renderer","goo/math/Vector4"],function(g,c){function b(a,b){this.renderList=a;this.filter=b;this.clearColor=new c(0,0,0,0);this.oldClearColor=new c;this.renderToScreen=!1;this.overrideMaterial=null;this.clear=this.enabled=!0;this.needsSwap=!1}b.prototype.render=function(a,b,c,f,j,h,k){h=h||g.mainCamera;k=k||[];this.clearColor&&(this.oldClearColor.setv(a.clearColor),a.setClearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a));
b=this.filter?this.renderList.filter(this.filter):this.renderList;this.renderToScreen?a.render(b,h,k):a.render(b,h,k,c,this.clear,this.overrideMaterial);this.clearColor&&a.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)};return b});
define("goo/util/Skybox","goo/shapes/ShapeCreator,goo/shapes/Sphere,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/entities/Entity,goo/renderer/TextureCreator,goo/entities/components/TransformComponent,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/ScriptComponent".split(","),function(g,c,b,a,d,e,f,j,h,k,i){function l(b,p,n,r,t){e.call(this,b,"Skybox");this._cameraPos=p.transformComponent.transform.translation;if(n===
l.SPHERE)b=g.createSphere(48,48,1,t||c.TextureModes.Projected),r instanceof Array&&(r=r[0]),r=(new f).loadTexture2D(r);else if(n===l.BOX)b=g.createBox(1,1,1),r=(new f).loadTextureCube(r);else throw Error("Unknown geometry type");var q=new j;q.transform.scale.scale(100);n===l.SPHERE&&t!==c.TextureModes.Chromeball&&q.transform.setRotationXYZ(-Math.PI/2,0,0);(p=p.transformComponent.parent)&&p.attachChild(q);this.setComponent(q);this.setComponent(new h(b));p=new k;n=a.createMaterial(m[n],"Skybox material");
n.setTexture(d.DIFFUSE_MAP,r);n.cullState.cullFace="Front";n.depthState.enabled=!1;n.renderQueue=0;p.materials[0]=n;p.cullMode="Never";this.setComponent(p);this.setComponent(new i({run:function(a){a.transformComponent.transform.translation.setv(this._cameraPos);a.transformComponent.setUpdated()}.bind(this)}))}l.prototype=Object.create(e.prototype);l.SPHERE="sphere";l.BOX="box";var m={};m.box={attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,
worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,diffuseMap:d.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nvarying vec3 eyeVec;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",fshader:"precision mediump float;\nuniform samplerCube diffuseMap;\nvarying vec3 eyeVec;\nvoid main(void)\n{\n\tvec4 cube = textureCube(diffuseMap, eyeVec);\n\tgl_FragColor = cube;\n}"};
m.sphere={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,diffuseMap:d.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};return l});
define("goo/renderer/pass/DOFPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass,goo/renderer/Util,goo/util/Skybox".split(","),function(g,c,b,a,d,e,f,j,h,k){function i(a,b){this.depthPass=new e(a,function(a){return!(a instanceof k)});this.regularPass=new e(a);this.depthPass.overrideMaterial=g.createMaterial(l);this.outPass=new f(b||
m);this.outPass.useReadBuffer=!1;this.outPass.renderToScreen=!0;var d=window.innerWidth||1,i=window.innerHeight||1,j=h.nearestPowerOfTwo(Math.max(d,i));this.depthTarget=new c(d,i);this.regularTarget=new c(j/2,j/2);this.regularTarget2=new c(d,i);this.regularTarget.generateMipmaps=!0;this.regularTarget.minFilter="Trilinear";this.enabled=!0;this.clear=!1;this.needsSwap=!0}i.prototype.render=function(b,d,c,e){this.depthPass.render(b,null,this.depthTarget,e);this.regularPass.render(b,null,this.regularTarget,
e);this.regularPass.render(b,null,this.regularTarget2,e);this.outPass.material.setTexture(a.DEPTH_MAP,this.depthTarget);this.outPass.material.setTexture(a.DIFFUSE_MAP,this.regularTarget);this.outPass.material.setTexture("DIFFUSE_MIP",this.regularTarget2);this.outPass.render(b,d,c,e)};var l={attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,farPlane:a.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",
fshader:["precision mediump float;\nuniform float farPlane;",d.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(-vPosition.z, farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")},m={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{worldMatrix:a.WORLD_MATRIX,viewProjectionMatrix:a.VIEW_PROJECTION_MATRIX,depthMap:a.DEPTH_MAP,diffuseMap:a.DIFFUSE_MAP,diffuseMip:"DIFFUSE_MIP",zfar:a.FAR_PLANE,focalDepth:100,fStop:2,
CoC:0.003,focalLength:75,maxBlur:16},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"uniform sampler2D diffuseMap;\nuniform sampler2D diffuseMip;\nuniform sampler2D depthMap;\nuniform float zfar; //camera clipping end\nuniform float focalDepth;\nuniform float focalLength;\nuniform float fStop;\nuniform float CoC;\nuniform float maxBlur;\nvarying vec2 texCoord0;\n"+
d.methods.unpackDepth+"void main() \n{\n\tfloat depth = unpackDepth(texture2D(depthMap,texCoord0)) * zfar;\n\tfloat f = focalLength; //focal length in mm\n\tfloat d = focalDepth*1000.0; //focal plane in mm\n\tfloat o = depth*1000.0; //depth in mm\n\tfloat a = (o*f)/(o-f); \n\tfloat b = (d*f)/(d-f); \n\tfloat c = (d-f)/(d*fStop*CoC); \n\tfloat blur = clamp(abs(a-b)*c, 0.0, maxBlur);\n if (blur < 0.3) {\n   gl_FragColor = texture2D(diffuseMip, texCoord0);\n } else { \n   gl_FragColor = texture2D(diffuseMap, texCoord0, log2(blur));\n }\n gl_FragColor.a = 1.0;}"};
return i});
define("goo/renderer/pass/DepthPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass".split(","),function(g,c,b,a,d,e,f,j){function h(a,b){this.depthPass=new e(a);this.depthPass.overrideMaterial=g.createMaterial(k);this.blurTarget=new c(256,256);this.blurPass=new j({target:this.blurTarget});this.outPass=new f(b||i);this.outPass.useReadBuffer=
!1;this.depthTarget=new c(window.innerWidth||1,window.innerHeight||1);this.enabled=!0;this.clear=!1;this.needsSwap=!0}h.prototype.render=function(b,d,c,e){this.depthPass.render(b,null,this.depthTarget,e);this.blurPass.render(b,d,c,e);this.outPass.material.setTexture(a.DEPTH_MAP,this.depthTarget);this.outPass.material.setTexture(a.DIFFUSE_MAP,c);this.outPass.material.setTexture("BLUR_MAP",this.blurTarget);this.outPass.render(b,d,c,e)};var k={attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:a.VIEW_MATRIX,
projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,farPlane:a.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",d.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")},
i={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,depthMap:a.DEPTH_MAP,diffuseMap:a.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:["precision mediump float;\nuniform sampler2D depthMap;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;",d.methods.unpackDepth,"void main(void)\n{\n\tvec4 depthCol = texture2D(depthMap, texCoord0);\n\tvec4 diffuseCol = texture2D(diffuseMap, texCoord0);\n\tfloat depth = unpackDepth(depthCol);\n\tgl_FragColor = diffuseCol * vec4(depth);\n}"].join("\n")};return h});
define("goo/renderer/pass/DoGPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(g,c,b,a,d){function e(e){e=e||{};this.target=e.target!==void 0?e.target:null;var j=e.width!==void 0?e.width:512,h=e.height!==void 0?e.height:512,k=e.sigma!==void 0?e.sigma:0.6,e=e.threshold!==void 0?e.threshold:0.005;k>2.5&&(k=2.5);this.renderTargetX=new b(j,h);this.gaussian1=new b(j,h);this.gaussian2=new b(j,
h);this.renderable={meshData:c.quad,materials:[]};this.convolutionShader1=a.clone(d.convolution);this.convolutionShader2=a.clone(d.convolution);this.differenceShader=a.clone(d.differenceOfGaussians);this.differenceShader.uniforms.threshold=e;this.differenceMaterial=g.createMaterial(this.differenceShader);var e=this.convolutionShader1.buildKernel(k),k=this.convolutionShader2.buildKernel(1.6*k),i=e.length;this.convolutionShader1.defines={KERNEL_SIZE_FLOAT:i.toFixed(1),KERNEL_SIZE_INT:i.toFixed(0)};
i=k.length;this.convolutionShader2.defines={KERNEL_SIZE_FLOAT:i.toFixed(1),KERNEL_SIZE_INT:i.toFixed(0)};this.convolutionShader1.uniforms.cKernel=e;this.convolutionShader2.uniforms.cKernel=k;this.blurX=[0.5/j,0];this.blurY=[0,0.5/h];this.convolutionMaterial1=g.createMaterial(this.convolutionShader1);this.convolutionMaterial2=g.createMaterial(this.convolutionShader2);this.enabled=!0;this.needsSwap=this.clear=!1}e.prototype.render=function(a,b,d){this.renderable.materials[0]=this.convolutionMaterial1;
this.convolutionMaterial1.setTexture("DIFFUSE_MAP",d);this.convolutionShader1.uniforms.uImageIncrement=this.blurX;a.render(this.renderable,c.camera,[],this.renderTargetX,!0);this.convolutionMaterial1.setTexture("DIFFUSE_MAP",this.renderTargetX);this.convolutionShader1.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,c.camera,[],this.gaussian1,!0);this.renderable.materials[0]=this.convolutionMaterial2;this.convolutionMaterial2.setTexture("DIFFUSE_MAP",d);this.convolutionShader2.uniforms.uImageIncrement=
this.blurX;a.render(this.renderable,c.camera,[],this.renderTargetX,!0);this.convolutionMaterial2.setTexture("DIFFUSE_MAP",this.renderTargetX);this.convolutionShader2.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,c.camera,[],this.gaussian2,!0);this.renderable.materials[0]=this.differenceMaterial;this.differenceMaterial.setTexture("BLUR1",this.gaussian1);this.differenceMaterial.setTexture("BLUR2",this.gaussian2);this.differenceMaterial.setTexture("ORIGINAL",d);this.target!==null?a.render(this.renderable,
c.camera,[],this.target,this.clear):a.render(this.renderable,c.camera,[],d,this.clear)};return e});
define("goo/renderer/pass/NesPass",["goo/renderer/TextureCreator","goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(g,c,b,a){function d(a){this.material=c.createMaterial(e);this.renderToScreen=!1;this.renderable={meshData:b.quad,materials:[this.material]};this.mapping=(new g).loadTexture2D(a);this.mapping.minFilter="NearestNeighborNoMipMaps";this.mapping.magFilter="NearestNeighbor";this.mapping.generateMipmaps=!1;this.enabled=!0;this.clear=!1;this.needsSwap=
!0}d.prototype.render=function(a,d,c){this.material.setTexture("DIFFUSE_MAP",c);this.material.setTexture("COLOR_MAPPING",this.mapping);this.renderToScreen?a.render(this.renderable,b.camera,[],null,this.clear):a.render(this.renderable,b.camera,[],d,this.clear)};var e={attributes:a.copy.attributes,uniforms:{diffuse:"DIFFUSE_MAP",mapping:"COLOR_MAPPING",$link:a.copy.uniforms},vshader:a.copy.vshader,fshader:"precision mediump float;\nuniform sampler2D diffuse;\nuniform sampler2D mapping;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 texCol = texture2D( diffuse, texCoord0 );\n\tfloat r = floor(texCol.r * 31.0);\n\tfloat g = floor(texCol.g * 31.0);\n\tfloat b = floor(texCol.b * 31.0);\n\tvec4 texPalette = texture2D( mapping, vec2((r * 32.0 + g)/1024.0, b / 32.0) );\n\tgl_FragColor = vec4( texPalette.rgb, 1.0 );\n}"};
return d});
define("goo/renderer/pass/SSAOPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/Util,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass,goo/renderer/shaders/ShaderLib".split(","),function(g,c,b,a,d,e,f,j,h,k){function i(a){this.depthPass=new f(a);this.depthPass.clearColor.set(1,1,1,1);this.depthPass.overrideMaterial=g.createMaterial(l);var a=window.innerWidth/4,
d=window.innerHeight/4,e=b.clone(k.ssao);e.uniforms.size=[a,d];this.outPass=new j(e);this.outPass.useReadBuffer=!1;this.blurPass=new h({sizeX:a,sizeY:d});this.depthTarget=new c(a,d,{magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"});this.enabled=!0;this.clear=!1;this.needsSwap=!0}i.prototype.render=function(a,b,c,e){this.depthPass.render(a,null,this.depthTarget,e);this.outPass.material.setTexture(d.DIFFUSE_MAP,c);this.outPass.material.setTexture(d.DEPTH_MAP,this.depthTarget);this.outPass.render(a,
b,c,e)};var l={attributes:{vertexPosition:a.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:["precision mediump float;",e.methods.packDepth,"void main(void) {\n\tgl_FragColor = packDepth(gl_FragCoord.z);\n}"].join("\n")};
return i});
define("goo/scripts/BasicControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(g,c){function b(a){this.domElement=a===void 0?document:a.domElement||a;this.name="BasicControlScript";this.movementSpeed=10;this.rollSpeed=2;this.movementSpeedMultiplier=1;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new g(0,0,0);this.rotationVector=new g(0,0,0);this.multiplier=new g(1,1,1);this.rotationMatrix=
new c;this.tmpVec=new g;this.handleEvent=function(a){if(typeof this[a.type]==="function")this[a.type](a)};this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;
break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=
0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};var b,e;this.mousedown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a=a.touches&&a.touches.length===1?a.touches[0]:a;this.mouseDownX=a.pageX;this.mouseDownY=a.pageY;
this.mouseStatus=1;b=this.mousemove.bind(this);e=this.mouseup.bind(this);document.addEventListener("mousemove",b,!1);document.addEventListener("mouseup",e,!1);document.addEventListener("touchmove",b,!1);document.addEventListener("touchend",e,!1)};this.mousemove=function(a){if(this.mouseStatus>0)a=a.touches&&a.touches.length===1?a.touches[0]:a,this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=
a.pageY};this.mouseup=function(a){if(this.mouseStatus)a.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",e),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",e)};this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;
this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-a+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,
this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};a=this.mousedown.bind(this);this.domElement.addEventListener("mousedown",a,!1);this.domElement.addEventListener("touchstart",a,!1);this.domElement.addEventListener("keydown",this.keydown.bind(this),!1);this.domElement.addEventListener("keyup",this.keyup.bind(this),!1);this.updateMovementVector();this.updateRotationVector()}b.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",
type:"number"}]};b.prototype.run=function(a){var b=a.transformComponent,c=b.transform,f=a._world.tpf,a=f*this.movementSpeed*this.movementSpeedMultiplier,f=f*this.rollSpeed*this.movementSpeedMultiplier;if(!this.moveVector.equals(g.ZERO)||!this.rotationVector.equals(g.ZERO)||this.mouseStatus>0){c.translation.x+=this.moveVector.x*a;c.translation.y+=this.moveVector.y*a;c.translation.z+=this.moveVector.z*a;this.tmpVec.x+=-this.rotationVector.x*f*this.multiplier.x;this.tmpVec.y+=this.rotationVector.y*f*
this.multiplier.y;this.tmpVec.z+=this.rotationVector.z*f*this.multiplier.z;c.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z);if(this.mouseStatus>0)this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector();b.setUpdated()}};return b});
define("goo/scripts/HeightMapBoundingScript",[],function(){function g(c,b){var a=new Image;a.src=c;this.canvas=document.createElement("canvas");this.con2d=this.canvas.getContext("2d");this.loaded=!1;var d=this;a.onload=function(){d.canvas.width=a.width;d.canvas.height=a.height;d.con2d.drawImage(a,0,0);d.loaded=!0;b(this)}}g.prototype.getMatrix=function(){for(var c=[],b=0;b<this.canvas.width;b++){c.push([]);for(var a=0;a<this.canvas.height;a++)c[b].push(this.getAt(b,a))}return c};g.prototype.getAt=
function(c,b){return c<0||c>this.canvas.width||b<0||b>this.canvas.height?0:this.con2d.getImageData(c,b,1,1).data[0]/255*8};g.prototype.getInterpolated=function(c,b){var a=this.getAt(Math.ceil(c),Math.ceil(b)),d=this.getAt(Math.ceil(c),Math.floor(b)),e=this.getAt(Math.floor(c),Math.ceil(b)),f=this.getAt(Math.floor(c),Math.floor(b)),g=c-Math.floor(c),h=b-Math.floor(b);return(a*g+e*(1-g))*h+(d*g+f*(1-g))*(1-h)};g.prototype.run=function(c){c=c.transformComponent.transform.translation;c.data[1]=this.getInterpolated(c.data[0],
c.data[2])};return g});
define("goo/scripts/MouseLookControlScript",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(g,c,b){function a(a){a=a||{};this.name="MouseLookControlScript";this.domElement=a.domElement||document;this.turnSpeedHorizontal=!isNaN(a.turnSpeedHorizontal)?a.turnSpeed:0.01;this.turnSpeedVertical=!isNaN(a.turnSpeedVertical)?a.turnSpeed:0.01;this.dragOnly=a.dragOnly!==void 0?a.dragOnly===!0:!0;this.dragButton=!isNaN(a.dragButton)?a.dragButton:-1;this.worldUpVector=a.worldUpVector||
new g(0,1,0);this.localLeftVector=a.localLeftVector||new g(-1,0,0);this.onRun=a.onRun;this.maxAscent=a.maxAscent!==void 0?a.maxAscent:89.95*b.DEG_TO_RAD;this.minAscent=a.minAscent!==void 0?a.minAscent:-89.95*b.DEG_TO_RAD;this.calcVector=new g;this.calcMat1=new c;this.calcMat2=new c;this.rotY=this.rotX=0;this.resetMouseState();this.setupMouseControls()}a.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN,dX:0,dY:0}};a.prototype.updateButtonState=function(a,b){this.domElement!==
document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a.button))this.mouseState.buttonDown=b,a.preventDefault()};a.prototype.updateDeltas=function(a){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0):(this.mouseState.dX=a.clientX-this.mouseState.lastX,this.mouseState.dY=a.clientY-this.mouseState.lastY);this.mouseState.lastX=a.clientX;this.mouseState.lastY=a.clientY};var d,e,f,j=function(a){this.resetMouseState();
this.updateButtonState(a,!0);e=h.bind(this);f=k.bind(this);document.addEventListener("mousemove",e,!1);document.addEventListener("mouseup",f,!1);document.addEventListener("mouseout",f,!1)},h=function(a){this.updateDeltas(a)},k=function(a){this.updateButtonState(a,!1);document.removeEventListener("mousemove",e);document.removeEventListener("mouseup",f);document.removeEventListener("mouseout",f)};a.prototype.setupMouseControls=function(){d=j.bind(this);this.domElement.addEventListener("mousedown",d,
!1)};a.prototype.run=function(a){if(a=a.transformComponent){var b=a.transform;b.rotation.toAngles(this.calcVector);this.rotY=this.calcVector.x;this.rotX=this.calcVector.y;if(!(this.dragOnly&&!this.mouseState.buttonDown||this.mouseState.dX===0&&this.mouseState.dY===0)){var d=this.turnSpeedHorizontal,c=this.turnSpeedVertical;this.mouseState.dX!==0&&(this.rotX-=d*this.mouseState.dX);if(this.mouseState.dY!==0)if(this.rotY-=c*this.mouseState.dY,this.rotY>this.maxAscent)this.rotY=this.maxAscent;else if(this.rotY<
this.minAscent)this.rotY=this.minAscent;b.rotation.fromAngles(this.rotY,this.rotX,0);a.setUpdated()}this.mouseState.dX=0;this.mouseState.dY=0}};return a});
define("goo/scripts/OrbitCamControlScript",["goo/math/Vector2","goo/math/Vector3","goo/math/MathUtils"],function(g,c,b){function a(a){var a=a||{},b;for(b in d)this[b]=typeof d[b]==="boolean"?a[b]!==void 0?a[b]===!0:d[b]:isNaN(d[b])?d[b]instanceof c?a[b]||(new c).copy(d[b]):a[b]||d[b]:!isNaN(a[b])?a[b]:d[b];this.name="OrbitCamControlScript";this.timeSamples=[0,0,0,0,0];this.xSamples=[0,0,0,0,0];this.ySamples=[0,0,0,0,0];this.sample=0;this.velocity=new g;this.targetSpherical=new c(this.spherical);this.cartesian=
new c;this.dirty=!0;this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN};this.setupMouseControls();this.domElement.oncontextmenu=function(){return!1}}var d={domElement:document,turnSpeedHorizontal:0.005,turnSpeedVertical:0.005,zoomSpeed:0.2,dragOnly:!0,dragButton:-1,worldUpVector:new c(0,1,0),baseDistance:15,minZoomDistance:1,maxZoomDistance:1E3,minAscent:-89.95*b.DEG_TO_RAD,maxAscent:89.95*b.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*b.DEG_TO_RAD,maxAzimuth:270*b.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,
invertedY:!1,invertedWheel:!0,drag:5,maxSampleTimeMS:200,lookAtPoint:new c(0,0,0),spherical:new c(15,0,0),interpolationSpeed:7,onRun:null};a.prototype.updateButtonState=function(a,d){this.domElement!==document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a))(this.mouseState.buttonDown=d)?(this.mouseState.lastX=NaN,this.mouseState.lastY=NaN,this.velocity.set(0,0),this.spherical.y=b.moduloPositive(this.spherical.y,b.TWO_PI),this.targetSpherical.copy(this.spherical)):
this.applyReleaseDrift()};a.prototype.updateDeltas=function(a,b){var d=0,c=0;!isNaN(this.mouseState.lastX)&&!isNaN(this.mouseState.lastY)&&(d=-(a-this.mouseState.lastX),c=b-this.mouseState.lastY);this.mouseState.lastX=a;this.mouseState.lastY=b;if(!(this.dragOnly&&!this.mouseState.buttonDown||d===0&&c===0)){this.timeSamples[this.sample]=Date.now();this.xSamples[this.sample]=d;this.ySamples[this.sample]=c;this.sample++;if(this.sample>this.timeSamples.length-1)this.sample=0;this.velocity.set(0,0);this.move(this.turnSpeedHorizontal*
d,this.turnSpeedVertical*c)}};a.prototype.move=function(a,d){var c=this.invertedX?-a:a,g=this.invertedY?-d:d;if(this.clampAzimuth){var k=this.targetSpherical,c=this.targetSpherical.y-c,i=this.minAzimuth,l=this.maxAzimuth,m=(i+l)/2+(l>i?Math.PI:0),o=b.moduloPositive(c-m,b.TWO_PI),p=b.moduloPositive(i-m,b.TWO_PI),m=b.moduloPositive(l-m,b.TWO_PI);c<0&&i>0?i-=b.TWO_PI:c>0&&i<0&&(i+=b.TWO_PI);c>b.TWO_PI&&l<b.TWO_PI&&(l+=b.TWO_PI);k.y=o<p?i:o>m?l:c}else this.targetSpherical.y-=c;this.targetSpherical.z=
b.clamp(this.targetSpherical.z+g,this.minAscent,this.maxAscent);this.dirty=!0};a.prototype.applyWheel=function(a){this.zoom(this.zoomSpeed*(this.invertedWheel?-1:1)*Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)))};a.prototype.zoom=function(a){this.targetSpherical.x=b.clamp(this.targetSpherical.x+a*this.baseDistance,this.minZoomDistance,this.maxZoomDistance);this.dirty=!0};a.prototype.applyReleaseDrift=function(){for(var a=Date.now(),b=0,d=0,c=!1,g=0,i=this.timeSamples.length;g<i;g++)a-this.timeSamples[g]<
this.maxSampleTimeMS&&(b+=this.xSamples[g],d+=this.ySamples[g],c=!0);c?this.velocity.set(b*this.turnSpeedHorizontal/this.timeSamples.length,d*this.turnSpeedVertical/this.timeSamples.length):this.velocity.set(0,0)};a.prototype.setupMouseControls=function(){var a=this;this.domElement.addEventListener("mousedown",function(b){a.updateButtonState(b.button,!0)},!1);document.addEventListener("mouseup",function(b){a.updateButtonState(b.button,!1)},!1);document.addEventListener("mousemove",function(b){a.updateDeltas(b.clientX,
b.clientY)},!1);this.domElement.addEventListener("mousewheel",function(b){a.applyWheel(b)},!1);this.domElement.addEventListener("DOMMouseScroll",function(b){a.applyWheel(b)},!1);this.domElement.addEventListener("dragstart",function(a){a.preventDefault()},!1);if(typeof window.Hammer!=="undefined")window.Hammer(this.domElement,{transform_always_block:!0,transform_min_scale:1}).on("touch drag transform release",function(b){switch(b.type){case "transform":b=b.gesture.scale;b<1?a.zoom(a.zoomSpeed*1):b>
1&&a.zoom(a.zoomSpeed*-1);break;case "touch":a.updateButtonState(0,!0);break;case "release":a.updateButtonState(0,!1);break;case "drag":a.updateDeltas(b.gesture.center.pageX,b.gesture.center.pageY)}})};a.prototype.updateVelocity=function(a){this.velocity.lengthSquared()>1.0E-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(b.clamp(b.lerp(a,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)};a.prototype.run=function(a){var d=a.transformComponent;if(d){var c=d.transform;this.releaseVelocity&&
this.updateVelocity(a._world.tpf);if(this.dirty){a=this.interpolationSpeed*a._world.tpf;this.spherical.y=b.lerp(a,this.spherical.y,this.targetSpherical.y);this.spherical.x=b.lerp(a,this.spherical.x,this.targetSpherical.x);this.spherical.z=b.lerp(a,this.spherical.z,this.targetSpherical.z);b.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian);c.translation.set(this.cartesian.add(this.lookAtPoint));c.translation.equals(this.lookAtPoint)||c.lookAt(this.lookAtPoint,
this.worldUpVector);if(this.spherical.distanceSquared(this.targetSpherical)<1.0E-6)this.dirty=!1,this.spherical.y=b.moduloPositive(this.spherical.y,b.TWO_PI),this.targetSpherical.copy(this.spherical);d.setUpdated()}}};return a});
define("goo/scripts/OrbitNPanControlScript",["goo/scripts/OrbitCamControlScript","goo/renderer/Renderer","goo/math/Vector3"],function(g,c,b){function a(a,c){c=c||{};c.dragButton=2;g.call(this,c);this.panState={buttonDown:!1,lastX:NaN,lastY:NaN,lastPos:new b};this.goo=a}a.prototype=Object.create(g.prototype);a.prototype.updateButtonState=function(a,b){g.prototype.updateButtonState.call(this,a,b);if(a===1&&(this.panState.buttonDown=b))this.panState.lastX=NaN,this.panState.lastY=NaN,this.panState.lastPos.setv(this.lookAtPoint)};
a.prototype.updateDeltas=function(a,e){g.prototype.updateDeltas.call(this,a,e);var f=new b,j=new b;if(isNaN(this.panState.lastX)||isNaN(this.panState.lastY))this.panState.lastX=a,this.panState.lastY=e;if(this.panState.buttonDown){var h=c.mainCamera;h.getScreenCoordinates(this.panState.lastPos,1,1,j);j.x-=(a-this.panState.lastX)/this.goo.renderer.viewportWidth;j.y+=(e-this.panState.lastY)/this.goo.renderer.viewportHeight;h.getWorldCoordinates(j.x,j.y,1,1,j.z,f);this.debug&&console.log(f.data);this.lookAtPoint.setv(f);
this.dirty=!0}};return a});
define("goo/scripts/RotationControlScript",["goo/math/Matrix3x3"],function(g){function c(a){this.bindings={attach:b.bind(this),update:null,remove:null};this.element=a;this.name="RotationControlScript";this.states={dirty:!1,x:null,y:null,dx:null,dy:null};this.element.addEventListener("mousedown",this.bindings.attach,!1);this.element.addEventListener("touchstart",this.bindings.attach,!1)}var b=function(b){b=b.touches&&b.touches.length===1?b.touches[0]:b;this.states.dx=0;this.states.dy=0;this.states.x=
b.pageX;this.states.y=b.pageY;this.bindings.update=a.bind(this);this.bindings.remove=d.bind(this);document.addEventListener("mousemove",this.bindings.update,!1);document.addEventListener("touchmove",this.bindings.update,!1);document.addEventListener("mouseup",this.bindings.remove,!1);document.addEventListener("touchend",this.bindings.remove,!1)},a=function(a){a=a.touches&&a.touches.length===1?a.touches[0]:a;this.states.dirty=!0;this.states.dx+=a.pageX-this.states.x;this.states.dy+=a.pageY-this.states.y;
this.states.x=a.pageX;this.states.y=a.pageY},d=function(){document.removeEventListener("mousemove",this.bindings.update);document.removeEventListener("touchmove",this.bindings.update);document.removeEventListener("mouseup",this.bindings.remove);document.removeEventListener("touchend",this.bindings.remove)};c.prototype.run=function(a){if(this.states.dirty){var b=Math.PI*this.states.dy/this.element.clientHeight,d=Math.PI*this.states.dx/this.element.clientWidth,c=Math.cos(b),b=Math.sin(b),k=Math.cos(d),
d=Math.sin(d),c=new g(k,b*d,0-c*d,0,c,b,d,0-b*k,c*k);g.combine(c,a.transformComponent.transform.rotation,a.transformComponent.transform.rotation);a.transformComponent.setUpdated();this.states.dirty=!1;this.states.dx=0;this.states.dy=0}};return c});
define("goo/scripts/SplineInterpolator",["goo/math/Matrix4x4","goo/math/Vector4"],function(g,c){function b(a){a=a||{};this.controlPoint=0;this.controlPoints=a.controlPoints||[];this.elapsedTime=0;this.enabled=a.enabled||!0;this.firstIteration=!0;this.tolerance=a.tolerance||0.01;this.beforeFunction=a.beforeFunction||function(a){return a.transformComponent.transform.translation.clone().data};this.updateFunction=a.updateFunction||function(a,b){a.transformComponent.transform.translation.set(b);a.transformComponent.setUpdated()};
this.afterFunction=a.afterFunction||function(){}}b.CATMULL_ROM=new g(-0.5,1,-0.5,0,1.5,-2.5,0,1,-1.5,2,0.5,0,0.5,-0.5,0,0);b.UNIFORM_CUBIC=new g(-0.16667,0.5,-0.5,0.16667,0.5,-1,0,0.66667,-0.5,0.5,0.5,0.16667,0.16667,0,0,0);b.prototype.run=function(a,d){if(this.firstIteration){this.firstIteration=!1;try{this.controlPoints.unshift({time:0,value:this.beforeFunction(a)})}catch(e){this.enabled=!1;return}}for(var f=Math.min(Math.max(this.controlPoint-1,0),this.controlPoints.length-1),g=Math.min(Math.max(this.controlPoint+
0,0),this.controlPoints.length-1),h=Math.min(Math.max(this.controlPoint+1,0),this.controlPoints.length-1),k=Math.min(Math.max(this.controlPoint+2,0),this.controlPoints.length-1),i=this.controlPoints[h].time>this.controlPoints[g].time?(this.elapsedTime-this.controlPoints[g].time)/(this.controlPoints[h].time-this.controlPoints[g].time):0,i=b.CATMULL_ROM.applyPre(new c(i*i*i,i*i,i,1)),l=Array(this.controlPoints[0].value.length),m=0,o=0;o<l.length;o++)l[o]=0,l[o]+=this.controlPoints[f].value[o]*i[0],
l[o]+=this.controlPoints[g].value[o]*i[1],l[o]+=this.controlPoints[h].value[o]*i[2],l[o]+=this.controlPoints[k].value[o]*i[3],m+=Math.abs(this.controlPoints[this.controlPoints.length-1].value[o]-l[o]);try{this.updateFunction(a,l)}catch(p){this.enabled=!1;return}this.elapsedTime+=d;this.elapsedTime>=this.controlPoints[h].time&&this.controlPoint++;if(this.controlPoint>=this.controlPoints.length||m<this.tolerance){try{this.afterFunction(a)}catch(n){}this.enabled=!1}};return b});
define("goo/scripts/WASDControlScript",["goo/math/Vector","goo/math/Vector3"],function(g,c){function b(a){a=a||{};this.name="WASDControlScript";this.domElement=a.domElement||document;a.domElement&&this.domElement.setAttribute("tabindex",-1);this.walkSpeed=!isNaN(a.walkSpeed)?a.walkSpeed:100;this.crawlSpeed=!isNaN(a.crawlSpeed)?a.crawlSpeed:10;this.fwdVector=a.fwdVector||new c(0,0,-1);this.leftVector=a.leftVector||new c(-1,0,0);this.crawlKey=!isNaN(a.crawlKey)?a.crawlKey:16;this.forwardKey=!isNaN(a.forwardKey)?
a.forwardKey:87;this.backKey=!isNaN(a.backKey)?a.backKey:83;this.strafeLeftKey=!isNaN(a.strafeLeftKey)?a.strafeLeftKey:65;this.strafeRightKey=!isNaN(a.strafeRightKey)?a.strafeRightKey:68;this.XZ=a.XZ||!1;this.onRun=a.onRun;this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1};this.moveVector=new c(0,0,0);this.calcVector=new c;this.setupKeyControls()}b.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight;this.moveVector.z=
this.moveState.forward-this.moveState.back};b.prototype.updateKeys=function(a,b){if(!a.altKey){var c=!1;switch(a.keyCode){case this.crawlKey:this.moveState.crawling=b;break;case this.forwardKey:this.moveState.forward=b?1:0;c=!0;break;case this.backKey:this.moveState.back=b?1:0;c=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=b?1:0;c=!0;break;case this.strafeRightKey:this.moveState.strafeRight=b?1:0,c=!0}c&&this.updateMovementVector()}};b.prototype.setupKeyControls=function(){var a=this;
this.domElement.addEventListener("keydown",function(b){a.updateKeys(b,!0)},!1);this.domElement.addEventListener("keyup",function(b){a.updateKeys(b,!1)},!1)};b.prototype.run=function(a){var b=a.transformComponent;if(b){var e=b.transform;g.equals(this.moveVector,c.ZERO)||(this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),
this.calcVector.normalize(),this.calcVector.mul(a._world.tpf*(this.moveState.crawling?this.crawlSpeed:this.walkSpeed)),e.rotation.applyPost(this.calcVector),this.XZ&&(this.calcVector.data[1]=0),e.translation.add(this.calcVector),b.setUpdated())}};return b});
define("goo/shapes/Disk",["goo/renderer/MeshData"],function(g){function c(b,a,c){this.nSegments=b||8;this.radius=a||1;this.pointiness=c||0;b=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);g.call(this,b,this.nSegments+1,this.nSegments+2);this.indexModes=["TriangleFan"];this.rebuild()}c.prototype=Object.create(g.prototype);c.prototype.rebuild=function(){var b=[],a=[],c=[],e=[];b.push(0,0,this.pointiness);a.push(0,0,1);c.push(0.5,0.5);e.push(0);for(var f=Math.atan2(this.radius,this.pointiness),j=Math.PI*
2/this.nSegments,h=1,k=0;h<=this.nSegments;h++,k+=j)b.push(Math.cos(k)*this.radius,Math.sin(k)*this.radius,0),a.push(Math.cos(k)*Math.cos(f),Math.sin(k)*Math.cos(f),Math.sin(f)),c.push(Math.cos(k)*0.5+0.5,Math.sin(k)*0.5+0.5),e.push(h);e.push(1);this.getAttributeBuffer(g.POSITION).set(b);this.getAttributeBuffer(g.NORMAL).set(a);this.getAttributeBuffer(g.TEXCOORD0).set(c);this.getIndexBuffer().set(e);return this};return c});
define("goo/shapes/FilledPolygon",["goo/renderer/MeshData","goo/math/MathUtils"],function(g,c){function b(a,b){this.verts=a;var c;if(b)c=b;else{var f=a.length/3;if(f<3)c=[];else{c=[];for(var j=[],h=0;h<f;h++)j.push(h);for(h=0;f>3;){var k=j[(h+0)%f],i=j[(h+1)%f],l=j[(h+2)%f],m=a[3*k],o=a[3*k+1],p=a[3*i],n=a[3*i+1],r=a[3*l],t=a[3*l+1],q=!1;if((o-n)*(r-p)+(p-m)*(t-n)>=0)for(var q=!0,v=0;v<f;v++){var y=j[v];if(!(y===k||y===i||y===l)){var s=r-m,u=t-o,z=p-m,w=n-o,A=a[3*y]-m,x=a[3*y+1]-o,y=s*s+u*u,B=s*z+
u*w,s=s*A+u*x,u=z*z+w*w,z=z*A+w*x,w=1/(y*u-B*B),A=(u*s-B*z)*w,y=(y*z-B*s)*w;if(A>=0&&y>=0&&A+y<1){q=!1;break}}}if(q)c.push(k,i,l),j.splice((h+1)%f,1),f--,h=0;else if(h++>3*f)break}c.push(j[0],j[1],j[2])}}this.indices=c;c=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);g.call(this,c,this.verts.length/3,this.indices.length);this.rebuild()}b.prototype=Object.create(g.prototype);b.prototype.rebuild=function(){var a,b,e,f;this.getAttributeBuffer(g.POSITION).set(this.verts);var j=[];for(f=0;f<this.indices.length;f+=
3)a=c.getTriangleNormal(this.verts[this.indices[f+0]*3+0],this.verts[this.indices[f+0]*3+1],this.verts[this.indices[f+0]*3+2],this.verts[this.indices[f+1]*3+0],this.verts[this.indices[f+1]*3+1],this.verts[this.indices[f+1]*3+2],this.verts[this.indices[f+2]*3+0],this.verts[this.indices[f+2]*3+1],this.verts[this.indices[f+2]*3+2]),j[this.indices[f+0]*3+0]=a[0],j[this.indices[f+0]*3+1]=a[1],j[this.indices[f+0]*3+2]=a[2],j[this.indices[f+1]*3+0]=a[0],j[this.indices[f+1]*3+1]=a[1],j[this.indices[f+1]*
3+2]=a[2],j[this.indices[f+2]*3+0]=a[0],j[this.indices[f+2]*3+1]=a[1],j[this.indices[f+2]*3+2]=a[2];this.getAttributeBuffer(g.NORMAL).set(j);this.getIndexBuffer().set(this.indices);j=[];a=this.verts;var h=a[0];b=a[0];e=a[1];f=a[1];for(var k=3;k<a.length;k+=3)h=h<a[k+0]?h:a[k+0],b=b>a[k+0]?b:a[k+0],e=e<a[k+1]?e:a[k+1],f=f>a[k+1]?f:a[k+1];a=h;b-=a;h=f-e;for(f=0;f<this.verts.length;f+=3)j.push((this.verts[f+0]-a)/b,(this.verts[f+1]-e)/h);this.getAttributeBuffer(g.TEXCOORD0).set(j);return this};return b});
define("goo/shapes/Surface",["goo/renderer/MeshData","goo/math/MathUtils"],function(g,c){function b(a,b,c){this.verts=a;this.vertsPerLine=b||2;this.verticallyClosed=!!c;a=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]);b=this.verts.length/3;g.call(this,a,b,(b/this.vertsPerLine-1)*(this.vertsPerLine-1)*6);this.rebuild()}b.prototype=Object.create(g.prototype);b.prototype.rebuild=function(){var a,b,e,f;this.getAttributeBuffer(g.POSITION).set(this.verts);var j=[];a=[];var h=[];e=this.verts.length/3/this.vertsPerLine;
for(f=0;f<e-1;f++){for(b=0;b<this.vertsPerLine-1;b++){var h=(f+0)*this.vertsPerLine+(b+0),k=(f+1)*this.vertsPerLine+(b+0),i=(f+0)*this.vertsPerLine+(b+1);j.push(h,k,i,i,k,(f+1)*this.vertsPerLine+(b+1));h=c.getTriangleNormal(this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2],this.verts[k*3+0],this.verts[k*3+1],this.verts[k*3+2],this.verts[i*3+0],this.verts[i*3+1],this.verts[i*3+2]);a.push(h[0],h[1],h[2])}this.verticallyClosed&&(h=(f+0)*this.vertsPerLine+0,k=(f+1)*this.vertsPerLine+0,i=(f+0)*this.vertsPerLine+
1,h=c.getTriangleNormal(this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2],this.verts[k*3+0],this.verts[k*3+1],this.verts[k*3+2],this.verts[i*3+0],this.verts[i*3+1],this.verts[i*3+2]));a.push(h[0],h[1],h[2])}f--;for(b=0;b<this.vertsPerLine-1;b++)h=(f+0)*this.vertsPerLine+(b+0),k=(f+1)*this.vertsPerLine+(b+0),i=(f+0)*this.vertsPerLine+(b+1),h=c.getTriangleNormal(this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2],this.verts[k*3+0],this.verts[k*3+1],this.verts[k*3+2],this.verts[i*3+0],this.verts[i*
3+1],this.verts[i*3+2]),a.push(h[0],h[1],h[2]);a.push(h[0],h[1],h[2]);this.getAttributeBuffer(g.NORMAL).set(a);this.getIndexBuffer().set(j);j=[];a=this.verts;h=a[0];b=a[0];e=a[1];f=a[1];for(k=3;k<a.length;k+=3)h=h<a[k+0]?h:a[k+0],b=b>a[k+0]?b:a[k+0],e=e<a[k+1]?e:a[k+1],f=f>a[k+1]?f:a[k+1];a=h;b-=a;h=f-e;for(f=0;f<this.verts.length;f+=3)j.push((this.verts[f+0]-a)/b,(this.verts[f+1]-e)/h);this.getAttributeBuffer(g.TEXCOORD0).set(j);return this};b.createFromHeightMap=function(a,c,e){for(var c=c||1,e=
e||1,f=[],g=0;g<a.length;g++)for(var h=0;h<a[g].length;h++)f.push(g*c,h*e,a[g][h]);return new b(f,a[0].length)};return b});
define("goo/shapes/PolyLine",["goo/renderer/MeshData","goo/shapes/Surface"],function(g,c){function b(a,b){this.verts=a;this.closed=!!b;var c=g.defaultMap([g.POSITION]);g.call(this,c,this.verts.length/3,this.verts.length/3);this.indexModes=this.closed?["LineLoop"]:["LineStrip"];this.rebuild()}b.prototype=Object.create(g.prototype);b.prototype.rebuild=function(){this.getAttributeBuffer(g.POSITION).set(this.verts);for(var a=[],b=this.verts.length/3,c=0;c<b;c++)a.push(c);this.getIndexBuffer().set(a);
return this};b.prototype.mul=function(a){if(a instanceof b){for(var d=a.verts.length/3,e=[],f=0;f<this.verts.length;f+=3)for(var g=0;g<a.verts.length;g+=3)e.push(this.verts[f+0]+a.verts[g+0],this.verts[f+1]+a.verts[g+1],this.verts[f+2]+a.verts[g+2]);return new c(e,d)}};b.prototype.pipe=function(a){if(a instanceof b){for(var d=a.verts.length/3,e=[],f=0;f<this.verts.length;f+=3){var g;var h=this.verts,k=f/3,i=h.length/3,l=void 0,m=void 0,o=void 0,p=g=void 0,n=void 0;k===0?(o=h[0],g=h[2],p=h[3],n=h[5],
g=Math.atan2(n-g,p-o)-Math.PI/2):k===i-1?(l=h[(i-2)*3+0],m=h[(i-2)*3+2],o=h[(i-1)*3+0],g=h[(i-1)*3+2],g=Math.atan2(g-m,o-l)-Math.PI/2):(l=h[(k-1)*3+0],m=h[(k-1)*3+2],o=h[k*3+0],g=h[k*3+2],p=h[(k+1)*3+0],n=h[(k+1)*3+2],h=o-l,m=g-m,o=p-o,g=n-g,p=Math.sqrt(h*h+m*m),n=h/p,p=m/p,m=Math.sqrt(o*o+g*g),g=Math.atan2(p+g/m,n+o/m)-Math.PI/2);for(n=0;n<a.verts.length;n+=3)e.push(this.verts[f+0]+a.verts[n+2]*Math.cos(g),this.verts[f+1]+a.verts[n+1],this.verts[f+2]+a.verts[n+2]*Math.sin(g))}return new c(e,d)}else console.error("pipe operation can only be applied to PolyLines")};
b.prototype.lathe=function(a){for(var a=a||8,b=Math.PI*2/a,e=[],f=0;f<this.verts.length;f+=3)for(var g=0,h=0;g<=a;g++,h+=b)e.push(Math.cos(h)*this.verts[f+0],this.verts[f+1],Math.sin(h)*this.verts[f+0]);return new c(e,a+1,!0)};b.prototype.concat=function(a,c){if(a instanceof b)return new b(this.verts.concat(a.verts),c);else console.error("concat operation can only be applied to PolyLines")};b.fromCubicBezier=function(a,c,e){if(a.length!==12)console.error("PolyLine.fromCubicBezier takes an array of exactly 12 coordinates");
else{for(var c=c||16,f=[],g=[],h=[],k=[],i=[],l=[],m=[],e=e||0;e<=c;e++){var o=e/c;g[0]=a[0]+(a[3]-a[0])*o;g[1]=a[1]+(a[4]-a[1])*o;g[2]=a[2]+(a[5]-a[2])*o;h[0]=a[3]+(a[6]-a[3])*o;h[1]=a[4]+(a[7]-a[4])*o;h[2]=a[5]+(a[8]-a[5])*o;k[0]=a[6]+(a[9]-a[6])*o;k[1]=a[7]+(a[10]-a[7])*o;k[2]=a[8]+(a[11]-a[8])*o;i[0]=g[0]+(h[0]-g[0])*o;i[1]=g[1]+(h[1]-g[1])*o;i[2]=g[2]+(h[2]-g[2])*o;l[0]=h[0]+(k[0]-h[0])*o;l[1]=h[1]+(k[1]-h[1])*o;l[2]=h[2]+(k[2]-h[2])*o;m[0]=i[0]+(l[0]-i[0])*o;m[1]=i[1]+(l[1]-i[1])*o;m[2]=i[2]+
(l[2]-i[2])*o;f.push(m[0],m[1],m[2])}return new b(f)}};b.fromCubicSpline=function(a,c,e){if(e){if(a.length%3!==0&&a.length/3%3!==0){console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline");return}e=a.length/3;e/=3;for(var f=b.fromCubicBezier(a.slice(0,12),c,1),g=1;g<e-1;g++)var h=b.fromCubicBezier(a.slice(g*9,g*9+12),c,1),f=f.concat(h);h=b.fromCubicBezier(a.slice(g*9,g*9+9).concat(a.slice(0,3)),c,1);f=f.concat(h)}else{if(a.length%3!==0&&a.length/3%3!==1){console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline");
return}e=a.length/3;e=(e-1)/3;f=b.fromCubicBezier(a.slice(0,12),c,1);for(g=1;g<e;g++)h=b.fromCubicBezier(a.slice(g*9,g*9+12),c,1),f=f.concat(h)}return f};return b});
define("goo/shapes/ProjectedGrid","goo/renderer/MeshData,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/renderer/Camera,goo/math/MathUtils".split(","),function(g,c,b,a,d,e,f){function j(f,k){this.densityX=f!==void 0?f:20;this.densityY=k!==void 0?k:20;this.projectorCamera=new e(45,1,0.1,2E3);this.mainCamera=new e(45,1,0.1,2E3);this.freezeProjector=!1;this.upperBound=20;this.origin=new a;this.direction=new a;this.source=new c;this.rangeMatrix=new d;this.intersectBottomLeft=
new a;this.intersectTopLeft=new a;this.intersectTopRight=new a;this.intersectBottomRight=new a;this.planeIntersection=new b;this.freezeProjector=!1;this.projectorMinHeight=50;this.intersections=[];for(var i=0;i<24;i++)this.intersections.push(new b);this.connections=[0,3,1,2,0,4,1,5,2,6,3,7,4,7,5,6];var i=this.densityX*this.densityY,j=(this.densityX-1)*(this.densityY-1)*6,m=g.defaultMap([g.POSITION,g.TEXCOORD0]);g.call(this,m,i,j);this.rebuild()}j.prototype=Object.create(g.prototype);j.prototype.update=
function(c){var e=this.upperBound,g=this.mainCamera;this.freezeProjector||g.copy(c);c=g.translation;c.y>0&&c.y<e+g.near?g.translation.setd(c.x,e+g.near,c.z):c.y<0&&c.y>-e-g.near&&g.translation.setd(c.x,-e-g.near,c.z);for(var j=g.calculateFrustumCorners(),m=0,o=new b,p=0;p<8;p++){var c=this.connections[p*2],n=this.connections[p*2+1];(j[c].y>e&&j[n].y<e||j[c].y<e&&j[n].y>e)&&this.getWorldIntersectionSimple(e,j[c],j[n],this.intersections[m++],o);(j[c].y>-e&&j[n].y<-e||j[c].y<-e&&j[n].y>-e)&&this.getWorldIntersectionSimple(-e,
j[c],j[n],this.intersections[m++],o)}for(p=0;p<8;p++)j[p].y<e&&j[p].y>-e&&this.intersections[m++].set(j[p]);if(m===0)return!1;e=this.projectorCamera;e.copy(g);if(e.translation.y>0&&e._direction.y>0||e.translation.y<0&&e._direction.y<0)e._direction.y=-e._direction.y,c=new b,c.setv(e._direction).cross(e._left).normalize(),e._up.setv(c);c=this.source;p=this.planeIntersection;c.set(0.5,0.5);this.getWorldIntersection(0,c,e.getViewProjectionInverseMatrix(),p);g=e.translation;g.y>0&&g.y<this.projectorMinHeight*
2?(j=(this.projectorMinHeight*2-g.y)/(this.projectorMinHeight*2),e.translation.setd(g.x,this.projectorMinHeight*2-this.projectorMinHeight*j,g.z)):g.y<0&&g.y>-this.projectorMinHeight*2&&(j=(-this.projectorMinHeight*2-g.y)/(-this.projectorMinHeight*2),e.translation.setd(g.x,-this.projectorMinHeight*2+this.projectorMinHeight*j,g.z));p.subv(e.translation);p.y=0;g=p.length();if(g>Math.abs(e.translation.y))p.normalize(),p.mul(Math.abs(e.translation.y));else if(g<f.EPSILON)p.addv(e._up),p.y=0,p.normalize(),
p.mul(0.1);p.addv(e.translation);p.y=0;e.lookAt(p,b.UNIT_Y);j=e.getViewProjectionMatrix();o=new a;g=this.intersections;for(p=0;p<m;p++)o.set(g[p].x,0,this.intersections[p].z,1),j.applyPost(o),g[p].set(o.x,o.y,0),g[p].div(o.w);for(var j=Number.MAX_VALUE,o=-Number.MAX_VALUE,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,p=0;p<m;p++){if(g[p].x<j)j=g[p].x;if(g[p].x>o)o=g[p].x;if(g[p].y<n)n=g[p].y;if(g[p].y>r)r=g[p].y}m=this.rangeMatrix;m.setIdentity();m.e00=o-j;m.e11=r-n;m.e03=j;m.e13=n;e=e.getViewProjectionInverseMatrix();
d.combine(e,m,m);c.set(0.5,0.5);this.getWorldIntersectionHomogenous(0,c,m,this.intersectBottomLeft);c.set(0.5,1);this.getWorldIntersectionHomogenous(0,c,m,this.intersectTopLeft);c.set(1,1);this.getWorldIntersectionHomogenous(0,c,m,this.intersectTopRight);c.set(1,0.5);this.getWorldIntersectionHomogenous(0,c,m,this.intersectBottomRight);return!0};j.prototype.getWorldIntersectionHomogenous=function(a,b,c,d){this.calculateIntersection(a,b,c);d.setv(this.origin)};j.prototype.getWorldIntersection=function(a,
b,c,d){this.calculateIntersection(a,b,c);d.setd(this.origin.x,this.origin.y,this.origin.z).div(this.origin.w)};j.prototype.getWorldIntersectionSimple=function(a,b,c,d,e){b=d.setv(b);c=e.setv(c).sub(b);a=(a-b.y)/c.y;c.mul(a);b.addv(c);return a>=0&&a<=1};j.prototype.calculateIntersection=function(a,b,c){this.origin.setd(b.x*2-1,b.y*2-1,-1,1);this.direction.setd(b.x*2-1,b.y*2-1,1,1);c.applyPost(this.origin);c.applyPost(this.direction);this.direction.sub(this.origin);Math.abs(this.direction.y)>f.EPSILON?
this.direction.mul((a-this.origin.y)/this.direction.y):(this.direction.normalize(),this.direction.mul(this.mainCamera._frustumFar));this.origin.add(this.direction)};j.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(g.POSITION),b=this.getAttributeBuffer(g.TEXCOORD0),c=this.getIndexBuffer(),d=this.densityX,e=this.densityY,f=0;f<d;f++)for(var j=0;j<e;j++)a[(f+j*d)*3+0]=f,a[(f+j*d)*3+1]=0,a[(f+j*d)*3+2]=j,b[(f+j*d)*2+0]=f/(d-1),b[(f+j*d)*2+1]=j/(e-1);for(b=a=0;b<d*(e-1);b++)b%(d*(Math.floor(b/
d)+1)-1)===0&&b!==0||(c[a++]=b,c[a++]=1+d+b,c[a++]=1+b,c[a++]=b,c[a++]=d+b,c[a++]=1+d+b);return this};return j});define("goo/shapes/RegularPolygon",["goo/renderer/MeshData","goo/shapes/PolyLine"],function(g,c){function b(a,b){this.nSegments=a||5;this.radius=b||1;for(var e=[],f=Math.PI*2/a,g=0,h=0;g<this.nSegments;g++,h+=f)e.push(Math.cos(h)*this.radius,Math.sin(h)*this.radius,0);c.call(this,e,!0);this.rebuild()}b.prototype=Object.create(c.prototype);return b});
define("goo/shapes/SimpleBox",["goo/renderer/MeshData"],function(g){function c(b,a,c){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=c!==void 0?c*0.5:0.5;b=g.defaultMap([g.POSITION]);g.call(this,b,8,36);this.rebuild()}c.prototype=Object.create(g.prototype);c.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,c=this.zExtent;this.getAttributeBuffer(g.POSITION).set([-b,-a,-c,b,-a,-c,b,a,-c,-b,a,-c,-b,-a,c,b,-a,c,b,a,c,-b,a,c]);this.getIndexBuffer().set([0,
1,2,2,3,0,7,6,5,5,4,7,0,3,7,7,4,0,1,2,6,6,5,1,3,2,6,6,7,3,0,1,5,5,4,0]);return this};return c});
define("goo/shapes/Triangle",["goo/renderer/MeshData","goo/math/MathUtils"],function(g,c){function b(a){this.verts=a;a=g.defaultMap([g.POSITION,g.NORMAL]);g.call(this,a,3,3);this.rebuild()}b.prototype=Object.create(g.prototype);b.prototype.rebuild=function(){this.getAttributeBuffer(g.POSITION).set(this.verts);var a=c.getTriangleNormal(this.verts[0],this.verts[1],this.verts[2],this.verts[3],this.verts[4],this.verts[5],this.verts[6],this.verts[7],this.verts[8]);this.getAttributeBuffer(g.NORMAL).set([a[0],
a[1],a[2],a[0],a[1],a[2],a[0],a[1],a[2]]);this.getIndexBuffer().set([0,1,2]);return this};return b});
define("goo/util/ColorUtil",["goo/math/Vector4"],function(g){function c(){}c.arrayToVector4=function(a,b){b=b||new g;b.seta(a);return b};c.hexToArray=function(a,b){b=b||[];a=Math.floor(a);b[0]=(a>>16&255)/255;b[1]=(a>>8&255)/255;b[2]=(a&255)/255;return b};c.arrayToHex=function(a){return a[0]*255<<16^a[1]*255<<8^a[2]*255<<0};c.arrayToHexString=function(a){return("000000"+c.arrayToHex(a).toString(16)).slice(-6)};var b=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,a=/^rgb\(\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*\)$/i,
d=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,e=/^\#([0-9a-f]{6})$/i,f=/^(\w+)$/i;c.cssToArray=function(g,h){h=h||[];if(b.test(g)){var k=b.exec(g);h[0]=Math.min(255,parseInt(k[1],10))/255;h[1]=Math.min(255,parseInt(k[2],10))/255;h[2]=Math.min(255,parseInt(k[3],10))/255;return h}if(a.test(g))return k=a.exec(g),h[0]=Math.min(100,parseInt(k[1],10))/100,h[1]=Math.min(100,parseInt(k[2],10))/100,h[2]=Math.min(100,parseInt(k[3],10))/100,h;if(e.test(g))return k=e.exec(g),this.hexToArray(parseInt(k[1],16),h);if(d.test(g))return k=
d.exec(g),this.hexToArray(parseInt(k[1]+k[1]+k[2]+k[2]+k[3]+k[3],16),h);if(f.test(g))return this.hexToArray(c.color[g],h);console.warn("No matching style found");h[0]=h[1]=h[2]=0;return h};c.HSLToArray=function(a,b,c,d){d=d||[];if(b===0)d[0]=d[1]=d[2]=c;else{var e=function(a,b,c){c<0&&(c+=1);c>1&&(c-=1);return c<1/6?a+(b-a)*6*c:c<0.5?b:c<2/3?a+(b-a)*6*(2/3-c):a},b=c<=0.5?c*(1+b):c+b-c*b,c=2*c-b;d[0]=e(c,b,a+1/3);d[1]=e(c,b,a);d[2]=e(c,b,a-1/3)}return d};c.arrayToHSL=function(a,b){var b=b||[],c=a[0],
d=a[1],e=a[2],f=Math.max(c,d,e),g=Math.min(c,d,e),p,n=(g+f)/2;if(g===f)g=p=0;else{var r=f-g,g=n<=0.5?r/(f+g):r/(2-f-g);switch(f){case c:p=(d-e)/r+(d<e?6:0);break;case d:p=(e-c)/r+2;break;case e:p=(c-d)/r+4}p/=6}b[0]=p;b[1]=g;b[2]=n;return b};c.HSBToArray=function(a,b,c,d){var d=d||[],e=0,f=0,g=0;if(b===0)e=f=g=c;else{var a=(a-Math.floor(a))*6,p=a-Math.floor(a),n=c*(1-b),r=c*(1-b*p),b=c*(1-b*(1-p));switch(a){case 0:e=c;f=b;g=n;break;case 1:e=r;f=c;g=n;break;case 2:e=n;f=c;g=b;break;case 3:e=n;f=r;
g=c;break;case 4:e=b;f=n;g=c;break;case 5:e=c,f=n,g=r}}d[0]=e;d[1]=f;d[2]=g;return d};c.arrayToHSB=function(a,b){var b=b||[],c=a[0],d=a[1],e=a[2],f,g=c>d?c:d;e>g&&(g=e);var p=c<d?c:d;e<p&&(p=e);f=g!==0?(g-p)/g:0;if(f===0)c=0;else{var n=(g-c)/(g-p),r=(g-d)/(g-p),e=(g-e)/(g-p),c=c===g?e-r:d===g?2+n-e:4+r-n;c/=6;c<0&&(c+=1)}b[0]=c;b[1]=f;b[2]=g/255;return b};c.arrayToCSS=function(a){return"rgb("+(a[0]*255|0)+","+(a[1]*255|0)+","+(a[2]*255|0)+")"};c.color={aliceblue:15792383,antiquewhite:16444375,aqua:65535,
aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,
darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,
indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,
maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,
papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,
white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};return c});define("goo/util/ConsoleUtil",["goo/util/ObjectUtil"],function(g){var c={},b=null,a=["debug","log","info","warn","error"],d=function(){};c.setLogLevel=function(e){var f,j;b==null&&(b=g.clone(window.console));c.clearLogLevel();for(j=0;j<a.length;j++){f=a[j];if(f===e)break;window.console[f]=d}};c.clearLogLevel=function(){var c,d;if(b)for(d=0;d<a.length;d++)c=a[d],window.console[c]=b[c]};return c});
define("goo/util/DebugDraw",[],function(){function g(){}g.prototype.countDown=function(){};return g});
define("goo/util/Promise",[],function(){function g(){this._state="pending";this._resolved=[];this._rejected=[];this._always=[]}g.prototype.then=function(c,b){c&&c!==null&&this._resolved.push(c);b&&b!==null&&this._rejected.push(b);return this};g.prototype.done=function(c){this._state==="pending"?this.then(c):this._state==="resolved"&&c(this._data);return this};g.prototype.fail=function(c){this._state==="pending"?this.then(null,c):this._state==="rejected"&&c(this._data);return this};g.prototype.always=
function(c){typeof c!=="undefined"&&c!==null&&(this._state==="pending"?this._always.push(c):c(this._data));return this};return g});
define("goo/util/Deferred",["goo/util/Promise"],function(g){function c(b){this._promise=b||new g}c.prototype.promise=function(){return this._promise};c.prototype.resolve=function(b){if(this._promise._state==="pending")this._promise._data=b,this._promise._resolved.every(function(a){a(b);return!0}),this._promise._always.every(function(a){a(b);return!0}),this._promise._state="resolved";return this._promise};c.prototype.reject=function(b){if(this._promise._state==="pending")this._promise._data=b,this._promise._rejected.every(function(a){if(b instanceof
Error)throw b;a(b);return!0}),this._promise._always.every(function(a){a(b);return!0}),this._promise._state="rejected";return this._promise};c.prototype.then=function(b,a){return this._promise.then(b,a)};c.prototype.done=function(b){return this._promise.done(b)};c.prototype.fail=function(b){return this._promise.fail(b)};c.prototype.always=function(b){return this._promise.always(b)};c.when=function(){var b=Array.prototype.slice.call(arguments),a=b.length,d=a,e=new c,f=[],g=function(a,b){return function(c){b[a]=
c;--d<=0&&e.resolve(b)}};if(a>0){var a=function(a){e.reject(a)},h;for(h in b)b[h]&&Object.prototype.toString.call(b[h].constructor)==="[object Function]"?b[h].done(g(h,f)).fail(a):--d}d||e.resolve(f);return e.promise()};return c});
define("goo/util/FastBuilder",["goo/renderer/MeshData","goo/math/Vector3"],function(g,c){function b(a,b,c){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);this.callback=c||{progress:function(){},done:function(){}};this.meshDatas=[];this.dataCounter=0;for(c=b;;){var j=Math.floor(65535/a.vertexCount),j=Math.min(j,b),h=a.vertexCount*j,k=a.indexCount*j,i={},l;for(l in a.attributeMap){var m=a.attributeMap[l];i[l]={count:m.count,type:m.type,
stride:m.stride,offset:m.offset,normalized:m.normalized}}h=new g(i,h,k);c-=j;this.meshDatas.push(h);if(c<=0)break}this.indexCounter=this.vertexCounter=0;this.callback.progress(0)}var a=new c;b.prototype.addMeshData=function(b,c){if(b.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+b.vertexCount);else if(this.vertexCounter+b.vertexCount>=65536)this.dataCounter++,this.vertexData={},this.indexData=[],this.indexCounter=this.vertexCounter=0,this.callback.progress(this.dataCounter/
(this.meshDatas.length-1));var f=this.meshDatas[this.dataCounter],j=b.attributeMap,h;for(h in j){var k=this.vertexCounter*j[h].count,i=b.getAttributeBuffer(h),l=i.length,m=f.getAttributeBuffer(h);if(h===g.POSITION)for(var o=0;o<l;o+=3)a.setd(i[o+0],i[o+1],i[o+2]),c.matrix.applyPostPoint(a),m[k+o+0]=a.data[0],m[k+o+1]=a.data[1],m[k+o+2]=a.data[2];else if(h===g.NORMAL)for(o=0;o<l;o+=3)a.setd(i[o+0],i[o+1],i[o+2]),c.rotation.applyPost(a),m[k+o+0]=a.data[0],m[k+o+1]=a.data[1],m[k+o+2]=a.data[2];else if(h===
g.TANGENT)for(o=0;o<l;o+=3)a.setd(i[o+0],i[o+1],i[o+2]),c.rotation.applyPost(a),m[k+o+0]=a.data[0],m[k+o+1]=a.data[1],m[k+o+2]=a.data[2];else for(o=0;o<l;o++)m[k+o]=i[o]}j=b.getIndexBuffer();m=f.getIndexBuffer();o=0;for(f=b.indexCount;o<f;o++)m[this.indexCounter+o]=j[o]+this.vertexCounter;this.vertexCounter+=b.vertexCount;this.indexCounter+=b.indexCount};b.prototype.build=function(){this.callback.done();return this.meshDatas};return b});
define("goo/util/Grid","goo/entities/Entity,goo/entities/EntityUtils,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/shapes/ShapeCreator,goo/renderer/shaders/ShaderLib,goo/renderer/Util".split(","),function(g,c,b,a,d,e,f,j,h,k){function i(d,f){f=f||{};this.topEntity=d.createEntity(this.name);f.floor&&this.topEntity.transformComponent.transform.rotation.rotateX(-Math.PI/2);if(f.surface){var g=
j.createQuad(f.width,f.height),g=c.createTypicalEntity(d,g),i=e.createMaterial(h.simpleLit);i.uniforms.materialDiffuse=f.surfaceColor||[1,1,1,1];i.depthState={writable:!1,enabled:!1};i.renderQueue=9;g.meshRendererComponent.materials.push(i);this.topEntity.transformComponent.attachChild(g.transformComponent)}this.gridShader=this._buildGridShader(f);if(!f.grids)f.grids=[];f.grids.length===0&&f.grids.push(k.clone(l));this.grids=f.grids;for(var r,t=0;t<f.grids.length;t++)i=f.grids[t],this._fillDefaults(i,
l),i._width=f.width||1,i._height=f.height||1,g=d.createEntity("grid_"+t),g.setComponent(new b(this._buildGrid(i))),r=new a,r.materials.push(this._buildGridMaterial(i,t)),g.setComponent(r),this.topEntity.transformComponent.attachChild(g.transformComponent)}var l={stepX:1,stepY:1,color:[0,0,0,1],width:1};i.prototype.addToWorld=function(){c.traverse(this.topEntity,function(a){a.addToWorld()})};i.prototype._collides=function(a,b,c){for(var c="step"+c,d=0;d<this.grids.length;d++){if(a===this.grids[d])break;
if(b%this.grids[d][c]===0)return!0}return!1};i.prototype._buildGrid=function(a){var b=Math.ceil(a._width/a.stepX),c=Math.ceil(a._height/a.stepY),e=a._width/2,f=a._height/2,g=[],h=[];a===this.grids[0]&&(g.push(-e,-f,0,-e,f,0,e,f,0,e,-f,0),h.push(0,1,1,2,2,3,3,0));for(var i,j=1;j<b;j++)i=a.stepX*j,this._collides(a,i,"X")||(i-=e,g.push(i,-f,0,i,f,0));for(j=1;j<c;j++)b=a.stepY*j,this._collides(a,b,"Y")||(b-=f,g.push(-e,b,0,e,b,0));for(j=h.length/2;j<g.length/3;j+=2)h.push(j,j+1);a=new d(d.defaultMap([d.POSITION]),
g.length,h.length);a.getAttributeBuffer(d.POSITION).set(g);a.getIndexBuffer().set(h);a.indexModes[0]="Lines";return a};i.prototype._buildGridMaterial=function(a,b){var c=new e("GridMaterial_"+b);if(this.gridShader)c.shader=this.gridShader;c.uniforms.color=a.color;c.lineWidth=a.width;c.depthState={enabled:!1,write:!1};c.renderQueue=10+b;return c};i.prototype._fillDefaults=function(a,b){for(var c in b)a[c]===void 0&&(a[c]=typeof b[c]==="array"||b[c]instanceof Object?k.clone(b[c]):b[c])};i.prototype._buildGridShader=
function(a){return e.createShader({attributes:{vertexPosition:d.POSITION},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,color:[0,0,0,1],fogOn:a.fogOn||!1,fogColor:a.fogColor||[0,0,0,1],fogNear:f.MAIN_NEAR_PLANE,fogFar:a.fogFar||f.MAIN_FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 worldMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nvarying float depth;\nvoid main(void)\n{\nvec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\ndepth = viewPosition.z;\ngl_Position = projectionMatrix * viewPosition;\n}",
fshader:"precision mediump float;\nuniform vec4 fogColor;\nuniform vec4 color;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogOn;\nvarying float depth;\nvoid main(void)\n{\nif (fogOn) {\nfloat lerpVal = clamp(depth / (-fogFar - fogNear), 0.0, 1.0);\nlerpVal = pow(lerpVal, 0.4);\ngl_FragColor = mix(color, fogColor, lerpVal);\n} else {\ngl_FragColor = color;\n}\n}"},"Grid Shader")};return i});
define("goo/util/NoWebGL",["goo/util/Logo"],function(g){function c(b){this.template=c.templates[b]?c.templates[b]:c.templates.standard}c.prototype.upgradeLocation="http://goodemos.com/recommended.html";c.prototype.gooLocation="http://gooengine.com";c.templates={};c.templates.standard={};c.templates.standard.css="#unsupportedBrowser {z-index: 10000;position: absolute;top: 0;left: 0;width: 100%;background: #1c1c1c;border-top: 1px solid #2a3276;font-family: Helvetica Neue, Helvetica, sans-serif;font-size: 90%;line-height: 145%;}#unsupportedBrowser a.button {-webkit-border-radius: 18px;-moz-border-radius: 18px;-o-border-radius: 18px;border-radius: 18px;margin: 5px 20px 0 0;text-align: left;padding: 10px 25px;color: #1d1d1d;font-weight: 600;font-style: italic;display: inline-block;text-shadow: 0px 1px 1px #8372da;filter: dropshadow(color=#02c2df, offx=0, offy=1);-moz-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-o-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-webkit-box-shadow: inset 1px 1px 2px 0 #a9b1fd;box-shadow: inset 1px 1px 2px 0 #a9b1fd;background: #2a3276;background-image: -ms-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -moz-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -o-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #2a3276), color-stop(1, #6b7aff));background-image: -webkit-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: linear-gradient(top, #2a3276 0%, #6b7aff 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#2a3276\", endColorstr=\"#6b7aff\");}#unsupportedBrowser a.button:hover {-moz-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-o-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-webkit-box-shadow: inset 3px 3px 5px 0 #a9b1fd;box-shadow: inset 3px 3px 5px 0 #a9b1fd;background: #6b7aff;background-image: -ms-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -moz-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -o-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #6b7aff), color-stop(1, #2a3276));background-image: -webkit-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: linear-gradient(top, #6b7aff 0%, #2a3276 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#6b7aff', endColorstr='#2a3276'); }#unsupportedBrowser > svg {margin-top: 5px;}#unsupportedBrowser > .logo {background-image: -moz-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -webkit-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -o-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -ms-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);}#unsupportedBrowser > .content {color: #9f9f9f;max-width: 700px;margin-left: 120px;margin-right: 20px;padding-top: 1em;}#unsupportedBrowser p {margin: 0 0 25px 0;}#unsupportedBrowser h1 {display: inline-block;max-width: 600px;margin: 13px 0 25px 20px;color: #f1eee5;vertical-align: top;font-weight: normal}";
c.templates.standard.html='<div class="logo"><a href="http://gooengine.com">'+g.getLogo({color:g.white,shadow:!0,width:"100px",height:"70px"})+'</a><h1>Whoopsie daisy!</h1></div><div class="content"><p>Your browser doesn\'t seem to support HTML5 and WebGL. The best thing to do is upgrade to a modern browser that supports all the awesome things the web has to offer.</p><p><a data-upgrade class="button" href="">Upgrade my browser!</a><a data-close class="button" href="">Not now</a></p></div>';c.prototype.show=
function(){var b=document.createElement("div");b.innerHTML=this.template.html;b.setAttribute("id","unsupportedBrowser");var a=document.createElement("style");a.type="text/css";a.setAttribute("id","unsupportedBrowserStyles");a.stylesheet?a.stylesheet.cssText=this.template.css:a.appendChild(document.createTextNode(this.template.css));document.head.appendChild(a);document.body.appendChild(b);var a=b.querySelector("[data-close]"),c=function(a){a.preventDefault();a.stopPropagation();document.location.href=
this.gooLocation;document.body.removeChild(document.querySelector("div#unsupportedBrowser"));document.head.removeChild(document.querySelector("#unsupportedBrowserStyles"))}.bind(this);a.addEventListener("click",c);b=b.querySelector("[data-upgrade]");a=function(a){a.preventDefault();a.stopPropagation();document.location.href=this.upgradeLocation}.bind(this);b.addEventListener("click",a)};c.prototype.addTemplate=function(b,a){c.templates[b]?console.error("Template "+b+" already exists"):c.templates[b]=
a};return c});define("goo/util/Rc4Random",[],function(){return function(g){var c=[],b=0,a=0;(function(a){for(var b=0;b<256;b++)c[b]=b;for(var f=0,b=0;b<256;b++){var f=(f+c[b]+a.charCodeAt(b%a.length))%256,g=c[b];c[b]=c[f];c[f]=g}})(g);this.getRandomNumber=function(){for(var d=0,e=1,f=0;f<8;f++){b=(b+1)%256;a=(a+c[b])%256;var g=c[b];c[b]=c[a];c[a]=g;d+=c[(c[b]+c[a])%256]*e;e*=256}return d/1.8446744073709552E19}}});
define("goo/util/URLTools",[],function(){function g(){}g.getDirectory=function(c){var b=/.*\//.exec(c);return!b?c+"/":b[0]};return g});require("goo/addons/box2d/components/Box2DComponent,goo/addons/box2d/systems/Box2DSystem,goo/addons/cannon/components/CannonjsComponent,goo/addons/cannon/systems/CannonjsSystem,goo/addons/howler/components/HowlerComponent,goo/addons/howler/systems/HowlerSystem,goo/addons/scripts/PolyBoundingScript,goo/addons/soundmanager2/components/SoundManager2Component,goo/addons/soundmanager2/systems/SoundManager2System,goo/addons/terrain/Terrain,goo/addons/water/FlatWaterRenderer,goo/addons/water/ProjectedGridWaterRenderer,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ClipSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/clip/AbstractAnimationChannel,goo/animation/clip/AnimationClip,goo/animation/clip/AnimationClipInstance,goo/animation/clip/InterpolatedFloatChannel,goo/animation/clip/JointChannel,goo/animation/clip/JointData,goo/animation/clip/TransformChannel,goo/animation/clip/TransformData,goo/animation/clip/TriggerChannel,goo/animation/clip/TriggerData,goo/animation/layer/AnimationLayer,goo/animation/layer/LayerLERPBlender,goo/animation/state/AbstractState,goo/animation/state/AbstractTransitionState,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/SteadyState,goo/animation/state/SyncFadeTransitionState,goo/debug/Debugger,goo/debug/EntityCounter,goo/debug/components/MarkerComponent,goo/debug/systems/MarkerSystem,goo/entities/Entity,goo/entities/EntityUtils,goo/entities/EventHandler,goo/entities/GooRunner,goo/entities/World,goo/entities/components/AnimationComponent,goo/entities/components/CSSTransformComponent,goo/entities/components/CameraComponent,goo/entities/components/CameraDebugComponent,goo/entities/components/Component,goo/entities/components/LightComponent,goo/entities/components/LightDebugComponent,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/ParticleComponent,goo/entities/components/PortalComponent,goo/entities/components/ScriptComponent,goo/entities/components/TextComponent,goo/entities/components/TransformComponent,goo/entities/managers/DebugManager,goo/entities/managers/EntityManager,goo/entities/managers/LightManager,goo/entities/systems/AnimationSystem,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/CSSTransformSystem,goo/entities/systems/CameraDebugSystem,goo/entities/systems/CameraSystem,goo/entities/systems/LightDebugSystem,goo/entities/systems/LightingSystem,goo/entities/systems/ParticlesSystem,goo/entities/systems/PickingSystem,goo/entities/systems/PortalSystem,goo/entities/systems/RenderSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/System,goo/entities/systems/TextSystem,goo/entities/systems/TransformSystem,goo/loaders/BundleLoader,goo/loaders/DynamicLoader,goo/loaders/EntityLoader,goo/loaders/JsonUtils,goo/loaders/Loader,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/SceneLoader,goo/loaders/ScriptLoader,goo/loaders/ShaderLoader,goo/loaders/SkeletonLoader,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/loaders/handlers/AnimationClipHandler,goo/loaders/handlers/AnimationComponentHandler,goo/loaders/handlers/AnimationLayersHandler,goo/loaders/handlers/CameraComponentHandler,goo/loaders/handlers/ComponentHandler,goo/loaders/handlers/ConfigHandler,goo/loaders/handlers/EntityHandler,goo/loaders/handlers/LightComponentHandler,goo/loaders/handlers/MaterialHandler,goo/loaders/handlers/MeshDataComponentHandler,goo/loaders/handlers/MeshDataHandler,goo/loaders/handlers/MeshRendererComponentHandler,goo/loaders/handlers/SceneHandler,goo/loaders/handlers/ShaderHandler,goo/loaders/handlers/SkeletonHandler,goo/loaders/handlers/TextureHandler,goo/loaders/handlers/TransformComponentHandler,goo/loaders/tga/TgaLoader,goo/math/MathUtils,goo/math/Matrix,goo/math/Matrix2x2,goo/math/Matrix3x3,goo/math/Matrix4x4,goo/math/Plane,goo/math/Quaternion,goo/math/Ray,goo/math/Transform,goo/math/Vector,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Versor,goo/noise/Noise,goo/noise/ValueNoise,goo/particles/Particle,goo/particles/ParticleEmitter,goo/particles/ParticleInfluence,goo/particles/ParticleUtils,goo/picking/BoundingTree,goo/picking/PrimitivePickLogic,goo/renderer/BufferData,goo/renderer/BufferUtils,goo/renderer/Camera,goo/renderer/Material,goo/renderer/MeshData,goo/renderer/RenderQueue,goo/renderer/Renderer,goo/renderer/RendererRecord,goo/renderer/Shader,goo/renderer/ShaderCall,goo/renderer/SimplePartitioner,goo/renderer/Texture,goo/renderer/TextureCreator,goo/renderer/Util,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume,goo/renderer/light/DirectionalLight,goo/renderer/light/Light,goo/renderer/light/PointLight,goo/renderer/light/SpotLight,goo/renderer/pass/BloomPass,goo/renderer/pass/BlurPass,goo/renderer/pass/Composer,goo/renderer/pass/DOFPass,goo/renderer/pass/DepthPass,goo/renderer/pass/DoGPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/FullscreenUtil,goo/renderer/pass/NesPass,goo/renderer/pass/RenderPass,goo/renderer/pass/RenderTarget,goo/renderer/pass/SSAOPass,goo/renderer/shaders/ShaderBuilder,goo/renderer/shaders/ShaderFragment,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler,goo/scripts/BasicControlScript,goo/scripts/HeightMapBoundingScript,goo/scripts/MouseLookControlScript,goo/scripts/OrbitCamControlScript,goo/scripts/OrbitNPanControlScript,goo/scripts/RotationControlScript,goo/scripts/SplineInterpolator,goo/scripts/WASDControlScript,goo/shapes/Box,goo/shapes/Cylinder,goo/shapes/Disk,goo/shapes/FilledPolygon,goo/shapes/PolyLine,goo/shapes/ProjectedGrid,goo/shapes/Quad,goo/shapes/RegularPolygon,goo/shapes/ShapeCreator,goo/shapes/SimpleBox,goo/shapes/Sphere,goo/shapes/Surface,goo/shapes/TextureGrid,goo/shapes/Torus,goo/shapes/Triangle,goo/util/Ajax,goo/util/ArrayUtil,goo/util/ColorUtil,goo/util/ConsoleUtil,goo/util/DebugDraw,goo/util/Deferred,goo/util/Enum,goo/util/FastBuilder,goo/util/FrustumViewer,goo/util/GameUtils,goo/util/Grid,goo/util/Handy,goo/util/Latch,goo/util/LightPointer,goo/util/Logo,goo/util/MeshBuilder,goo/util/NoWebGL,goo/util/ObjectUtil,goo/util/Promise,goo/util/PromiseUtil,goo/util/Rc4Random,goo/util/SimpleResourceUtil,goo/util/Skybox,goo/util/Stats,goo/util/StringUtil,goo/util/TangentGenerator,goo/util/URLTools,goo/util/rsvp".split(","));
define("req_temp",function(){});
}; if(window.localStorage&&window.localStorage.gooPath){ require.config({ paths: { goo: localStorage.gooPath } }); }else f(); })(window);